{
    "version": "https://jsonfeed.org/version/1",
    "title": "æ…•é’ã®è¿·é€”",
    "description": "æ—¶é›¨ç—…é‡ç—‡æ‚£è€…ï¼ï¼ï¼",
    "home_page_url": "https://cecilia.cool",
    "items": [
        {
            "id": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(6)-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/",
            "url": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(6)-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/",
            "title": "Mybatis(6)--åŠ¨æ€ä»£ç†",
            "date_published": "2022-10-19T08:01:45.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<blockquote>\n<p>è¯·å…ˆå­¦ä¹  Java åå°„éƒ¨åˆ†</p>\n</blockquote>\n<h2 id=\"é™æ€ä»£ç†\"><a class=\"anchor\" href=\"#é™æ€ä»£ç†\">#</a> é™æ€ä»£ç†</h2>\n<p>ä¸€æ–¹æä¾›æ¥å£å®šä¹‰è¡Œä¸ºï¼Œå¹¶å®ç°è¡Œä¸ºçš„åŸºæœ¬æ“ä½œã€‚ä»£ç†æ–¹åœ¨æ‰§è¡Œè¯¥è¡Œä¸ºæ—¶ï¼Œå¯ä»¥åŠ å…¥è‡ªå·±çš„è¡Œä¸ºè¿›å»ã€‚è¿™æ ·éœ€è¦æå‰çŸ¥é“æ¥å£çš„å®šä¹‰å¹¶è¿›è¡Œå®ç°æ‰å¯ä»¥å®Œæˆä»£ç†ã€‚è€Œ Mybatis è¿™æ ·çš„æ˜¯æ— æ³•é¢„çŸ¥ä»£ç†æ¥å£çš„ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°åŠ¨æ€ä»£ç†ã€‚</p>\n<blockquote>\n<p>JDK æä¾›çš„åå°„æ¡†æ¶å°±ä¸ºæˆ‘ä»¬å¾ˆå¥½åœ°è§£å†³äº†åŠ¨æ€ä»£ç†çš„é—®é¢˜ã€‚</p>\n</blockquote>\n<p>åœ¨ä½¿ç”¨ Mybatis çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åªå®šä¹‰ä¸€ä¸ª XxxMaper æ¥å£ï¼Œç„¶åç›´æ¥åˆ©ç”¨è¿™ä¸ªæ¥å£å®šä¹‰çš„æŠ½è±¡æ–¹æ³•æ¥è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼ŒMybatis å†…éƒ¨å®é™…ä¸Šåˆ©ç”¨äº†åŠ¨æ€ä»£ç†æŠ€æœ¯å¸®æˆ‘ä»¬ç”Ÿæˆäº†è¿™ä¸ªæ¥å£çš„ä»£ç†ç±»ã€‚</p>\n<h1 id=\"åŠ¨æ€ä»£ç†\"><a class=\"anchor\" href=\"#åŠ¨æ€ä»£ç†\">#</a> åŠ¨æ€ä»£ç†</h1>\n<p>æˆ‘ä»¬å¸¦ç€ 2 ä¸ªé—®é¢˜æ¥è¿›è¡Œæºç åˆ†æï¼š</p>\n<ul>\n<li>\n<p>åŠ¨æ€ä»£ç†ç±»æ˜¯å¦‚ä½•ç”Ÿæˆçš„</p>\n</li>\n<li>\n<p>åŠ¨æ€ä»£ç†ç±»æ˜¯å¦‚ä½•å¯¹æ–¹æ³•è¿›è¡Œæ‹¦æˆªçš„</p>\n</li>\n</ul>\n<h2 id=\"ç”Ÿæˆæ—¶æœº\"><a class=\"anchor\" href=\"#ç”Ÿæˆæ—¶æœº\">#</a> ç”Ÿæˆæ—¶æœº</h2>\n<p>è®©æˆ‘ä»¬å…ˆå›åˆ°ä½¿ç”¨ xml æ˜ å°„æ¥å£çš„é˜¶æ®µï¼ˆå°±æ˜¯å¿˜æ‰æ³¨è§£å¼€å‘ï¼‰ï¼Œæ‰“å¼€ä¸€ä¸ª web ç¨‹åºï¼Œå› ä¸ºèµ„æºæ–‡ä»¶ä¸€èˆ¬éƒ½æ”¾åœ¨ <code>resources</code>  æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ‰€ä»¥æ˜ å°„æ¥å£çš„ xml æ–‡ä»¶ä¹Ÿæ”¾åœ¨é‡Œé¢ã€‚</p>\n<p>æ€»ä½“å¦‚å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/19/a39d795cee468fd8.jpg\" alt=\"\" /></p>\n<p>å†å°†æ˜ å°„æ¥å£çš„ xml æ–‡ä»¶é…ç½®åˆ° <code>mybatis-config.xml</code>  é‡Œé¢å³å¯ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mappers/Mapper-config.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æœ€ååœ¨ä¸»å‡½æ•°é‡Œè¿è¡Œï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">SqlUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">Mapper</span> mapper <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// ç»“æœï¼šorg.apache.ibatis.binding.MapperProxy@318ba8c8</span></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œé€šè¿‡è°ƒç”¨ <code>getMapper(Class&lt;T&gt;)</code> ï¼ŒMybatis ä¸ºæˆ‘ä»¬åŠ¨æ€ç”Ÿæˆäº†ä¸€ä¸ªæ¥å£çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œç°åœ¨æˆ‘æ›´æ”¹ä¸€ä¸ªå°åœ°æ–¹è®©ç¨‹åºæŠ¥ä¸ªé”™ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.mappers.Mappe<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†æ¥å£çš„å…¨ç±»è·¯å¾„åæ•…æ„å†™é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‹™åŠ£çš„é”™è¯¯ï¼Œåœ¨ IDEA é‡Œé¢ <code>selectStudent</code>  ç”šè‡³ä¼šçˆ†çº¢ã€‚</p>\n<p>æŠ¥çš„é”™è¯¯å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Exception</span> in thread <span class=\"token string\">\"main\"</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>binding<span class=\"token punctuation\">.</span></span>BindingException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Type</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>cyan<span class=\"token punctuation\">.</span>mappers<span class=\"token punctuation\">.</span></span>Mapper</span> is not known <span class=\"token keyword\">to</span> <span class=\"token namespace\">the</span> <span class=\"token class-name\">MapperRegistry</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tat <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>binding<span class=\"token punctuation\">.</span></span>MapperRegistry</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MapperRegistry</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">47</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tat <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span></span>Configuration</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">745</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><blockquote>\n<p>æˆ‘ä¸æ˜¯ç›´æ¥å¸¦ä½ ç‚¹å…¥æºç æŸ¥çœ‹ï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸ªé”™è¯¯ä»ä¸­åˆ‡å…¥ï¼Œç”¨å¿ƒè‰¯è‹¦ï¼Œè‡ªæˆ‘æ„ŸåŠ¨ ingã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æŠ¥é”™çš„ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Type interface com.cyan.mappers.Mapper is not known to the MapperRegistry.</pre></td></tr></table></figure><p>æˆ‘ä»¬å¸Œæœ›åŠ¨æ€ä»£ç†ä¸€ä¸ª <code>Mapper</code>  çš„å®ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯ <code>Mybatis</code>  è¯´è¿™ä¸ªæ¥å£çš„å…¨ç±»è·¯å¾„å¯¹äº <code>MapperRegister</code>  æ˜¯ä¸çŸ¥é“çš„ã€‚</p>\n<p>é€šè¿‡æŠ¥é”™çš„å®šä½ç‚¹è¿›å»ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/19/8d8b3ba43b87a522.jpg\" alt=\"\" /></p>\n<p>æˆ‘ä»¬å®šä½æ‰¾åˆ°äº†è¿™æ®µä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å› ä¸ºåšå®¢å±•ç¤ºé—®é¢˜ï¼Œç¼©å¯èƒ½å’Œæºç ä¸ä¸€æ ·</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">addMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">isInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasMapper</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BindingException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Type \"</span> <span class=\"token operator\">+</span> type <span class=\"token operator\">+</span> <span class=\"token string\">\" is already known to the MapperRegistry.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">// ... </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// ç°åœ¨æ²¡å¿…è¦ç ”ç©¶å…·ä½“çš„ä»£ç ç»†èŠ‚</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ˜¯ <code>MapperRegister</code>  ç±»çš„ä»£ç ï¼Œçœ‹ <code>throw</code>  æŠ›å‡ºçš„å¼‚å¸¸æ­£æ˜¯æ§åˆ¶å°æ˜¾ç¤ºçš„å¼‚å¸¸ã€‚</p>\n<ul>\n<li><code>addMapper</code>  å°† mybatis è§£æé…ç½®æ–‡ä»¶æ—¶ï¼Œå°†éœ€è¦ç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„æ¥å£æ³¨å†Œåˆ°å…¶ä¸­ã€‚</li>\n<li><code>getMapper</code>  å°±æ˜¯ç”¨äºåˆ›å»ºæ¥å£çš„åŠ¨æ€ç±»ã€‚</li>\n</ul>\n<p>æ­£æ˜¯å› ä¸ºæ— æ³•å°†æ¥å£æ³¨å†Œåˆ° <code>MapperRegister</code>  æ‰ä¼šå‡ºé”™ã€‚</p>\n<h3 id=\"åº•å±‚æºç \"><a class=\"anchor\" href=\"#åº•å±‚æºç \">#</a> åº•å±‚æºç </h3>\n<p>ç°åœ¨ä» <code>sqlSession.getMapper(Class&lt;T&gt;)</code>  é‡Œé¢æŸ¥çœ‹æºç ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/19/65e8fe8ce6574d26.jpg\" alt=\"\" /></p>\n<p>æŸ¥çœ‹ä¸€ä¸‹å®ç°ç±»çš„ <code>getMapper</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DefaultSqlSession</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SqlSession</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Configuration</span> configuration<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// å°†å®é™…çš„ getmapper äº¤ç»™ Configuration å¤„ç†</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// å¹¶ä¸”ä¼ é€’ this--SqlSeesion å‚æ•°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> configuration<span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶å®ï¼Œ <code>Configuration</code>  ä¹Ÿæ˜¯äº¤ç»™ <code>MapperRegister</code>  æ‰§è¡Œçš„ï¼Œå¹¶ä¸”å°† <code>SqlSession</code>  äº†ä¸‹å»ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Configuration</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">MapperRegistry</span> mapperRegistry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapperRegistry</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">void</span> <span class=\"token function\">addMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      mapperRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapper</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»º</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> type<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SqlSession</span> sqlSession<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token keyword\">return</span> mapperRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> sqlSession<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>äºæ˜¯ï¼Œæœ€ç»ˆåˆå›åˆ°äº† <code>MapperRegister</code>  è¿™ä¸ªç±»ä¸Šï¼Œæˆ‘ä»¬ç°åœ¨çœ‹ä¸€ä¸‹æºç ï¼ˆå†…å« <code>getMapper()</code>  æ–¹æ³•ï¼‰ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MapperRegistry</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Configuration</span> config<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token comment\">// ç”¨äºç»´æŠ¤æ‰€æœ‰è¦ç”ŸæˆåŠ¨æ€ä»£ç†ç±» XxxMapper æ˜ å°„å…³ç³»ï¼Œ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">//key å°±æ˜¯è¦ç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„ Class å¯¹è±¡ï¼Œvalue æ˜¯çœŸæ­£ç”ŸæˆåŠ¨æ€ä»£ç†çš„å·¥å‚ç±»</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Class</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MapperProxyFactory</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> knownMappers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      \t\t\t\t\t\t\t\t     <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Class</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MapperProxyFactory</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">T</span> <span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> type<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SqlSession</span> sqlSession<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// è·å–åˆ›å»ºåŠ¨æ€ä»£ç†çš„å·¥å‚å¯¹è±¡ MapperProxyFactory</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">MapperProxyFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> mapperProxyFactory <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MapperProxyFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        \t\t\t\t\t\t\t\t\t\t\t\t\tknownMappers<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mapperProxyFactory <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// æŠ›å‡ºä¹‹å‰æ§åˆ¶å°çš„æŠ¥é”™ï¼Œå¤ªé•¿äº†ï¼Œè¿™é‡Œå°±ä¸æ˜¾ç¤º</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç†å¯¹è±¡è¿”å›</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">return</span> mapperProxyFactory<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span>sqlSession<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BindingException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error getting mapper instance. Cause: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ€»ç»“æ­¥éª¤ï¼š</p>\n<ul>\n<li>è°ƒç”¨ SqlSession çš„ <code>getMapper()</code>  æ–¹æ³•ï¼Œéšåè¿™ä¸ªå§”æ‰˜å‘ä¸‹ä¼ é€’ç»™ <code>MapperRegister</code> ã€‚</li>\n<li><code>MapperRegister</code>  é€šè¿‡åŠ è½½é…ç½®æ–‡ä»¶æ—¶æ³¨å†Œçš„ä»£ç†å·¥å‚æ¥è¿”å›éœ€è¦çš„å®ä¾‹ç±»å¯¹è±¡ã€‚</li>\n</ul>\n<p><strong>æ˜¯é€šè¿‡ <code>newIntance(sqlSession)</code>  è¿”å›çš„å¯¹è±¡ã€‚</strong></p>\n<p>ä¹‹å‰æˆ‘ä»¬è®²è¿‡å¦‚ä½•<a href=\"https://cecilia.cool/2022/10/16/Java/Mybatis/Mybatis(1)-%E5%88%9D%E4%BD%BF%E7%94%A8/\">è§£æ xml æ–‡ä»¶</a>ï¼Œä¹Ÿè®¸ä½ æ²¡æœ‰è®°ä½ç›¸å…³ä»£ç è¯¥æ€ä¹ˆå†™ï¼Œæ”¾å¿ƒï¼Œæˆ‘ä¹Ÿæ²¡è®°ä½ã€‚ä½†æ˜¯ä¹‹å‰è¯´è¿‡ï¼Œxml é‡Œé¢ä¸€å±‚ä¸€å±‚çš„æ ‡ç­¾åµŒå¥—å…¶å®å°±æ˜¯æ ‘çš„èŠ‚ç‚¹ï¼Œåœ¨æ³¨å†ŒåŠ¨æ€ä»£ç†æ—¶ï¼Œå°±æ˜¯é€šè¿‡ <code>parse(/mappers)</code>  æ–¹æ³•æ‹¿åˆ° mapper çš„ <code>namespace</code> ï¼Œå†æ³¨å†Œï¼Œæ€»ä½“æµç¨‹å¾ˆæ¸…æ™°å§ã€‚</p>\n<blockquote>\n<p>å¥½äº†å¥½äº†ï¼Œæ‰“ä½ï¼Œè¿™éƒ¨åˆ†å†çœ‹æºç å°±ä¸ç¤¼è²Œäº†ï¼Œä¸è¦çº ç»“æ¡†æ¶åº•å±‚ä»£ç ç»†èŠ‚ï¼Œæ²¡åµç”¨ï¼Œåˆ«è¯´ä»€ä¹ˆå­¦å­¦åˆ«äººæ€ä¹ˆå†™çš„ï¼Œæœ‰æ—¶å€™æˆ‘è¿è‡ªå·±å†™çš„ä»£ç éƒ½å­¦ä¸æ‡‚ã€‚</p>\n</blockquote>\n<h2 id=\"æ–¹æ³•æ‹¦æˆª\"><a class=\"anchor\" href=\"#æ–¹æ³•æ‹¦æˆª\">#</a> æ–¹æ³•æ‹¦æˆª</h2>\n<blockquote>\n<p>ç­‰æˆ‘å¤ä¹ ä¸€ä¸‹åå°„å†æ¥å¡«å‘</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>ç”°å®ˆæ Java æŠ€æœ¯åšå®¢ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50aWFuc2hvdXpoaS5jb20vYXBpL3R1dG9yaWFscy9teWJhdGlzLzM2MA==\">http://www.tianshouzhi.com/api/tutorials/mybatis/360</span></p>\n<p>é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjODE1ZjhjZWM=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#815f8cec</span></p>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(5)-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/",
            "url": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(5)-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/",
            "title": "Myabtis(5)--æ³¨è§£å¼€å‘",
            "date_published": "2022-10-19T04:28:04.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>æœ€åˆè®¾è®¡æ—¶ï¼ŒMyBatis æ˜¯ä¸€ä¸ª XML é©±åŠ¨çš„æ¡†æ¶ã€‚é…ç½®ä¿¡æ¯æ˜¯åŸºäº XML çš„ï¼Œè€Œä¸”<strong>æ˜ å°„è¯­å¥ä¹Ÿæ˜¯å®šä¹‰åœ¨ XML ä¸­çš„</strong>ã€‚è€Œåˆ°äº† <strong>MyBatis 3</strong>ï¼Œæœ‰æ–°çš„å¯ç”¨çš„é€‰æ‹©äº†ã€‚MyBatis3 æ„å»ºåœ¨åŸºäºå…¨é¢è€Œä¸”å¼ºå¤§çš„ Java é…ç½® API ä¹‹ä¸Šã€‚è¿™ä¸ªé…ç½® API æ˜¯åŸºäº XML çš„ MyBatis é…ç½®çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æ–°çš„åŸºäºæ³¨è§£é…ç½®çš„åŸºç¡€ã€‚æ³¨è§£æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®ç°ç®€å•æ˜ å°„è¯­å¥ï¼Œè€Œä¸ä¼šå¼•å…¥å¤§é‡çš„å¼€é”€ã€‚</p>\n<blockquote>\n<p>æ³¨æ„ï¼šä¸å¹¸çš„æ˜¯ï¼ŒJava æ³¨è§£é™åˆ¶äº†å®ƒä»¬çš„è¡¨ç°å’Œçµæ´»ã€‚æœ€å¼ºå¤§çš„ MyBatis æ˜ å°„ä¸èƒ½ç”¨æ³¨è§£æ¥æ„å»ºï¼Œé‚£å¹¶ä¸å¯ç¬‘ï¼ŒåŸºäº Java æ³¨è§£çš„é…ç½®ç¦»ä¸å¼€å®ƒçš„ç‰¹æ€§ã€‚</p>\n</blockquote>\n<h1 id=\"æ³¨è§£å¼€å‘\"><a class=\"anchor\" href=\"#æ³¨è§£å¼€å‘\">#</a> æ³¨è§£å¼€å‘</h1>\n<p>ä¹‹å‰éœ€è¦ç¼–å†™å¯¹åº”çš„æ˜ å°„å™¨å¹¶ç»‘å®šåˆ°æ¥å£ä¸Šï¼Œé€šè¿‡æ¥å£æ‰§è¡Œ sql è¯­å¥ã€‚æ³¨è§£å¼€å‘å®ç°æ— éœ€ <code>xml</code>  æ˜ å°„å™¨é…ç½®ï¼Œç›´æ¥ä½¿ç”¨æ³¨è§£åœ¨æ¥å£ä¸Šè¿›è¡Œé…ç½®ã€‚</p>\n<blockquote>\n<p>åœ¨å‰è¨€å·²ç»è¯´è¿‡äº†ï¼Œæ³¨è§£çš„è¡¨è¾¾èƒ½åŠ›å’Œçµæ´»æ€§æœ‰é™ï¼Œå¹¶ä¸æ˜¯è¯´å®Œå…¨æŠ›å¼ƒ xml é…ç½®ã€‚</p>\n</blockquote>\n<p>å¤ä¹ ä¸€ä¸‹æ¥å£æ˜ å°„ï¼š</p>\n<p>ä¹‹å‰ä½¿ç”¨ xml éœ€è¦ç¼–å†™æ˜ å°„å™¨ï¼šåœ¨ xml ä¸­å®šä¹‰æ˜ å°„è§„åˆ™å’Œ SQL è¯­å¥ï¼Œå†ç»‘å®šåˆ°æ¥å£çš„æ–¹æ³•å®šä¹‰ä¸Šï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!-- æ˜ å°„ StudentMapper æ¥å£ï¼Œnamespace æ˜¯æ¥å£çš„å…¨ç±»é™å®šå --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.mappers.StudentMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½¿ç”¨å…¨ç±»é™å®šåå¤ªéº»çƒ¦ï¼Œå¯ä»¥å† xml ä¸­åŠ ä¸Šåˆ«å</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.mappers<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ç°åœ¨ä½¿ç”¨æ³¨è§£å®ç°ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Insert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insert into student(sid, name) value(#&#123;sid&#125;, #&#123;name&#125;)\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">addStudent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Student</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>åŒæ—¶ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„æ˜ å°„å™¨æ³¨å†Œï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>mappers<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token operator\">&lt;</span>mapper <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"com.cyan.mapper.StudentMapper\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>mappers<span class=\"token operator\">></span></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç›´æ¥å‘ SqlSession ä¼ å…¥æ¥å£ Class å³å¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">StudentMapper</span> mapper <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StudentMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"è‡ªå®šä¹‰æ˜ å°„\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰æ˜ å°„\">#</a> è‡ªå®šä¹‰æ˜ å°„</h2>\n<blockquote>\n<p>é€šè¿‡ <code>@Result</code>  è¿›è¡Œè‡ªå®šä¹‰æ˜ å°„ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Results</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> column <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å·¦è¾¹çš„ <code>column</code>  å…¶å®å°±æ˜¯æŸ¥è¯¢ç»“æœç»„æˆçš„è¡¨çš„ä¸€åˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸º Student å†åŠ ä¸€ä¸ªå±æ€§ <code>sex</code> ï¼Œæˆ‘æƒ³è®©æ€§åˆ«çš„ç»“æœæ˜ å°„åˆ° Student å¯¹è±¡çš„ name å±æ€§ä¸Šï¼Œè®© name ç»“æœæ˜ å°„ä¸º sexã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Results</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> column <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>æˆ‘çŸ¥é“è¿™ç§æ˜ å°„æ²¡æœ‰åµç”¨ï¼Œæˆ‘åªæ˜¯ä¸¾ä¸ªğŸŒ°ã€‚</p>\n</blockquote>\n<h2 id=\"å¤æ‚æŸ¥è¯¢\"><a class=\"anchor\" href=\"#å¤æ‚æŸ¥è¯¢\">#</a> å¤æ‚æŸ¥è¯¢</h2>\n<p>ä¸Šä¸€ç¯‡è®²äº†ä¸€å¯¹å¤šçš„å¤æ‚æŸ¥è¯¢ï¼Œteacher å¯¹è±¡æœ‰ä¸€ä¸ªå­¦ç”Ÿåˆ—è¡¨çš„å±æ€§ï¼Œè¿™é‡Œç”¨æ³¨è§£å®ç°ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student inner join teach on student.sid = teach.sid where tid = #&#123;tid&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getStudentByTid</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> tid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Reuslt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> column <span class=\"token operator\">=</span> <span class=\"token string\">\"tid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"tid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"tid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"studentList\"</span><span class=\"token punctuation\">,</span> many <span class=\"token operator\">=</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           <span class=\"token annotation punctuation\">@Many</span><span class=\"token punctuation\">(</span>select <span class=\"token operator\">=</span> <span class=\"token string\">\"getStudentByTid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Select * from teacher where tid = #&#123;tid&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\">Teacher</span> <span class=\"token function\">getTeacherByTid</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> tid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å­æŸ¥è¯¢ç»“æœä½œä¸º <code>@Result</code>  æ³¨è§£çš„ä¸€ä¸ª many ç»“æœï¼Œä»£è¡¨å­æŸ¥è¯¢çš„æ‰€æœ‰ç»“æœéƒ½å½’å…¥æ­¤é›†åˆä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰çš„ collection æ ‡ç­¾ï¼‰ã€‚</p>\n<p><code>@Result</code>  ä¹Ÿæä¾›äº† <code>@One</code>  å­æ³¨è§£æ¥å®ç°ä¸€å¯¹ä¸€çš„å…³ç³»è¡¨ç¤ºï¼Œç±»ä¼¼äºä¹‹å‰çš„ <code>assocation</code>  æ ‡ç­¾ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Results</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> column <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token annotation punctuation\">@Result</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">,</span> property <span class=\"token operator\">=</span> <span class=\"token string\">\"teacher\"</span><span class=\"token punctuation\">,</span> one <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token annotation punctuation\">@One</span><span class=\"token punctuation\">(</span>select <span class=\"token operator\">=</span> <span class=\"token string\">\"getTeacherBySid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å¦‚æœè§‰å¾—åœ¨ Java ä»£ç ä¸­ç¼–å†™<strong>æ˜ å°„è§„åˆ™</strong>ä¸ç¾è§‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>@ResultMap</code>  æ ‡ç­¾ï¼ŒæŒ‡å®š xml æ–‡ä»¶é‡Œçš„ <code>resultMap</code>  çš„ IDï¼Œå°±å¯ä»¥åœ¨è¯¥ <code>ResultMap</code>  ç¼–å†™æ˜ å°„è§„åˆ™äº†ã€‚</p>\n<h2 id=\"æŒ‡å®šæ„é€ å™¨ä¸å‚æ•°\"><a class=\"anchor\" href=\"#æŒ‡å®šæ„é€ å™¨ä¸å‚æ•°\">#</a> æŒ‡å®šæ„é€ å™¨ä¸å‚æ•°</h2>\n<p>ä½¿ç”¨ <code>@ConstructorArgs</code>  å‚æ•°æ¥æŒ‡å®šæ„é€ å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@ConstructorArgs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token annotation punctuation\">@Arg</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">,</span> javaType <span class=\"token operator\">=</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token annotation punctuation\">@Arg</span><span class=\"token punctuation\">(</span>column <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> javaType <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student where sid = #&#123;sid&#125; and sex = #&#123;sex&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">Student</span> <span class=\"token function\">getStudentBySidAndSex</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sex\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å‚æ•°åˆ—è¡¨ä¸­ï¼Œå‚æ•°ä¸ªæ•°è¶…è¿‡ä¸¤ä¸ªæ—¶å°±å¿…é¡»è¦ä½¿ç”¨ <code>@Param</code>  æ¥æŒ‡å®šå‚æ•°åç§°ï¼Œä¸ç„¶ Mybatis ä¸æ˜ç¡®å“ªä¸ªå‚æ•°æ˜¯ä»€ä¹ˆã€‚</p>\n<p>å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±éœ€è¦åœ¨ sql è¯­å¥ä¸­æŒ‡å®šå±æ€§æ¥è‡ªå“ªï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Insert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insert into student(sid, name, sex) values(#&#123;sid&#125;, #&#123;student.name&#125;, #&#123;student.sex&#125;)\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">addStudent</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sid\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"student\"</span><span class=\"token punctuation\">)</span>  <span class=\"token class-name\">Student</span> student<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ä¸Šæ–‡æåˆ°ç¼“å­˜æœºåˆ¶ï¼Œåœ¨æ³¨è§£å¼€å‘ä¸­å°±éœ€è¦ä½¿ç”¨ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@CacheNamespace</span><span class=\"token punctuation\">(</span>readWrite <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MyMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select * from student\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Options</span><span class=\"token punctuation\">(</span>useCache <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>@CacheNamespace</code>  æ³¨è§£ç›´æ¥å®šä¹‰åœ¨æ¥å£ä¸Šå³å¯ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@Options</code>  æ¥æ§åˆ¶å•ä¸ªæ“ä½œçš„ç¼“å­˜å¯ç”¨ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHhzdHJpdmUuY29tL3N1YmplY3QvbXliYXRpcy8xOTYuaHRt\">https://www.hxstrive.com/subject/mybatis/196.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjODE1ZjhjZWM=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#815f8cec</span></p>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(4)-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/",
            "url": "https://cecilia.cool/2022/10/19/Java/Mybatis/Mybatis(4)-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/",
            "title": "Mybatis(4)--ç¼“å­˜æœºåˆ¶",
            "date_published": "2022-10-19T02:09:51.000Z",
            "content_html": "<h1 id=\"ç¼“å­˜æœºåˆ¶\"><a class=\"anchor\" href=\"#ç¼“å­˜æœºåˆ¶\">#</a> ç¼“å­˜æœºåˆ¶</h1>\n<p>ç¼“å­˜æœºåˆ¶å…¶å®å°±æ˜¯æå‰å°†ä¸€éƒ¨åˆ†å†…å®¹æ”¾å…¥ç¼“å­˜ä¸­ï¼Œä¸‹æ¬¡è·å–æ•°æ®æ—¶å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯å†å‘æ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡æ•ˆç‡ã€‚</p>\n<blockquote>\n<p>Mybatis å­˜åœ¨ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚</p>\n</blockquote>\n<h2 id=\"ä¸€çº§ç¼“å­˜\"><a class=\"anchor\" href=\"#ä¸€çº§ç¼“å­˜\">#</a> ä¸€çº§ç¼“å­˜</h2>\n<p>ä¸€çº§ç¼“å­˜æ— æ³•å…³é—­ï¼Œåªèƒ½è°ƒæ•´ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">SqlUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Mapper</span> mapper <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Student</span> s1 <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectStudentBySid</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Student</span> s2 <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectStudentBySid</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é€šè¿‡ sid æŸ¥è¯¢å­¦ç”Ÿ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">==</span> s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// ç»“æœä¸º true</span></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œs2 å’Œ s1 æŒ‡å‘çš„æ˜¯åŒä¸€ç‰‡å†…å­˜åœ°å€ã€‚å¦‚æœä½ è§‰å¾—ãƒ»ä¸æ˜æ˜¾ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹æ„é€ å‡½æ•°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Studentè¢«æ„é€ \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// ç»“æœæ˜¯ï¼Œæœ€ååªæ‰“å°ä¸€æ¬¡ â€”â€”Student è¢«æ„é€ </span></pre></td></tr></table></figure><p>é€šè¿‡å‰é¢çš„å­¦ä¹ å¾—çŸ¥ Mybatis åœ¨æ˜ å°„ä¸ºå¯¹è±¡æ—¶ï¼Œåœ¨åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œæ— è®ºä½ æ„é€ æ–¹æ³•å†™æˆä»€ä¹ˆæ ·å­ï¼Œéƒ½ä¼šå»è°ƒç”¨ä¸€æ¬¡æ„é€ æ–¹æ³•ï¼Œ<strong>å¦‚æœå­˜åœ¨å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå»æ‰¾åŒ¹é…çš„æ„é€ æ–¹æ³•</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æ„é€ æ–¹æ³•æ¥éªŒè¯å¯¹è±¡è¢«åˆ›å»ºäº†å‡ æ¬¡ã€‚</p>\n<p>ä½†æ˜¯ä¸€çº§ç¼“å­˜ä¼šåœ¨è¿›è¡Œ<strong> DML æ“ä½œ</strong> â€”â€” æ’å…¥ï¼Œåˆ é™¤ï¼Œæ›´æ–°åå¤±æ•ˆï¼Œå½“ç„¶ï¼Œä¹Ÿåªæ˜¯å½“å‰ä¼šè¯çš„ç¼“å­˜ä¼šå¤±æ•ˆï¼Œè¿™å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Œå°½ç®¡å®ƒåšåˆ°äº†ä¼šè¯ä¹‹é—´çš„éš”ç¦»ï¼Œä½†æ˜¯ä¼šå‡ºç°æ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼ˆå¯è§æ€§é—®é¢˜ï¼‰ã€‚</p>\n<blockquote>\n<p>å½“å‰ä¼šè¯ç»“æŸåï¼Œä¹Ÿä¼šæ¸…ç†å…¨éƒ¨çš„ç¼“å­˜ï¼Œå› ä¸ºå·²ç»ä¸ä¼šå†ç”¨åˆ°äº†ã€‚ä¸€çº§ç¼“å­˜åªé’ˆå¯¹äºå•ä¸ªä¼šè¯ï¼Œå¤šä¸ªä¼šè¯ä¹‹é—´ä¸ç›¸é€šã€‚</p>\n</blockquote>\n<p>å…¶å®åœ¨ MySQL ä¸­ï¼ˆInnoDB å­˜å‚¨å¼•æ“ï¼‰ï¼ŒDML æ“ä½œä¹Ÿä¸æ˜¯å³æ—¶å†™å…¥ç£ç›˜ä¸­ï¼Œè€Œæ˜¯ä¼šåœ¨ç¼“å­˜ä¸­å‘†ç€ï¼Œåªä¸è¿‡è¿™ä¸ªæœºåˆ¶æ¶‰åŠçš„çŸ¥è¯†æ›´å¤šï¼ŒåŒ…æ‹¬åˆ·è„ï¼Œflush é“¾è¡¨ï¼ŒLRU é“¾è¡¨ï¼Œç¼“å­˜æ± å•¥çš„ã€‚</p>\n<h2 id=\"äºŒçº§ç¼“å­˜\"><a class=\"anchor\" href=\"#äºŒçº§ç¼“å­˜\">#</a> äºŒçº§ç¼“å­˜</h2>\n<p>æ‰©å±•åˆ°æ‰€æœ‰ä¼šè¯éƒ½èƒ½ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯å…³é—­çŠ¶æ€ã€‚å¼€å¯äºŒçº§ç¼“å­˜ï¼Œéœ€è¦åœ¨æ˜ å°„å™¨ XMLï¼ˆå°±æ˜¯ mapper.xmlï¼‰ä¸­æ·»åŠ ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TestMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ”¾åœ¨æŸä¸€ä¸ª mapper é‡Œé¢ï¼ŒäºŒçº§ç¼“å­˜çš„å®˜æ–¹é…ç½®ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cache</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token attr-name\">eviction</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FIFO<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token attr-name\">flushInterval</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>60000<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token attr-name\">size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>512<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token attr-name\">readOnly</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›æŸä¸ªæ–¹æ³•å¼€å¯äºŒçº§ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>useCache</code>  å±æ€§ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">useCache</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    select * from student</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><code>flushCache</code>  å±æ€§åœ¨ <code>select</code>  è¯­å¥é‡Œé¢é»˜è®¤ä¸º <code>false</code> ï¼Œåœ¨ <code>DML</code>  è¯­å¥ä¸­é»˜è®¤ä¸º <code>true</code> ã€‚å¯ä»¥é€šè¿‡è¯¥å±æ€§æ¥è°ƒæ•´ç¼“å­˜æ¸…ç†æƒ…å†µã€‚</p>\n<p>æŸ¥è¯¢æ•°æ®åº“æ—¶çš„ä¼˜å…ˆçº§ï¼šäºŒçº§ç¼“å­˜ &gt; ä¸€çº§ç¼“å­˜ &gt; æ•°æ®åº“ã€‚</p>\n<h2 id=\"ä¸€è‡´æ€§é—®é¢˜\"><a class=\"anchor\" href=\"#ä¸€è‡´æ€§é—®é¢˜\">#</a> ä¸€è‡´æ€§é—®é¢˜</h2>\n<p>å•ç‹¬çš„ä¸€ä¸ªç¨‹åºä½¿ç”¨ Mybatisï¼Œå¦‚æœæ“ä½œå¾—å½“ï¼Œä¹Ÿè®¸ä¸ä¼šå‡ºç°ä¸€è‡´æ€§é—®é¢˜ã€‚ä½†æ˜¯å½“å¤šä¸ªç¨‹åºï¼ˆè®¡ç®—æœºï¼‰ä½¿ç”¨è‡ªå·±çš„ Mybatis è®¿é—®ç›¸åŒçš„æ•°æ®åº“ï¼Œå°±ä¼šå¯¼è‡´ä¸¥é‡çš„ä¸€è‡´æ€§é—®é¢˜ã€‚ç¨‹åº A æ­£åœ¨å¤„ç†ä¸€æ‰¹æŸ¥è¯¢è¯·æ±‚ï¼ˆè¾ƒé•¿æ—¶é—´ï¼‰ï¼Œç¨‹åº B æ­£åœ¨å¤„ç†ä¸€æ‰¹ä¿®æ”¹è¯·æ±‚ï¼ŒA ä½¿ç”¨ Mybatis çš„ç¼“å­˜æœºåˆ¶ï¼ŒA çš„ Mybaits å¹¶ä¸çŸ¥é“ B åœ¨ä¿®æ”¹æ•°æ®åº“ï¼Œä»ç„¶ä½¿ç”¨ A çš„å¯èƒ½è¿‡æœŸäº†çš„ç¼“å­˜ã€‚</p>\n<p>è¿™æ—¶å€™éœ€è¦å…³é—­ Mybatis ç¼“å­˜æ¥ä¿è¯ä¸€è‡´æ€§ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- åœ¨ configuration æ ‡ç­¾ä¸‹ï¼Œè¿™æ˜¯å…³é—­äºŒçº§ç¼“å­˜ï¼Œå¦‚æœä¸º falseï¼Œå°±æ˜¯å¼€å¯äºŒçº§ç¼“å­˜ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cacheEnabled<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!-- è¿˜éœ€è¦å°† select è¯­å¥çš„ useCache æ”¹ä¸º false--></span></pre></td></tr></table></figure><p>åé¢ï¼Œæˆ‘ä»¬ä¼šç»§ç»­å­¦ä¹  Redisã€Ehcacheã€Memcache ç­‰ç¼“å­˜æ¡†æ¶ï¼Œé€šè¿‡ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå°±èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjMmFiZjNlYWE=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#2abf3eaa</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2h4c3RyaXZlLmNvbS9zdWJqZWN0L215YmF0aXMvMjIzLmh0bQ==\">hxstrive.com/subject/mybatis/223.htm</span></p>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/",
            "url": "https://cecilia.cool/2022/10/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/",
            "title": "åŠ¨æ€è§„åˆ’",
            "date_published": "2022-10-18T13:19:44.000Z",
            "content_html": "<h1 id=\"æ•°ä½dp\"><a class=\"anchor\" href=\"#æ•°ä½dp\">#</a> æ•°ä½ DP</h1>\n<p>LeetCode ä¸Šçš„ **ã€Œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9udW1iZXJzLWF0LW1vc3Qtbi1naXZlbi1kaWdpdC1zZXQv\">902. æœ€å¤§ä¸º N çš„æ•°å­—ç»„åˆ</span>ã€<strong>ï¼Œéš¾åº¦ä¸º</strong>ã€Œå›°éš¾ã€**ã€‚</p>\n<p>ç»™å®šä¸€ä¸ªæŒ‰ éé€’å‡é¡ºåº æ’åˆ—çš„æ•°å­—æ•°ç»„  <code>digits</code> ã€‚ä½ å¯ä»¥ç”¨ä»»æ„æ¬¡æ•° æ¥å†™çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ ï¼Œæˆ‘ä»¬å¯ä»¥å†™æ•°å­—ï¼Œå¦‚  <code>'13'</code> ,  <code>'551'</code> , å’Œ  <code>'1351315'</code> ã€‚</p>\n<p>è¿”å› <strong>å¯ä»¥ç”Ÿæˆçš„å°äºæˆ–ç­‰äºç»™å®šæ•´æ•°</strong> çš„æ­£æ•´æ•°çš„ä¸ªæ•° ã€‚</p>\n<p>ç¤ºä¾‹ 1ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>è¾“å…¥ï¼šdigits <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"3\"</span>,<span class=\"token string\">\"5\"</span>,<span class=\"token string\">\"7\"</span><span class=\"token punctuation\">]</span>, n <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>è¾“å‡ºï¼š20</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>è§£é‡Šï¼š</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>å¯å†™å‡ºçš„ <span class=\"token number\">20</span> ä¸ªæ•°å­—æ˜¯ï¼š</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span>, <span class=\"token number\">3</span>, <span class=\"token number\">5</span>, <span class=\"token number\">7</span>, <span class=\"token number\">11</span>, <span class=\"token number\">13</span>, <span class=\"token number\">15</span>, <span class=\"token number\">17</span>, <span class=\"token number\">31</span>, <span class=\"token number\">33</span>, <span class=\"token number\">35</span>, <span class=\"token number\">37</span>, <span class=\"token number\">51</span>, <span class=\"token number\">53</span>, <span class=\"token number\">55</span>, <span class=\"token number\">57</span>, <span class=\"token number\">71</span>, <span class=\"token number\">73</span>, <span class=\"token number\">75</span>, <span class=\"token number\">77</span>.</pre></td></tr></table></figure><blockquote>\n<p>å…¶å®å°±æ˜¯æ•°ç»„ä¸­ç»„åˆèµ·æ¥å°äº n çš„æ•°çš„ä¸ªæ•°ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Solution</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> nums<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">dp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            x <span class=\"token operator\">/=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> m <span class=\"token operator\">=</span> nums<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> ans <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// ä½æ•°å’Œ x ç›¸åŒ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> p <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">--</span><span class=\"token punctuation\">,</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">int</span> cur <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">int</span> l <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> r <span class=\"token operator\">=</span> m <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>l <span class=\"token operator\">&lt;</span> r<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token keyword\">int</span> mid <span class=\"token operator\">=</span> l <span class=\"token operator\">+</span> r <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">[</span>mid<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;=</span> cur<span class=\"token punctuation\">)</span> l <span class=\"token operator\">=</span> mid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">else</span> r <span class=\"token operator\">=</span> mid <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> cur<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> cur<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                ans <span class=\"token operator\">+=</span> r <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> ans<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nums<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> cur<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                ans <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// ä½æ•°æ¯” x å°‘çš„</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> last <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">int</span> cur <span class=\"token operator\">=</span> last <span class=\"token operator\">*</span> m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            ans <span class=\"token operator\">+=</span> cur<span class=\"token punctuation\">;</span> last <span class=\"token operator\">=</span> cur<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> ans<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">atMostNGivenDigitSet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> digits<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> digits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        nums <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> nums<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>digits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">dp</span><span class=\"token punctuation\">(</span>max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "æ•°æ®ç»“æ„ä¸ç®—æ³•"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/17/Java/Mybatis/Mybatis(3)-%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2/",
            "url": "https://cecilia.cool/2022/10/17/Java/Mybatis/Mybatis(3)-%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2/",
            "title": "Mybatis(3)--å¤æ‚æŸ¥è¯¢",
            "date_published": "2022-10-17T07:59:11.000Z",
            "content_html": "<h1 id=\"ç®€å•æŸ¥è¯¢\"><a class=\"anchor\" href=\"#ç®€å•æŸ¥è¯¢\">#</a> ç®€å•æŸ¥è¯¢</h1>\n<p>é©¼å³°å‘½åé…ç½®ï¼š</p>\n<blockquote>\n<p>ä¸€èˆ¬æ•°æ®åº“çš„å­—æ®µåéƒ½æ˜¯ä¸‹åˆ’çº¿åˆ†éš”ï¼Œä½†æ˜¯ Java é‡Œé¢æ˜¯é©¼å³°å‘½åï¼Œå°±ä¼šå¯¼è‡´æŸ¥è¯¢æ—¶æ•°æ®åº“çš„å­—æ®µæ˜ å°„ä¸åˆ° Java ç±»é‡Œé¢ï¼Œæ‰€ä»¥éœ€è¦å¼€å¯è½¬æ¢</p>\n</blockquote>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>setting</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mapUnderscoreToCamelCase<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>settings</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¯¹äºæŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹æ›´æ”¹ï¼š</p>\n<ul>\n<li>æŸ¥è¯¢ç»“æœæ˜ å°„ä¸ºå®ä½“ç±»</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>studentList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    select * from student</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>æŸ¥è¯¢ç»“æœæ˜ å°„ä¸º Map</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Map<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    select * from student</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€ä¸ª <code>Map</code>  å°±æ˜¯ä¸€<strong>è¡Œ</strong>æŸ¥è¯¢ç»“æœï¼Œå½“ç„¶ï¼Œå¯¹åº”çš„ mapper æ¥å£æ–¹æ³•å°±éœ€è¦æ¢æˆï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">selectStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>æŒ‡å®šæ˜ å°„è§„åˆ™</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Map<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    select * from student</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>æŒ‡å®šæ„é€ å™¨</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Map<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>constructor</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Integer<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>arg</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>String<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>constructor</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Map<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    select * from student</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>ä½†æ˜¯æŸ¥è¯¢ä¸€èˆ¬ä¼šé™„å¸¦æ¡ä»¶ï¼Œæ‰€ä»¥ <code>select</code>  æ ‡ç­¾é™¤äº† <code>resultType</code>  ä¹‹å¤–ï¼Œè¿˜éœ€è¦ <code>parameterType</code>  æ ‡ç­¾ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getStudentBySid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">parameterType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>int<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    select * from student where sid = #&#123;sid&#125;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨ <code>#&#123;xxx&#125;</code>  æˆ–æ˜¯ <code>$&#123;xxx&#125;</code>  æ¥å¡«å…¥æˆ‘ä»¬ç»™å®šçš„å±æ€§ï¼Œå®é™…ä¸Š Mybatis æœ¬è´¨ä¹Ÿæ˜¯é€šè¿‡ <code>PreparedStatement</code>  é¦–å…ˆè¿›è¡Œä¸€æ¬¡é¢„ç¼–è¯‘ï¼Œæœ‰æ•ˆåœ°é˜²æ­¢ SQL æ³¨å…¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ <code>$&#123;xxx&#125;</code>  å°±ä¸å†æ˜¯é€šè¿‡é¢„ç¼–è¯‘ï¼Œè€Œæ˜¯ç›´æ¥ä¼ å€¼ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬éƒ½ä½¿ç”¨ <code>#&#123;xxx&#125;</code>  æ¥è¿›è¡Œæ“ä½œã€‚</p>\n<blockquote>\n<p>å…¶å®æ’å…¥ï¼Œåˆ é™¤è¿™äº›éœ€è¦ä¼ é€’å‚æ•°çš„è¯­å¥éƒ½ä¼šç”¨åˆ° <code>#&#123;&#125;</code> ã€‚</p>\n</blockquote>\n<h1 id=\"å¤æ‚æŸ¥è¯¢\"><a class=\"anchor\" href=\"#å¤æ‚æŸ¥è¯¢\">#</a> å¤æ‚æŸ¥è¯¢</h1>\n<h2 id=\"ä¸€å¯¹å¤š\"><a class=\"anchor\" href=\"#ä¸€å¯¹å¤š\">#</a> ä¸€å¯¹å¤š</h2>\n<p>ä¸€ä¸ªè€å¸ˆå¯ä»¥æ•™æˆå¤šä¸ªå­¦ç”Ÿï¼Œéœ€è¦ä¸€æ¬¡æ€§å°†<strong> A</strong> è€å¸ˆçš„å­¦ç”Ÿå…¨éƒ¨æ˜ å°„ç»™<strong> A</strong> è€å¸ˆçš„å¯¹è±¡ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Teacher</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> tid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> studentList<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¹‹å‰ç¼–å†™çš„éƒ½æ˜¯éå¸¸ç®€å•çš„æ˜ å°„ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨ <code>resultMap</code>  æ¥è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>getTeacherByTid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>asTeacher<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        select *, teacher.name as tname from student </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            inner join teach on student.sid = teach.sid                          </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            inner join teacher on teach.tid = teacher.tid where teach.tid = #&#123;tid&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!--teach æ˜¯ä¸­é—´è¡¨ï¼Œè¿æ¥å­¦ç”Ÿå’Œè€å¸ˆä¸¤å¼ è¡¨ --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>asTeacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Teacher<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tname<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>collection</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>studentList<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ofType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sex<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sex<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>collection</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><code>&lt;resultMap&gt;</code>  çš„ <code>id</code>  è¦ä¸ <code>&lt;select&gt;</code>  æ ‡ç­¾ç›¸å…³è”ã€‚</p>\n<blockquote>\n<p>ä¹‹å‰è¯´è¿‡ï¼Œå®é™…é¡¹ç›®ä¸­è”è¡¨æŸ¥è¯¢æœ‰æ—¶ä¼šéå¸¸å¤æ‚ï¼Œæ‰€ä»¥æœ‰æ—¶ä¼šç›´æ¥é€‰æ‹©æ‰‹å†™ sql è¯­å¥ä½¿ç”¨ <code>jdbc</code>  è€Œä¸æ˜¯ä½¿ç”¨ Mybatisã€‚</p>\n</blockquote>\n<h2 id=\"å¤šå¯¹ä¸€\"><a class=\"anchor\" href=\"#å¤šå¯¹ä¸€\">#</a> å¤šå¯¹ä¸€</h2>\n<p>ç°åœ¨ä¿®æ”¹ä¸€ä¸‹ <code>Student</code>  å’Œ <code>Teacher</code>  ä¸¤ä¸ªç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Accessors</span><span class=\"token punctuation\">(</span>chain <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Teacher</span> teacher<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Teacher</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">int</span> tid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬æƒ³è¦é€šè¿‡æŸä¸ªæ¡ä»¶æŸ¥è¯¢å­¦ç”Ÿæ•°æ®ï¼Œæ¯ä¸€è¡Œå­¦ç”Ÿéƒ½è¦é¡ºå¸¦æŸ¥è¯¢è€å¸ˆçš„ä¿¡æ¯ï¼Œå¯¼è‡´å‡ºç°å¤šå¯¹ä¸€æŸ¥è¯¢ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultMap</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>sTot<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tselect * , teacher.name as tname from Student</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    \tleft join teach on teach.sid = student.sid</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    \tleft join teacher on teach.tid = teacher.tid</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">&lt;!-- æŸ¥è¯¢ç»“æœé‡Œé¢ä¸éœ€è¦å†™ teacher.tidï¼Œå› ä¸ºå­¦ç”Ÿè¡¨ä¸­æœ‰ --></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>resultMap</span> <span class=\"token attr-name\">id</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>sTot<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sex<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sex<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>association</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>teacher<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">javaType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Teacher<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    \t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tid<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>result</span> <span class=\"token attr-name\">column</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tname<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>association</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>resultMap</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å…¶å®ä¸è®ºæ˜¯ç”¨ <code>&lt;collection&gt;</code>  è¿˜æ˜¯ <code>&lt;association&gt;</code> ï¼Œéƒ½æ˜¯å¯¹æŸ¥è¯¢ç»“æœçš„ä¸€ç§å¤„ç†æ–¹å¼ç½¢äº†ã€‚</p>\n<h1 id=\"äº‹åŠ¡\"><a class=\"anchor\" href=\"#äº‹åŠ¡\">#</a> äº‹åŠ¡</h1>\n<blockquote>\n<p>å› ä¸ºå†…å®¹æ¯”è¾ƒå°‘ï¼Œå°±æ”¾åˆ°å¤æ‚æŸ¥è¯¢é‡Œé¢ä¸€èµ·è®²è§£ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬ä½¿ç”¨ Mybatisï¼Œåœ¨ Java ä»£ç å±‚é¢æ˜¯ä½¿ç”¨ <code>SqlSession</code> ï¼Œå…¶å®æ‰“å¼€ä¸€ä¸ª <code>SqlSession</code> ï¼Œç›¸å½“äºæ‰“å¼€äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœ<strong>å…³é—­äº†è‡ªåŠ¨æäº¤</strong>ï¼Œåœ¨è°ƒç”¨äº†ä¿®æ”¹æ•°æ®åº“çš„è¯­å¥ï¼Œå°±éœ€è¦ <code>commit</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">TestMapper</span> testMapper <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TestMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    testMapper<span class=\"token punctuation\">.</span><span class=\"token function\">addStudent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setSex</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”·\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å°ç‹\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    testMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token operator\">::</span><span class=\"token function\">println</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å›æ»š</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// æäº¤</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjMzIwM2ZlMTU=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#3203fe15</span></p>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/17/Java/Mybatis/Mybatis(2)-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/",
            "url": "https://cecilia.cool/2022/10/17/Java/Mybatis/Mybatis(2)-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/",
            "title": "Mybatis(2)--é…ç½®æ–‡ä»¶",
            "date_published": "2022-10-17T03:52:12.000Z",
            "content_html": "<h1 id=\"é…ç½®æ–‡ä»¶\"><a class=\"anchor\" href=\"#é…ç½®æ–‡ä»¶\">#</a> é…ç½®æ–‡ä»¶</h1>\n<p>ä¹‹å‰æˆ‘ä»¬æœ€å¼€å§‹çš„ <code>Mybatis-config.xml</code>  æ˜¯è¿™æ ·çš„ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;é©±åŠ¨ç±»ï¼ˆå«åŒ…åï¼‰&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;æ•°æ®åº“è¿æ¥URL&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;ç”¨æˆ·å&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;å¯†ç &#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"ç¯å¢ƒ\"><a class=\"anchor\" href=\"#ç¯å¢ƒ\">#</a> ç¯å¢ƒ</h2>\n<p>å¯ä»¥çœ‹åˆ°æœ‰è¿™æ ·çš„æ ‡ç­¾ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">&lt;!-- .... --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å…¶å®å¯ä»¥å†™å¾ˆå¤šä¸ª <code>&lt;environment&gt;</code>  æ ‡ç­¾ï¼Œè¡¨ç¤ºè¿æ¥ä¸åŒçš„æ•°æ®åº“ï¼Œå› ä¸ºå®é™…å¼€å‘ä¸­ä¸å¯èƒ½åªä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ã€‚ä¾‹å¦‚ï¼šåŒæ—¶æ”¯æŒ Oracle å’Œ MySQL æ•°æ®åº“ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸ºäº†åˆ†åˆ«å®šä¹‰å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚</p>\n<blockquote>\n<p><strong>ä½ å¯ä»¥é…ç½®å¤šç§ç¯å¢ƒï¼ˆenvironmentï¼‰ï¼Œä½†æ˜¯æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ä¸ªç¯å¢ƒ</strong>ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¹‹å‰ä¸ºæˆ‘ä»¬ä¸ºäº†å¾—åˆ° <code>SqlSession</code>  åšäº†äº›ä»€ä¹ˆï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">SqlSessionFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">SqlSessionFactoryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsReader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mybatis-config.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å…¶å® <code>SqlSessionFactoryBuilder</code>  çš„ <code>build</code>  å¯ä»¥æ¥æ”¶é…ç½®ç¯å¢ƒçš„å±æ€§ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">SqlSessionFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">SqlSessionFactoryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsReader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mybatis-config.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ç¯å¢ƒID\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é€‰æ‹©ç¯å¢ƒ IDï¼Œå°±ä½¿ç”¨é»˜è®¤çš„ç¯å¢ƒ IDï¼Œçœ‹æœ€ä¸Šé¢çš„ <code>default = development</code> ã€‚</p>\n<h2 id=\"typealiasesæ ‡ç­¾\"><a class=\"anchor\" href=\"#typealiasesæ ‡ç­¾\">#</a> typeAliases æ ‡ç­¾</h2>\n<p>æˆ‘ä»¬ä¹‹å‰ä¸ºäº†å®šä¹‰ä¸€ä¸ª mapperï¼Œéœ€è¦å…³è”åˆ°é¡¹ç›®ä¸­çš„å®ä½“ç±»ï¼Œç„¶è€Œå®ä½“ç±»éœ€è¦ä½¿ç”¨å…¨ç±»é™å®šåï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TestMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><code>resultType</code>  æŒ‡å®šäº† <strong>JavaBean</strong> å®Œå…¨é™å®šåï¼Œè¿™ä¸ªåç§°å¾ˆé•¿ï¼Œæ¯æ¬¡éƒ½è¦å®Œæ•´çš„è¾“å…¥ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚å› æ­¤å°±å‡ºç°äº†  <code>&lt;typeAliases&gt; </code> æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾ç”¨æ¥å°†ç»™å®šçš„å®ä½“å®šä¹‰åˆ«åã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlias</span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Student<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">&lt;!-- è¿˜å¯ä»¥å®šä¹‰å¾ˆå¤š --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">&lt;!-- å¦‚æœè§‰å¾—è¿˜æ˜¯éº»çƒ¦ï¼Œç›´æ¥è®© Mybatis å»æ‰«æä¸€ä¸ªåŒ…ï¼Œå¹¶å°†åŒ…ä¸‹çš„æ‰€æœ‰ç±»è‡ªåŠ¨èµ·åˆ«å --></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>ä½ åº”è¯¥å°½é‡é¿å…ä¸åŒåŒ…å‡ºç°ç›¸åŒç±»åçš„ç±»ã€‚</p>\n</blockquote>\n<p>ä¹Ÿå¯ä»¥æŒ‡å®šå®ä½“ç±»æ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼ŒæŒ‡å®šåˆ«åï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lbwnb\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> sex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"transactionmanageræ ‡ç­¾\"><a class=\"anchor\" href=\"#transactionmanageræ ‡ç­¾\">#</a> transactionManager æ ‡ç­¾</h2>\n<p>ç¿»è¯‘è¿‡æ¥æ˜¯<strong>äº‹åŠ¡ç®¡ç†å™¨</strong>ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¹‹å‰æ˜¯æ€ä¹ˆå†™çš„ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>åœ¨ MyBatis ä¸­æœ‰ä¸¤ç§äº‹åŠ¡ç®¡ç†å™¨ç±»å‹ï¼š</p>\n<ul>\n<li><strong>JDBC</strong> â€“ è¿™ä¸ªé…ç½®ç›´æ¥ç®€å•ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾ç½®ã€‚å®ƒä¾èµ–äºä»æ•°æ®æºå¾—åˆ°çš„<strong>è¿æ¥</strong>æ¥ç®¡ç†äº‹åŠ¡èŒƒå›´ã€‚</li>\n<li><strong>MANAGED</strong> â€“ è¿™ä¸ªé…ç½®å‡ ä¹æ²¡åšä»€ä¹ˆã€‚å®ƒä»æ¥ä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ã€‚è€Œå®ƒä¼šè®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ Spring æˆ– JEE åº”ç”¨æœåŠ¡å™¨çš„ä¸Šä¸‹æ–‡ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šå…³é—­è¿æ¥ã€‚ç„¶è€Œä¸€äº›å®¹å™¨å¹¶ä¸å¸Œæœ›è¿™æ ·ï¼Œå› æ­¤å¦‚æœä½ éœ€è¦ä»è¿æ¥ä¸­åœæ­¢å®ƒï¼Œå°† closeConnection å±æ€§è®¾ç½®ä¸º falseã€‚</li>\n</ul>\n<p>è¿˜å¯ä»¥è‡ªå®šä¹‰äº‹åŠ¡ç®¡ç†å™¨ï¼ŒJDBC å®ç°äº† TransacFacotryï¼ŒMANAGED å®ç°äº† Transactionï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰äº‹åŠ¡ç®¡ç†å™¨éœ€è¦å®ç°å…¶ä¸­ä¸€ä¸ªæ¥å£ã€‚</p>\n<p>TransacFacotry æºç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TransactionFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// è®¾ç½®å±æ€§</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">void</span> <span class=\"token function\">setProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Properties</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token comment\">// åˆ›å»ºäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token class-name\">Transaction</span> <span class=\"token function\">newTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  \t<span class=\"token class-name\">Transaction</span> <span class=\"token function\">newTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DataSource</span> dataSource<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                             <span class=\"token class-name\">TransactionIsolationLevel</span> level<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> autoCommit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Transaction æºç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Transaction</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// è·å–æ•°æ®åº“è¿æ¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// æäº¤äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// å›æ»šäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// å…³é—­æ•°æ®åº“è¿æ¥</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å‡è®¾ä¸ºæˆ‘ä»¬è¦å®ç°çš„è‡ªå®šä¹‰äº‹åŠ¡ç®¡ç†å™¨å«åš <code>MyTransaction</code> ï¼Œå…¨ç±»é™å®šåæ˜¯ <code>com.utils.MyTransaction</code> ã€‚</p>\n<p>é‚£ä¹ˆéœ€è¦åœ¨åˆ«åä¸­å£°æ˜ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlia</span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_transaction<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.utils.MyTransaction<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Mybatis ä¼šé€šè¿‡ resolveAlias æ–¹æ³•å»è§£æåˆ«åï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">resolveClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> alias<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>alias <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// æ‹¿åˆ°ç±»</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">resolveAlias</span><span class=\"token punctuation\">(</span>alias<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BuilderException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error resolving class. Cause: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç°åœ¨çœ‹ä¸€ä¸‹æ•´ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span> <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>typeAlia</span> <span class=\"token attr-name\">alias</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_transaction<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.utils.MyTransaction<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>typeAliases</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_transaction<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbc.driver&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbc.url&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbc.username&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;jdbc.password&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">&lt;!-- å®šä¹‰ mapper--></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è‡ªå®šä¹‰äº‹åŠ¡å·¥å‚ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyTransactionFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TransactionFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">NAME</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">MyTransactionFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Properties</span> props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" setProperties()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Transaction</span> <span class=\"token function\">newTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> conn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" newTransaction()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyTransaction</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Transaction</span> <span class=\"token function\">newTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DataSource</span> dataSource<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                                      ransactionIsolationLevel level<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                                      <span class=\"token keyword\">boolean</span> autoCommit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" newTransaction()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyTransaction</span><span class=\"token punctuation\">(</span>dataSource<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è‡ªå®šä¹‰äº‹åŠ¡ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyTransaction</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Transaction</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">NAME</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">MyTransaction</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" getConnection()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" commit()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">getAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" rollback()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">getAutoCommit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre> </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" close()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>\n<h2 id=\"datasourceæ ‡ç­¾\"><a class=\"anchor\" href=\"#datasourceæ ‡ç­¾\">#</a> dataSource æ ‡ç­¾</h2>\n<p>å…ˆçœ‹ä¸€ä¸‹ä¹‹å‰ <code>dataSource</code>  æ˜¯ä»€ä¹ˆï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;é©±åŠ¨ç±»ï¼ˆå«åŒ…åï¼‰&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;æ•°æ®åº“è¿æ¥URL&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;ç”¨æˆ·å&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;å¯†ç &#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><code>&lt;dataSource&gt; </code> æ ‡ç­¾ä½¿ç”¨åŸºæœ¬çš„ JDBC æ•°æ®æºæ¥å£æ¥é…ç½® JDBC è¿æ¥å¯¹è±¡çš„èµ„æºã€‚</p>\n<p><code>type</code>  å¯å–çš„å†…ç½®æ•°æ®æºæœ‰ï¼š <code>UNPOOLED</code> ï¼Œ <code>POOLED</code> ï¼Œ <code>JNDI</code> ã€‚</p>\n<p>ç¬¬äºŒä¸ªæ˜¯ web å¸¸ç”¨çš„ï¼Œä¸åŒçš„æ•°æ®åº“å¯¹è¿™ä¸ªçš„è¡¨ç°ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯¹æŸäº›æ•°æ®åº“æ¥è¯´é…ç½®æ•°æ®æºå¹¶ä¸é‡è¦ï¼Œè¿™ä¸ªé…ç½®ä¹Ÿæ˜¯é—²ç½®çš„ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHhzdHJpdmUuY29tL3N1YmplY3QvbXliYXRpcy8yNDUuaHRt\">https://www.hxstrive.com/subject/mybatis/245.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHhzdHJpdmUuY29tL3N1YmplY3QvbXliYXRpcy8yNDEuaHRt\">https://www.hxstrive.com/subject/mybatis/241.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHhzdHJpdmUuY29tL3N1YmplY3QvbXliYXRpcy8yNDYuaHRt\">https://www.hxstrive.com/subject/mybatis/246.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHhzdHJpdmUuY29tL3N1YmplY3QvbXliYXRpcy8yNDcuaHRt\">https://www.hxstrive.com/subject/mybatis/247.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjYTI4NzI2ZTE=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#a28726e1</span></p>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/16/%E8%BD%BB%E5%B0%8F%E8%AF%B4%E7%BB%93%E5%B1%80%E9%AD%94%E6%94%B9/%E3%80%8A%E6%88%91%E5%92%8C%E5%A5%B3%E5%8F%8B%E7%9A%84%E5%A6%B9%E5%A6%B9%E6%8E%A5%E5%90%BB%E4%BA%86%E3%80%8B/",
            "url": "https://cecilia.cool/2022/10/16/%E8%BD%BB%E5%B0%8F%E8%AF%B4%E7%BB%93%E5%B1%80%E9%AD%94%E6%94%B9/%E3%80%8A%E6%88%91%E5%92%8C%E5%A5%B3%E5%8F%8B%E7%9A%84%E5%A6%B9%E5%A6%B9%E6%8E%A5%E5%90%BB%E4%BA%86%E3%80%8B/",
            "title": "ã€Šæˆ‘å’Œå¥³å‹çš„å¦¹å¦¹æ¥å»äº†ã€‹",
            "date_published": "2022-10-16T15:54:21.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>è¿™æœ¬ä¹¦æ¯æ¬¡æ›´æ–°ï¼Œåœ¨ GA æ–‡åº“é‡Œé¢ï¼Œç›´æ¥å°±æ˜¯ S çº§çƒ­åº¦ï¼Œè¤’ä¸ä¸€ï¼Œè´¬å´å¾ˆä¸€ï¼Œä½†å¤§å®¶æœ€ç»Ÿä¸€çš„æ„è§å°±æ˜¯å¯¹ç»“å±€ä¸æ»¡æ„ï¼ˆæ±‰åŒ–ç»“å±€è¿˜æ²¡å‡ºï¼Œä½†æ˜¯æœ‰äººçœ‹äº†æ—¥æ–‡ç‰ˆï¼Œç„¶åå‰§é€ï¼Œæˆ‘è°¢è°¢ã€‚ï¼‰æˆ‘å¯¹ç»“å±€ä¹Ÿè¶…çº§æ— è¯­ï¼Œè„è¯ï¼ˆ*â€¦â€¦ï¿¥%@**ï¼‰ï¼Œå‡ºäºå¯¹ç»“å±€çš„ä¸æ»¡ï¼Œæˆ‘æƒ³åœ¨æ±‰åŒ–ç‰ˆæ›´æ–°å®ŒåæŒ‰ç…§è‡ªå·±çš„æƒ³æ³•é‡æ„ä¸€ä¸‹ç»“å±€ï¼Œä¹‹äºæˆ‘å–œæ¬¢çš„ç»“å±€ã€‚</p>\n<p>ä½œè€…<strong>æµ·é™†ç©º</strong>ï¼Œè¯´å®è¯ï¼Œè¿™æœ¬ä¹¦å…³äºäººç‰©å¿ƒç†æå†™æ˜¯å¾ˆåˆ°ä½äº†ï¼Œå‰§æƒ…çŸ›ç›¾ä¹Ÿååˆ†çªå‡ºï¼Œä¸ªäººè®¤ä¸ºæœ€é‡è¦çš„ï¼Œæœ€å¥½çš„ï¼Œå°±æ˜¯æ¯ä¸ªäººçš„ä¸ªæ€§é²œæ˜ï¼Œè€Œä¸”è‡³å§‹è‡³ç»ˆã€‚æ— è®ºæ˜¯ä¸¤é¢ä¸ºéš¾ï¼ŒæŠ‰æ‹©ä¸å®šçš„ä½è—¤åšé“ï¼Œè¿˜æ˜¯å ªç§°å®Œç¾çš„ä½è—¤æ—¶é›¨ï¼ˆæ²¡é”™ï¼Œæˆ‘å¯¹æ—¶é›¨çš„è¯„ä»·éå¸¸é«˜ï¼šé¢œå€¼é«˜ï¼Œæ ¼æ–—å¼ºï¼Œä¼šæŒå®¶ï¼Œæ“…é•¿ç†è§£åŒ…å®¹ä»–äººï¼Œæ•¢çˆ±æ•¢æ¨ç­‰ç­‰ï¼Œæˆ‘å°±æ˜¯æ—¶é›¨é‡åº¦æ‚£è€…ï¼‰ï¼Œä»¥åŠå°†å‘¨å›´ç†æƒ³åŒ–çš„æ‰å·æ™´é¦™ã€‚å½“ç„¶ï¼Œç”·ä¸»æœ‰äº›æ€§æ ¼æˆ‘æ˜¯çœŸçš„æ— è¯­ï¼Œå‡ºäºå‰§æƒ…éœ€è¦ï¼Œæˆ‘ç†è§£ã€‚</p>\n<blockquote>\n<p>å…¶å®ä»…é™ä¸‰ä¸ªäººï¼Œäººç‰©å¡‘é€ éš¾åº¦ä¹Ÿä¸å¤§ã€‚</p>\n</blockquote>\n<p>ä¸‹é¢ç»™å‡ºä¸€äº›èŠ‚é€‰ï¼Œæˆ‘è§‰å¾—å†™çš„æ¯”è¾ƒå¥½ï¼š</p>\n<p>ä½è—¤åšé“å¿ƒç†æ´»åŠ¨ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ä¸æ˜¯çš„ï¼Œæ™´é¦™ï¼Œä¸æ˜¯è¿™æ ·çš„ã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>æˆ‘å…¶å®æ‰ä¸åœ¨ä¹ä»€ä¹ˆçƒŸç«å¤§ä¼šï¼Œå¯¹é‚£ä¸€ç‚¹å…´è¶£ä¹Ÿæ²¡æœ‰ã€‚çº¦ä¼šä¹Ÿä¸€æ ·ã€‚ä»Šå¤©ä¹Ÿå¥½æ˜å¤©ä¹Ÿç½¢ï¼Œå“ªå¤©éƒ½æ— æ‰€è°“ã€‚åªæ˜¯<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>æˆ‘å°±åªæ˜¯å¸Œæœ›<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>ä½ èƒ½å¤Ÿé€‰æ‹©æˆ‘ã€‚</pre></td></tr></table></figure><p>ä½è—¤æ—¶é›¨å¯¹è¯ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>è¦æ˜¯è¿™æ ·çš„æ„Ÿæƒ…èƒ½ä¼ è¾¾ç»™å“¥å“¥ï¼Œé‚£ä¹ˆå’Œå§Šå§Šçš„å…³ç³»å¦‚ä½•ï¼Œå¯¹æˆ‘æ¥è¯´éƒ½æ— æ‰€è°“äº†ã€‚æ›¾ç»æ˜¯æŒšçˆ±çš„å§Šå§Šï¼Œä¹Ÿå˜å¾—ä¸é‡è¦ã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>å°±æ˜¯è¿™å¼ºçƒˆçš„æ‰§è‘—ï¼Œå°†æˆ‘çš„ä¸–ç•Œåˆ’åˆ†ä¸ºã€å”¯ä¸€ä¸€äººã€‘å’Œã€å…¶ä»–äººã€‘ä¸¤ä¸ªéƒ¨åˆ†ã€‚æˆ‘æƒ³è¿™å°±æ˜¯æ‰€è°“çš„çˆ±å§ã€‚</pre></td></tr></table></figure><p>æ‰å·æ™´é¦™å¿ƒç†æ´»åŠ¨ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>é‚£ä¸ªç¬é—´ï¼Œæˆ‘æ„Ÿè§‰æˆ‘çš„ä¸€åˆ‡ä¸æ„‰å¿«éƒ½è¢«å¹åˆ°äº†èº«åã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tä»è‡ªå·±æœ€å–œæ¬¢çš„äººé‚£ï¼Œç¬¬ä¸€æ¬¡æ‹¿åˆ°ç”Ÿæ—¥ç¤¼ç‰©ã€‚æˆ‘å†…å¿ƒçš„ä¸€åˆ‡é˜´éœ¾çš†è¢«é‚£æ²¾æ»¡å„ç§è‰²å½©çš„åˆ·å­æœ‰åŠ›åœ°è¦†ç›–æ‰äº†ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tæˆ‘çŸ¥é“åšé“å›ä¸€å®šå‡†å¤‡å¥½äº†ç¤¼ç‰©ã€‚</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tå°±åƒæˆ‘çŸ¥é“ä»–ä¸€å®šåªçˆ±ç€æˆ‘ä¸€æ ·ã€‚</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tæˆ‘ç›¸ä¿¡ä»–ä¼šä¸€ç›´å›åº”æˆ‘çš„æœŸå¾…ï¼Œè¿™ç‚¹è‡ªä¿¡æˆ‘è¿˜æ˜¯æœ‰çš„ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å¾—åˆ°äº†ä»–çš„å›åº”ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±çš„èº«ä½“ï¼Œä»è„¸é¢ŠéåŠå…¨èº«ï¼Œéƒ½çƒ­çš„åƒæ˜¯è¦èåŒ–äº†ä¸€æ ·ã€‚</pre></td></tr></table></figure><p>æˆ‘è¦è¯´çš„æ˜¯</p>\n<blockquote>\n<p>è™½ç„¶æˆ‘å¾ˆæ¨èè¿™æœ¬è½»å°è¯´ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ è§‰å¾—ä½ æ˜¯é‚£ç§å¯¹äºçˆ±æƒ…å¿ è´ä¸æ¸ï¼Œæ— è®ºå¯¹æ–¹æ€ä¹ˆâ€ å†·è½ â€œä½ ï¼Œä½ éƒ½ä¼šå›åº”å¥¹çš„æœŸå¾…ï¼Œå¦‚æœä½ è§‰å¾—ä½ æ€»æ˜¯èƒ½å¿«åˆ€æ–©ä¹±éº»ï¼Œå¦‚æœä½ è§‰å¾—è¿™æœ¬ä¹¦ä¸€çœ‹æ ‡é¢˜å°±æ˜¯è®©äººæ— è¯­çš„ ntr å°è¯´ï¼ŒæŠ±æ­‰ï¼Œè¯·ä¸è¦çœ‹è¿™æœ¬ä¹¦ï¼Œå› ä¸ºå®ƒç¡®å®ä¸é€‚åˆä½ ã€‚ä¸è¿‡åˆ†åœ°è¯´ï¼Œæˆ‘å°±æ˜¯ä¸ºäº†è¿™æœ¬ä¹¦å•ç‹¬å¼€äº†è¿™ä¹ˆä¸€ä¸ª<strong>è½»å°è¯´ç»“å±€é­”æ”¹</strong>çš„ tagï¼Œå› ä¸ºç»“å±€è®©æˆ‘æ„éš¾å¹³å•Šã€‚</p>\n</blockquote>\n",
            "tags": [
                "è½»å°è¯´ç»“å±€é­”æ”¹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/16/Java/Mybatis/Mybatis(1)-%E5%88%9D%E4%BD%BF%E7%94%A8/",
            "url": "https://cecilia.cool/2022/10/16/Java/Mybatis/Mybatis(1)-%E5%88%9D%E4%BD%BF%E7%94%A8/",
            "title": "Mybatis(1)--åˆä½¿ç”¨",
            "date_published": "2022-10-16T02:49:26.000Z",
            "content_html": "<h1 id=\"xmlè¯­è¨€\"><a class=\"anchor\" href=\"#xmlè¯­è¨€\">#</a> XML è¯­è¨€</h1>\n<p><code>xml</code>  ä¸ <code>html</code>  éƒ½æ˜¯æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„å­é›†ï¼ŒSGML (SGM) æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ï¼Œæ˜¯ä¸€ç§å®šä¹‰ç”µå­æ–‡æ¡£ç»“æ„å’Œæè¿°å…¶å†…å®¹çš„å›½é™…æ ‡å‡†è¯­è¨€ï¼Œå…·æœ‰æå¥½çš„æ‰©å±•æ€§ã€‚</p>\n<ul>\n<li><code>html</code>  ç”¨äºæ˜¾ç¤ºæ•°æ®ï¼Œå…¶ä¸­å…ƒç´ æ˜¯å›ºå®šçš„ï¼Œæµè§ˆå™¨è§£ææ‰§è¡Œã€‚</li>\n<li><code>xml</code>  ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œæ ‡ç­¾å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œ <code>xml</code>  è§£æå™¨éœ€è¦è‡ªå·±å†™ã€‚</li>\n</ul>\n<h2 id=\"æ–‡æ¡£å£°æ˜\"><a class=\"anchor\" href=\"#æ–‡æ¡£å£°æ˜\">#</a> æ–‡æ¡£å£°æ˜</h2>\n<p><code>xml</code>  æ–‡æ¡£é¦–å…ˆéœ€è¦ä½¿ç”¨<strong>æ–‡æ¡£å£°æ˜</strong>æ¥å£°æ˜æ–‡æ¡£ï¼Œä¸”å¿…é¡»å‡ºç°åœ¨æ–‡æ¡£ç¬¬ä¸€è¡Œï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"GB2312\" standalone=\"yes\"?></span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>version</code>  æ˜¯ç‰ˆæœ¬å·ï¼Œ <code>xml 1.0</code>  ç‰ˆæœ¬åœ¨ 1998 å¹´å‘å¸ƒï¼Œ2004 å¹´å‘å¸ƒ <code>1.1</code>  ç‰ˆæœ¬ï¼Œä½†æ˜¯ <code>1.1</code>  ç‰ˆæœ¬ä¸å‘ä¸‹å…¼å®¹ <code>1.0</code>  ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç°åœ¨ä½¿ç”¨çš„ä¾ç„¶æ˜¯ <code>1.0</code> ã€‚</p>\n</li>\n<li>\n<p><code>encoding</code>  è¡¨ç¤ºç¼–ç æ ¼å¼ã€‚</p>\n</li>\n<li>\n<p><code>standalone</code>  è¡¨ç¤ºæ–‡æ¡£æ˜¯å¦ç‹¬ç«‹ï¼Œå³æ˜¯å¦ä¾èµ–å…¶ä»–æ–‡æ¡£ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>æ²¡æœ‰æ–‡æ¡£å£°æ˜çš„ <code>xml</code>  æ–‡æ¡£ï¼Œä¸æ˜¯æ ¼å¼è‰¯å¥½çš„ <code>xml</code>  æ–‡æ¡£ã€‚æ–‡æ¡£å£°æ˜å¿…é¡»ä» <code>xml</code>  æ–‡æ¡£çš„ 1 è¡Œ 1 åˆ—å¼€å§‹ ä¹Ÿå°±æ˜¯å¿…é¡»ç¬¬ä¸€è¡Œé¡¶æ ¼å†™ã€‚</p>\n</blockquote>\n<h2 id=\"xmlå…ƒç´ \"><a class=\"anchor\" href=\"#xmlå…ƒç´ \">#</a> XML å…ƒç´ </h2>\n<p>å…ƒç´ æŒ‡çš„æ˜¯ä»ï¼ˆä¸”åŒ…æ‹¬ï¼‰å¼€å§‹æ ‡ç­¾ç›´åˆ°ï¼ˆä¸”åŒ…æ‹¬ï¼‰ç»“æŸæ ‡ç­¾çš„éƒ¨åˆ†ã€‚å…ƒç´ å¯åŒ…å«å…¶ä»–å…ƒç´ ã€æ–‡æœ¬æˆ–è€…ä¸¤è€…çš„æ··åˆç‰©ã€‚å…ƒç´ ä¹Ÿå¯ä»¥æ‹¥æœ‰å±æ€§ã€‚</p>\n<blockquote>\n<p>ä¸€ä¸ªæ ‡ç­¾å°±æ˜¯ä¸€ä¸ªå…ƒç´ ã€‚</p>\n</blockquote>\n<p>è¦æ±‚ï¼š</p>\n<ul>\n<li>å…ƒç´ éƒ½å¿…é¡»æœ‰å…³é—­æ ‡ç­¾ï¼Œçœç•¥å…³é—­æ ‡ç­¾æ˜¯éæ³•çš„ã€‚å£°æ˜ä¸æ˜¯ XML çš„å…ƒç´ ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œçš„å£°æ˜ï¼Œå¹¶ä¸éœ€è¦å…³é—­æ ‡ç­¾ã€‚</li>\n<li>å¤§å°æ•æ„Ÿï¼Œå¿…é¡»æ­£ç¡®åµŒå¥—ã€‚</li>\n<li>æœ‰ä¸”å¿…é¡»åªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ ã€‚</li>\n</ul>\n<blockquote>\n<p>æ ‡ç­¾å‘½ååº”å°½å¯èƒ½ç®€çŸ­ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿_ï¼Œé¿å…ä½¿ç”¨è¿å­—ç¬¦ -ã€‚</p>\n</blockquote>\n<p>ä¸€ä¸ªå…ƒç´ ï¼ˆæ ‡ç­¾ï¼‰å¯ä»¥æœ‰å¤šä¸ªå±æ€§ï¼Œ <code>xml</code>  å±æ€§æ˜¯é”®å€¼å¯¹å½¢å¼ï¼Œå¦‚ <code>sex = &quot;male&quot;</code> ï¼Œå€¼å¿…é¡»åŠ å•ï¼ˆåŒï¼‰å¼•å·ã€‚</p>\n<h2 id=\"æ³¨é‡Š\"><a class=\"anchor\" href=\"#æ³¨é‡Š\">#</a> æ³¨é‡Š</h2>\n<p><code>CDATA</code>  åŒºæ®µä¸­çš„æ–‡æœ¬ä¼šè¢«è§£æå™¨å¿½ç•¥ â€”â€” <code>&lt;![CDATA[]]&gt;</code> ã€‚</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token cdata\">&lt;![CDATA[to be or not to be]]></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"åˆ«å\"><a class=\"anchor\" href=\"#åˆ«å\">#</a> åˆ«å</h2>\n<blockquote>\n<p><code>&lt;typeAliases&gt;</code>  æ ‡ç­¾ï¼Œè¿™é‡Œç•™ç€åœ¨ Mybatis è®²ã€‚</p>\n</blockquote>\n<h2 id=\"è§£æxml\"><a class=\"anchor\" href=\"#è§£æxml\">#</a> è§£æ XML</h2>\n<blockquote>\n<p>JDK å†…ç½®äº†ä¸€ä¸ª <code>org.w3c</code>  çš„ XML è§£æåº“ã€‚</p>\n</blockquote>\n<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>test.xml</code>  æ–‡ä»¶ï¼Œä¸ºäº†ç®€å•ï¼Œç›´æ¥æŠŠå®ƒæ”¾åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆä¸ <code>src</code>  åŒçº§ï¼‰</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>message</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>to</span><span class=\"token punctuation\">></span></span>Mike<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>to</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>from</span><span class=\"token punctuation\">></span></span>Bob<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>from</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>content</span><span class=\"token punctuation\">></span></span>please get up<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>content</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>message</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è¿™æ˜¯æœ€åŸºæœ¬çš„ <code>xml</code>  å†…å®¹ï¼Œä¹Ÿæ˜¯ w3c çš„ä¾‹å­ã€‚</p>\n<p>å†å†™ä¸€ä¸‹è§£æä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»º DocumentBuilderFactory å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">DocumentBuilderFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token class-name\">DocumentBuilderFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»º DocumentBuilder å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">DocumentBuilder</span> builder <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">newDocumentBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// è¿™é‡Œè¦æ”¹æˆ test.xml è·¯å¾„ï¼Œå› ä¸ºç›´æ¥æ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‰€ä»¥åªéœ€è¦å†™æ–‡ä»¶å</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">Document</span> d <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// æ¯ä¸€ä¸ªæ ‡ç­¾éƒ½ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">NodeList</span> nodeList <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å¯èƒ½æœ‰å¾ˆå¤šä¸ªåå­—ä¸º message çš„æ ‡ç­¾</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Node</span> rootNode <span class=\"token operator\">=</span> nodeList<span class=\"token punctuation\">.</span><span class=\"token function\">item</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è·å–é¦–ä¸ª</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// ä¸€ä¸ªèŠ‚ç‚¹ä¸‹å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚æ ¹èŠ‚ç‚¹ä¸‹å°±å›Šæ‹¬äº†æ‰€æœ‰çš„èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">NodeList</span> childNodes <span class=\"token operator\">=</span> rootNode<span class=\"token punctuation\">.</span><span class=\"token function\">getChildNodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// èŠ‚ç‚¹å¯ä»¥æ˜¯ä¸€ä¸ªå¸¦æœ‰å†…å®¹çš„æ ‡ç­¾ï¼ˆå®ƒå†…éƒ¨å°±è¿˜æœ‰å­èŠ‚ç‚¹ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€æ®µæ–‡æœ¬å†…å®¹</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> childNodes<span class=\"token punctuation\">.</span><span class=\"token function\">getLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Node</span> child <span class=\"token operator\">=</span> childNodes<span class=\"token punctuation\">.</span><span class=\"token function\">item</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// è¿‡æ»¤æ¢è¡Œç¬¦ä¹‹ç±»çš„å†…å®¹ï¼Œå› ä¸ºå®ƒä»¬éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">.</span><span class=\"token function\">getNodeType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ELEMENT_NODE</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">.</span><span class=\"token function\">getNodeName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"ï¼š\"</span> <span class=\"token operator\">+</span>child<span class=\"token punctuation\">.</span><span class=\"token function\">getFirstChild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getNodeValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">// è¾“å‡ºèŠ‚ç‚¹åç§°ï¼Œä¹Ÿå°±æ˜¯æ ‡ç­¾åç§°ï¼Œä»¥åŠæ ‡ç­¾å†…éƒ¨çš„æ–‡æœ¬ï¼ˆå†…éƒ¨çš„å†…å®¹éƒ½æ˜¯å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¦è·å–å†…éƒ¨çš„èŠ‚ç‚¹ï¼‰</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœï¼š</p>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"><span>text</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>toï¼šMike</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>fromï¼šBob</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>contentï¼šplease get up</pre></td></tr></table></figure><blockquote>\n<p>Mybatis ä¹Ÿæ˜¯ä½¿ç”¨çš„ JDK å†…ç½®çš„ <code>xml</code>  è§£æå™¨ã€‚</p>\n</blockquote>\n<h1 id=\"åˆæ¬¡ä½¿ç”¨\"><a class=\"anchor\" href=\"#åˆæ¬¡ä½¿ç”¨\">#</a> åˆæ¬¡ä½¿ç”¨</h1>\n<blockquote>\n<p>é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼ŒMybatis å¾ˆå¥½ç”¨ï¼Œå¯ä»¥é«˜æ•ˆä»£æ›¿ <code>JDBC</code> ï¼Œä½†æ˜¯åœ¨æŸäº›å®é™…åœºæ™¯ä¸­ï¼Œæ¶‰åŠåˆ°å¤æ‚çš„è”è¡¨æŸ¥è¯¢ç­‰æ“ä½œï¼Œè¿˜æ˜¯å¾—ä¹–ä¹–æ‰‹å†™ sql è¯­å¥ï¼Œè¿™ä¹Ÿè­¦ç¤ºæˆ‘ä»¬ï¼šç®—æ³•å¾ˆé‡è¦ï¼Œæ¡†æ¶åªæ˜¯èŠ‚çœæ—¶é—´ï¼Œæ–¹ä¾¿å¼€å‘ã€‚</p>\n</blockquote>\n<p>é€šè¿‡ maven å¯¼å…¥ä¾èµ–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mybatis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.4.6<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆweb é¡¹ç›®æ”¾åœ¨ resources ç›®å½•ï¼‰åˆ›å»º <code>mybatis-config.xml</code>  æ–‡ä»¶ï¼Œå…¶å®åå­—éšä¾¿å–ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environments</span> <span class=\"token attr-name\">default</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>environment</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>development<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>transactionManager</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JDBC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POOLED<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>driver<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;é©±åŠ¨ç±»ï¼ˆå«åŒ…åï¼‰&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>url<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;æ•°æ®åº“è¿æ¥URL&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;ç”¨æˆ·å&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;å¯†ç &#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environment</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>environments</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è¿™é‡Œä»¥ web é¡¹ç›®ä¸ºä¾‹ï¼Œå°† <code>xml</code>  é…ç½®æ–‡ä»¶æ”¾åˆ° Resources ç›®å½•é‡Œé¢ï¼Œæ„å»ºä¸€ä¸ª <code>SqlSessionFactory</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SqlUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSessionFactory</span> factory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SqlSessionFactoryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsReader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mybatis-config.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SqlSession</span> <span class=\"token function\">getSqlSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">openSession</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¯ä¸ªåŸºäº MyBatis çš„åº”ç”¨éƒ½æ˜¯ä»¥ä¸€ä¸ª SqlSessionFactory çš„å®ä¾‹ä¸ºæ ¸å¿ƒçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>SqlSessionFactory</code>  æ¥åˆ›å»ºå¤šä¸ªæ–°çš„ä¼šè¯ï¼Œ <code>SqlSession</code>  å¯¹è±¡ï¼Œæ¯ä¸ªä¼šè¯å°±ç›¸å½“äºæˆ‘ä¸åŒçš„åœ°æ–¹ç™»é™†ä¸€ä¸ªè´¦å·å»è®¿é—®æ•°æ®åº“ï¼Œä½ ä¹Ÿå¯ä»¥è®¤ä¸ºè¿™å°±æ˜¯ä¹‹å‰ JDBC ä¸­çš„ <code>Statement</code>  å¯¹è±¡ï¼Œä¼šè¯ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ã€‚</p>\n<p>ç¼–å†™ä¸€ä¸ªå®ä½“ç±» Studentï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Data</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ Lombok å¾ˆæ–¹ä¾¿</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Data</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> sid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª mapper æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª <code>TestMapper.xml</code>  æ–‡ä»¶ä½œä¸ºæ˜ å°„å™¨ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">mapper</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TestMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>éœ€è¦æ³¨æ„ <code>resultType</code>  å±æ€§çš„åŒ…è·¯å¾„ï¼Œæ¯ä¸ªäººä¸ä¸€æ ·ã€‚</p>\n</blockquote>\n<p>å…¶ä¸­ <code>namespace</code>  å°±æ˜¯å‘½åç©ºé—´ï¼Œæ¯ä¸ª Mapper éƒ½æ˜¯å”¯ä¸€çš„ï¼Œ<strong>å› æ­¤éœ€è¦ç”¨ä¸€ä¸ªå‘½åç©ºé—´æ¥åŒºåˆ†</strong>ï¼Œå®ƒè¿˜å¯ä»¥ç”¨æ¥ç»‘å®šä¸€ä¸ªæ¥å£ã€‚åœ¨é‡Œé¢å†™å…¥äº†ä¸€ä¸ª select æ ‡ç­¾ï¼Œè¡¨ç¤ºæ·»åŠ ä¸€ä¸ª select æ“ä½œï¼ŒåŒæ—¶<strong> id ä½œä¸ºæ“ä½œçš„åç§°</strong>ï¼ŒresultType æŒ‡å®šä¸ºæˆ‘ä»¬åˆšåˆšå®šä¹‰çš„å®ä½“ç±»ï¼Œè¡¨ç¤ºå°†æ•°æ®åº“ç»“æœæ˜ å°„ä¸º <code>Student</code>  ç±»ï¼Œç„¶åå°±åœ¨æ ‡ç­¾ä¸­å†™å…¥æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥å³å¯ã€‚</p>\n<p>ç¼–å†™å¥½åå†é…ç½®æ–‡ä»¶çš„ <code>&lt;configuration&gt;</code>  æ ‡ç­¾ä¸‹ï¼Œæ·»åŠ è¿™ä¸ª Mapper æ˜ å°„å™¨ï¼š</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">resource</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com/cyan/mappers/TestMapper.xml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mappers</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><blockquote>\n<p>è¿™é‡Œçš„ <code>TestMapper.xml</code>  æ”¾åœ¨æ–‡ä»¶å¤¹å†…éƒ¨ä½œä¸ºå†…éƒ¨èµ„æºï¼Œä½¿ç”¨ resource æŒ‡å®šè·¯å¾„ï¼Œresource è¡¨ç¤ºæ˜¯ Jar å†…éƒ¨çš„æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>æœ€ååœ¨ç¨‹åºä¸­ä½¿ç”¨å®šä¹‰å¥½çš„ Mapperï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">SqlUtil</span><span class=\"token punctuation\">.</span>getSqlSession<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> student <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">sqlSelectList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"selectStudent\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        student<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span>println<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ˜ å°„æ¥å£\"><a class=\"anchor\" href=\"#æ˜ å°„æ¥å£\">#</a> æ˜ å°„æ¥å£</h2>\n<p>ç›´æ¥é€šè¿‡ sqlSession è°ƒç”¨ mapper æœ‰æ—¶ä¼šä¸æ˜ç¡®ï¼Œè¿˜æ¶‰åŠåˆ°ç±»å‹è½¬æ¢ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† <code>mapper.xml</code>  ä¸ä¸€ä¸ªæ¥å£ç›¸å…³è”ï¼Œåœ¨ mappers æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºä¸€ä¸ª <code>TestMapper</code>  æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TestMapper</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">selectStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼š</p>\n<ul>\n<li>æ¥å£ä¸ <code>TestMapper.xml</code>  ç›¸å…³è”ï¼š <code>TestMapper.xml</code>  çš„ namespace æ”¹ä¸ºæ¥å£çš„å…¨ç±»é™å®šå</li>\n</ul>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mapper</span> <span class=\"token attr-name\">namespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.TestMapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectStudent<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">resultType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.cyan.entity.Student<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        select * from student</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mapper</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>é€šè¿‡ <code>SqlSession</code>  è·å–å¯¹åº”çš„å®ç°ç±»ï¼š</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlSession</span> sqlSession <span class=\"token operator\">=</span> <span class=\"token class-name\">MybatisUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">TestMapper</span> testMapper <span class=\"token operator\">=</span> sqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TestMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> student <span class=\"token operator\">=</span> testMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectStudent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        student<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token operator\">::</span><span class=\"token function\">println</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>TestMapper</code>  æ¥å£æ˜¯ Mybatis é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆçš„å®ç°ç±»ã€‚è€Œä¸æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tsqlSession<span class=\"token punctuation\">.</span><span class=\"token function\">getMapper</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TestMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// ç»“æœï¼šcom.sun.proxy.$Proxy4</span></pre></td></tr></table></figure><blockquote>\n<p>å°½ç®¡æ­¤æ—¶ <code>Mybatis</code>  ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯é…ç½® <code>TestMapper.xml</code> ï¼Œæ˜ å°„æ¥å£è¿˜æ˜¯æœ‰ç‚¹ä½æ•ˆï¼Œä¹‹åä¼šæœ‰æ›´å¿«æ·çš„åŠæ³•ã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>xml éƒ¨åˆ†ï¼š</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudzNzY2hvb2wuY29tLmNuL3htbC94bWxfY2RhdGEuYXNw\">https://www.w3school.com.cn/xml/xml_cdata.asp</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbm90ZWxlc3MvYXJjaGl2ZS8yMDE4LzA4LzAxLzk0MDA2MzMuaHRtbA==\">https://www.cnblogs.com/noteless/archive/2018/08/01/9400633.html</span></li>\n</ul>\n<p>Mybatis éƒ¨åˆ†ï¼š</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXdlYi9nbjBzeXQjYWY5OTBhY2M=\">https://www.yuque.com/qingkongxiaguang/javaweb/gn0syt#af990acc</span></li>\n</ul>\n</blockquote>\n",
            "tags": [
                "Mybatis"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/14/Java/JVM/JVM(9)-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/",
            "url": "https://cecilia.cool/2022/10/14/Java/JVM/JVM(9)-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/",
            "title": "JVM(9)-åƒåœ¾æ”¶é›†å™¨",
            "date_published": "2022-10-14T04:10:45.000Z",
            "content_html": "<h1 id=\"åƒåœ¾æ”¶é›†å™¨\"><a class=\"anchor\" href=\"#åƒåœ¾æ”¶é›†å™¨\">#</a> åƒåœ¾æ”¶é›†å™¨</h1>\n<blockquote>\n<p>ä¸»è¦æ˜¯ä»‹ç»ä¸åŒæ”¶é›†å™¨å¾—ä¼˜åŠ£ä»¥åŠä½¿ç”¨</p>\n</blockquote>\n<ul>\n<li>\n<p>å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ”¶é›†ï¼Œè€Œå¤šçº¿ç¨‹ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ã€‚</p>\n</li>\n<li>\n<p>ä¸²è¡Œä¸å¹¶è¡Œï¼šä¸²è¡ŒæŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨ä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿æ‰§è¡Œï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œåƒåœ¾æ”¶é›†çš„æ—¶å€™éœ€è¦åœé¡¿ç”¨æˆ·ç¨‹åºï¼›å¹¶å½¢æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚</p>\n</li>\n</ul>\n<h2 id=\"serialæ”¶é›†å™¨\"><a class=\"anchor\" href=\"#serialæ”¶é›†å™¨\">#</a> Serial æ”¶é›†å™¨</h2>\n<p><code>Serial</code>  ç¿»è¯‘ä¸ºä¸²è¡Œï¼Œå³ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚å®ƒæ˜¯å•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œã€‚åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¦æš‚åœç­‰å¾…ã€‚å°½ç®¡ç¼ºç‚¹æ˜æ˜¾ï¼Œä½†æ˜¯ä» JDK1.3.1 å¼€å§‹ï¼ŒSerial æ”¶é›†å™¨å°±æ˜¯é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨äº†ï¼ˆå®¢æˆ·ç«¯æ¨¡å¼ï¼‰ã€‚</p>\n<p>ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>è®¾è®¡ç®€å•é«˜æ•ˆã€‚</li>\n<li>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå†…å­˜ä¸€èˆ¬ä¸å¤§ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li>\n</ul>\n<blockquote>\n<p>å®¢æˆ·ç«¯æ¨¡å¼ä¸€èˆ¬æ˜¯ä¸€äº›æ¡Œé¢çº§å›¾å½¢åŒ–ç•Œé¢åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨å†…å­˜è¾ƒå°‘ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ JDK å½“å‰æ¨¡å¼ä¸ºå®¢æˆ·ç«¯æ¨¡å¼ï¼Œå¯ä»¥åœ¨ jvm.cfg æ–‡ä»¶å°†å†…å®¹ä¿®æ”¹ä¸º</p>\n<pre><code class=\"language-Plain\">-client KNOWN\n-server IGNORE\n</code></pre>\n<p>ä½¿ç”¨ <code>java -version</code>  æŸ¥çœ‹å½“å‰æ¨¡å¼ã€‚ï¼ˆä¸‹å›¾è¿˜æ²¡æœ‰ä¿®æ”¹ä¸ºå®¢æˆ·ç«¯æ¨¡å¼ï¼‰</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/df6e14722988927f.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å®ƒæ˜¯ Client æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå› ä¸ºåœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸‹ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬æ¥è¯´ä¸ä¼šå¾ˆå¤§ã€‚Serial æ”¶é›†å™¨æ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£åœé¡¿æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œè¿™ç‚¹åœé¡¿æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>\n</blockquote>\n<h2 id=\"parnewæ”¶é›†å™¨\"><a class=\"anchor\" href=\"#parnewæ”¶é›†å™¨\">#</a> ParNew æ”¶é›†å™¨</h2>\n<p>æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</p>\n<p>æ˜¯ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºé¦–é€‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œã€‚</p>\n<p>é»˜è®¤å¼€å¯çš„çº¿ç¨‹æ•°é‡ä¸ CPU æ•°é‡ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨ -XX:ParallelGCThreads å‚æ•°æ¥è®¾ç½®çº¿ç¨‹æ•°ã€‚</p>\n<h2 id=\"parallel-scavengeæ”¶é›†å™¨\"><a class=\"anchor\" href=\"#parallel-scavengeæ”¶é›†å™¨\">#</a> Parallel Scavenge æ”¶é›†å™¨</h2>\n<p>å…¶å®ƒæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œå®ƒçš„ç›®æ ‡æ˜¯<strong>è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡</strong>ï¼Œå®ƒè¢«ç§°ä¸º â€œååé‡ä¼˜å…ˆâ€ æ”¶é›†å™¨ã€‚è¿™é‡Œçš„ååé‡æŒ‡ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼ã€‚</p>\n<ul>\n<li>åœé¡¿æ—¶é—´çŸ­é€‚åˆç”¨äºä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œ<strong>è‰¯å¥½çš„å“åº”é€Ÿåº¦æå‡ç”¨æˆ·ä½“éªŒ</strong>ã€‚</li>\n<li>é«˜ååé‡å¯ä»¥å°½å¿«å®Œæˆç¨‹åºè¿ç®—ä»»åŠ¡ï¼Œé€‚åˆåå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</li>\n</ul>\n<blockquote>\n<p>ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚</p>\n</blockquote>\n<p>è¿˜æœ‰ä¸ª<strong> Parallel Old æ”¶é›†å™¨</strong>ï¼Œæ˜¯ Parallel Scavenge è€å¹´ä»£ç‰ˆæœ¬ï¼Œåœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚</p>\n<h2 id=\"serial-oldæ”¶é›†å™¨\"><a class=\"anchor\" href=\"#serial-oldæ”¶é›†å™¨\">#</a> Serial Old æ”¶é›†å™¨</h2>\n<p>Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚</p>\n<p>å¦‚æœç”¨åœ¨ Server æ¨¡å¼ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”:</p>\n<ul>\n<li>åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ (Parallel Old è¯ç”Ÿä»¥å‰) ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li>\n<li>ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚</li>\n</ul>\n<h2 id=\"cmsæ”¶é›†å™¨\"><a class=\"anchor\" href=\"#cmsæ”¶é›†å™¨\">#</a> CMS æ”¶é›†å™¨</h2>\n<blockquote>\n<p>CMS (Concurrent Mark Sweep)ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚</p>\n</blockquote>\n<p>è¿™æ¬¾æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆæ³¨æ„è¿™é‡Œçš„å¹¶å‘å’Œä¹‹å‰çš„å¹¶è¡Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¹¶å‘å¯ä»¥ç†è§£ä¸ºåŒæ—¶è¿è¡Œç”¨æˆ·çº¿ç¨‹å’Œ GC çº¿ç¨‹ï¼Œè€Œå¹¶è¡Œå¯ä»¥ç†è§£ä¸ºå¤šæ¡ GC çº¿ç¨‹åŒæ—¶å·¥ä½œï¼‰æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/17a1a966f2a69388.jpg\" alt=\"\" /></p>\n<p>æ•´ä¸ªæµç¨‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li>åˆå§‹æ ‡è®°ï¼ˆéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ä»…ä»…åªæ˜¯æ ‡è®°å‡º GC Roots èƒ½<strong>ç›´æ¥å…³è”</strong>åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä¸ç”¨æ‹…å¿ƒä¼šåœé¡¿å¤ªé•¿æ—¶é—´ã€‚</li>\n</ul>\n<blockquote>\n<p>ç›´æ¥å…³è”ï¼šè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œè¢«é”çš„å¯¹è±¡ï¼Œé™æ€å¼•ç”¨ï¼ˆæ–¹æ³•åŒºï¼‰ï¼Œè™šæ‹Ÿæœºå†…éƒ¨ä½¿ç”¨çš„å¯¹è±¡</p>\n</blockquote>\n<ul>\n<li>\n<p>å¹¶å‘æ ‡è®°ï¼šä» GC Roots çš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹<strong>éå†æ•´ä¸ªå¯¹è±¡å›¾</strong>çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</p>\n</li>\n<li>\n<p>é‡æ–°æ ‡è®°ï¼ˆéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚è¿™ä¸ªæ—¶é—´ä¼šæ¯”åˆå§‹æ ‡è®°æ—¶é—´é•¿ä¸€ä¸¢ä¸¢ã€‚</p>\n</li>\n<li>\n<p>å¹¶å‘æ¸…é™¤ï¼šæœ€åå°±å¯ä»¥ç›´æ¥å°†æ‰€æœ‰æ ‡è®°å¥½çš„æ— ç”¨å¯¹è±¡è¿›è¡Œåˆ é™¤ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡ç¨‹åºä¸­ä¹Ÿç”¨ä¸åˆ°äº†ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œã€‚</p>\n</li>\n</ul>\n<p>å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹:</p>\n<ul>\n<li>ååé‡ä½ï¼šä½åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡ä¸å¤Ÿé«˜ã€‚</li>\n<li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç° Concurrent Mode Failureã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡ ** å¹¶å‘æ¸…é™¤é˜¶æ®µï¼ˆç¬¬å››ä¸ªé˜¶æ®µï¼‰** ç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚</li>\n<li>æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCã€‚</li>\n</ul>\n<h2 id=\"g1æ”¶é›†å™¨\"><a class=\"anchor\" href=\"#g1æ”¶é›†å™¨\">#</a> G1 æ”¶é›†å™¨</h2>\n<p>å †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€Œ G1ï¼ˆGarbage First ï¼‰ å¯ä»¥ç›´æ¥å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸€èµ·å›æ”¶ã€‚</p>\n<p>åƒåœ¾å›æ”¶åˆ†ä¸º <code>Minor GC</code> ã€ <code>Major GC</code>  å’Œ <code>Full GC</code> ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ•´ä¸ªå †å†…å­˜çš„åƒåœ¾å›æ”¶ï¼Œè€Œ G1 æ”¶é›†å™¨å·§å¦™åœ°ç»•è¿‡äº†è¿™äº›çº¦å®šï¼Œå®ƒå°†æ•´ä¸ª Java å †åˆ’åˆ†æˆ <code>2048</code>  ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹ <code>Region</code>  å—ï¼Œæ¯ä¸ª <code>Regionå—</code> çš„å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨ 1MB åˆ° 32MB ä¹‹é—´ï¼Œä¸”éƒ½ä¸º 2 çš„ N æ¬¡å¹‚ã€‚æ‰€æœ‰çš„ <code>Region</code>  å¤§å°ç›¸åŒï¼Œä¸”åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>\n<p>æ¯ä¸€ä¸ª <code>Region</code>  éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªç”±å†³å®šæ‰®æ¼”å“ªä¸ªè§’è‰²ï¼ˆEdenã€Survivor å’Œè€å¹´ä»£ï¼‰ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®å¯¹åº”çš„è§’è‰²é‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥ã€‚æ­¤å¤–ï¼ŒG1 æ”¶é›†å™¨è¿˜å­˜åœ¨ä¸€ä¸ª Humongous åŒºåŸŸï¼Œå®ƒä¸“é—¨ç”¨äºå­˜æ”¾å¤§å¯¹è±¡ï¼ˆä¸€èˆ¬è®¤ä¸ºå¤§å°è¶…è¿‡äº† Region å®¹é‡ä¸€åŠçš„å¯¹è±¡ä¸ºå¤§å¯¹è±¡ï¼‰è¿™æ ·ï¼Œæ–°ç”Ÿä»£ã€è€å¹´ä»£åœ¨ç‰©ç†ä¸Šï¼Œä¸å†æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œè€Œæ˜¯åˆ°å¤„åˆ†å¸ƒçš„ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/9472c91267ced332.jpg\" alt=\"\" /></p>\n<p>å›æ”¶è¿‡ç¨‹ä¸ CMS ç›¸ä¼¼ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/ec5b94383e100df0.jpg\" alt=\"\" /></p>\n<ul>\n<li>\n<p>åˆå§‹æ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹ TAMS æŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„ Region ä¸­åˆ†é…æ–°å¯¹è±¡ã€‚</p>\n</li>\n<li>\n<p>å¹¶å‘æ ‡è®°ï¼šä» GC Root å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>æœ€ç»ˆæ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šå¯¹ç”¨æˆ·çº¿ç¨‹åšä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µæ¼æ ‡çš„é‚£éƒ¨åˆ†å¯¹è±¡ã€‚</p>\n</li>\n<li>\n<p>ç­›é€‰å›æ”¶ï¼šè´Ÿè´£æ›´æ–° Region çš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ª Region çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œ<strong>å¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ª Region æ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ† Region çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„ Region ä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§ Region çš„å…¨éƒ¨ç©ºé—´</strong>ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šä¸ªæ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</p>\n</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2hsYTdociMyNDY2Yzc5Mg==\">https://www.yuque.com/qingkongxiaguang/javase/hla7hr#2466c792</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tZ2MuaHRtbCMlRTUlOUUlODMlRTUlOUMlQkUlRTYlOTQlQjYlRTklOUIlODYlRTUlOTklQTg=\">https://pdai.tech/md/java/jvm/java-jvm-gc.html# åƒåœ¾æ”¶é›†å™¨</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/13/Java/JVM/JVM(8)-%E5%AF%B9%E8%B1%A1%E5%AD%98%E6%B4%BB%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/",
            "url": "https://cecilia.cool/2022/10/13/Java/JVM/JVM(8)-%E5%AF%B9%E8%B1%A1%E5%AD%98%E6%B4%BB%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/",
            "title": "JVM(8)--å¯¹è±¡å­˜æ´»ä¸åƒåœ¾å›æ”¶",
            "date_published": "2022-10-13T08:20:56.000Z",
            "content_html": "<h1 id=\"å¯¹è±¡å­˜æ´»ç®—æ³•\"><a class=\"anchor\" href=\"#å¯¹è±¡å­˜æ´»ç®—æ³•\">#</a> å¯¹è±¡å­˜æ´»ç®—æ³•</h1>\n<blockquote>\n<p>å°½é‡ä»¥ç®€çŸ­ç²¾ç‚¼çš„è¯­è¨€è®²è§£ï¼Œå””ï¼Œæ‰€è§å³æ‰€å¾—ã€‚</p>\n</blockquote>\n<h2 id=\"å¼•ç”¨è®¡æ•°ç®—æ³•\"><a class=\"anchor\" href=\"#å¼•ç”¨è®¡æ•°ç®—æ³•\">#</a> å¼•ç”¨è®¡æ•°ç®—æ³•</h2>\n<p>ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°å™¨åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶è®¡æ•°å™¨å‡ 1ã€‚å¼•ç”¨è®¡æ•°ä¸º 0 çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p>\n<p>ä¸¤ä¸ªå¯¹è±¡å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå›æ”¶ã€‚</p>\n<p>æ­£å› ä¸ºå¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼Œå› æ­¤ Java è™šæ‹Ÿæœºä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReferenceCountingGC</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ReferenceCountingGC</span> objectA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReferenceCountingGC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">ReferenceCountingGC</span> objectB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReferenceCountingGC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        objectA<span class=\"token punctuation\">.</span>instance <span class=\"token operator\">=</span> objectB<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        objectB<span class=\"token punctuation\">.</span>instance <span class=\"token operator\">=</span> objectA<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å¯è¾¾æ€§åˆ†æç®—æ³•\"><a class=\"anchor\" href=\"#å¯è¾¾æ€§åˆ†æç®—æ³•\">#</a> å¯è¾¾æ€§åˆ†æç®—æ³•</h2>\n<p>é€šè¿‡ GC Roots ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œèƒ½å¤Ÿè¾¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/13/b793a432c31cfc5a.jpg\" alt=\"\" /></p>\n<p>GC Roots ä¸€èˆ¬åŒ…å«ï¼š</p>\n<ul>\n<li><a href=\"https://cecilia.cool/2022/10/10/Java/JVM/JVM(5)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E7%A7%81%E6%9C%89/#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88\">è™šæ‹Ÿæœºæ ˆ</a>ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼‰ã€‚</li>\n<li><a href=\"https://cecilia.cool/2022/10/10/Java/JVM/JVM(5)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E7%A7%81%E6%9C%89/#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88\">æœ¬åœ°æ–¹æ³•æ ˆ</a>ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆè°ƒç”¨ native æ–¹æ³•ï¼‰ã€‚</li>\n<li><a href=\"https://cecilia.cool/2022/10/11/Java/JVM/JVM(6)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB/#%E6%96%B9%E6%B3%95%E5%8C%BA\">æ–¹æ³•åŒº</a>ä¸­ç±»é™æ€å±æ€§ï¼Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼ˆæ–¹æ³•åŒºå…¶å®å°±æ˜¯ heap è€å¹´ä»£åé¢é‚£ä¸ªï¼Œåˆå«å…ƒæ•°æ®åŒºï¼Œæ°¸ä¹…ä»£ï¼‰ã€‚</li>\n<li>è¢«æ·»åŠ äº†é”çš„å¯¹è±¡</li>\n<li>è™šæ‹Ÿæœºå†…éƒ¨éœ€è¦ç”¨åˆ°çš„å¯¹è±¡ã€‚</li>\n</ul>\n<p>ä¸€æ—¦å·²ç»å­˜åœ¨çš„æ ¹èŠ‚ç‚¹ä¸æ»¡è¶³å­˜åœ¨çš„æ¡ä»¶æ—¶ï¼Œé‚£ä¹ˆæ ¹èŠ‚ç‚¹ä¸å¯¹è±¡ä¹‹é—´çš„è¿æ¥å°†è¢«æ–­å¼€ã€‚æ­¤æ—¶è™½ç„¶å¯¹è±¡ 1 ä»å­˜åœ¨å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯ç”±äºå…¶æ²¡æœ‰ä»»ä½•æ ¹èŠ‚ç‚¹å¼•ç”¨ï¼Œæ‰€ä»¥æ­¤å¯¹è±¡å³å¯è¢«åˆ¤å®šä¸ºä¸å†ä½¿ç”¨ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/13/1622fa539ace74ea.jpg\" alt=\"\" /></p>\n<h2 id=\"æ–¹æ³•åŒºå›æ”¶\"><a class=\"anchor\" href=\"#æ–¹æ³•åŒºå›æ”¶\">#</a> æ–¹æ³•åŒºå›æ”¶</h2>\n<blockquote>\n<p>æ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œå…¶å›æ”¶ç‡å¾ˆä½ï¼Œå› æ­¤åœ¨æ–¹æ³•åŒºä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½</p>\n</blockquote>\n<p>å¤§é‡ä½¿ç”¨åå°„ï¼ŒåŠ¨æ€ä»£ç†ï¼ŒCGLib ç­‰æ¡†æ¶ï¼Œè¿™ç±»é¢‘ç¹å®šä¹‰ ClassLoader çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚</p>\n<p>ç±»å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå¹¶ä¸”æ»¡è¶³äº†ä¹Ÿä¸ä¸€å®šä¼šè¢«å¸è½½ï¼š</p>\n<ul>\n<li>\n<p>è¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½è¢«å›æ”¶</p>\n</li>\n<li>\n<p>åŠ è½½è¯¥ç±»çš„ <code>ClassLoader</code>  å·²ç»è¢«å›æ”¶</p>\n</li>\n<li>\n<p>è¯¥ç±»å¯¹è±¡çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"finalize\"><a class=\"anchor\" href=\"#finalize\">#</a> finalize()</h2>\n<p><code>finalize()</code>  ç±»ä¼¼ C++ çš„ææ„å‡½æ•°ï¼Œç”¨æ¥åšå…³é—­å¤–éƒ¨èµ„æºç­‰å·¥ä½œã€‚ä½†æ˜¯ try-finally ç­‰æ–¹å¼å¯ä»¥åšçš„æ›´å¥½ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œ<strong>å› æ­¤æœ€å¥½ä¸è¦ä½¿ç”¨</strong>ã€‚</p>\n<p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ finalize () æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€šè¿‡åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚<strong>è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡</strong>ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize () æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šè°ƒç”¨  <code>finalize()</code>  æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è¯¥æ–¹æ³•åœ¨ Object ç±»ä¸­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">finalize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å¼•ç”¨ç±»å‹\"><a class=\"anchor\" href=\"#å¼•ç”¨ç±»å‹\">#</a> å¼•ç”¨ç±»å‹</h1>\n<p>è¿™ä¸ªåœ¨ <code>WeakHashMap</code>  ä¸­è®²è¿‡ï¼Œç›¸å…³<a href=\"https://cecilia.cool/2022/10/04/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(5)-WeakHashMap/\">é“¾æ¥</a>ã€‚</p>\n<h1 id=\"åƒåœ¾å›æ”¶\"><a class=\"anchor\" href=\"#åƒåœ¾å›æ”¶\">#</a> åƒåœ¾å›æ”¶</h1>\n<h2 id=\"æ ‡è®°-æ¸…é™¤\"><a class=\"anchor\" href=\"#æ ‡è®°-æ¸…é™¤\">#</a> æ ‡è®° - æ¸…é™¤</h2>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/6e2c2f6a36068e2f.jpg\" alt=\"\" /></p>\n<p>å•çº¯æ¸…ç†æ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼šæ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡ä¸é«˜ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚</p>\n<h2 id=\"æ ‡è®°-æ•´ç†\"><a class=\"anchor\" href=\"#æ ‡è®°-æ•´ç†\">#</a> æ ‡è®° - æ•´ç†</h2>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/e25babeccdf54b47.jpg\" alt=\"\" /></p>\n<p>è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p>\n<h2 id=\"å¤åˆ¶\"><a class=\"anchor\" href=\"#å¤åˆ¶\">#</a> å¤åˆ¶</h2>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/14/ea3a84203595777f.jpg\" alt=\"\" /></p>\n<p>æœ‰æ²¡æœ‰æƒ³èµ·å †åŒºä¸­çš„ä¸¤ä¸ªå¹¸å­˜è€…åŒºï¼Œå°½ç®¡è¿™ä¸æ˜¯ï¼Œè¿™ç§å¤åˆ¶çš„ç¼ºç‚¹æ˜¯åªæ˜¯ç”¨äº†å†…å­˜çš„ä¸€åŠï¼Œç°åœ¨çš„ JVM éƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œè€Œä¸æ˜¯å°†æ–°ç”Ÿä»£åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden ç©ºé—´å’Œå…¶ä¸­ä¸€å— Survivorã€‚</p>\n<p>HotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor çš„å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º <strong>8:1</strong>ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90%ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œ<strong>é‚£ä¹ˆä¸€å— Survivor ç©ºé—´å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ä¾èµ–äºè€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡</strong>ï¼ˆè¿™å°±æ˜¯ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶ï¼‰ã€‚</p>\n<p>å…ˆçœ‹ä¸€ä¸‹åƒåœ¾æ”¶é›†ç±»åˆ«ï¼š</p>\n<ul>\n<li>\n<p>Minor GC  -  æ¬¡è¦åƒåœ¾å›æ”¶ï¼Œä¸»è¦è¿›è¡Œæ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚</p>\n</li>\n<li>\n<ul>\n<li>è§¦å‘æ¡ä»¶ï¼šæ–°ç”Ÿä»£çš„ Eden åŒºå®¹é‡å·²æ»¡æ—¶ã€‚</li>\n</ul>\n</li>\n<li>\n<p>Major GC  -  ä¸»è¦åƒåœ¾å›æ”¶ï¼Œä¸»è¦è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</p>\n</li>\n<li>\n<p>Full GC    -   å®Œå…¨åƒåœ¾å›æ”¶ï¼Œå¯¹æ•´ä¸ª Java å †å†…å­˜å’Œæ–¹æ³•åŒºè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>\n</li>\n<li>\n<ul>\n<li>è§¦å‘æ¡ä»¶ 1ï¼šæ¯æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹³å‡å¤§å°å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>è§¦å‘æ¡ä»¶ 2ï¼šMinor GC åå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£å‰©ä½™ç©ºé—´</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>è§¦å‘æ¡ä»¶ 3ï¼šæ°¸ä¹…ä»£å†…å­˜ä¸è¶³ï¼ˆJDK8 ä¹‹å‰ï¼‰</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>è§¦å‘æ¡ä»¶ 4ï¼šæ‰‹åŠ¨è°ƒç”¨ <code>System.gc()</code>  æ–¹æ³•</li>\n</ul>\n</li>\n</ul>\n<p><strong>è¯¦ç»†çš„ç©ºé—´åˆ†é…æ‹…ä¿</strong>ï¼š</p>\n<p>å½“æ–°ç”Ÿä»£æ— æ³•å®¹çº³æ›´å¤šçš„çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥æŠŠæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ï¼Œè¿™æ ·æ–°ç”Ÿä»£å°±è…¾å‡ºäº†ç©ºé—´æ¥å®¹çº³æ›´å¤šçš„å¯¹è±¡ã€‚</p>\n<p>å¦‚æœè€å¹´ä»£ä¹Ÿè£…ä¸ä¸‹ï¼Œé¦–å…ˆä¼šåˆ¤æ–­ä¸€ä¸‹ä¹‹å‰çš„æ¯æ¬¡åƒåœ¾å›æ”¶è¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°æ˜¯å¦å°äºå½“å‰è€å¹´ä»£çš„å‰©ä½™ç©ºé—´ï¼Œå¦‚æœå°äºï¼Œé‚£ä¹ˆè¯´æ˜ä¹Ÿè®¸å¯ä»¥æ”¾å¾—ä¸‹ï¼ˆä¸è¿‡ä¹Ÿä»…ä»…æ˜¯ä¹Ÿè®¸ï¼Œä¾ç„¶æœ‰å¯èƒ½æ”¾ä¸ä¸‹ï¼Œå› ä¸ºåˆ¤æ–­çš„å®é™…ä¸Šåªæ˜¯å¹³å‡å€¼ï¼Œä¸‡ä¸€è¿™ä¸€æ¬¡çªç„¶éå¸¸å¤§å‘¢ï¼‰ï¼Œå¦åˆ™ï¼Œä¼šå…ˆæ¥ä¸€æ¬¡ Full GCï¼Œè¿›è¡Œä¸€æ¬¡å¤§è§„æ¨¡åƒåœ¾å›æ”¶ï¼Œæ¥å°è¯•è…¾å‡ºç©ºé—´ï¼Œå†æ¬¡åˆ¤æ–­è€å¹´ä»£æ˜¯å¦æœ‰ç©ºé—´å­˜æ”¾ï¼Œè¦æ˜¯è¿˜æ˜¯è£…ä¸ä¸‹ï¼Œç›´æ¥æŠ›å‡º OOM é”™è¯¯ï¼Œæ‘†çƒ‚ã€‚</p>\n<h2 id=\"åˆ†ä»£æ”¶é›†\"><a class=\"anchor\" href=\"#åˆ†ä»£æ”¶é›†\">#</a> åˆ†ä»£æ”¶é›†</h2>\n<p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚</p>\n<p>ä¸€èˆ¬å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p>\n<ul>\n<li>æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå¤åˆ¶ç®—æ³•</li>\n<li>è€å¹´ä»£ä½¿ç”¨ï¼šæ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³•</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tZ2MuaHRtbA==\">https://pdai.tech/md/java/jvm/java-jvm-gc.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2hsYTdociNjY2IxMGZlNA==\">https://www.yuque.com/qingkongxiaguang/javase/hla7hr#ccb10fe4</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/12/Java/JVM/JVM(7)-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/",
            "url": "https://cecilia.cool/2022/10/12/Java/JVM/JVM(7)-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/",
            "title": "JVM(7)--å†…å­˜æ¨¡å‹",
            "date_published": "2022-10-12T05:22:10.000Z",
            "content_html": "<h1 id=\"å¼•å…¥\"><a class=\"anchor\" href=\"#å¼•å…¥\">#</a> å¼•å…¥</h1>\n<blockquote>\n<p>å†…å­˜æ¨¡å‹å’Œå†…å­˜ç»“æ„ä¸ä¸€æ ·ï¼Œé€šè¿‡æœ¬èŠ‚ä»å †æ ˆè§’åº¦å¼•å…¥ JMMï¼Œä¸ºåç»­å†…å®¹åšé“ºå«ã€‚</p>\n</blockquote>\n<p>JMM åœ¨çº¿ç¨‹æ ˆå’Œå †ä¹‹é—´åˆ’åˆ†å†…å­˜ï¼Œå¦‚æœä½ ç³»ç»Ÿçš„å­¦ä¹ è¿‡ Javaï¼Œä¸€å®šå¬è¿‡<strong>å¼•ç”¨ä¿å­˜åœ¨æ ˆä¸­ï¼Œå®ä¾‹åŒ–å¯¹è±¡ä¿å­˜åœ¨å †ä¸­</strong>è¿™æ ·çš„è¯ã€‚ä»é€»è¾‘ä¸Šè¯´æ˜ JMMï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/12/542b995303607bcd.jpg\" alt=\"\" /></p>\n<p>ç”±çº¿ç¨‹åˆ›å»ºçš„å±€éƒ¨å˜é‡å¯¹äºåˆ›å»ºå®ƒçš„çº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰å…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚ å³ä½¿ä¸¤ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œå®Œå…¨ç›¸åŒçš„ä»£ç ï¼Œä¸¤ä¸ªçº¿ç¨‹ä»å°†åœ¨æ¯ä¸ªè‡ªå·±çš„çº¿ç¨‹å †æ ˆä¸­åˆ›å»ºè¯¥ä»£ç çš„å±€éƒ¨å˜é‡ã€‚</p>\n<blockquote>\n<p>åŸºæœ¬ç±»å‹çš„å±€éƒ¨å˜é‡å®Œå…¨å­˜å‚¨åœ¨çº¿ç¨‹å †æ ˆä¸­ï¼Œå¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§ï¼›ä½†æ˜¯ <code>new</code>  å¯¹è±¡æ—¶ï¼Œéƒ½å­˜å‚¨åœ¨å †ä¸Šï¼Œè¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ä¸å¯¹è±¡ä¸€èµ·å­˜å‚¨åœ¨å †ä¸Šã€‚</p>\n</blockquote>\n<h2 id=\"jmmä¸ç¡¬ä»¶å†…å­˜ç»“æ„å…³ç³»\"><a class=\"anchor\" href=\"#jmmä¸ç¡¬ä»¶å†…å­˜ç»“æ„å…³ç³»\">#</a> JMM ä¸ç¡¬ä»¶å†…å­˜ç»“æ„å…³ç³»</h2>\n<blockquote>\n<p>å…¶å®è¯¥éƒ¨åˆ†åœ¨ <code>J.U.C</code>  çš„ <code>volatile</code>  å…³é”®å­—è®²è¿‡ã€‚</p>\n</blockquote>\n<p>å…ˆçœ‹å†…å­˜ç»“æ„å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/12/f8124fb203ff9b3a.jpg\" alt=\"\" /></p>\n<p><code>å†…å­˜-&gt;cache-&gt;å¯„å­˜å™¨</code> ï¼šæœ‰äº›ç»“æ„æ˜¯å°† <code>cache</code>  ä¹Ÿåˆ°äº† CPU é‡Œé¢ã€‚</p>\n<p>å› ä¸º JVM ä¹Ÿæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ CPU çš„ç¨‹åºï¼Œæ‰€ä»¥å †å†…å­˜å’Œçº¿ç¨‹æ ˆçš„æ•°æ®å¯èƒ½åœ¨ä¸‰ä¸ªä½ç½®ï¼Œå°±ä¼šå¯¼è‡´å¯è§æ€§å’ŒåŒæ­¥æ€§çš„é—®é¢˜ï¼š</p>\n<blockquote>\n<p>å¯è§æ€§ï¼šå¯¹è±¡å…±äº«åï¼ŒæŸä¸€ä¸ªçº¿ç¨‹åšå‡ºä¿®æ”¹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Œå°±ä¼šå¯¼è‡´å¦ä¸€ä¸ªçº¿ç¨‹çœ‹ä¸åˆ°ä¿®æ”¹ã€‚</p>\n<p>åŒæ­¥æ€§ï¼šå¤šä¸ªçº¿ç¨‹çš„ä¿®æ”¹ï¼Œåä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ©ç›–å‰ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ã€‚</p>\n</blockquote>\n<p>è¿™äº›éƒ½æ˜¯å¹¶å‘è®²è¿‡çš„ï¼Œä¸å¤šè¯´äº†ï¼Œå‰ä¸€ä¸ªé—®é¢˜é€šè¿‡ <code>volatile</code>  è§£å†³ï¼Œåä¸€ä¸ªé—®é¢˜é€šè¿‡ä¸Šé”è§£å†³ã€‚</p>\n<p>å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼ŒåŒæ­¥å—æœ‰ä¸ªç‰¹æ€§ï¼šåŒæ­¥å—è¿˜ä¿è¯åœ¨åŒæ­¥å—å†…è®¿é—®çš„æ‰€æœ‰å˜é‡éƒ½å°†ä»ä¸»å­˜å‚¨å™¨ä¸­è¯»å…¥ï¼Œå½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—æ—¶ï¼Œæ‰€æœ‰æ›´æ–°çš„å˜é‡å°†å†æ¬¡åˆ·æ–°å›ä¸»å­˜å‚¨å™¨ï¼Œæ— è®ºå˜é‡æ˜¯ä¸æ˜¯å£°æ˜ä¸º volatileã€‚</p>\n<h1 id=\"å†…å­˜æ¨¡å‹\"><a class=\"anchor\" href=\"#å†…å­˜æ¨¡å‹\">#</a> å†…å­˜æ¨¡å‹</h1>\n<blockquote>\n<p>æ¥ä¸‹æ¥çš„å†…å®¹ä¸å¹¶å‘å†…å®¹å¤šæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚æ€»ç»“äº Info ä¸Šçš„æ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ï¼Œä½œè€…ç¨‹æ™“æ˜ã€‚</p>\n</blockquote>\n<h2 id=\"åŸºç¡€\"><a class=\"anchor\" href=\"#åŸºç¡€\">#</a> åŸºç¡€</h2>\n<p>çº¿ç¨‹ä¹‹é—´é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚å‰è€…å¾ˆç®€å•ï¼Œåè€…çš„æ¨¡å‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡æ˜ç¡®çš„å‘é€æ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€šä¿¡ã€‚</p>\n<p>Java çš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ï¼ŒJava çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚</p>\n<h3 id=\"jmmæŠ½è±¡\"><a class=\"anchor\" href=\"#jmmæŠ½è±¡\">#</a> JMM æŠ½è±¡</h3>\n<p>åœ¨å¼•å…¥ä¸­å°±è®²åˆ° JMMï¼Œçº¿ç¨‹ä¹‹é—´å†…å­˜ä¸å…±äº«ã€‚Java ä¸­ï¼Œæ‰€æœ‰å®ä¾‹ï¼Œé™æ€åŸŸï¼Œæ•°ç»„å…ƒç´ å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚æˆ‘ä»¬å¸¸è¯´çš„çº¿ç¨‹é€šä¿¡ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸»å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å‰¯æœ¬ï¼Œæ‰€ä»¥ä¼šå‡ºç°å¯è§æ€§é—®é¢˜ã€‚</p>\n<p><strong>happens-before</strong>ï¼šè¿™ä¸ªæ¦‚å¿µç”¨æ¥é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ï¼Œå¦‚æœ a æ“ä½œçš„ç»“æœéœ€è¦å¯¹ b æ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»å­˜åœ¨ happens-before å…³ç³»ã€‚</p>\n<ul>\n<li>\n<p>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens- before äºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</p>\n</li>\n<li>\n<p>ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨é”çš„è§£é”ï¼Œhappens- before äºéšåå¯¹è¿™ä¸ªç›‘è§†å™¨é”çš„åŠ é”ã€‚</p>\n</li>\n<li>\n<p>volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™ï¼Œhappens- before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ã€‚</p>\n</li>\n<li>\n<p>ä¼ é€’æ€§ï¼šå¦‚æœ A happens- before Bï¼Œä¸” B happens- before Cï¼Œé‚£ä¹ˆ A happens- before Cã€‚</p>\n</li>\n</ul>\n<p>happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚</p>\n<blockquote>\n<p>å› ä¸ºå†…å®¹å®Œæ•´æ€§æ‰å†™çš„è¿™ä¸ªï¼Œæ„Ÿè§‰éƒ½æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒçŸ¥é“æœ‰è¿™ä¹ˆä¸ªæ¦‚å¿µå³å¯ã€‚</p>\n</blockquote>\n<h2 id=\"é‡æ’åº\"><a class=\"anchor\" href=\"#é‡æ’åº\">#</a> é‡æ’åº</h2>\n<p><strong>æ•°æ®ä¾èµ–æ€§</strong>ï¼šå¦‚æœä¸¤ä¸ªæŒ‡ä»¤ï¼ˆæ“ä½œï¼‰é‡æ’åºä¼šå¯¼è‡´æ‰§è¡Œç»“æœæ”¹å˜ï¼Œå°±ä¸å…è®¸é‡æ’åºï¼šå†™åè¯»ï¼Œè¯»åå†™ï¼Œå†™åå†™ã€‚</p>\n<blockquote>\n<p>ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚</p>\n</blockquote>\n<p><strong>as-if-serial</strong>ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">double</span> pi <span class=\"token operator\">=</span> <span class=\"token number\">3.14</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//A</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">double</span> r   <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//B</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">double</span> area <span class=\"token operator\">=</span> pi <span class=\"token operator\">*</span> r <span class=\"token operator\">*</span> r<span class=\"token punctuation\">;</span> <span class=\"token comment\">//C</span></pre></td></tr></table></figure><p>ä¸‰ä¸ªæ“ä½œæ•°ä¾èµ–å…³ç³»ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/12/fb20c093ac1b648f.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å…¶å®å°±æ˜¯ Aï¼ŒB å¯ä»¥éšæ„äº¤æ¢æ‰§è¡Œé¡ºåºã€‚å…¶å®åœ¨è®¡ç®—æœºä¸­ï¼Œè½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„å¼€å‘å¹¶è¡Œåº¦ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµä»è¿™ä¸€ç›®æ ‡ï¼Œä» happens- before çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒJMM åŒæ ·éµä»è¿™ä¸€ç›®æ ‡ã€‚</p>\n</blockquote>\n<h1 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h1>\n<blockquote>\n<p>ä¸ªäººæ„Ÿè§‰ï¼šJMM å°±æ˜¯ä¸ºäº†ï¼ˆå¤šï¼‰çº¿ç¨‹æŒ‡ä»¤æ­£ç¡®æ‰§è¡Œè€Œåšå‡ºçš„åŠªåŠ›ã€‚</p>\n</blockquote>\n<p>ä¸€èˆ¬çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹éƒ½ç¬¦åˆè¿™ä¹ˆä¸€ä¸ªè§„å¾‹ï¼šè¶Šæ˜¯è¿½æ±‚æ€§èƒ½çš„å¤„ç†å™¨ï¼Œå†…å­˜æ¨¡å‹è®¾è®¡ä¼šè¶Šå¼±ï¼Œå› ä¸ºå¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡å‹å¯¹ä»–ä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ã€‚æ¯•ç«Ÿä¸ºäº†ä¿è¯å¹¶å‘ç¯å¢ƒä¸‹ç¨‹åºæ­£ç¡®æ‰§è¡Œï¼Œä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚</p>\n<blockquote>\n<p>JMM æ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹</p>\n</blockquote>\n<p>ä¸åŒå¤„ç†å™¨å¹³å°å¯¹äºæŒ‡ä»¤çš„é‡æ’åºä¹Ÿä¸ç›¸åŒï¼ŒJMM é€šè¿‡æ’å…¥å†…å­˜å±éšœé˜»æ­¢è¿™äº›ä¸åŒå¤„ç†å™¨çš„ä¸åŒé‡æ’åºï¼Œå‘ä¸Šå±è”½äº†å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å·®å¼‚ï¼Œå®ƒåœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šä¸º java ç¨‹åºå‘˜å‘ˆç°äº†ä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡å‹ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/12/b09bbd238021753d.jpg\" alt=\"\" /></p>\n<h2 id=\"jmmçš„è®¾è®¡\"><a class=\"anchor\" href=\"#jmmçš„è®¾è®¡\">#</a> JMM çš„è®¾è®¡</h2>\n<p>ä» JMM è®¾è®¡è€…çš„è§’åº¦æ¥è¯´ï¼Œåœ¨è®¾è®¡ JMM æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®å› ç´ ï¼š</p>\n<ul>\n<li>ç¨‹åºå‘˜å¯¹å†…å­˜æ¨¡å‹çš„ä½¿ç”¨ã€‚ç¨‹åºå‘˜å¸Œæœ›å†…å­˜æ¨¡å‹æ˜“äºç†è§£ï¼Œæ˜“äºç¼–ç¨‹ã€‚ç¨‹åºå‘˜å¸Œæœ›åŸºäºä¸€ä¸ªå¼ºå†…å­˜æ¨¡å‹æ¥ç¼–å†™ä»£ç ã€‚</li>\n<li>ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹å†…å­˜æ¨¡å‹çš„å®ç°ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡å‹å¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åšå°½å¯èƒ½å¤šçš„ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å®ç°ä¸€ä¸ªå¼±å†…å­˜æ¨¡å‹ã€‚</li>\n</ul>\n<blockquote>\n<p>ä¸€æ–¹é¢è¦ä¸ºç¨‹åºå‘˜æä¾›è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é™åˆ¶è¦å°½å¯èƒ½çš„æ”¾æ¾ã€‚</p>\n</blockquote>\n<p>ä¸‹é¢è®©æˆ‘ä»¬çœ‹çœ‹ JSR-133 æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">double</span> pi  <span class=\"token operator\">=</span> <span class=\"token number\">3.14</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//A</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">double</span> r   <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">//B</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">double</span> area <span class=\"token operator\">=</span> pi <span class=\"token operator\">*</span> r <span class=\"token operator\">*</span> r<span class=\"token punctuation\">;</span> <span class=\"token comment\">//C</span></pre></td></tr></table></figure><ul>\n<li>A happens- before Bï¼›</li>\n<li>B happens- before Cï¼›</li>\n<li>A happens- before Cï¼›</li>\n</ul>\n<p>happens- before çš„å®šä¹‰ä¼šè¦æ±‚ï¼šA æ“ä½œæ‰§è¡Œçš„ç»“æœè¦å¯¹ B å¯è§ï¼Œä¸” A æ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ B æ“ä½œä¹‹å‰ã€‚ ä½†æ˜¯ä»ç¨‹åºè¯­ä¹‰çš„è§’åº¦æ¥è¯´ï¼Œ<strong>å¯¹ A å’Œ B åšé‡æ’åºå³ä¸ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœ</strong>ï¼Œä¹Ÿè¿˜èƒ½æé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ï¼ˆå…è®¸è¿™ç§é‡æ’åºå‡å°‘äº†å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼˜åŒ–çš„æŸç¼šï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢è¿™ 3 ä¸ª happens- before å…³ç³»ä¸­ï¼Œè™½ç„¶ 2 å’Œ 3 æ˜¯å¿…éœ€è¦çš„ï¼Œä½† 1 æ˜¯ä¸å¿…è¦çš„ã€‚å› æ­¤ï¼ŒJMM æŠŠ happens- before <strong>è¦æ±‚ç¦æ­¢çš„é‡æ’åº</strong>åˆ†ä¸ºäº†ä¸‹é¢ä¸¤ç±»ï¼š</p>\n<ul>\n<li>ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºã€‚</li>\n<li>ä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºã€‚</li>\n</ul>\n<blockquote>\n<p>è¿™é‡Œè¯´çš„ happens- before <strong>è¦æ±‚ç¦æ­¢çš„é‡æ’åº</strong>å°±æ˜¯ A happens-before Bï¼Œä¹Ÿå°±æ˜¯ A çš„ç»“æœ B å¿…é¡»å¯è§ï¼ˆä½†æ˜¯æ˜¾ç„¶è¿™ä¸æ˜¯å¿…é¡»çš„ï¼‰ã€‚</p>\n</blockquote>\n<p>JMM å¯¹è¿™ä¸¤ç§ä¸åŒæ€§è´¨çš„é‡æ’åºï¼Œé‡‡å–äº†ä¸åŒçš„ç­–ç•¥ï¼š</p>\n<ul>\n<li>å¯¹äºä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºã€‚</li>\n<li>å¯¹äºä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä½œè¦æ±‚ï¼ˆJMM å…è®¸è¿™ç§é‡æ’åºï¼‰ã€‚</li>\n</ul>\n<blockquote>\n<p>ç¬¬äºŒç§å°±æ˜¯ï¼ŒJMM æ”¾å…»äº†ï¼Œéšä¾¿ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ˜¯å¦æ’åºã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tam1tLmh0bWw=\">https://pdai.tech/md/java/jvm/java-jvm-jmm.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW5mb3EuY24vbWluaWJvb2svamF2YV9tZW1vcnlfbW9kZWw=\">https://www.infoq.cn/minibook/java_memory_model</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/11/Java/JVM/JVM(6)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB/",
            "url": "https://cecilia.cool/2022/10/11/Java/JVM/JVM(6)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB/",
            "title": "JVM(6)--å†…å­˜ç»“æ„ä¹‹çº¿ç¨‹å…±äº«",
            "date_published": "2022-10-11T02:23:41.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>å…³äºå†…å­˜ç»“æ„çš„ç¬¬äºŒç¯‡ï¼šåŒ…å«å †å†…å­˜ï¼Œæ–¹æ³•åŒºã€‚</p>\n<h1 id=\"å †å†…å­˜\"><a class=\"anchor\" href=\"#å †å†…å­˜\">#</a> å †å†…å­˜</h1>\n<blockquote>\n<p>Java å †æ˜¯ Java è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°æ®éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p>\n</blockquote>\n<p>JVM æŠŠå †å†…å­˜é€»è¾‘ä¸Šåˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼ˆåˆ’åˆ†çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ– GC æ€§èƒ½ï¼‰:</p>\n<ul>\n<li>å¹´è½»ä»£ï¼šæ–°å¯¹è±¡å’Œæ²¡è¾¾åˆ°ä¸€å®šå¹´é¾„çš„å¯¹è±¡éƒ½åœ¨æ–°ç”Ÿä»£ã€‚</li>\n<li>è€å¹´ä»£ï¼šè¢«é•¿æ—¶é—´ä½¿ç”¨çš„å¯¹è±¡ï¼Œè€å¹´ä»£çš„å†…å­˜ç©ºé—´åº”è¯¥è¦æ¯”å¹´è½»ä»£æ›´å¤§ã€‚</li>\n<li>å…ƒç©ºé—´ï¼ˆJDK1.8 ä¹‹å‰å«æ°¸ä¹…ä»£ï¼‰ï¼šåƒä¸€äº›æ–¹æ³•ä¸­çš„æ“ä½œä¸´æ—¶å¯¹è±¡ç­‰ï¼ŒJDK1.8 ä¹‹å‰æ˜¯å ç”¨ JVM å†…å­˜ï¼ŒJDK1.8 ä¹‹åç›´æ¥ä½¿ç”¨ç‰©ç†å†…å­˜ã€‚</li>\n</ul>\n<p>ä¸»æµè™šæ‹Ÿæœºéƒ½æ˜¯å¯æ‰©å±•çš„ï¼ˆé€šè¿‡  <code>-Xmx</code>  å’Œ  <code>-Xms</code>  æ§åˆ¶ï¼‰ï¼Œå¦‚æœå †ä¸­æ²¡æœ‰å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †æ— æ³•å†æ‰©å±•æ—¶ï¼Œå°±ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>\n<h2 id=\"å¹´è½»ä»£\"><a class=\"anchor\" href=\"#å¹´è½»ä»£\">#</a> å¹´è½»ä»£</h2>\n<p>å¹´è½»ä»£æ˜¯æ‰€æœ‰æ–°å¯¹è±¡åˆ›å»ºçš„åœ°æ–¹ã€‚å½“å¡«å……å¹´è½»ä»£æ—¶ï¼Œæ‰§è¡Œåƒåœ¾æ”¶é›†ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç§°ä¸º <strong>Minor GC</strong>ã€‚å¹´è½»ä¸€ä»£è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ† â€”â€” ä¼Šç”¸å›­ï¼ˆ<strong>Eden Memory</strong>ï¼‰å’Œä¸¤ä¸ªå¹¸å­˜åŒºï¼ˆ<strong>Survivor Memory</strong>ï¼Œè¢«ç§°ä¸º from/to æˆ– s0/s1ï¼‰ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯ <code>8:1:1</code></p>\n<ul>\n<li>å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä½äº Eden å†…å­˜ç©ºé—´ä¸­ï¼Œæ­¤æ—¶ JVM ä¼šç»™å¯¹è±¡å®šä¹‰ä¸€ä¸ªå¯¹è±¡å¹´è½»è®¡æ•°å™¨ã€‚ï¼ˆ <code>-XX:MaxTenuringThreshold</code> ï¼‰ã€‚</li>\n<li>å½“ Eden ç©ºé—´è¢«å¯¹è±¡å¡«ï¼ˆ<strong>ç©ºé—´ä¸è¶³</strong>ï¼‰æ—¶ï¼Œæ‰§è¡Œ<strong> Minor GC</strong>ï¼Œå¹¶å°†æ‰€æœ‰å¹¸å­˜è€…å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ä¸­ã€‚</li>\n<li>Minor GC æ£€æŸ¥å¹¸å­˜è€…å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬ç§»åŠ¨åˆ°<strong>å¦ä¸€ä¸ª</strong>å¹¸å­˜è€…ç©ºé—´ã€‚æ‰€ä»¥æ¯æ¬¡ï¼Œä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´æ€»æ˜¯ç©ºçš„</li>\n<li>ç»è¿‡å¤šæ¬¡ GC å¾ªç¯ï¼ˆæ¯æ¬¡ Minor GC å¯¹è±¡å¹´é¾„ + 1ï¼‰åå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®å¹´è½»ä¸€ä»£å¯¹è±¡çš„å¹´é¾„é˜ˆå€¼æ¥å®ç°çš„ï¼Œç„¶åä»–ä»¬æ‰æœ‰èµ„æ ¼æå‡åˆ°è€ä¸€ä»£ã€‚</li>\n</ul>\n<blockquote>\n<p>å¯¹è±¡è¶…è¿‡äº† <code>-XX:PetenureSizeThreshold</code> ï¼Œå¯¹è±¡ä¼š<strong>ç›´æ¥è¢«åˆ†é…åˆ°è€å¹´ä»£</strong>ã€‚é»˜è®¤æ˜¯ 15 æ¬¡å›æ”¶æ ‡è®°ã€‚</p>\n</blockquote>\n<h2 id=\"è€å¹´ä»£\"><a class=\"anchor\" href=\"#è€å¹´ä»£\">#</a> è€å¹´ä»£</h2>\n<p>æ—§çš„ä¸€ä»£å†…å­˜åŒ…å«é‚£äº›ç»è¿‡è®¸å¤šè½®å°å‹ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚é€šå¸¸ï¼Œåƒåœ¾æ”¶é›†æ˜¯åœ¨è€å¹´ä»£å†…å­˜æ»¡æ—¶æ‰§è¡Œçš„ã€‚è€å¹´ä»£åƒåœ¾æ”¶é›†ç§°ä¸º ä¸» GCï¼ˆMajor GCï¼‰ï¼Œé€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</p>\n<p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´</strong>ã€‚</p>\n<blockquote>\n<p>åœ¨è€å¹´ä»£ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼Œè§¦å‘ Major GCï¼Œè¿›è¡Œå†…å­˜æ¸…ç†ã€‚ä¹‹åå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM å¼‚å¸¸ã€‚</p>\n</blockquote>\n<h2 id=\"å…ƒç©ºé—´\"><a class=\"anchor\" href=\"#å…ƒç©ºé—´\">#</a> å…ƒç©ºé—´</h2>\n<p>ä¸ç®¡æ˜¯ JDK8 ä¹‹å‰çš„æ°¸ä¹…ä»£ï¼Œè¿˜æ˜¯ JDK8 åŠä»¥åçš„å…ƒç©ºé—´ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚</p>\n<p>è™½ç„¶ Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå« Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€</p>\n<h2 id=\"è®¾ç½®å †å†…å­˜å¤§å°å’Œoom\"><a class=\"anchor\" href=\"#è®¾ç½®å †å†…å­˜å¤§å°å’Œoom\">#</a> è®¾ç½®å †å†…å­˜å¤§å°å’Œ OOM</h2>\n<p>å †çš„å¤§å°å¯ä»¥åœ¨ JVM å¯åŠ¨æ—¶ç¡®å®šï¼Œé€šè¿‡ <code>-Xmx</code>  å’Œ <code>-Xms</code>  è®¾å®šï¼š</p>\n<ul>\n<li><code>-Xms</code>  è¡¨ç¤ºå †çš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº <code>-XX:InitialHeapSize</code> ã€‚</li>\n<li><code>-Xmx</code>  è¡¨ç¤ºå †çš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº <code>-XX:MaxHeapSize</code> ã€‚</li>\n</ul>\n<p>å¦‚æœå †çš„å†…å­˜å¤§å°è¶…è¿‡  <code>-Xmx</code>  è®¾å®šçš„æœ€å¤§å†…å­˜ï¼Œ å°±ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>\n<p>é€šå¸¸ä¼šå°†  <code>-Xmx</code>  å’Œ  <code>-Xms</code>  ä¸¤ä¸ªå‚æ•°é…ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸å†éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †çš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½</p>\n<ul>\n<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆå§‹å †å†…å­˜å¤§å°ä¸ºï¼šç”µè„‘å†…å­˜å¤§å° / 64</li>\n<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€å¤§å †å†…å­˜å¤§å°ä¸ºï¼šç”µè„‘å†…å­˜å¤§å° / 4</li>\n</ul>\n<blockquote>\n<p>ä¹Ÿå¯èƒ½å‡ºç°åå·®ï¼Œå¯¼è‡´ä¸‹é¢ä»£ç çš„å†…å­˜å¹¶ä¸ç¬¦åˆè¿™ç§è®¡ç®—ã€‚</p>\n</blockquote>\n<p>å¯ä»¥é€šè¿‡ä»£ç è·å–åˆ°æˆ‘ä»¬çš„è®¾ç½®å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿ OOMï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">// è¿”å› JVM å †å¤§å°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">long</span> initalMemory <span class=\"token operator\">=</span> <span class=\"token class-name\">Runtime</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRuntime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">totalMemory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">/</span><span class=\"token number\">1024</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">// è¿”å› JVM å †çš„æœ€å¤§å†…å­˜</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">long</span> maxMemory <span class=\"token operator\">=</span> <span class=\"token class-name\">Runtime</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRuntime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">maxMemory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">/</span><span class=\"token number\">1024</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-Xms : \"</span><span class=\"token operator\">+</span>initalMemory <span class=\"token operator\">+</span> <span class=\"token string\">\"M\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-Xmx : \"</span><span class=\"token operator\">+</span>maxMemory <span class=\"token operator\">+</span> <span class=\"token string\">\"M\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç³»ç»Ÿå†…å­˜å¤§å°ï¼š\"</span> <span class=\"token operator\">+</span> initalMemory <span class=\"token operator\">*</span> <span class=\"token number\">64</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"G\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç³»ç»Ÿå†…å­˜å¤§å°ï¼š\"</span> <span class=\"token operator\">+</span> maxMemory <span class=\"token operator\">*</span> <span class=\"token number\">4</span> <span class=\"token operator\">/</span> <span class=\"token number\">1024</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"G\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æŸ¥çœ‹jvmå †å†…å­˜åˆ†é…\"><a class=\"anchor\" href=\"#æŸ¥çœ‹jvmå †å†…å­˜åˆ†é…\">#</a> æŸ¥çœ‹ JVM å †å†…å­˜åˆ†é…</h2>\n<ol>\n<li>åœ¨é»˜è®¤ä¸é…ç½® JVM å †å†…å­˜å¤§å°çš„æƒ…å†µä¸‹ï¼ŒJVM æ ¹æ®é»˜è®¤å€¼æ¥é…ç½®å½“å‰å†…å­˜å¤§å°</li>\n<li>é»˜è®¤æƒ…å†µä¸‹æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹æ˜¯ 1:2ï¼Œå¯ä»¥é€šè¿‡  <code>â€“XX:NewRatio</code>  æ¥é…ç½®\n<ul>\n<li>æ–°ç”Ÿä»£ä¸­çš„ <strong>Eden</strong>:<strong>From Survivor</strong>:<strong>To Survivor</strong> çš„æ¯”ä¾‹æ˜¯ <strong>8:1:1</strong>ï¼Œå¯ä»¥é€šè¿‡  <code>-XX:SurvivorRatio</code>  æ¥é…ç½®</li>\n</ul>\n</li>\n<li>è‹¥åœ¨ JDK 7 ä¸­å¼€å¯äº†  <code>-XX:+UseAdaptiveSizePolicy</code> ï¼ŒJVM ä¼šåŠ¨æ€è°ƒæ•´ JVM å †ä¸­å„ä¸ªåŒºåŸŸçš„å¤§å°ä»¥åŠè¿›å…¥è€å¹´ä»£çš„å¹´é¾„ã€‚æ­¤æ—¶  <code>â€“XX:NewRatio</code>  å’Œ  <code>-XX:SurvivorRatio</code>   å°†ä¼šå¤±æ•ˆï¼Œè€Œ JDK 8 æ˜¯é»˜è®¤å¼€å¯ <code>-XX:+UseAdaptiveSizePolicy</code> ã€‚åœ¨ JDK 8 ä¸­ï¼Œ<strong>ä¸è¦éšæ„å…³é—­</strong> <code>-XX:+UseAdaptiveSizePolicy</code> ï¼Œé™¤éå¯¹å †å†…å­˜çš„åˆ’åˆ†æœ‰æ˜ç¡®çš„è§„åˆ’ã€‚</li>\n</ol>\n<blockquote>\n<p>æ‰€ä»¥è®°ä½äº†æ¯”ä¾‹ä¹Ÿæ˜¯ç„¶å¹¶åµå¯¹å—ï¼Ÿ</p>\n</blockquote>\n<p>æ¯æ¬¡ GC åéƒ½ä¼šé‡æ–°è®¡ç®— Edenã€From Survivorã€To Survivor çš„å¤§å°</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-XX:+PrintFlagsFinal</span> <span class=\"token parameter variable\">-version</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> HeapSize</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    uintx ErgoHeapSizeLimit                         <span class=\"token operator\">=</span> <span class=\"token number\">0</span>                                   <span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    uintx HeapSizePerGCThread                       <span class=\"token operator\">=</span> <span class=\"token number\">87241520</span>                            <span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    uintx InitialHeapSize                          :<span class=\"token operator\">=</span> <span class=\"token number\">134217728</span>                           <span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    uintx LargePageHeapSizeThreshold                <span class=\"token operator\">=</span> <span class=\"token number\">134217728</span>                           <span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    uintx MaxHeapSize                              :<span class=\"token operator\">=</span> <span class=\"token number\">2147483648</span>                          <span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">java</span> version <span class=\"token string\">\"1.8.0_211\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Java<span class=\"token punctuation\">(</span>TM<span class=\"token punctuation\">)</span> SE Runtime Environment <span class=\"token punctuation\">(</span>build <span class=\"token number\">1.8</span>.0_211-b12<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Java HotSpot<span class=\"token punctuation\">(</span>TM<span class=\"token punctuation\">)</span> <span class=\"token number\">64</span>-Bit Server VM <span class=\"token punctuation\">(</span>build <span class=\"token number\">25.211</span>-b12, mixed mode<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"æ‰©å±•é€ƒé€¸åˆ†æ\"><a class=\"anchor\" href=\"#æ‰©å±•é€ƒé€¸åˆ†æ\">#</a> æ‰©å±•ï¼šé€ƒé€¸åˆ†æ</h2>\n<blockquote>\n<p>éšç€ JIT ç¼–è¯‘æœŸçš„å‘å±•å’Œé€ƒé€¸åˆ†ææŠ€æœ¯çš„é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆ â€œç»å¯¹â€ äº†ã€‚ â€”â€”ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</p>\n</blockquote>\n<p><strong>é€ƒé€¸åˆ†æ (Escape Analysis) æ˜¯ç›®å‰ Java è™šæ‹Ÿæœºä¸­æ¯”è¾ƒå‰æ²¿çš„ä¼˜åŒ–æŠ€æœ¯</strong>ã€‚é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspot ç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®š<strong>æ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Š</strong>ã€‚</p>\n<p>é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼š</p>\n<ul>\n<li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚</li>\n<li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒè¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ï¼Œç§°ä¸ºæ–¹æ³•é€ƒé€¸ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">StringBuffer</span> <span class=\"token function\">craeteStringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> s2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token class-name\">StringBuffer</span> sb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   sb<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>s1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   sb<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> sb<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//sb å°±å¯ä»¥è¢«å¤–éƒ¨æ–¹æ³•è®¿é—®ï¼Œå³æ–¹æ³•é€ƒé€¸ï¼Œå¦‚æœè¿˜è¢«å¤–éƒ¨çº¿ç¨‹è®¿é—®äº†ï¼Œå°±æ˜¯çº¿ç¨‹é€ƒé€¸ã€‚</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// å¦‚æœä¸æƒ³ sb é€ƒé€¸å‡ºå»ï¼Œå¯ä»¥å†™æˆ sb.toString ()ï¼Œå½“ç„¶æ–¹æ³•è¿”å›ç±»å‹æ”¹ä¸º String</span></pre></td></tr></table></figure><p>ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšä¼˜åŒ–ï¼š</p>\n<ul>\n<li><strong>æ ˆä¸Šåˆ†é…</strong>ï¼šå°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…ï¼Œè¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šé€ƒé€¸ï¼Œå¯¹è±¡å¯èƒ½æ˜¯æ ˆåˆ†é…çš„å€™é€‰ï¼Œè€Œä¸æ˜¯å †åˆ†é…ï¼ˆè¿™ä¸ªå¯ä»¥æœ‰ï¼Œè€Œä¸”ä¼˜åŒ–æ•ˆæœä¼šéå¸¸æ˜æ˜¾ï¼‰ã€‚</li>\n</ul>\n<p>JVM é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ã€‚é‚£å°±é€šè¿‡æ ‡é‡æ›¿æ¢å°†è¯¥å¯¹è±¡åˆ†è§£åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ï¼Œè¿™æ ·è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å°±å¯ä»¥éšæ ˆå¸§å‡ºæ ˆè€Œé”€æ¯ï¼Œå°±å‡è½»äº†åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚</p>\n<ul>\n<li><strong>åŒæ­¥çœç•¥</strong>ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªèƒ½ä»ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">keep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token class-name\">Object</span> keeper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">synchronized</span><span class=\"token punctuation\">(</span>keeper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>keeper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// å½“ç„¶ï¼Œè¿™ç§æ›´è€ƒéªŒå¼€å‘äººå‘˜å†™ä»£ç çš„æ°´å¹³ï¼Œå› ä¸ºæœ¬æ¥å°±ä¸è¯¥ç»™ keeper</span></pre></td></tr></table></figure><ul>\n<li><strong>åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢</strong>ï¼šæœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œå­˜å‚¨åœ¨ CPU å¯„å­˜å™¨</li>\n</ul>\n<p>åˆ†ç¦»å¯¹è±¡ï¼ˆæ ‡é‡æ›¿æ¢ï¼‰è¯´ç›´ç™½ç‚¹å°±æ˜¯å°†å¯¹è±¡æ‹†åˆ†ä¸ºæ ‡é‡ã€‚</p>\n<blockquote>\n<p><strong>æ ‡é‡</strong>ï¼ˆScalarï¼‰æ˜¯æŒ‡ä¸€ä¸ªæ— æ³•å†åˆ†è§£æˆæ›´å°çš„æ•°æ®çš„æ•°æ®ï¼Œå…¶ä»–çš„å°±æ˜¯èšåˆé‡ã€‚</p>\n</blockquote>\n<p>é€šè¿‡  <code>-XX:+EliminateAllocations</code>  å¯ä»¥å¼€å¯æ ‡é‡æ›¿æ¢ï¼Œ <code>-XX:+PrintEliminateAllocations</code>  æŸ¥çœ‹æ ‡é‡æ›¿æ¢æƒ…å†µã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token class-name\">Point</span> point <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span>ï¼ˆ<span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span>ï¼‰<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"point.x=\"</span><span class=\"token operator\">+</span>point<span class=\"token punctuation\">.</span>x<span class=\"token operator\">+</span><span class=\"token string\">\"; point.y=\"</span><span class=\"token operator\">+</span>point<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>point å¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡º  <code>alloc()</code>  æ–¹æ³•ï¼Œå¹¶ä¸” point å¯¹è±¡æ˜¯å¯ä»¥æ‹†è§£æˆæ ‡é‡çš„ã€‚é‚£ä¹ˆï¼ŒJIT å°±ä¸ä¼šç›´æ¥åˆ›å»º Point å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ä¸¤ä¸ªæ ‡é‡ int x ï¼Œint y æ¥æ›¿ä»£ Point å¯¹è±¡ã€‚</p>\n<p><strong>æ€»ç»“</strong>ï¼š</p>\n<p>** è™½ç„¶ç»è¿‡é€ƒé€¸åˆ†æå¯ä»¥åšæ ‡é‡æ›¿æ¢ã€æ ˆä¸Šåˆ†é…ã€å’Œé”æ¶ˆé™¤ã€‚ä½†æ˜¯é€ƒé€¸åˆ†æè‡ªèº«ä¹Ÿæ˜¯éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„åˆ†æçš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ã€‚** ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œå°±æ˜¯ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œå‘ç°æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸é€ƒé€¸çš„ã€‚é‚£è¿™ä¸ªé€ƒé€¸åˆ†æçš„è¿‡ç¨‹å°±ç™½ç™½æµªè´¹æ‰äº†ã€‚å…³äºé€ƒé€¸åˆ†æçš„è®ºæ–‡åœ¨ 1999 å¹´å°±å·²ç»å‘è¡¨äº†ï¼Œä½†ç›´åˆ° JDK 1.6 æ‰æœ‰å®ç°ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯åˆ°å¦‚ä»Šä¹Ÿå¹¶ä¸æ˜¯ååˆ†æˆç†Ÿçš„ã€‚</p>\n<h1 id=\"æ–¹æ³•åŒº\"><a class=\"anchor\" href=\"#æ–¹æ³•åŒº\">#</a> æ–¹æ³•åŒº</h1>\n<p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ / å­—æ®µ / æ–¹æ³• / æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†ç±»åœ¨åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚è¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯  <code>String.intern()</code>  æ–¹æ³•ã€‚å—æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º  <code>OutOfMemoryErro</code> r å¼‚å¸¸ã€‚</p>\n<h3 id=\"è§£æƒ‘\"><a class=\"anchor\" href=\"#è§£æƒ‘\">#</a> è§£æƒ‘</h3>\n<p>ä½ æ˜¯å¦ä¹Ÿæœ‰çœ‹ä¸åŒçš„å‚è€ƒèµ„æ–™ï¼Œæœ‰çš„å†…å­˜ç»“æ„å›¾æœ‰æ–¹æ³•åŒºï¼Œæœ‰çš„åˆæ˜¯æ°¸ä¹…ä»£ï¼Œå…ƒæ•°æ®åŒºï¼Œä¸€è„¸æ‡µé€¼çš„æ—¶å€™ï¼Ÿ</p>\n<ul>\n<li><strong>æ–¹æ³•åŒºï¼ˆmethod areaï¼‰åªæ˜¯ JVM è§„èŒƒä¸­å®šä¹‰çš„ä¸€ä¸ªæ¦‚å¿µ</strong>ï¼Œç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡ã€JIT ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œå¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å»å®ç°å®ƒï¼Œä¸åŒçš„å‚å•†æœ‰ä¸åŒçš„å®ç°ã€‚è€Œ<strong>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰æ˜¯ Hotspot è™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œ Java8 çš„æ—¶å€™åˆè¢«å…ƒç©ºé—´</strong>å–ä»£äº†ï¼Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´éƒ½å¯ä»¥ç†è§£ä¸ºæ–¹æ³•åŒºçš„è½åœ°å®ç°ã€‚</li>\n<li>æ°¸ä¹…ä»£ç‰©ç†æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œå’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£åœ°å€æ˜¯è¿ç»­çš„ï¼ˆå—åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼‰ï¼Œè€Œå…ƒç©ºé—´å­˜åœ¨äºæœ¬åœ°å†…å­˜ï¼ˆæˆ‘ä»¬å¸¸è¯´çš„å †å¤–å†…å­˜ï¼Œä¸å—åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼‰ï¼Œè¿™æ ·å°±ä¸å— JVM é™åˆ¶äº†ï¼Œä¹Ÿæ¯”è¾ƒéš¾å‘ç”Ÿ OOMï¼ˆéƒ½ä¼šæœ‰æº¢å‡ºå¼‚å¸¸ï¼‰ã€‚</li>\n<li>Java7 ä¸­æˆ‘ä»¬é€šè¿‡ <code>-XX:PermSize</code>  å’Œ  <code>-xx:MaxPermSize</code>  æ¥è®¾ç½®æ°¸ä¹…ä»£å‚æ•°ï¼ŒJava8 ä¹‹åï¼Œéšç€æ°¸ä¹…ä»£çš„å–æ¶ˆï¼Œè¿™äº›å‚æ•°ä¹Ÿå°±éšä¹‹å¤±æ•ˆäº†ï¼Œæ”¹ä¸ºé€šè¿‡ <code>-XX:MetaspaceSize</code>  å’Œ  <code>-XX:MaxMetaspaceSize</code>  ç”¨æ¥è®¾ç½®å…ƒç©ºé—´å‚æ•°ã€‚</li>\n<li>å­˜å‚¨å†…å®¹ä¸åŒï¼Œå…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œé™æ€å˜é‡å’Œå¸¸é‡æ± ç­‰å¹¶å…¥å †ä¸­ã€‚ç›¸å½“äºæ°¸ä¹…ä»£çš„æ•°æ®è¢«åˆ†åˆ°äº†å †å’Œå…ƒç©ºé—´ä¸­ã€‚</li>\n<li>å¦‚æœæ–¹æ³•åŒºåŸŸä¸­çš„å†…å­˜ä¸èƒ½ç”¨äºæ»¡è¶³åˆ†é…è¯·æ±‚ï¼Œåˆ™ Java è™šæ‹ŸæœºæŠ›å‡º  <code>OutOfMemoryError</code> ã€‚</li>\n<li>JVM è§„èŒƒè¯´æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç›®å‰å®é™…ä¸Šæ˜¯ä¸ Java å †åˆ†å¼€çš„ï¼ˆNon-Heapï¼‰ã€‚</li>\n</ul>\n<p>æ‰€ä»¥å¯¹äºæ–¹æ³•åŒºï¼ŒJava8 ä¹‹åçš„å˜åŒ–ï¼š</p>\n<ul>\n<li>ç§»é™¤äº†æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œæ›¿æ¢ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼›</li>\n<li>æ°¸ä¹…ä»£ä¸­çš„ class metadata è½¬ç§»åˆ°äº† native memoryï¼ˆæœ¬åœ°å†…å­˜ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºï¼‰ï¼›</li>\n<li>æ°¸ä¹…ä»£ä¸­çš„ interned Strings å’Œ class static variables è½¬ç§»åˆ°äº† Java heapï¼›</li>\n<li>æ°¸ä¹…ä»£å‚æ•° ï¼ˆPermSize MaxPermSizeï¼‰ -&gt; å…ƒç©ºé—´å‚æ•°ï¼ˆMetaspaceSize MaxMetaspaceSizeï¼‰</li>\n</ul>\n<h3 id=\"æ–¹æ³•åŒºå†…éƒ¨ç»“æ„\"><a class=\"anchor\" href=\"#æ–¹æ³•åŒºå†…éƒ¨ç»“æ„\">#</a> æ–¹æ³•åŒºå†…éƒ¨ç»“æ„</h3>\n<blockquote>\n<p>æ–¹æ³•åŒºç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰ã€‚</p>\n</blockquote>\n<h4 id=\"ç±»å‹ä¿¡æ¯\"><a class=\"anchor\" href=\"#ç±»å‹ä¿¡æ¯\">#</a> ç±»å‹ä¿¡æ¯</h4>\n<p>å¯¹æ¯ä¸ªåŠ è½½çš„ç±»å‹ï¼ˆç±» classã€æ¥å£ interfaceã€æšä¸¾ enumã€æ³¨è§£ annotationï¼‰ï¼ŒJVM å¿…é¡»åœ¨æ–¹æ³•åŒºä¸­å­˜å‚¨ä»¥ä¸‹ç±»å‹ä¿¡æ¯</p>\n<ul>\n<li>è¿™ä¸ªç±»å‹çš„å®Œæ•´æœ‰æ•ˆåç§°ï¼ˆå…¨å = åŒ…åã€‚ç±»åï¼‰</li>\n<li>è¿™ä¸ªç±»å‹ç›´æ¥çˆ¶ç±»çš„å®Œæ•´æœ‰æ•ˆåï¼ˆå¯¹äº interface æˆ–æ˜¯ java.lang.Objectï¼Œéƒ½æ²¡æœ‰çˆ¶ç±»ï¼‰</li>\n<li>è¿™ä¸ªç±»å‹çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œabstractï¼Œfinal çš„æŸä¸ªå­é›†ï¼‰</li>\n<li>è¿™ä¸ªç±»å‹ç›´æ¥æ¥å£çš„ä¸€ä¸ªæœ‰åºåˆ—è¡¨</li>\n</ul>\n<h4 id=\"åŸŸä¿¡æ¯\"><a class=\"anchor\" href=\"#åŸŸä¿¡æ¯\">#</a> åŸŸä¿¡æ¯</h4>\n<ul>\n<li>JVM å¿…é¡»åœ¨æ–¹æ³•åŒºä¸­ä¿å­˜ç±»å‹çš„æ‰€æœ‰åŸŸçš„ç›¸å…³ä¿¡æ¯ä»¥åŠåŸŸçš„å£°æ˜é¡ºåº</li>\n<li>åŸŸçš„ç›¸å…³ä¿¡æ¯åŒ…æ‹¬ï¼šåŸŸåç§°ã€åŸŸç±»å‹ã€åŸŸä¿®é¥°ç¬¦ï¼ˆpublicã€privateã€protectedã€staticã€finalã€volatileã€transient çš„æŸä¸ªå­é›†ï¼‰</li>\n</ul>\n<h4 id=\"æ–¹æ³•ä¿¡æ¯\"><a class=\"anchor\" href=\"#æ–¹æ³•ä¿¡æ¯\">#</a> æ–¹æ³•ä¿¡æ¯</h4>\n<p>JVM å¿…é¡»ä¿å­˜æ‰€æœ‰æ–¹æ³•çš„</p>\n<ul>\n<li>æ–¹æ³•åç§°</li>\n<li>æ–¹æ³•çš„è¿”å›ç±»å‹</li>\n<li>æ–¹æ³•å‚æ•°çš„æ•°é‡å’Œç±»å‹</li>\n<li>æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œsynchronizedï¼Œnativeï¼Œabstract çš„ä¸€ä¸ªå­é›†ï¼‰</li>\n<li>æ–¹æ³•çš„å­—ç¬¦ç ï¼ˆbytecodesï¼‰ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨åŠå¤§å°ï¼ˆabstract å’Œ native æ–¹æ³•é™¤å¤–ï¼‰</li>\n<li>å¼‚å¸¸è¡¨ï¼ˆabstract å’Œ native æ–¹æ³•é™¤å¤–ï¼‰\n<ul>\n<li>æ¯ä¸ªå¼‚å¸¸å¤„ç†çš„å¼€å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€ä»£ç å¤„ç†åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­çš„åç§»åœ°å€ã€è¢«æ•è·çš„å¼‚å¸¸ç±»çš„å¸¸é‡æ± ç´¢å¼•</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è¿è¡Œæ—¶å¸¸é‡æ± \"><a class=\"anchor\" href=\"#è¿è¡Œæ—¶å¸¸é‡æ± \">#</a> è¿è¡Œæ—¶å¸¸é‡æ± </h3>\n<p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åŠ è½½ç±»å’Œç»“æ„åˆ°è™šæ‹Ÿæœºåï¼Œå°±ä¼šåˆ›å»ºå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p>\n<ul>\n<li>å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰æ˜¯ Class æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œ<strong>è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­</strong>ã€‚</li>\n<li>JVM ä¸ºæ¯ä¸ªå·²åŠ è½½çš„ç±»å‹ï¼ˆç±»æˆ–æ¥å£ï¼‰éƒ½ç»´æŠ¤ä¸€ä¸ªå¸¸é‡æ± ã€‚æ± ä¸­çš„æ•°æ®é¡¹åƒæ•°ç»„é¡¹ä¸€æ ·ï¼Œæ˜¯é€šè¿‡ç´¢å¼•è®¿é—®çš„ã€‚</li>\n<li>è¿è¡Œæ—¶å¸¸é‡æ± ä¸­åŒ…å«å„ç§ä¸åŒçš„å¸¸é‡ï¼ŒåŒ…æ‹¬ç¼–è¯‘å™¨å°±å·²ç»æ˜ç¡®çš„æ•°å€¼å­—é¢é‡ï¼Œä¹ŸåŒ…æ‹¬åˆ°è¿è¡ŒæœŸè§£æåæ‰èƒ½å¤Ÿè·å¾—çš„æ–¹æ³•æˆ–å­—æ®µå¼•ç”¨ã€‚æ­¤æ—¶ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·åœ°å€äº†ï¼Œè¿™é‡Œæ¢ä¸ºçœŸå®åœ°å€ã€‚è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç›¸å¯¹äº Class æ–‡ä»¶å¸¸é‡æ± çš„å¦ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼š<strong>åŠ¨æ€æ€§</strong>ï¼ŒJava è¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘æœŸé—´æ‰èƒ½äº§ç”Ÿï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯ä»¥å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼ŒString ç±»çš„  <code>intern()</code>  æ–¹æ³•å°±æ˜¯è¿™æ ·çš„ã€‚</li>\n<li>å½“åˆ›å»ºç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶å¸¸é‡æ± æ—¶ï¼Œå¦‚æœæ„é€ è¿è¡Œæ—¶å¸¸é‡æ± æ‰€éœ€çš„å†…å­˜ç©ºé—´è¶…è¿‡äº†æ–¹æ³•åŒºæ‰€èƒ½æä¾›çš„æœ€å¤§å€¼ï¼Œåˆ™ JVM ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li>\n</ul>\n<h3 id=\"æ–¹æ³•åŒºçš„gc\"><a class=\"anchor\" href=\"#æ–¹æ³•åŒºçš„gc\">#</a> æ–¹æ³•åŒºçš„ GC</h3>\n<p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼š<strong>å¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹</strong>ã€‚</p>\n<p>å…ˆæ¥è¯´è¯´æ–¹æ³•åŒºå†…å¸¸é‡æ± ä¹‹ä¸­ä¸»è¦å­˜æ”¾çš„ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘ Java è¯­è¨€å±‚æ¬¡çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸º final çš„å¸¸é‡å€¼ç­‰ã€‚è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š</p>\n<ul>\n<li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li>\n<li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li>\n<li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li>\n</ul>\n<p>HotSpot è™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</p>\n<p>åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äº â€œä¸å†è¢«ä½¿ç”¨çš„ç±»â€ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p>\n<ul>\n<li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹</li>\n<li>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚ OSGiã€JSP çš„é‡åŠ è½½ç­‰ï¼Œå¦åˆ™é€šå¸¸å¾ˆéš¾è¾¾æˆ</li>\n<li>è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•</li>\n</ul>\n<p>Java è™šæ‹Ÿæœºè¢«å…è®¸å †æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯ â€œè¢«å…è®¸â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œä¸ä½¿ç”¨äº†å°±å¿…ç„¶ä¼šå›æ”¶ã€‚æ˜¯å¦å¯¹ç±»è¿›è¡Œå›æ”¶ï¼ŒHotSpot è™šæ‹Ÿæœºæä¾›äº†  <code>-Xnoclassgc</code>  å‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨  <code>-verbose:class</code>  ä»¥åŠ  <code>-XX:+TraceClassLoading</code>  ã€ <code>-XX:+TraceClassUnLoading</code>  æŸ¥çœ‹ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯ã€‚</p>\n<p>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLib ç­‰ ByteCode æ¡†æ¶ã€åŠ¨æ€ç”Ÿæˆ JSP ä»¥åŠ OSGi è¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ ClassLoader çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½çš„åŠŸèƒ½ï¼Œä»¥ä¿è¯æ°¸ä¹…ä»£ä¸ä¼šæº¢å‡ºã€‚</p>\n<h1 id=\"å‚è€ƒä¸æ„Ÿè°¢\"><a class=\"anchor\" href=\"#å‚è€ƒä¸æ„Ÿè°¢\">#</a> å‚è€ƒä¸æ„Ÿè°¢</h1>\n<ul>\n<li>ä½œè€…ï¼šæµ·æ˜Ÿ</li>\n<li>æ¥æºäºï¼šJavaKeeper</li>\n</ul>\n<p>åŸä½œè€…å‚è€ƒå†…å®¹å¦‚ä¸‹</p>\n<p>ç®—æ˜¯ä¸€ç¯‡å­¦ä¹ ç¬”è®°ï¼Œå…±å‹‰ï¼Œä¸»è¦æ¥æºï¼š</p>\n<p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº ç¬¬ä¸‰ç‰ˆã€‹</p>\n<p>å®‹çº¢åº·è€å¸ˆçš„ JVM æ•™ç¨‹</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlL3NwZWNzL2luZGV4Lmh0bWw=\">https://docs.oracle.com/javase/specs/index.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd2ljZmh3ZmZnL3AvOTM4MjY3Ny5odG1s\">https://www.cnblogs.com/wicfhwffg/p/9382677.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vaG9sbGlzY2h1YW5nL3AvMTI1MDE5NTAuaHRtbA==\">https://www.cnblogs.com/hollischuang/p/12501950.html</span></p>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/10/Java/JVM/JVM(5)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E7%A7%81%E6%9C%89/",
            "url": "https://cecilia.cool/2022/10/10/Java/JVM/JVM(5)-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E4%B9%8B%E7%BA%BF%E7%A8%8B%E7%A7%81%E6%9C%89/",
            "title": "JVM(5)--å†…å­˜ç»“æ„ä¹‹çº¿ç¨‹ç§æœ‰",
            "date_published": "2022-10-10T11:48:04.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>JVM å†…å­˜ç»“æ„ä¸»è¦åˆ†ä¸º 5 ä¸ªï¼š</p>\n<ul>\n<li>\n<p>çº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆã€‚</p>\n</li>\n<li>\n<p>çº¿ç¨‹å…±äº«ï¼šæ–¹æ³•åŒºï¼Œå †å†…å­˜ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/10/db2c0ead0de42c67.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å› ä¸ºå†…å®¹è¾ƒå¤šï¼Œæ‰€ä»¥åˆ†ä¸¤ç¯‡è®²å®Œã€‚</p>\n</blockquote>\n<h1 id=\"ç¨‹åºè®¡æ•°å™¨\"><a class=\"anchor\" href=\"#ç¨‹åºè®¡æ•°å™¨\">#</a> ç¨‹åºè®¡æ•°å™¨</h1>\n<p>ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆ<strong>Program Counter Register</strong>ï¼‰ï¼ŒRegister çš„å‘½åæºäº CPU çš„å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„çº¿ç¨‹ä¿¡æ¯ï¼ŒCPU åªæœ‰æŠŠæ•°æ®è£…è½½åˆ°å¯„å­˜å™¨æ‰èƒ½å¤Ÿè¿è¡Œã€‚</p>\n<p>è¿™é‡Œï¼Œå¹¶éæ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œå«ç¨‹åºè®¡æ•°å™¨ï¼ˆæˆ– PC è®¡æ•°å™¨æˆ–æŒ‡ä»¤è®¡æ•°å™¨ï¼‰ä¼šæ›´åŠ è´´åˆ‡ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·ä¸€äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚<strong>JVM ä¸­çš„ PC å¯„å­˜å™¨æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ</strong>ã€‚</p>\n<blockquote>\n<p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚</p>\n</blockquote>\n<h2 id=\"ä½œç”¨\"><a class=\"anchor\" href=\"#ä½œç”¨\">#</a> ä½œç”¨</h2>\n<p>PC å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/10/8fd60a5f2a320f84.jpg\" alt=\"\" /></p>\n<p>é€šè¿‡ä¸¤ä¸ªé—®é¢˜æ¥ç†è§£ PC å¯„å­˜å™¨ï¼š</p>\n<ul>\n<li><strong>ä½¿ç”¨ PC å¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨ PC å¯„å­˜å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œåœ°å€å‘¢ï¼Ÿ</strong></li>\n</ul>\n<p>å› ä¸º CPU éœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªå¼€å§‹ç»§ç»­æ‰§è¡Œã€‚JVM çš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜ PC å¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>\n<ul>\n<li><strong>PC å¯„å­˜å™¨ä¸ºä»€ä¹ˆä¼šè¢«è®¾å®šä¸ºçº¿ç¨‹ç§æœ‰çš„ï¼Ÿ</strong></li>\n</ul>\n<p>å¤šçº¿ç¨‹åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µå†…åªä¼šæ‰§è¡Œå…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹æ–¹æ³•ï¼ŒCPU ä¼šä¸åœçš„åšä»»åŠ¡åˆ‡æ¢ï¼Œè¿™æ ·å¿…ç„¶ä¼šå¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ã€‚ä¸ºäº†èƒ½å¤Ÿå‡†ç¡®çš„è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæ‰€ä»¥ä¸º<strong>æ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…äº†ä¸€ä¸ª PC å¯„å­˜å™¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ç‹¬ç«‹è®¡ç®—ï¼Œä¸ä¼šäº’ç›¸å½±å“</strong>ã€‚</p>\n<blockquote>\n<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>\n</blockquote>\n<ul>\n<li>å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä¹Ÿæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸ</li>\n<li>åœ¨ JVM è§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´</li>\n<li>ä»»ä½•æ—¶é—´ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>å½“å‰æ–¹æ³•</strong>ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ Java æ–¹æ³•ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯ JVM å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œå¦‚æœæ˜¯æ‰§è¡Œ native æ–¹æ³•ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ (undefined)</li>\n<li>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤</li>\n<li><strong>å®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ JVM è§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•  <code>OutOfMemoryError</code>  æƒ…å†µçš„åŒºåŸŸ</strong></li>\n</ul>\n<h1 id=\"è™šæ‹Ÿæœºæ ˆ\"><a class=\"anchor\" href=\"#è™šæ‹Ÿæœºæ ˆ\">#</a> è™šæ‹Ÿæœºæ ˆ</h1>\n<p>æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå…¶å†…éƒ¨ä¿å­˜ä¸€ä¸ªä¸ªçš„æ ˆå¸§ (Stack Frameï¼‰ï¼Œå¯¹åº”ç€ä¸€æ¬¡æ¬¡ Java æ–¹æ³•è°ƒç”¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ã€‚</p>\n<blockquote>\n<p>æ–¹æ³•è°ƒç”¨ä¼šå…¥æ ˆï¼Œæ–¹æ³•é€’å½’æ—¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªä¸ªæ–¹æ³•ä¸æ–­å…¥æ ˆã€‚å¦‚æœä¸€ç›´é€’å½’æ— æ³•ç»“æŸï¼Œå°±ä¼š <code>StackOverflowError</code> ã€‚</p>\n</blockquote>\n<p><strong>æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</strong>ï¼š</p>\n<p>Java è™šæ‹Ÿæœºè§„èŒƒå…è®¸ <strong>Java è™šæ‹Ÿæœºæ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„</strong></p>\n<ul>\n<li>å¦‚æœé‡‡ç”¨<strong>å›ºå®šå¤§å°</strong>çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Java è™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <strong>StackOverflowError</strong> å¼‚å¸¸</li>\n<li>å¦‚æœ Java è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<strong> OutOfMemoryError</strong> å¼‚å¸¸</li>\n</ul>\n<h2 id=\"å­˜å‚¨å•ä½\"><a class=\"anchor\" href=\"#å­˜å‚¨å•ä½\">#</a> å­˜å‚¨å•ä½</h2>\n<ul>\n<li>\n<p>æ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰çš„æ ¼å¼å­˜åœ¨</strong></p>\n</li>\n<li>\n<p>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªæœ‰å¯¹åº”çš„ä¸€ä¸ªæ ˆå¸§</p>\n</li>\n<li>\n<p>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯</p>\n</li>\n</ul>\n<h2 id=\"è¿è¡ŒåŸç†\"><a class=\"anchor\" href=\"#è¿è¡ŒåŸç†\">#</a> è¿è¡ŒåŸç†</h2>\n<ul>\n<li>\n<p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆ<strong>æ ˆé¡¶æ ˆå¸§</strong>ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸º<strong>å½“å‰æ ˆå¸§</strong>ï¼ˆCurrent Frameï¼‰ï¼Œä¸å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•å°±æ˜¯<strong>å½“å‰æ–¹æ³•</strong>ï¼ˆCurrent Methodï¼‰ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯<strong>å½“å‰ç±»</strong>ï¼ˆCurrent Classï¼‰</p>\n</li>\n<li>\n<p>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œç§°ä¸ºæ–°çš„å½“å‰æ ˆå¸§</p>\n</li>\n<li>\n<p>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œ<strong>ä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨ return æŒ‡ä»¤ï¼Œå¦ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ç®¡ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡º</strong>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æ ˆå¸§å†…éƒ¨ç»“æ„\"><a class=\"anchor\" href=\"#æ ˆå¸§å†…éƒ¨ç»“æ„\">#</a> æ ˆå¸§å†…éƒ¨ç»“æ„</h2>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zMy5ibXAub3ZoL2ltZ3MvMjAyMi8xMC8xMC8yNWJhMzFhMGJlMDM0MzRmLmpwZw==\">https://s3.bmp.ovh/imgs/2022/10/10/25ba31a0be03434f.jpg</span>&quot;  /&gt;</p>\n<p>ä¸Šå›¾æœ€å³è¾¹å³æ˜¯æ ˆå¸§çš„å†…éƒ¨ç»“æ„ï¼š</p>\n<ul>\n<li>åŠ¨æ€é“¾æ¥ï¼šæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ã€‚</li>\n<li>æ–¹æ³•è¿”å›åœ°å€ï¼šæ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„åœ°å€ã€‚</li>\n</ul>\n<h3 id=\"å±€éƒ¨å˜é‡è¡¨\"><a class=\"anchor\" href=\"#å±€éƒ¨å˜é‡è¡¨\">#</a> å±€éƒ¨å˜é‡è¡¨</h3>\n<p><strong>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€è¦çš„å®¹é‡å¤§å°æ˜¯ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥çš„</strong>ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„ Code å±æ€§çš„  <code>maximum local variables</code>  æ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</p>\n<blockquote>\n<p>å±€éƒ¨å˜é‡ä¸ä»…åŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿˜åŒ…æ‹¬å¯¹è±¡å¼•ç”¨ã€‚</p>\n</blockquote>\n<p>å±€éƒ¨å˜é‡è¡¨æœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯ <code>Slot</code> -- æ§½ï¼š</p>\n<ul>\n<li>åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œ32 ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ª Slot (åŒ…æ‹¬ returnAddress ç±»å‹)ï¼Œ64 ä½çš„ç±»å‹ï¼ˆlong å’Œ doubleï¼‰å ç”¨ä¸¤ä¸ªè¿ç»­çš„ Slotã€‚</li>\n<li>byteã€shortã€char åœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸º intï¼Œboolean ä¹Ÿè¢«è½¬æ¢ä¸º intï¼Œ0 è¡¨ç¤º falseï¼Œé 0 è¡¨ç¤º trueã€‚</li>\n</ul>\n<blockquote>\n<p>æ‰€ä»¥æœ‰æ—¶å€™åœ¨æ–¹æ³•é‡Œé¢æƒ³ç€èŠ‚çœç©ºé—´ï¼Œå°† <code>int</code>  åœ¨å…è®¸çš„æƒ…å†µä¸‹æ¢æˆ <code>byte</code>  å•¥çš„ï¼Œå…¶å®å¹¶ä¸èŠ‚çœç©ºé—´ã€‚</p>\n</blockquote>\n<ul>\n<li>\n<p>æ¯ä¸ª Slot å¯¹åº”ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼ŒèŒƒå›´ä» 0 åˆ° Slot æœ€å¤§æ•°é‡ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå½“å‰å¸§æ˜¯ç”±æ„é€ æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•åˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨ this å°†ä¼šå­˜æ”¾åœ¨ index ä¸º 0 çš„ Slot å¤„ï¼Œå…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ï¼ˆè¿™é‡Œå°±å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šé™æ€æ–¹æ³•ä¸­ä¸ºä»€ä¹ˆä¸å¯ä»¥å¼•ç”¨ thisï¼Œå°±æ˜¯å› ä¸º this å˜é‡ä¸å­˜åœ¨äºå½“å‰æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼‰ã€‚</p>\n</li>\n<li>\n<p><strong>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„</strong>ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜çš„æ–°çš„å±€éƒ¨å˜é‡å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œ<strong>è¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„</strong>ã€‚</p>\n</li>\n<li>\n<p><strong>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶</strong>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ“ä½œæ•°æ ˆ\"><a class=\"anchor\" href=\"#æ“ä½œæ•°æ ˆ\">#</a> æ“ä½œæ•°æ ˆ</h3>\n<p><strong>åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ“ä½œæ•°æ ˆä¸­å†™å…¥æ•°æ®æˆ–æå–æ•°æ®ï¼Œå³å…¥æ ˆï¼ˆpushï¼‰ã€å‡ºæ ˆï¼ˆpopï¼‰</strong>ã€‚</p>\n<blockquote>\n<p>å¯¹ï¼Œå°±æ˜¯æ“ä½œæ•°çš„ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p>\n</blockquote>\n<p>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œå…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆã€‚ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆã€‚æ¯”å¦‚ï¼Œæ‰§è¡Œå¤åˆ¶ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œã€‚</p>\n<h3 id=\"åŠ¨æ€é“¾æ¥\"><a class=\"anchor\" href=\"#åŠ¨æ€é“¾æ¥\">#</a> åŠ¨æ€é“¾æ¥</h3>\n<p>åœ¨ Java æºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸º<strong>ç¬¦å·å¼•ç”¨</strong>ï¼ˆSymbolic Referenceï¼‰ä¿å­˜åœ¨ Class æ–‡ä»¶çš„å¸¸é‡æ± ä¸­ã€‚æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆ<strong>åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨</strong></p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/10/05c85fc5e1233e0a.jpg\" alt=\"\" /></p>\n<p><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šå”¯ä¸€ä»»åŠ¡è‘—æ˜¯ç¡®å®šè¢«è°ƒç”¨æ–¹æ³•çš„ç‰ˆæœ¬ï¼ˆå³è°ƒç”¨å“ªä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œä¸æ¶‰åŠæ–¹æ³•å†…éƒ¨çš„å…·ä½“è¿è¡Œè¿‡ç¨‹ã€‚Class æ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸åŒ…æ‹¬ä¼ ç»Ÿç¼–è¯‘å™¨ä¸­çš„è¿æ¥æ­¥éª¤ï¼Œä¸€åˆ‡<strong>æ–¹æ³•è°ƒç”¨</strong>åœ¨ Class æ–‡ä»¶é‡Œé¢å­˜å‚¨çš„éƒ½æ˜¯<strong>ç¬¦å·å¼•ç”¨</strong>ï¼Œè€Œä¸æ˜¯æ–¹æ³•åœ¨å®é™…è¿è¡Œæ—¶å†…å­˜å¸ƒå±€ä¸­çš„å…¥å£åœ°å€ï¼ˆ<strong>ç›´æ¥å¼•ç”¨</strong>ï¼‰ã€‚ä¹Ÿå°±æ˜¯éœ€è¦åœ¨ç±»åŠ è½½é˜¶æ®µï¼Œç”šè‡³åˆ°è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šç›®æ ‡æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</p>\n<ul>\n<li>\n<p><strong>é™æ€é“¾æ¥</strong>ï¼šå½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿› JVM å†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„<strong>ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸå¯çŸ¥</strong>ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ã€‚è¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥</p>\n</li>\n<li>\n<p><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šå¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥</p>\n</li>\n</ul>\n<p>å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©æœŸç»‘å®šï¼ˆEarly Bindingï¼‰å’Œæ™šæœŸç»‘å®šï¼ˆLate Bindingï¼‰ã€‚<strong>ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡</strong>ã€‚</p>\n<blockquote>\n<p>æ—©æœŸå’Œæ™šæœŸçš„åŒºåˆ«åœ¨äº<strong>è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶</strong>ï¼Œå³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šã€‚è¿™ç§æ–¹æ³•ä¹Ÿå«åšéè™šæ–¹æ³•ã€‚</p>\n</blockquote>\n<h3 id=\"æ–¹æ³•è¿”å›åœ°å€\"><a class=\"anchor\" href=\"#æ–¹æ³•è¿”å›åœ°å€\">#</a> æ–¹æ³•è¿”å›åœ°å€</h3>\n<p>æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°<strong>è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®</strong>ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„ <strong>PC è®¡æ•°å™¨çš„å€¼</strong>ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡<strong>å¼‚å¸¸è¡¨</strong>æ¥ç¡®å®šçš„ï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</p>\n<p>åœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºã€‚ç®€ç§°<strong>å¼‚å¸¸å®Œæˆå‡ºå£</strong>ã€‚</p>\n<p>æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼š<strong>é€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼</strong>ã€‚</p>\n<h1 id=\"æœ¬åœ°æ–¹æ³•æ ˆ\"><a class=\"anchor\" href=\"#æœ¬åœ°æ–¹æ³•æ ˆ\">#</a> æœ¬åœ°æ–¹æ³•æ ˆ</h1>\n<p>ä¸€ä¸ª Native Method å°±æ˜¯ä¸€ä¸ª Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ã€‚æˆ‘ä»¬çŸ¥é“çš„ Unsafe ç±»å°±æœ‰å¾ˆå¤šæœ¬åœ°æ–¹æ³•ã€‚</p>\n<p>æˆ‘ä»¬åœ¨å¼€å‘ç¨‹åºæ—¶ï¼Œæœ‰æ—¶ä¼šä¸å¯é¿å…åœ°ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚</p>\n<ul>\n<li>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚</li>\n<li>å…è®¸çº¿ç¨‹å›ºå®šæˆ–è€…å¯åŠ¨æ€æ‰©å±•çš„å†…å­˜å¤§å°ï¼ˆæŠ›å‡ºå¼‚å¸¸æœºåˆ¶å’Œè™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼‰ã€‚</li>\n<li>æœ¬åœ°æ–¹æ³•å¯ä»¥é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å£æ¥è®¿é—®è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå®ƒç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°å¤„ç†å™¨ä¸­çš„å¯„å­˜å™¨ï¼Œç›´æ¥ä»æœ¬åœ°å†…å­˜çš„å †ä¸­åˆ†é…ä»»æ„æ•°é‡çš„å†…å­˜ã€‚</li>\n<li><strong>åœ¨ Hotspot JVM ä¸­ï¼Œç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€</strong>ã€‚</li>\n</ul>\n<blockquote>\n<p><strong>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½</strong>ã€‚</p>\n<p>æ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ã€æ”¾åœ¨å“ªã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<p><strong>æµ·æ˜Ÿçš„ javakeeper å…¬ä¼—å·</strong>æ•´ç†çš„æ–‡ç« ï¼Œå†™å¾—å¥½å°±ç›´æ¥ç”¨äº†ã€‚</p>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/10/Java/JVM/JVM(4)-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/",
            "url": "https://cecilia.cool/2022/10/10/Java/JVM/JVM(4)-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/",
            "title": "JVM(4)--ç±»åŠ è½½å™¨",
            "date_published": "2022-10-10T02:58:09.000Z",
            "content_html": "<blockquote>\n<p>jvm å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ class æ–‡ä»¶ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½ã€‚ClassLoader çš„å…·ä½“ä½œç”¨å°±æ˜¯å°† class æ–‡ä»¶åŠ è½½åˆ° jvm è™šæ‹Ÿæœºä¸­å»ï¼Œç¨‹åºå°±å¯ä»¥æ­£ç¡®è¿è¡Œäº†ã€‚æ™®é€šçš„<span class=\"exturl\" data-url=\"aHR0cDovL2xpYi5jc2RuLm5ldC9iYXNlL2phdmFzZQ==\"> Java</span> å¼€å‘è€…å…¶å®ç”¨åˆ°çš„ä¸å¤šï¼Œä½†å¯¹äºæŸäº›æ¡†æ¶å¼€å‘è€…æ¥è¯´å´éå¸¸å¸¸è§ã€‚</p>\n</blockquote>\n<h1 id=\"ä½¿ç”¨\"><a class=\"anchor\" href=\"#ä½¿ç”¨\">#</a> ä½¿ç”¨</h1>\n<blockquote>\n<p>çœ‹äº†å¾ˆå¤šæ–‡ç« ï¼Œä¸ªäººè§‰å¾—å…ˆæŠŠå¦‚ä½•ä½¿ç”¨ç±»åŠ è½½å™¨ -- <code>ClassLoader</code>  å¼„æ˜ç™½ï¼Œå†æ¥è®²è§£åŸç†æ•ˆæœå¥½å¾—å¤šã€‚</p>\n</blockquote>\n<p><code>class</code>  å­—èŠ‚ç æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½å­—èŠ‚ç ï¼Œå³åœ¨ java ä¸­æ‰€æœ‰ç±»éƒ½ä¼šé€šè¿‡åŠ è½½å™¨åŠ è½½æ‰èƒ½è¿è¡Œã€‚ä¸‹æ–‡æåˆ°çš„ç±»ä¼¼ <code>Bootstrap ClassLoader</code> ï¼Œ <code>Extension ClassLoader</code>  ç­‰ï¼Œéƒ½æ˜¯ JDK è‡ªå¸¦çš„ï¼Œæ­£æ˜¯è¿™äº›è‡ªå¸¦çš„ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬æ‰èƒ½å°†æºç çš„ class æ–‡ä»¶åŠ è½½å­—èŠ‚ç ã€‚</p>\n<h2 id=\"è‡ªå®šä¹‰classloader\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰classloader\">#</a> è‡ªå®šä¹‰ ClassLoader</h2>\n<p>æ ¸å¿ƒæ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> className<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ ¹æ®åå­—åŠ è½½ä¸€ä¸ªç±»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">defineClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> b<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å°†å­—èŠ‚æµå®šä¹‰ä¸ºç±»</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">findClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æŸ¥æ‰¾ä¸€ä¸ªç±»</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">findLoaderClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// åœ¨å·²åŠ è½½çš„ç±»ä¸­ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªç±»</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">resolveClass</span><span class=\"token punctuation\">(</span>é“¾æ¥æŒ‡å®šçš„<span class=\"token class-name\">Java</span>ç±»<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åŠ¨æ€åŠ è½½ä¸€äº›ä¸œè¥¿ï¼Œæˆ–è€…ä» C ç›˜æŸä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹åŠ è½½ä¸€ä¸ª class æ–‡ä»¶ï¼Œåˆæˆ–è€…ä»ç½‘ç»œä¸Šä¸‹è½½ class ä¸»å†…å®¹ç„¶åå†è¿›è¡ŒåŠ è½½ç­‰ã€‚åˆ†ä¸‰æ­¥æå®šï¼š</p>\n<ul>\n<li>ç¼–å†™ä¸€ä¸ªç±»ç»§æ‰¿ <code>ClassLoader</code>  æŠ½è±¡ç±»ã€‚</li>\n<li>é‡å†™ <code>findClass()</code>  æ–¹æ³•ã€‚</li>\n<li>åœ¨ <code>findClass()</code>  æ–¹æ³•ä¸­è°ƒç”¨ <code>defineClass()</code>  æ–¹æ³•å³å¯å®ç°è‡ªå®šä¹‰ <code>ClassLoader</code> ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> test <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello,world\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// ç¼–è¯‘å¾—åˆ° class æ–‡ä»¶ -> å†™ç¨‹åºå°† class æ–‡ä»¶è½¬æ¢ä¸ºå­—èŠ‚æµ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// InputStream fis = new FileInputStream(\"test.class\");</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// byte[] bytes = IOUtils.readFully(fis, -1, false);</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/10/67d06fbed9be1513.jpg\" alt=\"\" /></p>\n<p>è‡ªå®šä¹‰åŠ è½½å™¨ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token constant\">JVM</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">sun<span class=\"token punctuation\">.</span>misc<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOUtils</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InvocationTargetException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Method</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClassLoaderTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ClassLoader</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">InputStream</span> fis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> testClassname <span class=\"token operator\">=</span> <span class=\"token string\">\"JVM.Test\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    \t\t<span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InstantiationException</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">IllegalAccessException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">NoSuchMethodException</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    \t\t<span class=\"token class-name\">InvocationTargetException</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        fis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src/JVM/Test.class\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        bytes <span class=\"token operator\">=</span> <span class=\"token class-name\">IOUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">readFully</span><span class=\"token punctuation\">(</span>fis<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»ºåŠ è½½å™¨</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">ClassLoaderTest</span> classloadertest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassLoaderTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å»åŠ è½½ testClassname</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Class</span> aClass <span class=\"token operator\">=</span> classloadertest<span class=\"token punctuation\">.</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span>testClassname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// åå°„åˆ›å»º test ç±»å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">Object</span> o <span class=\"token operator\">=</span> aClass<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// åå°„è·å– method æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">Method</span> method <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// åå°„å»è°ƒç”¨æ‰§è¡Œ method æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// åªå¤„ç† JVM.Test ç±»</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>testClassname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token comment\">// å°†ä¸€ä¸ªå­—èŠ‚æµå®šä¹‰ä¸ºä¸€ä¸ªç±»ã€‚</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token comment\">// å…¶å®è¿™ä¸ªåå­—å¯ä»¥éšä¾¿å–</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">defineClass</span><span class=\"token punctuation\">(</span>testClassname<span class=\"token punctuation\">,</span> bytes<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> bytes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">findClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/10/b6c86511a9b493e8.jpg\" alt=\"\" /></p>\n<h1 id=\"ç±»åŠ è½½å™¨å±‚æ¬¡\"><a class=\"anchor\" href=\"#ç±»åŠ è½½å™¨å±‚æ¬¡\">#</a> ç±»åŠ è½½å™¨å±‚æ¬¡</h1>\n<p>ç«™åœ¨å¼€å‘äººå‘˜è§’åº¦ï¼š</p>\n<ul>\n<li><code>Bootstrap ClassLoader</code> ï¼šå¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œè´Ÿè´£åŠ è½½å­˜æ”¾åœ¨ JDK\\jre\\lib (JDK ä»£è¡¨ JDK çš„å®‰è£…ç›®å½•ï¼Œä¸‹åŒ) ä¸‹ï¼Œæˆ–è¢« - Xbootclasspath å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“ (å¦‚ rt.jarï¼Œæ‰€æœ‰çš„ java.* å¼€å¤´çš„ç±»å‡è¢« Bootstrap ClassLoader åŠ è½½)ã€‚</li>\n<li><code>Extension ClassLoader</code> ï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½ JDK\\jre\\lib\\ext ç›®å½•ä¸­ï¼Œæˆ–è€…ç”± java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ (å¦‚ javax.* å¼€å¤´çš„ç±»)ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</li>\n<li><code>Application ClassLoader</code> ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ (ClassPath) æ‰€æŒ‡å®šçš„ç±»ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</li>\n</ul>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zMy5ibXAub3ZoL2ltZ3MvMjAyMi8xMC8xMC83MTViMzllNmUyZjM0NTAwLmpwZw==\">https://s3.bmp.ovh/imgs/2022/10/10/715b39e6e2f34500.jpg</span>&quot; style=&quot;zoom:80%;&quot; /&gt;</p>\n<blockquote>\n<p>è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œå› ä¸º JVM è‡ªå¸¦çš„ ClassLoader åªèƒ½ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ ‡å‡†çš„ <code>java.class</code>  æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>pdai<span class=\"token punctuation\">.</span>jvm<span class=\"token punctuation\">.</span>classloader</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClassLoaderTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ClassLoader</span> loader <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContextClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span><span class=\"token function\">getParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>loader<span class=\"token punctuation\">.</span><span class=\"token function\">getParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// sun.misc.Launcher$AppClassLoader@64fef26a</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// sun.misc.Launcher$ExtClassLoader@1ddd40f3</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// null</span></pre></td></tr></table></figure><p>å¹¶æ²¡æœ‰è·å–åˆ° <code>ExtClassLoader</code>  çš„çˆ¶ Loaderï¼ŒåŸå› æ˜¯ <code>BootstrapLoader</code>  (å¼•å¯¼ç±»åŠ è½½å™¨) æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œæ‰¾ä¸åˆ°ä¸€ä¸ªç¡®å®šçš„è¿”å›çˆ¶ Loader çš„æ–¹å¼ï¼Œäºæ˜¯å°±è¿”å› <code>null</code> ã€‚</p>\n<h1 id=\"ç±»çš„åŠ è½½\"><a class=\"anchor\" href=\"#ç±»çš„åŠ è½½\">#</a> ç±»çš„åŠ è½½</h1>\n<p>ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>\n<ul>\n<li>å¯åŠ¨åº”ç”¨æ—¶ç”± JVM åˆå§‹åŒ–åŠ è½½</li>\n<li>é€šè¿‡ <code>Class.forName()</code>  æ–¹æ³•åŠ¨æ€åŠ è½½</li>\n<li>é€šè¿‡ <code>Class.loader.loadClass()</code>  æ–¹æ³•åŠ¨æ€åŠ è½½ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä½¿ç”¨loader.loadClass()ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">ClassLoader</span> loader <span class=\"token operator\">=</span> <span class=\"token class-name\">Main</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        loader<span class=\"token punctuation\">.</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.Test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// é»˜è®¤æ‰§è¡Œåˆå§‹åŒ–å—</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä½¿ç”¨Class.forName()ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.Test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// æŒ‡å®š ClassLoaderï¼Œåˆå§‹åŒ–ä¸æ‰§è¡Œé™æ€å—</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä½¿ç”¨Class.forName(name,false,loader)ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.Test\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é™æ€åˆå§‹åŒ–å—æ‰§è¡Œäº†ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºç»“æœï¼š</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ loader.loadClass ()ï¼š</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ Class.forName ()ï¼š</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">// é™æ€åˆå§‹åŒ–å—æ‰§è¡Œäº†ï¼</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ Class.forName (name,false,loader)ï¼š</span></pre></td></tr></table></figure><blockquote>\n<p><code>Class.forName()</code>  å’Œ <code>ClassLoader.loadClass()</code>  åŒºåˆ«ï¼Ÿ</p>\n</blockquote>\n<ul>\n<li>\n<p>Class.forName (): å°†ç±»çš„.class æ–‡ä»¶åŠ è½½åˆ° jvm ä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„ static å—ï¼›</p>\n</li>\n<li>\n<p><code>ClassLoader.loadClass()</code> ï¼šåªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.class æ–‡ä»¶åŠ è½½åˆ° jvm ä¸­ï¼Œä¸ä¼šæ‰§è¡Œ static ä¸­çš„å†…å®¹ï¼Œåªæœ‰åœ¨ <code>newInstance</code>  æ‰ä¼šå»æ‰§è¡Œ static å—ã€‚</p>\n</li>\n<li>\n<p><code>Class.forName(name,initialize,loader)</code> ï¼šå¯æ§åˆ¶æ˜¯å¦åŠ è½½ <code>static</code>  å—ã€‚</p>\n</li>\n</ul>\n<h1 id=\"jvmç±»åŠ è½½æœºåˆ¶\"><a class=\"anchor\" href=\"#jvmç±»åŠ è½½æœºåˆ¶\">#</a> JVM ç±»åŠ è½½æœºåˆ¶</h1>\n<p><strong>å…¨ç›˜è´Ÿè´£</strong>ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ª Class æ—¶ï¼Œè¯¥ Class æ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»– Class ä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥</p>\n<p><strong>çˆ¶ç±»å§”æ‰˜</strong>ï¼Œå…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±»</p>\n<p><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼Œç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„ Class éƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ª Class æ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥ Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆ Class å¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº† Class åï¼Œå¿…é¡»é‡å¯ JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ</p>\n<p><strong>åŒäº²å§”æ´¾æœºåˆ¶</strong> å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥è¢«ä¼ é€’åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åœ¨å®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»æ—¶ï¼Œå³æ— æ³•å®Œæˆè¯¥åŠ è½½ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¯¥ç±»ã€‚</p>\n<h2 id=\"åŒäº²å§”æ´¾\"><a class=\"anchor\" href=\"#åŒäº²å§”æ´¾\">#</a> åŒäº²å§”æ´¾</h2>\n<ol>\n<li>å½“ <code>AppClassLoader</code>  åŠ è½½ä¸€ä¸ª class æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ <code>ExtClassLoader</code>  å»å®Œæˆã€‚</li>\n<li>å½“ <code>ExtClassLoader</code>  åŠ è½½ä¸€ä¸ª class æ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™ <code>BootStrapClassLoader</code>  å»å®Œæˆã€‚</li>\n<li>å¦‚æœ <code>BootStrapClassLoader</code>  åŠ è½½å¤±è´¥ (ä¾‹å¦‚åœ¨ <code>$JAVA_HOME/jre/lib</code>  é‡ŒæœªæŸ¥æ‰¾åˆ°è¯¥ class)ï¼Œä¼šä½¿ç”¨ <code>ExtClassLoader</code>  æ¥å°è¯•åŠ è½½ï¼›</li>\n<li>è‹¥ <code>ExtClassLoader</code>  ä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨ <code>AppClassLoader</code>  æ¥åŠ è½½ï¼Œå¦‚æœ <code>AppClassLoader</code>  ä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ <code>ClassNotFoundException</code> ã€‚</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> resolve<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \t\t\t\t\t\t\t\t  <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é¦–å…ˆåˆ¤æ–­è¯¥ç±»å‹æ˜¯å¦å·²ç»è¢«åŠ è½½</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">Class</span> c <span class=\"token operator\">=</span> <span class=\"token function\">findLoadedClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœæ²¡æœ‰è¢«åŠ è½½ï¼Œå°±å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½æˆ–è€…å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœå­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                c <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœä¸å­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±æ£€æŸ¥æ˜¯å¦æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œé€šè¿‡è°ƒç”¨æœ¬åœ°æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">//native Class findBootstrapClass(String name)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                c <span class=\"token operator\">=</span> <span class=\"token function\">findBootstrapClass0</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœçˆ¶ç±»åŠ è½½å™¨å’Œå¯åŠ¨ç±»åŠ è½½å™¨éƒ½ä¸èƒ½å®ŒæˆåŠ è½½ä»»åŠ¡ï¼Œæ‰è°ƒç”¨è‡ªèº«çš„åŠ è½½åŠŸèƒ½</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            c <span class=\"token operator\">=</span> <span class=\"token function\">findClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token function\">resolveClass</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbmljZTBlMy9wLzEzNzE5OTAzLmh0bWwjMHgwMi0tY2xhc3Nsb2FkZXIlRTclQjElQkIlRTUlOEElQTAlRTglQkQlQkQlRTUlOTklQTg=\">Java å®‰å…¨ä¹‹ ClassLoader ç±»åŠ è½½å™¨</span>.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tlb3BtZyM5OTk1ZmZjYw==\">https://www.yuque.com/qingkongxiaguang/javase/keopmg#9995ffcc</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tY2xhc3Nsb2FkLmh0bQ==\">https://pdai.tech/md/java/jvm/java-jvm-classload.htm</span></p>\n<p>ä¸€ä¸ªå°ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZXNpb24uY29tL2FydGljbGUvMjE3ODMwODc5OC8=\">https://www.freesion.com/article/2178308798/</span></p>\n<p>ä¸‰å¤§ç±»åŠ è½½å™¨çš„æºç è§£è¯»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmJzbWF4LmNvbS9BL24yZDliTzB3ekQv\">https://www.bbsmax.com/A/n2d9bO0wzD/</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/09/Java/JVM/JVM(3)-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/",
            "url": "https://cecilia.cool/2022/10/09/Java/JVM/JVM(3)-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/",
            "title": "JVM(3)--ç±»åŠ è½½æœºåˆ¶",
            "date_published": "2022-10-09T04:39:46.000Z",
            "content_html": "<h1 id=\"ç±»çš„ç”Ÿå‘½å‘¨æœŸ\"><a class=\"anchor\" href=\"#ç±»çš„ç”Ÿå‘½å‘¨æœŸ\">#</a> ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/09/167570c48203f9c9.jpg\" alt=\"\" /></p>\n<p><code>åŠ è½½</code> ã€ <code>éªŒè¯</code> ã€ <code>å‡†å¤‡</code> å’Œ <code>åˆå§‹åŒ–</code> è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œè€Œ <code>è§£æ</code> é˜¶æ®µåˆ™ä¸ä¸€å®šï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒ Java è¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®š (ä¹Ÿæˆä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®š)ã€‚</p>\n<blockquote>\n<p>è¿™äº›é˜¶æ®µçŸ¥è¯†æŒ‰é¡ºåºå¼€å§‹ï¼Œå¹¶ä¸æ˜¯æŒ‰é¡ºåºç»“æŸï¼Œè¿™äº›é˜¶æ®µå¾€å¾€äº’ç›¸äº¤å‰æ··åˆè¿›è¡Œï¼Œå†ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨æˆ–æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p>\n</blockquote>\n<h1 id=\"ç±»çš„åŠ è½½\"><a class=\"anchor\" href=\"#ç±»çš„åŠ è½½\">#</a> ç±»çš„åŠ è½½</h1>\n<p>é¦–å…ˆä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š</p>\n<ul>\n<li>æ–¹æ³•åŒºï¼šJVM å®ä¾‹å†…éƒ¨ï¼Œç±»å‹ä¿¡æ¯è¢«å­˜å‚¨åœ¨æ–¹æ³•åŒºçš„å†…å­˜é€»è¾‘åŒºä¸­ã€‚ç±»å‹ä¿¡æ¯æ˜¯ç”±ç±»åŠ è½½æ—¶ä»ç±»æ–‡ä»¶ä¸­æå–å‡ºæ¥çš„ã€‚æ–¹æ³•åŒºåˆå«åšé™æ€åŒºï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ–¹æ³•åŒºåŒ…å«æ‰€æœ‰ <code>class</code>  å’Œ <code>static</code> ã€‚é™æ€<strong>å¸¸é‡</strong>å­˜æ”¾åœ¨æ–¹æ³•åŒºçš„å¸¸é‡åŒºä¸­ï¼Œè¿™ä¹‹åä¼šè®²è§£ã€‚</li>\n</ul>\n<p>åŠ è½½é˜¶æ®µè™šæ‹Ÿæœºéœ€è¦å®Œæˆï¼š</p>\n<ul>\n<li>é€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆä»æ–¹æ³•åŒºï¼‰æ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li>\n<li>å­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</li>\n<li>åœ¨ Java å †ä¸­ç”Ÿæˆä»£è¡¨è¿™ä¸ªç±»çš„ <code>java.lang.Class</code>  å¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/09/842b5cd01faa5b42.jpg\" alt=\"\" /></p>\n<p>ç±»åŠ è½½å™¨ä¸éœ€è¦ç­‰å¾…æŸä¸ªç±»é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨æ—¶åœ¨åŠ è½½ï¼ŒJVM å…è®¸é¢„æ–™æŸä¸ªç±»éœ€è¦ä½¿ç”¨æ—¶ä¸»åŠ¨åŠ è½½ã€‚åœ¨<strong>é¢„åŠ è½½</strong>ä¸­é‡åˆ°.class æ–‡ä»¶ç¼ºå¤±æˆ–å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åº<strong>é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨</strong>è¯¥ç±»æ—¶æ‰ä¼šæŠ¥é”™è¯¯ --LinkageErrorã€‚</p>\n<h1 id=\"è¿æ¥\"><a class=\"anchor\" href=\"#è¿æ¥\">#</a> è¿æ¥</h1>\n<h2 id=\"éªŒè¯\"><a class=\"anchor\" href=\"#éªŒè¯\">#</a> éªŒè¯</h2>\n<p>ç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§ï¼Œä¹Ÿå°±æ˜¯ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚</p>\n<blockquote>\n<p>å¦‚æœä½¿ç”¨çº¯ Java ä»£ç ç¼–å†™çš„ç±»ï¼Œç¼–è¯‘å‡ºæ¥çš„ class æ–‡ä»¶æ˜¯ç›¸å¯¹å®‰å…¨çš„ã€‚ä½†æ˜¯.class æ–‡ä»¶å¹¶ä¸åªæ˜¯ç”± Java æºç ç¼–è¯‘è€Œæ¥ï¼Œå“ªæ€•ç”¨é”®ç›˜è¾“å…¥ 01 å¹¶å°†æ–‡ä»¶åç¼€æ”¹ä¸º.class éƒ½å¯ä»¥ï¼Œæ‰€ä»¥éªŒè¯éå¸¸æœ‰å¿…è¦ã€‚</p>\n</blockquote>\n<p>éªŒè¯é˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š</p>\n<ul>\n<li><strong>æ–‡ä»¶æ ¼å¼éªŒè¯</strong>ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒã€‚ï¼ˆé­”æ•°ï¼Œä¸»æ¬¡ç‰ˆæœ¬ï¼Œå¸¸é‡çš„ tag æ ‡å¿—ç­‰ï¼‰</li>\n<li><strong>å…ƒæ•°æ®éªŒè¯</strong>ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æã€‚ï¼ˆè¯¥ç±»æ˜¯å¦ç»§æ‰¿ä¸å¯ç»§æ‰¿çš„ final ç±»ï¼Œæ˜¯å¦è¦†ç›–çˆ¶ç±»çš„ final å­—æ®µç­‰ï¼‰</li>\n<li><strong>å­—èŠ‚ç éªŒè¯</strong>ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ï¼Œç¬¦åˆé€»è¾‘çš„ã€‚</li>\n<li><strong>ç¬¦å·å¼•ç”¨éªŒè¯</strong>ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚</li>\n</ul>\n<blockquote>\n<p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨ <code>-Xverifynone</code>  å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p>\n</blockquote>\n<h2 id=\"å‡†å¤‡\"><a class=\"anchor\" href=\"#å‡†å¤‡\">#</a> å‡†å¤‡</h2>\n<p>æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡<strong>åˆå§‹å€¼</strong>çš„é˜¶æ®µï¼Œ<strong>è¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…</strong>ã€‚</p>\n<ul>\n<li>å†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬é™æ€å˜é‡ï¼Œ<strong>ä¸åŒ…æ‹¬</strong>å®ä¾‹å˜é‡ã€‚<strong>å®ä¾‹å˜é‡æ˜¯åœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨ Java å †ä¸­</strong>ã€‚</li>\n<li>åˆå§‹å€¼ï¼š <code>0,0L,null,false</code>  ç­‰ã€‚</li>\n</ul>\n<p>æ¯”å¦‚æŸä¸ªç±»ç”±ä»¥ä¸‹è¯­å¥ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> value <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>åœ¨å‡†å¤‡é˜¶æ®µåªä¼šèµ‹å€¼ 0ï¼Œå°† <code>value</code>  èµ‹å€¼ä¸º 3 çš„ <code>put static</code>  æŒ‡ä»¤å­˜æ”¾äº <code>&lt;clinit()&gt;</code>  æ–¹æ³•ä¸­ã€‚æ‰€ä»¥åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šèµ‹å€¼ä¸º 3ã€‚</p>\n<p><code>&lt;clinit&gt;</code>  æ–¹æ³•æ˜¯ç±»åŠ è½½çš„<strong>åˆå§‹åŒ–</strong>è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºï¼Œä¾æ¬¡è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„é™æ€å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿ <code>&lt;clinit&gt;</code>  æ–¹æ³•ã€‚å¹¶ä¸”  <code>&lt;clinit&gt;()</code>  ä¸éœ€è¦æ˜¾å¼è°ƒç”¨çˆ¶ç±»ï¼ˆæ¥å£é™¤å¤–ï¼Œæ¥å£ä¸éœ€è¦è°ƒç”¨çˆ¶æ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œåªæœ‰ä½¿ç”¨åˆ°çˆ¶æ¥å£ä¸­çš„é™æ€å˜é‡æ—¶æ‰éœ€è¦è°ƒç”¨ï¼‰çš„åˆå§‹åŒ–æ–¹æ³•  <code>&lt;clinit&gt;()</code> ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</p>\n<p>éšä¾¿å†™ä¸ªç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> a <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–è¯‘åé€šè¿‡ <code>jclasslib</code>  æ’ä»¶æŸ¥çœ‹ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/09/f122fdb91f027a3f.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å½“ int å–å€¼ -128~127 æ—¶ï¼ŒJVM é‡‡ç”¨  <code>bipush</code>  æŒ‡ä»¤å°†å¸¸é‡å‹å…¥æ ˆä¸­ã€‚</p>\n</blockquote>\n<p>è¿˜éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>\n<ul>\n<li>å¯¹äºåŒæ—¶è¢« <code>static</code>  å’Œ <code>final</code>  ä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ï¼›åªè¢« final ä¿®é¥°çš„å¸¸é‡åˆ™æ—¢å¯ä»¥åœ¨å£°æ˜æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»åˆå§‹åŒ–æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ­¤æ—¶ç¼–è¯‘ä¼šæŠ¥é”™ï¼š<strong>java: å˜é‡ tmp æœªåœ¨é»˜è®¤æ„é€ å™¨ä¸­åˆå§‹åŒ–</strong>ã€‚</p>\n<p>å¿…é¡»åœ¨æ„é€ å™¨ä¸­å°† <code>final</code>  å˜é‡åˆå§‹åŒ–ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> k<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>k <span class=\"token operator\">=</span> k<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>åŒæ—¶è¢« <code>static</code>  å’Œ <code>final</code>  ä¿®é¥°çš„å¸¸é‡ï¼Œç±»ä¼šä¸ºå®ƒç”Ÿæˆ <code>ConstantValue</code>  å±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µ JVM å°±ä¼šæ ¹æ® <code>ConstantValue</code>  çš„è®¾ç½®å°†å˜é‡èµ‹å€¼ã€‚</li>\n</ul>\n<h2 id=\"è§£æ\"><a class=\"anchor\" href=\"#è§£æ\">#</a> è§£æ</h2>\n<p>JVM å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ <code>ç±»</code> æˆ– <code>æ¥å£</code> ã€ <code>å­—æ®µ</code> ã€ <code>ç±»æ–¹æ³•</code> ã€ <code>æ¥å£æ–¹æ³•</code> ã€ <code>æ–¹æ³•ç±»å‹</code> ã€ <code>æ–¹æ³•å¥æŸ„</code> å’Œ <code>è°ƒç”¨ç‚¹</code> é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚</p>\n<p><code>ç›´æ¥å¼•ç”¨</code> å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p>\n<h2 id=\"åˆå§‹åŒ–\"><a class=\"anchor\" href=\"#åˆå§‹åŒ–\">#</a> åˆå§‹åŒ–</h2>\n<p>åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVM è´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚</p>\n<blockquote>\n<p>ä¹Ÿå°±æ˜¯ <code>&lt;clinit&gt;</code>  æ–¹æ³•ã€‚</p>\n</blockquote>\n<p><strong>ç±»åˆå§‹åŒ–æ—¶æœº</strong>ï¼šåªæœ‰å½“å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œç±»çš„ä¸»åŠ¨ä½¿ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§:</p>\n<ul>\n<li>\n<p>åˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ new çš„æ–¹å¼</p>\n</li>\n<li>\n<p>è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</p>\n</li>\n<li>\n<p>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ï¼ˆä¹Ÿç»å¸¸å’Œç¬¬äºŒç‚¹åˆå¹¶åœ¨ä¸€èµ·ï¼‰</p>\n</li>\n<li>\n<p>åå°„ (å¦‚ Class.forName (&quot;com.pdai.jvm.Test&quot;))</p>\n</li>\n<li>\n<p>åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ–</p>\n</li>\n<li>\n<p>Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±» (Java Test)ï¼Œç›´æ¥ä½¿ç”¨ java.exe å‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</p>\n</li>\n</ul>\n<p>åªæœ‰è¿™å…­ç§æ˜¯ä¸»åŠ¨ä½¿ç”¨ï¼Œå…¶ä»–çš„éƒ½æ˜¯è¢«åŠ¨ä½¿ç”¨ï¼Œè¢«åŠ¨ä½¿ç”¨ä¸ä¼šåˆå§‹åŒ–ã€‚è¢«åŠ¨å¼•ç”¨çš„ä¾‹å­å¯ä»¥çœ‹è¿™ç¯‡<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3poYW5nbGlhbmd6aS9hcnRpY2xlL2RldGFpbHMvNTEzMTkwMzM=\">åšå®¢</span>ã€‚</p>\n<h3 id=\"æ³¨æ„\"><a class=\"anchor\" href=\"#æ³¨æ„\">#</a> æ³¨æ„</h3>\n<p>å…³äºè®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œä¸€å®šè¦æ³¨æ„è¿™é‡Œå†™çš„æ˜¯<strong>å˜é‡ï¼Œå˜é‡ï¼Œå˜é‡</strong>ï¼ˆé‡è¦çš„æ˜¯å¼ºè°ƒä¸‰éï¼‰ã€‚ <code>static final int a = 10;</code>  æ˜¯<strong>å¸¸é‡ï¼Œå¸¸é‡ï¼Œå¸¸é‡</strong>ã€‚è®¿é—® <code>a</code>  ä¸ä¼šè®©ç±»è¢«åŠ è½½ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">.</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†™ä¸€ä¸‹ <code>Test</code>  ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘è¢«åˆå§‹åŒ–äº†ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸ç»™ä¸ªä¸‰è¿+å…³æ³¨å—ï¼Ÿ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…ˆç¼–è¯‘ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹ <code>Main.class</code>  çš„å†…å®¹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸ç»™ä¸ªä¸‰è¿+å…³æ³¨å—ï¼Ÿ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå°† <code>Test.str</code>  ç›´æ¥æ›¿æ¢æˆäº†å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ‰§è¡Œæ—¶å’Œ <code>Test</code>  ä¹Ÿå°±æ²¡æœ‰ä»»ä½•å…³ç³»äº†ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šå®ä¾‹åŒ– <code>Test</code> ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/09/28f0a77b42aeafb5.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å½“ int å–å€¼ -2147483648~2147483647 æ—¶ï¼ŒJVM é‡‡ç”¨  <code>ldc</code>  æŒ‡ä»¤å°†å¸¸é‡å‹å…¥æ ˆä¸­ã€‚</p>\n</blockquote>\n<h2 id=\"å¸è½½\"><a class=\"anchor\" href=\"#å¸è½½\">#</a> å¸è½½</h2>\n<p>JVM å°†ç»“æŸç”Ÿå‘½å‘¨æœŸçš„å‡ ç§æƒ…å†µï¼š</p>\n<ul>\n<li>æ‰§è¡Œäº† System.exit () æ–¹æ³•</li>\n<li>ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</li>\n<li>ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</li>\n<li>ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´ Java è™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3poYW5nbGlhbmd6aS9hcnRpY2xlL2RldGFpbHMvNTEzMTkwMzM=\">https://blog.csdn.net/zhangliangzi/article/details/51319033</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tY2xhc3Nsb2FkLmh0bWw=\">https://pdai.tech/md/java/jvm/java-jvm-classload.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tlb3BtZyNkZGFmYzg3Ng==\">https://www.yuque.com/qingkongxiaguang/javase/keopmg#ddafc876</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd2FuZ2d1b25pbmcvcC82MTA5Mzc3Lmh0bWw=\">https://www.cnblogs.com/wangguoning/p/6109377.html</span></p>\n<p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆ</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vY3p3YmlnL3AvMTExNTU1NTUuaHRtbA==\">https://www.cnblogs.com/czwbig/p/11155555.html</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/08/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E8%AE%BF%E9%97%AE%E8%80%85/",
            "url": "https://cecilia.cool/2022/10/08/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E8%AE%BF%E9%97%AE%E8%80%85/",
            "title": "è¡Œä¸ºå‹--è®¿é—®è€…",
            "date_published": "2022-10-08T05:02:44.000Z",
            "content_html": "<h1 id=\"è®¿é—®è€…visitor\"><a class=\"anchor\" href=\"#è®¿é—®è€…visitor\">#</a> è®¿é—®è€… (Visitor)</h1>\n<blockquote>\n<p>å½“æƒ³è¦ä¸ºå¯¹è±¡çš„ç»„åˆå¢åŠ æ–°çš„èƒ½åŠ›ä¸”å°è£…å¹¶ä¸é‡è¦æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚</p>\n</blockquote>\n<p>ç°åœ¨éœ€è¦çŸ¥é“çš„å°±æ˜¯ï¼Œè¢«è®¿é—®çš„ç±»éœ€è¦å°†è‡ªèº«å¼•ç”¨ä¼ å…¥è®¿é—®è€…ã€‚è®²èµ·æ¥æ¯”è¾ƒç©ºæ³›ï¼Œæ‰€ä»¥å…ˆçœ‹ä»£ç ã€‚</p>\n<h2 id=\"å®ç°\"><a class=\"anchor\" href=\"#å®ç°\">#</a> å®ç°</h2>\n<blockquote>\n<p>ä»£ç æ¥è‡ªèœé¸Ÿæ•™ç¨‹ã€‚</p>\n</blockquote>\n<ul>\n<li>å®šä¹‰è¡¨ç¤ºå…ƒç´ çš„æ¥å£ï¼š</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ComputerPart</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// æ¥å£å®šä¹‰çš„è¡Œä¸ºï¼šå…ƒç´ æä¾›ä¸€ä¸ªæ–¹æ³•ä¾›è®¿é—®è€…è¿›å…¥</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// å‡è®¾å­˜åœ¨ ComputerPartVisitor æ¥å£å®šä¹‰äº†è®¿é—®è€…çš„ visit è¡Œä¸º</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComputerPartVisitor</span> computerPartVisitor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>åˆ›å»ºæ‰©å±•ä¸Šè¿°ç±»çš„å®ä½“ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªé”®ç›˜å®ä½“ç±»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Keybord</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ComputerPart</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComputerPartVisitor</span> computerPartVisitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// å®ä½“ç±»å®ç°çš„è¡Œä¸ºæ˜¯ï¼šå°†è‡ªå·±çš„å¼•ç”¨ this æš´éœ²ç»™å¤–éƒ¨è®¿é—®è€…</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        computerPartVisitor<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªç›‘è§†å™¨å®ä½“ç±»</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Monitor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ComputerPart</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    publicvoid <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComputerPartVisitor</span> computerPartVisitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        computerPartVisitor<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªé¼ æ ‡å®ä½“ç±»</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mouse</span>  <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ComputerPart</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComputerPartVisitor</span> computerPartVisitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      computerPartVisitor<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>å†å†™ä¸€ä¸ªæ€»ä½“çš„ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Computer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ComputerPart</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token class-name\">ComputerPart</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> parts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Computer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        parts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ComputerPart</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Keyboard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Monitor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ComputerPartVisitor</span> computerPartVisitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                parts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span>computerPartVisitor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            computerPartVisitor<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>åˆ›å»ºä¸€ä¸ªå®ä½“è®¿é—®è€…ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ComputerPartDisplayVisitor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ComputerPartVisitor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Computer</span> computer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Displaying Computer.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mouse</span> mouse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Displaying Mouse.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Keyboard</span> keyboard<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Displaying Keyboard.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Monitor</span> monitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Displaying Monitor.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>æœ€åè¿è¡Œä¸€ä¸‹</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VisitorPatternDemo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token class-name\">ComputerPart</span> computer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Computer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      computer<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ComputerPartDisplayVisitor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p>ä»£ç é€»è¾‘ç®€å•ï¼š</p>\n<ul>\n<li>è®¿é—®è€…æœ‰å¤„ç†è¢«è®¿é—®è€…çš„è¡Œä¸ºã€‚</li>\n<li>è¢«è®¿é—®è€…æœ‰æ¥æ”¶è®¿é—®è€…å¹¶å°†è‡ªèº«å¼•ç”¨æš´éœ²ç»™è®¿é—®è€…çš„è¡Œä¸ºã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/c634509b4c630678.jpg\" alt=\"\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kZXNpZ24tcGF0dGVybi92aXNpdG9yLXBhdHRlcm4uaHRtbD9fPTE0NzgwNjAwMzk=\">https://www.runoob.com/design-pattern/visitor-pattern.html?_=1478060039</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2LXNwZWMvcGF0dGVybi8yMF92aXNpdG9yLmh0bWw=\">https://pdai.tech/md/dev-spec/pattern/20_visitor.html</span></p>\n</blockquote>\n",
            "tags": [
                "è®¾è®¡æ¨¡å¼"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/08/Java/JVM/JVM(2)-%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA/",
            "url": "https://cecilia.cool/2022/10/08/Java/JVM/JVM(2)-%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA/",
            "title": "JVM(2)--å­—èŠ‚ç å¢å¼º",
            "date_published": "2022-10-08T04:56:20.000Z",
            "content_html": "<h1 id=\"jvmåŸºç¡€-å­—èŠ‚ç å¢å¼º\"><a class=\"anchor\" href=\"#jvmåŸºç¡€-å­—èŠ‚ç å¢å¼º\">#</a> JVM åŸºç¡€ - å­—èŠ‚ç å¢å¼º</h1>\n<blockquote>\n<p>å­—èŠ‚ç å¢å¼ºæŠ€æœ¯å°±æ˜¯ä¸€ç±»å¯¹ç°æœ‰å­—èŠ‚ç è¿›è¡Œä¿®æ”¹æˆ–è€…åŠ¨æ€ç”Ÿæˆå…¨æ–°å­—èŠ‚ç æ–‡ä»¶çš„æŠ€æœ¯ã€‚</p>\n</blockquote>\n<h2 id=\"asm\"><a class=\"anchor\" href=\"#asm\">#</a> ASM</h2>\n<p>ASM å¯ä»¥ç›´æ¥ç”Ÿæˆ <code>.class</code>  å­—èŠ‚ç æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ JVM ä¹‹å‰åŠ¨æ€ä¿®æ”¹ç±»è¡Œä¸ºã€‚ASM æ¡†æ¶æ˜¯ JDK å†…éƒ¨è‡ªå¸¦çš„ï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯é€šè¿‡ <code>ClassWriter</code>  å¯¹è±¡ç¼–è¾‘ç±»çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ClassWriter</span> writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">.</span><span class=\"token constant\">COMPUTE_MAXS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>åœ¨å­¦ä¹  ASM å‰ï¼Œè¯·å…ˆå­¦ä¹ ä¸€ä¸‹<a href=\"https://cecilia.cool/2022/10/08/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E8%AE%BF%E9%97%AE%E8%80%85/\">è®¿é—®è€…æ¨¡å¼</a>ã€‚</p>\n</blockquote>\n<p>å­—èŠ‚ç æ–‡ä»¶çš„ç»“æ„æ˜¯ç”± JVM å›ºå®šçš„ï¼Œé€‚åˆåˆ©ç”¨è®¿é—®è€…æ¨¡å¼å¯¹å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/b57b44956364c1b6.jpg\" alt=\"\" /></p>\n<h3 id=\"æ ¸å¿ƒapi\"><a class=\"anchor\" href=\"#æ ¸å¿ƒapi\">#</a> æ ¸å¿ƒ API</h3>\n<ul>\n<li>\n<p><code>ClassReader</code> ï¼šç”¨äºè¯»å–å·²ç»ç¼–è¯‘å¥½çš„.class æ–‡ä»¶ã€‚</p>\n</li>\n<li>\n<p><code>ClassWriter</code> ï¼šç”¨äºé‡æ–°æ„å»ºç¼–è¯‘åçš„ç±»ï¼Œå¦‚ä¿®æ”¹ç±»åã€å±æ€§ä»¥åŠæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆæ–°çš„ç±»çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</p>\n</li>\n<li>\n<p>å„ç§ <code>Visitor</code>  ç±»ï¼šå¦‚ä¸Šæ‰€è¿°ï¼ŒCoreAPI æ ¹æ®å­—èŠ‚ç ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å¤„ç†ï¼Œå¯¹äºå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒçš„åŒºåŸŸæœ‰ä¸åŒçš„ Visitorï¼Œæ¯”å¦‚ç”¨äºè®¿é—®æ–¹æ³•çš„ <code>MethodVisitor</code> ã€ç”¨äºè®¿é—®ç±»å˜é‡çš„ <code>FieldVisitor</code> ã€ç”¨äºè®¿é—®æ³¨è§£çš„ <code>AnnotationVisitor</code>  ç­‰ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>API æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29sLm9zY2hpbmEubmV0L2FwaWRvY3MvYXBpZG9jP2FwaT1hc20=\">https://tool.oschina.net/apidocs/apidoc?api=asm</span></p>\n</blockquote>\n<h2 id=\"æ–¹æ³•åå’Œæè¿°ç¬¦\"><a class=\"anchor\" href=\"#æ–¹æ³•åå’Œæè¿°ç¬¦\">#</a> æ–¹æ³•åå’Œæè¿°ç¬¦</h2>\n<p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ç±»æ–‡ä»¶ä¸­æ–¹æ³•åå’Œæè¿°ç¬¦çš„è¡¨ç¤ºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>jclasslib</code>  æ’ä»¶æŸ¥çœ‹ä¸€ä¸‹ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/d03410a93bae253c.jpg\" alt=\"\" /></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³•ååœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­è¢« <code>&lt;&gt;</code>  åŒ…å›´ï¼Œæè¿°ç¬¦å…¶å®å°±æ˜¯è¿”å›å€¼å’Œå‚æ•°åˆ—è¡¨ï¼Œä¹Ÿéƒ½è¢« <code>&lt;&gt;</code>  åŒ…å›´ã€‚ <code>&lt;()I&gt;</code>  è¡¨ç¤ºï¼š</p>\n<ul>\n<li>æ‹¬å·é‡Œçš„æ˜¯å‚æ•°ï¼Œåé¢çš„æ˜¯è¿”å›å€¼ã€‚</li>\n<li><code>I</code>  è¡¨ç¤º <code>int</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ–¹æ³•è¿”å› <code>int</code> ï¼Œå¦‚æœæ˜¯ <code>void</code> ï¼Œè¿™é‡Œå°±ä¼šæ˜¯ <code>V</code> ã€‚</li>\n</ul>\n<p>è¿™æ ·æˆ‘ä»¬å°±å›ºå®šäº†æ–¹æ³•çš„æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ä»¥åŠè¿”å›å€¼ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ <code>inc</code>  æ–¹æ³•ä¸Šé¢è¿˜æœ‰ä¸ª <code>&lt;init&gt;</code>  æ–¹æ³•ï¼Œé‚£å°±æ˜¯æ„é€ æ–¹æ³•ã€‚</p>\n<p>å¦‚æœæ–¹æ³•å‚æ•°ä¸­åŠ å…¥äº†å¯¹è±¡ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">return</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// æè¿°ç¬¦ï¼š&lt;(Ljava/lang/String;Ljava/lang/Object;) I></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> a<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> m<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// æè¿°ç¬¦ï¼š&lt;([[C) I></span></pre></td></tr></table></figure><p><code>L</code>  å¼€å¤´è¡¨ç¤ºæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå‚æ•°ä¹‹é—´è¦ç”¨ <code>;</code>  éš”å¼€ã€‚è¯¦ç»†çš„è¯»è€…å¯ä»¥è‡ªå·±å†™ä¸€äº›æ–¹æ³•æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„æ•ˆæœã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/5d052fc53aef3cb4.jpg\" alt=\"\" /></p>\n<h2 id=\"åŸºæœ¬ä½¿ç”¨\"><a class=\"anchor\" href=\"#åŸºæœ¬ä½¿ç”¨\">#</a> åŸºæœ¬ä½¿ç”¨</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ClassWriter</span> writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">.</span><span class=\"token constant\">COMPUTE_MAXS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°é‡Œçš„å‚æ•°ä¸æ“ä½œæ•°æ ˆå’Œå±€éƒ¨ä¸´æ—¶å˜é‡è¡¨æœ‰å…³ï¼Œä¸æƒ³ç¢ç£¨ï¼Œç”¨ <code>COMPUTE_MAXS</code>  å³å¯ã€‚</p>\n<p>é¦–å…ˆæŒ‡å®šä¸€ä¸‹ç±»çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ClassWriter</span> writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">.</span><span class=\"token constant\">COMPUTE_MAXS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// å› ä¸ºè¿™é‡Œç”¨åˆ°çš„å¸¸é‡æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥è¯´ç›´æ¥ä¸€æ¬¡æ€§é™æ€å¯¼å…¥ï¼š</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// import static jdk.internal.org.objectweb.asm.Opcodes.*;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        writer<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">V1_8</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ACC_PUBLIC</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"com/JVM/Main\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                     <span class=\"token string\">\"java/lang/Object\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„ Main è·¯å¾„å¡«å†™</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¾å®šçš„åŸºæœ¬ä¿¡æ¯ä¾æ¬¡æ˜¯ï¼šç‰ˆæœ¬ --Java8ï¼Œä¿®é¥°ç¬¦ -- <code>ACC_PUBLIC</code> ï¼Œç±»å -- è¦æºå¸¦åŒ…åï¼Œæ ‡ç­¾ -- <code>null</code> ï¼Œçˆ¶ç±» -- <code>Object</code> ã€‚</p>\n<p>å°†å…¶ä¿å­˜ï¼Œç„¶åå†™å…¥åˆ°è‡ªå·±ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶å½“ä¸­ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ClassWriter</span> writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassWriter</span><span class=\"token punctuation\">.</span><span class=\"token constant\">COMPUTE_MAXS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        writer<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">V1_8</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ACC_PUBLIC</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"com/test/Main\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                     <span class=\"token string\">\"java/lang/Object\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨ visitEnd è¡¨ç¤ºç»“æŸç¼–è¾‘</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        writer<span class=\"token punctuation\">.</span><span class=\"token function\">visitEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileOutputStream</span> stream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./Main.class\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            stream<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>writer<span class=\"token punctuation\">.</span><span class=\"token function\">toByteArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// ç›´æ¥é€šè¿‡ ClassWriter å°†å­—èŠ‚ç æ–‡ä»¶è½¬æ¢ä¸º byte æ•°ç»„ï¼Œå¹¶ä¿å­˜åˆ°æ ¹ç›®å½•ä¸‹</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç»“æœä¸ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/f0c63a80acdf6c29.jpg\" alt=\"\" /></p>\n<p>ä» class æ–‡ä»¶å¯çŸ¥ï¼Œ <code>Main.class</code>  æ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æ·»åŠ ä¸€ä¸ª</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é€šè¿‡ visitMethod æ–¹æ³•å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// æ”¾åœ¨ writer.visitEnd (); å‰é¢å³å¯</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>writer<span class=\"token punctuation\">.</span><span class=\"token function\">visitMethod</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ACC_PUBLIC</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;init>\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"()V\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å†æ¬¡ç¼–è¯‘ï¼Œå‘ç°å­˜åœ¨æ„é€ æ–¹æ³•ï¼Œä¹‹å‰è®²äº†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æ–¹æ³•åå’Œæè¿°ç¬¦ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œä¿®æ”¹æè¿°ç¬¦æ„Ÿå—ä¸€ä¸‹æ•ˆæœã€‚</p>\n<p>ä½†æ˜¯ <code>Main</code>  ç»§æ‰¿äº† <code>Object</code>  ç±»ï¼Œæ‰€ä»¥åœ¨å­ç±»æ„é€ æ–¹æ³•ä¸­åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²ƒæ©éœ€è¦åœ¨æ–¹æ³•ä¸­æ·»åŠ çˆ¶ç±»æ„é€ æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</p>\n<pre><code class=\"language-Plain\">public com.test.Main();\n    descriptor: ()V\n    flags: ACC_PUBLIC\n    Code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1             // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V\n         4: return\n      LineNumberTable:\n        line 11: 0\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            0       5     0  this   Lcom/test/Main;\n</code></pre>\n<p>æ‰€ä»¥æˆ‘ä»¬å¼€å§‹è®¿é—®ä»£ç ï¼ˆ <code>visitCode()</code> )ï¼Œä¹Ÿå°±æ˜¯å¯¹æ–¹æ³•è¿›è¡Œè¯¦ç»† i ç¼–è¾‘ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é€šè¿‡ MethodVisitor æ¥æ”¶è¿”å›å€¼ï¼Œè¿›è¡Œè¿›ä¸€æ­¥æ“ä½œ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">MethodVisitor</span> visitor <span class=\"token operator\">=</span> writer<span class=\"token punctuation\">.</span><span class=\"token function\">visitMethod</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ACC_PUBLIC</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;init>\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"()V\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// å¼€å§‹ç¼–è¾‘ä»£ç </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// Label ç”¨äºå­˜å‚¨è¡Œå·ï¼Œå½“å‰ä»£ç å†™åˆ°å“ªè¡Œäº†ï¼Œl1 å¾—åˆ°çš„å°±æ˜¯å¤šå°‘è¡Œ</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">Label</span> l1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// æ·»åŠ æºä»£ç è¡Œæ•°å¯¹åº”è¡¨ (å­—èŠ‚ç ä¸­çš„ LineNumberTable)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitListNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span>l1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// ä¸åŒç±»å‹çš„æŒ‡ä»¤éœ€è¦ä¸åŒæ–¹æ³•è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitVarInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ALOAD</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitMethodInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INVOKESPECIAL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"java/lang/Object\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;init>\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"()V\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RETURN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token class-name\">Label</span> l2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitLabel</span><span class=\"token punctuation\">(</span>l2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// æ·»åŠ æœ¬åœ°å˜é‡è¡¨ (å­—èŠ‚ç ä¸­çš„ LocalVariableTable)ï¼Œè¿™é‡Œæ˜¯ this å…³é”®å­—</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visiLocalVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"this\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Lcom/JVM/Main;\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>l1<span class=\"token punctuation\">,</span> l2<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// æœ€åè®¾å®šæœ€å¤§æ ˆæ·±åº¦å’Œæœ¬åœ°å˜é‡æ•°</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitMaxs</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// ç»“æŸç¼–è¾‘</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>visitor<span class=\"token punctuation\">.</span><span class=\"token function\">visitEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è‡³æ­¤æ„é€ æ–¹æ³•ç¼–è¾‘å®Œæˆï¼Œå¯ä»¥çœ‹åˆ°æ˜¯éå¸¸éº»çƒ¦çš„ä¸€ä»¶äº‹ï¼Œå…¶å®å“ªæ€•åªæ˜¯å®Œæˆä¸€ä¸ª</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>éƒ½æ˜¯éå¸¸å¤æ‚çš„ä¸€ä»¶äº‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å¼€å§‹å®‰æ’ main æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">MethodVisitor</span> v2 <span class=\"token operator\">=</span> writer<span class=\"token punctuation\">.</span><span class=\"token function\">visitMethod</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ACC_PUBLIC</span> <span class=\"token operator\">|</span> <span class=\"token constant\">ACC_STATIC</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"main\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                                      <span class=\"token string\">\"([Ljava/lang/String;)V\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// è®°å½•èµ·å§‹è¡Œä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">Label</span> l3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLabel</span><span class=\"token punctuation\">(</span>l3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLineNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span> l3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// é¦–å…ˆæ˜¯ int a = 10 çš„æ“ä½œï¼Œæ‰§è¡ŒæŒ‡ä»¤ä¾æ¬¡ä¸ºï¼š</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//bipush 10     å°† 10 æ¨å‘æ“ä½œæ•°æ ˆé¡¶</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//istore_1      å°†æ“ä½œæ•°æ ˆé¡¶å…ƒç´ ä¿å­˜åˆ° 1 å·æœ¬åœ°å˜é‡ a ä¸­</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitIntInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BIPUSH</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitVarInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ISTORE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token class-name\">Label</span> l4 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLabel</span><span class=\"token punctuation\">(</span>l4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// è®°å½•ä¸€ä¸‹è¡Œä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLineNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">,</span> l4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// è¿™é‡Œæ˜¯è·å– System ç±»ä¸­çš„ out é™æ€å˜é‡ï¼ˆPrintStream æ¥å£ï¼‰ï¼Œç”¨äºæ‰“å°</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitFieldInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GETSTATIC</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"java/lang/System\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"out\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Ljava/io/PrintStream;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// æŠŠ a çš„å€¼å–å‡ºæ¥</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitVarInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ILOAD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// è°ƒç”¨æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³• println</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitMethodInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INVOKEVIRTUAL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"java/io/PrintStream\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"println\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"(I)V\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">// å†æ¬¡è®°å½•è¡Œä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token class-name\">Label</span> l6 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLabel</span><span class=\"token punctuation\">(</span>l6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLineNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span> l6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitInsn</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RETURN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token class-name\">Label</span> l7 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Label</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLabel</span><span class=\"token punctuation\">(</span>l7<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">// æœ€åæ˜¯æœ¬åœ°å˜é‡è¡¨ä¸­çš„å„ä¸ªå˜é‡</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLocalVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"args\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"[Ljava/lang/String;\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> l3<span class=\"token punctuation\">,</span> l7<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitLocalVariable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"I\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> l4<span class=\"token punctuation\">,</span> l7<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitMaxs</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">// ç»ˆäº OK äº†</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>v2<span class=\"token punctuation\">.</span><span class=\"token function\">visitEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>å†™ä¹‹å‰å°±éœ€è¦å…ˆå†™å¥½ Java ç¨‹åºè¿›è¡Œåç¼–è¯‘ï¼Œå†ç…§ç€å­—èŠ‚ç ä¸€è¡Œä¸€è¡Œä½¿ç”¨ <code>MathodVisitor</code>  ç¼–è¾‘ã€‚</p>\n</blockquote>\n<h2 id=\"ä¾‹å­å®ç°aop\"><a class=\"anchor\" href=\"#ä¾‹å­å®ç°aop\">#</a> ä¾‹å­ï¼šå®ç° AOP</h2>\n<blockquote>\n<p>AOP-- é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒSpring æ ¸å¿ƒä¹‹ä¸€ï¼Œå¦‚æœä½ ä¸äº†è§£ AOPï¼Œå°±æš‚æ—¶ç†è§£ä¸ºï¼Œåœ¨ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼ˆæ¨¡å—ï¼‰ä¸­ï¼ŒåŠ å…¥ä¸€ä¸ªåˆ‡é¢ï¼Œé€šè¿‡è¿™ä¸ªåˆ‡é¢çš„æ–¹æ³•å¯ä»¥è¢«åˆ‡é¢åŠ å…¥ä¸€äº›æ“ä½œï¼Œå¦‚è®°å½•æ—¥å¿—å•¥çš„ã€‚</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/08/972d8fa05bf61137.jpg\" alt=\"\" /></p>\n<p>æˆ‘ä»¬å¸Œæœ›é€šè¿‡ ASM æ¥å®ç° AOPï¼šåœ¨æ–¹æ³•è°ƒç”¨å‰åå¢åŠ é€»è¾‘ï¼ˆä¹Ÿå«åšå‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ï¼‰ã€‚</p>\n<p>å…·ä½“ä»£ç å®ç°æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tY2xhc3MtZW5oYW5jZXIuaHRtbCMlRTUlQUQlOTclRTglOEElODIlRTclQTAlODElRTUlQTIlOUUlRTUlQkMlQkElRTYlOEElODAlRTYlOUMlQUY=\">ç›´æ¥åˆ©ç”¨ ASM å®ç° AOP</span>ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tlb3BtZw==\">https://www.yuque.com/qingkongxiaguang/javase/keopmg</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tY2xhc3MtZW5oYW5jZXIuaHRtbA==\">https://pdai.tech/md/java/jvm/java-jvm-class-enhancer.html</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/05/Java/JVM/JVM(1)-%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/",
            "url": "https://cecilia.cool/2022/10/05/Java/JVM/JVM(1)-%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/",
            "title": "JVM(1)--ç±»æ–‡ä»¶ç»“æ„",
            "date_published": "2022-10-05T15:29:47.000Z",
            "content_html": "<h1 id=\"ç±»æ–‡ä»¶ç»“æ„\"><a class=\"anchor\" href=\"#ç±»æ–‡ä»¶ç»“æ„\">#</a> ç±»æ–‡ä»¶ç»“æ„</h1>\n<p>è®¡ç®—æœºæ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œ java ä»£ç çš„ï¼Œå¿…é¡»è¦å…ˆè¿è¡Œ java è™šæ‹Ÿæœºï¼Œå†ç”± java è™šæ‹Ÿæœºè¿è¡Œç¼–è¯‘åçš„ java ä»£ç ã€‚è¿™ä¸ªç¼–è¯‘åçš„ java ä»£ç ï¼Œå°±æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„ java å­—èŠ‚ç ã€‚</p>\n<ul>\n<li>Java ä»£ç é—´æ¥ç¿»è¯‘æˆå­—èŠ‚ç ï¼Œå‚¨å­˜å­—èŠ‚ç çš„æ–‡ä»¶å†äº¤ç”±è¿è¡Œäºä¸åŒå¹³å°ä¸Šçš„ JVM è™šæ‹Ÿæœºå»è¯»å–æ‰§è¡Œï¼Œä»è€Œå®ç°ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œçš„ç›®çš„ã€‚</li>\n<li>JVM ä¹Ÿä¸å†åªæ”¯æŒ Javaï¼Œç”±æ­¤è¡ç”Ÿå‡ºäº†è®¸å¤šåŸºäº JVM çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ Groovy, Scala, Koltin ç­‰ç­‰ã€‚</li>\n</ul>\n<blockquote>\n<p>è®¸å¤šå¼€å‘è¯­è¨€æ”¯æŒå°†æºä»£ç ç¼–è¯‘ä¸º <code>.class</code>  å­—èŠ‚ç æ–‡ä»¶æ ¼å¼ï¼Œä»¥ä¾¿äº¤ç»™ JVM è¿è¡Œ</p>\n</blockquote>\n<h2 id=\"ç±»æ–‡ä»¶ä¿¡æ¯\"><a class=\"anchor\" href=\"#ç±»æ–‡ä»¶ä¿¡æ¯\">#</a> ç±»æ–‡ä»¶ä¿¡æ¯</h2>\n<p>å…ˆå†™ä¸€ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆ <code>Test.class</code>  æ–‡ä»¶ã€‚</p>\n<blockquote>\n<p>ä¸‹è½½ WinHex è½¯ä»¶ï¼Œä»¥åå…­è¿›åˆ¶æ ¼å¼æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ï¼ˆå°†ç¼–è¯‘å¥½çš„ <code>class</code>  æ–‡ä»¶æ‹–è¿›å»ï¼‰ï¼Œæ¯ä¸€ä½éƒ½æ˜¯ 4 ä¸ª bit</p>\n</blockquote>\n<p>å‘ˆç°å‡ºæ¥çš„æ˜¯é…±ç´«çš„ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/06/227b1ae28c54688f.jpg\" alt=\"\" /></p>\n<p>ä½†æ˜¯ winHex æˆ‘è¿™æ‰“å¼€æ€»æ˜¯æœ‰äº›æ¯›ç—…ï¼Œæ‰€ä»¥é€‰æ‹©å¦ä¸€ä¸ªå·¥å…·ï¼ˆIEDA æ’ä»¶ï¼‰æŸ¥çœ‹åå…­è¿›åˆ¶å­—èŠ‚ç ï¼š</p>\n<ul>\n<li>å®‰è£…æ’ä»¶ï¼šBinary/hexadecimal editorã€‚</li>\n<li>å³é”® class æ–‡ä»¶ï¼Œé€‰æ‹© Open As Binaryã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/06/995affe6c346a8aa.jpg\" alt=\"\" /></p>\n<p>æœ‰æ—¶ç›´æ¥æŸ¥çœ‹ 16 è¿›åˆ¶çš„ç»“æœä¸æ–¹ä¾¿ï¼Œä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿æŸ¥çœ‹å­—èŠ‚ç ä¿¡æ¯ï¼Œéœ€è¦å®‰è£…å¦ä¸€ä¸ªæ’ä»¶ï¼š</p>\n<ul>\n<li>å®‰è£…æ’ä»¶ï¼šjclasslib Bytecode Viewerã€‚</li>\n<li>é€‰ä¸­è¦æŸ¥çœ‹çš„ java æ–‡ä»¶ï¼ˆä¸æ˜¯ class æ–‡ä»¶ï¼‰ï¼Œç‚¹å‡» viewï¼ˆè§†å›¾ï¼‰ï¼Œå†ç‚¹å‡» <code>show Bytecode with jclasslib</code> ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/06/8f19ae55706ab1c2.jpg\" alt=\"\" /></p>\n<ul>\n<li>è¿™æ ·æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä»€ä¹ˆçš„å°±éå¸¸æ–¹ä¾¿ã€‚</li>\n</ul>\n<p>å¯¹äºç±»æ–‡ä»¶ä¿¡æ¯ï¼Œéœ€è¦çŸ¥é“çš„éƒ¨åˆ†å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/05/868070b026d6842b.jpg\" alt=\"\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ClassFile</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    u4             magic<span class=\"token punctuation\">;</span> <span class=\"token comment\">//Class æ–‡ä»¶çš„æ ‡å¿—</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    u2             minor_version<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class çš„å°ç‰ˆæœ¬å·</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    u2             major_version<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class çš„å¤§ç‰ˆæœ¬å·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    u2             constant_pool_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// å¸¸é‡æ± çš„æ•°é‡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    cp_info        constant_pool<span class=\"token punctuation\">[</span>constant_pool_count<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å¸¸é‡æ± </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    u2             access_flags<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class çš„è®¿é—®æ ‡è®°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    u2             this_class<span class=\"token punctuation\">;</span><span class=\"token comment\">// å½“å‰ç±»</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    u2             super_class<span class=\"token punctuation\">;</span><span class=\"token comment\">// çˆ¶ç±»</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    u2             interfaces_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ¥å£</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    u2             interfaces<span class=\"token punctuation\">[</span>interfaces_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    u2             fields_count<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class æ–‡ä»¶çš„å­—æ®µå±æ€§</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    field_info     fields<span class=\"token punctuation\">[</span>fields_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»ä¼šå¯ä»¥æœ‰ä¸ªå­—æ®µ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    u2             methods_count<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class æ–‡ä»¶çš„æ–¹æ³•æ•°é‡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    method_info    methods<span class=\"token punctuation\">[</span>methods_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    u2             attributes_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    attribute_info attributes<span class=\"token punctuation\">[</span>attributes_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å±æ€§è¡¨é›†åˆ</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"é­”æ•°ä¸ç‰ˆæœ¬\"><a class=\"anchor\" href=\"#é­”æ•°ä¸ç‰ˆæœ¬\">#</a> é­”æ•°ä¸ç‰ˆæœ¬</h3>\n<p>å­—èŠ‚ç æ–‡ä»¶å‰ 4 ä¸ªå­—èŠ‚ï¼ˆ32bitï¼‰ç»„æˆäº†é­”æ•°ï¼Œé­”æ•°æœºåˆ¶æ£€éªŒè¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ JVM å¯ä»¥ç›´æ¥è¿è¡Œçš„å­—èŠ‚ç æ–‡ä»¶ã€‚å­—èŠ‚ç æ–‡ä»¶çš„é­”æ•°ä¸ºï¼š<strong>CAFFBABE</strong>ã€‚</p>\n<p>é­”æ•°åé¢çš„ 4 ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯å­—èŠ‚ç æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œå‰ä¸¤ä¸ªæ˜¯æ¬¡è¦ç‰ˆæœ¬å·ï¼ˆç°åœ¨åŸºæœ¬ä¸ç”¨äº†ï¼‰ï¼Œåä¸¤ä¸ªæ˜¯ä¸»è¦ç‰ˆæœ¬å·ï¼Œå°† 16 è¿›åˆ¶æ¢ç®—æˆ 10 è¿›åˆ¶ä¹‹åï¼Œå¾—åˆ°çš„å¯ä»¥å‚ç…§ï¼š52 ä»£è¡¨ JDK8 ç¼–è¯‘çš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ51 æ˜¯ JDK7ï¼Œ53 æ˜¯ JDK9ï¼‰ã€‚</p>\n<h3 id=\"å¸¸é‡æ± \"><a class=\"anchor\" href=\"#å¸¸é‡æ± \">#</a> å¸¸é‡æ± </h3>\n<p><code>Constant pool</code>  æ„ä¸ºå¸¸é‡æ± ï¼Œå¯ä»¥ç†è§£ä¸º <code>Class</code>  æ–‡ä»¶ä¸­çš„èµ„æºä»“åº“ï¼Œæ˜¯ç¨‹åºè¿è¡Œä¸€äº›éœ€è¦ç”¨åˆ°çš„å¸¸é‡æ•°æ®ï¼Œä¸»è¦å­˜æ”¾<strong>å­—é¢é‡</strong>å’Œ<strong>ç¬¦å·å¼•ç”¨</strong>ã€‚å­—é¢é‡ç±»ä¼¼äº Java ä¸­çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œ <code>final</code>  å¸¸é‡ç­‰ã€‚</p>\n<p>ç¬¦å·å¼•ç”¨å±äºç¼–è¯‘åŸç†çš„æ¦‚å¿µï¼š</p>\n<ul>\n<li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li>\n<li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li>\n<li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li>\n</ul>\n<p>å¸¸é‡çš„æ•°é‡ä¸æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥åœ¨<strong>æœ€å¼€å§‹çš„ä½ç½®</strong>ä¼šå­˜æ”¾å¸¸é‡æ± ä¸­<strong>å¸¸é‡çš„æ•°é‡</strong>ï¼ˆæ˜¯ä» 1 å¼€å§‹è®¡ç®—çš„ï¼Œä¸æ˜¯ 0ï¼Œæ¯”å¦‚ 18ï¼Œç¿»è¯‘ä¸º 10 è¿›åˆ¶å°±æ˜¯ 24ï¼Œæ‰€ä»¥å®é™…ä¸Šæœ‰ 23 ä¸ªå¸¸é‡ï¼‰ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>u2             constant_pool_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// å¸¸é‡æ± çš„æ•°é‡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cp_info        constant_pool<span class=\"token punctuation\">[</span>constant_pool_count<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å¸¸é‡æ± </span></pre></td></tr></table></figure><p>æ¯ä¸€é¡¹å¸¸é‡æ± é‡Œé¢çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œéƒ½æ˜¯ä»¥_info ç»“å°¾çš„ï¼ˆé€šè¿‡æ’ä»¶æŸ¥çœ‹å³å¯ï¼‰ï¼Œæœ‰ 14 ç§è¡¨ã€‚</p>\n<h3 id=\"è®¿é—®æ ‡å¿—\"><a class=\"anchor\" href=\"#è®¿é—®æ ‡å¿—\">#</a> è®¿é—®æ ‡å¿—</h3>\n<p>ä¸¤ä¸ªå­—èŠ‚ï¼Œä»£è¡¨è®¿é—®æ ‡å¿—ï¼Œç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šClass æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦ä¸º public æˆ–è€… abstract ç±»å‹ï¼Œå¦‚æœæ˜¯ç±»çš„è¯æ˜¯å¦å£°æ˜ä¸º final ç­‰ç­‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/07/d412705d408b4988.jpg\" alt=\"\" /></p>\n<p>åç¼–è¯‘ä¸€ä¸‹ <code>Test.class</code>  æ–‡ä»¶æŸ¥çœ‹è®¿é—®æ ‡å¿—ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># -p -private æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># -v -verbose è¾“å‡ºé™„åŠ ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>javap <span class=\"token parameter variable\">-verbose</span> <span class=\"token parameter variable\">-p</span> Test.class</pre></td></tr></table></figure><p>å¯¹äºç»“æœä¸ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/07/175494f35c4a5e2e.jpg\" alt=\"\" /></p>\n<h3 id=\"ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆ\"><a class=\"anchor\" href=\"#ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆ\">#</a> ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆ</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>u2             this_class<span class=\"token punctuation\">;</span><span class=\"token comment\">// å½“å‰ç±»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>u2             super_class<span class=\"token punctuation\">;</span><span class=\"token comment\">// çˆ¶ç±»</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>u2             interfaces_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ¥å£</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>u2             interfaces<span class=\"token punctuation\">[</span>interfaces_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span></pre></td></tr></table></figure><p>åœ¨è®¿é—®æ ‡å¿—çš„åç¼–è¯‘å›¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°<strong>å½“å‰ç±»ç´¢å¼•</strong>ï¼Œ<strong>çˆ¶ç±»ç´¢å¼•</strong>ï¼Œ<strong>æ¥å£ç´¢å¼•</strong>ã€‚</p>\n<p><strong>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äº Java è¯­è¨€çš„å•ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†  <code>java.lang.Object</code>  ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ java ç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†  <code>java.lang.Object</code>  å¤–ï¼Œæ‰€æœ‰ Java ç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚</strong></p>\n<p><strong>æ¥å£ç´¢å¼•é›†åˆç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†é‚£äº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ <code>implents</code>  (å¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯æ¥å£çš„è¯åˆ™æ˜¯ <code>extends</code> ) åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</strong></p>\n<h3 id=\"å­—æ®µè¡¨é›†åˆ\"><a class=\"anchor\" href=\"#å­—æ®µè¡¨é›†åˆ\">#</a> å­—æ®µè¡¨é›†åˆ</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>u2             fields_count<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class æ–‡ä»¶çš„å­—æ®µçš„ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>field_info     fields<span class=\"token punctuation\">[</span>fields_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»ä¼šå¯ä»¥æœ‰ä¸ªå­—æ®µ</span></pre></td></tr></table></figure><p>ç”¨äºæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚ä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨çš„å±€éƒ¨å˜é‡ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/07/a82c68d88210068a.jpg\" alt=\"\" /></p>\n<ul>\n<li><strong>access_flags:</strong> å­—æ®µçš„ä½œç”¨åŸŸï¼ˆ <code>public</code>  , <code>private</code> , <code>protected</code>  ä¿®é¥°ç¬¦ï¼‰ï¼Œæ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆ <code>static</code>  ä¿®é¥°ç¬¦ï¼‰, å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransient ä¿®é¥°ç¬¦ï¼‰, å¯å˜æ€§ï¼ˆfinalï¼‰, å¯è§æ€§ï¼ˆvolatile ä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚</li>\n<li><strong>name_index:</strong> å¯¹<strong>å¸¸é‡æ± </strong>çš„å¼•ç”¨ï¼Œè¡¨ç¤ºçš„å­—æ®µçš„åç§°ï¼›</li>\n<li><strong>descriptor_index:</strong> å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ï¼›//</li>\n<li><strong>attributes_count:</strong> ä¸€ä¸ªå­—æ®µè¿˜ä¼šæ‹¥æœ‰ä¸€äº›é¢å¤–çš„å±æ€§ï¼Œattributes_count å­˜æ”¾å±æ€§çš„ä¸ªæ•°ï¼›</li>\n<li><strong>attributes[attributes_count]:</strong> å­˜æ”¾å…·ä½“å±æ€§å…·ä½“å†…å®¹ã€‚</li>\n</ul>\n<h3 id=\"æ–¹æ³•è¡¨é›†åˆ\"><a class=\"anchor\" href=\"#æ–¹æ³•è¡¨é›†åˆ\">#</a> æ–¹æ³•è¡¨é›†åˆ</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>u2             methods_count<span class=\"token punctuation\">;</span><span class=\"token comment\">//Class æ–‡ä»¶çš„æ–¹æ³•çš„æ•°é‡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>method_info    methods<span class=\"token punctuation\">[</span>methods_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span></pre></td></tr></table></figure><p>Class æ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°å‡ ä¹é‡‡ç”¨äº†å®Œå…¨ä¸€è‡´çš„æ–¹å¼ã€‚æ–¹æ³•è¡¨ï¼ˆ <code>method_info</code> ï¼‰çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•ã€å±æ€§è¡¨é›†åˆå‡ é¡¹ï¼ˆæ‰€ä»¥å‚ç…§ä¸Šå›¾ <code>field_info</code> ï¼‰ã€‚</p>\n<p>å¾—åˆ°çš„ç»“æœï¼ˆè¿™é‡Œåªçœ‹æ–¹æ³•é‚£éƒ¨åˆ†ï¼‰ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Chapter1<span class=\"token punctuation\">.</span>Test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    descriptor<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">V</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    flags<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0x0001</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">ACC_PUBLIC</span>\t\t\t\t<span class=\"token comment\">// è¿™å°±æ˜¯ access_flag å–å€¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Code</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      stack<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> locals<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> args_size<span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token number\">0</span><span class=\"token operator\">:</span> aload_0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token number\">1</span><span class=\"token operator\">:</span> invokespecial #<span class=\"token number\">1</span>                <span class=\"token comment\">// Method java/lang/Object.\"&lt;init>\":()V</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token number\">4</span><span class=\"token operator\">:</span> <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         <span class=\"token number\">0</span><span class=\"token operator\">:</span> aload_0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token number\">1</span><span class=\"token operator\">:</span> getfield      #<span class=\"token number\">2</span>                <span class=\"token comment\">// Field m:I</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token number\">4</span><span class=\"token operator\">:</span> iconst_1</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token number\">5</span><span class=\"token operator\">:</span> iadd</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         <span class=\"token number\">6</span><span class=\"token operator\">:</span> ireturn</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token class-name\">LineNumberTable</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        line <span class=\"token number\">6</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><p>å…¶ä¸­ <code>access_flag</code>  å–å€¼ä¸ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/07/f8a119d3fd7bb199.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å› ä¸º <code>volatile</code>  ä¿®é¥°ç¬¦å’Œ <code>transient</code>  ä¿®é¥°ç¬¦ä¸å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œæ‰€ä»¥æ–¹æ³•è¡¨çš„è®¿é—®æ ‡å¿—ä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªå¯¹åº”çš„æ ‡å¿—ï¼Œä½†æ˜¯å¢åŠ äº† <code>synchronized</code> ã€ <code>native</code> ã€ <code>abstract</code>  ç­‰å…³é”®å­—ä¿®é¥°æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±å¤šäº†è¿™äº›å…³é”®å­—å¯¹åº”çš„æ ‡å¿—ã€‚</p>\n</blockquote>\n<p>code å†…çš„ä¸»è¦å±æ€§ä¸º:</p>\n<ul>\n<li><strong>stack</strong>ï¼š æœ€å¤§æ“ä½œæ•°æ ˆï¼ŒJVM è¿è¡Œæ—¶ä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ (Frame) ä¸­çš„æ“ä½œæ ˆæ·±åº¦ï¼Œæ­¤å¤„ä¸º 1**ï¼ˆé€’å½’ï¼Ÿï¼‰**</li>\n<li><strong>locals</strong>ï¼šå±€éƒ¨å˜é‡æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ï¼Œå•ä½ä¸º Slot, Slot æ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ—¶æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ï¼Œä¸º 4 ä¸ªå­—èŠ‚å¤§å°ã€‚æ–¹æ³•å‚æ•° (åŒ…æ‹¬å®ä¾‹æ–¹æ³•ä¸­çš„éšè—å‚æ•° this)ï¼Œæ˜¾ç¤ºå¼‚å¸¸å¤„ç†å™¨çš„å‚æ•° (try catch ä¸­çš„ catch å—æ‰€å®šä¹‰çš„å¼‚å¸¸)ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡éƒ½éœ€è¦ä½¿ç”¨<strong>å±€éƒ¨å˜é‡è¡¨</strong>æ¥å­˜æ”¾ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œlocals çš„å¤§å°å¹¶ä¸ä¸€å®šç­‰äºæ‰€æœ‰å±€éƒ¨å˜é‡æ‰€å çš„ Slot ä¹‹å’Œï¼Œå› ä¸ºå±€éƒ¨å˜é‡ä¸­çš„ Slot æ˜¯å¯ä»¥é‡ç”¨çš„ã€‚</li>\n<li><strong>args_size</strong>ï¼šæ–¹æ³•å‚æ•°çš„ä¸ªæ•°ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œå› ä¸ºæ¯ä¸ªå®ä¾‹æ–¹æ³•éƒ½ä¼šæœ‰ä¸€ä¸ªéšè—å‚æ•° this</li>\n<li><strong>attribute_info</strong>: æ–¹æ³•ä½“å†…å®¹ï¼Œ0,1,4 ä¸ºå­—èŠ‚ç  &quot;è¡Œå·&quot;ï¼Œè¯¥æ®µä»£ç çš„æ„æ€æ˜¯å°†ç¬¬ä¸€ä¸ªå¼•ç”¨ç±»å‹æœ¬åœ°å˜é‡æ¨é€è‡³æ ˆé¡¶ï¼Œç„¶åæ‰§è¡Œè¯¥ç±»å‹çš„å®ä¾‹æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± å­˜æ”¾çš„ç¬¬ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯æ³¨é‡Šé‡Œçš„ <code>java/lang/Object.&quot;&quot;:()V</code> , ç„¶åæ‰§è¡Œè¿”å›è¯­å¥ï¼Œç»“æŸæ–¹æ³•ã€‚</li>\n<li><strong>LineNumberTable</strong>ï¼šè¯¥å±æ€§çš„ä½œç”¨æ˜¯æè¿°æºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå· (å­—èŠ‚ç åç§»é‡) ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å¯ä»¥ä½¿ç”¨ -g:none æˆ– - g:lines é€‰é¡¹æ¥å–æ¶ˆæˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ï¼Œå¦‚æœé€‰æ‹©ä¸ç”Ÿæˆ LineNumberTableï¼Œå½“ç¨‹åºè¿è¡Œå¼‚å¸¸æ—¶å°†æ— æ³•è·å–åˆ°å‘ç”Ÿå¼‚å¸¸çš„æºç è¡Œå·ï¼Œä¹Ÿæ— æ³•æŒ‰ç…§æºç çš„è¡Œæ•°æ¥è°ƒè¯•ç¨‹åºã€‚</li>\n</ul>\n<p>æœ‰æ—¶è¿˜ä¼šå‡ºç°è¿™ä¸ªï¼š</p>\n<ul>\n<li><strong>LocalVariableTable</strong>ï¼šè¯¥å±æ€§çš„ä½œç”¨æ˜¯æè¿°å¸§æ ˆä¸­å±€éƒ¨å˜é‡ä¸æºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚å¯ä»¥ä½¿ç”¨ -g:none æˆ– -g:vars æ¥å–æ¶ˆæˆ–ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ï¼Œé‚£ä¹ˆå½“åˆ«äººå¼•ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°†æ— æ³•è·å–åˆ°å‚æ•°åç§°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ arg0, arg1 è¿™æ ·çš„å ä½ç¬¦ã€‚ start è¡¨ç¤ºè¯¥å±€éƒ¨å˜é‡åœ¨å“ªä¸€è¡Œå¼€å§‹å¯è§ï¼Œlength è¡¨ç¤ºå¯è§è¡Œæ•°ï¼ŒSlot ä»£è¡¨æ‰€åœ¨å¸§æ ˆä½ç½®ï¼ŒName æ˜¯å˜é‡åç§°ï¼Œç„¶åæ˜¯ç±»å‹ç­¾åã€‚</li>\n</ul>\n<h3 id=\"å±æ€§è¡¨é›†åˆ\"><a class=\"anchor\" href=\"#å±æ€§è¡¨é›†åˆ\">#</a> å±æ€§è¡¨é›†åˆ</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>u2             attributes_count<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>attribute_info attributes<span class=\"token punctuation\">[</span>attributes_count<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å±æ€§è¡¨é›†åˆ</span></pre></td></tr></table></figure><p>ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpnMk9UQTBOamswT0E9PSZhbXA7bWlkPTIyNDc0ODUyNTAmYW1wO2lkeD0yJmFtcDtzbj0zMzc5M2JjY2UzZjJmZjMxYjgzY2YyZjljMzJkZjE1MyZhbXA7Y2hrc209Y2VhMjQ4ODlmOWQ1YzE5ZmEzZTJiN2Q0ZjU5NzYyYjU5ZTZjZDllNWU2NTY0ZmU3M2M2OTkzYmQwNmUwOGJkZGQ0MGNjMGYzY2JhMCZhbXA7c2NlbmU9MCZhbXA7eHRyYWNrPTEmYW1wO2tleT00OWNkMWU1OTk5MGMzZDFmMjA3ODY1ZDMyNzU5ZjFmZjJhZTdmZGY2NzZmM2IwYTAyYmE0OTkwNmE1YWYzY2NkYmQ3M2U0M2JiZTMxNTE1ODY2Zjk3NDgzODhjNzhjYjllNDQwNmQ4ODBlYWYyZDUxYWZjZjMyMTY4ZjNhZDI3MTc2OWNjMWM5M2NiZmIwMTM1MDQ2MjEwYjQxZDdkMDM2JmFtcDthc2NlbmU9MSZhbXA7dWluPU1qTXhNRGs0TkRJMyZhbXA7ZGV2aWNldHlwZT1XaW5kb3dzKzcmYW1wO3ZlcnNpb249NjIwNjA3MzkmYW1wO2xhbmc9emhfQ04mYW1wO3Bhc3NfdGlja2V0PUowJTJCTG5yTmdFRm91SzRldEJud2cxSFVhYnNGdzdqaTVXMWZpU3ZldWc1NCUzRA==\">è°ˆè°ˆ Java ç±»æ–‡ä»¶ç»“æ„</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlL3NwZWNzL2p2bXMvc2U3L2h0bWwvanZtcy00Lmh0bWw=\">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb29sc2hlbGwuY24vYXJ0aWNsZXMvOTIyOS5odG1s\">https://coolshell.cn/articles/9229.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1YW5sb3Vpcy9hcnRpY2xlL2RldGFpbHMvMzk5NjA4MTU=\">https://blog.csdn.net/luanlouis/article/details/39960815</span></p>\n<p>ã€Šå®æˆ˜ Java è™šæ‹Ÿæœºã€‹</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qdm0vamF2YS1qdm0tY2xhc3MuaHRtbA==\">https://pdai.tech/md/java/jvm/java-jvm-class.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tlb3BtZw==\">https://www.yuque.com/qingkongxiaguang/javase/keopmg</span></p>\n</blockquote>\n",
            "tags": [
                "JVM"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/04/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(5)-WeakHashMap/",
            "url": "https://cecilia.cool/2022/10/04/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(5)-WeakHashMap/",
            "title": "Javaé›†åˆ(5)--WeakHashMap",
            "date_published": "2022-10-04T09:46:00.000Z",
            "content_html": "<h1 id=\"å¼•ç”¨ç±»å‹\"><a class=\"anchor\" href=\"#å¼•ç”¨ç±»å‹\">#</a> å¼•ç”¨ç±»å‹</h1>\n<h2 id=\"å¼ºå¼•ç”¨\"><a class=\"anchor\" href=\"#å¼ºå¼•ç”¨\">#</a> å¼ºå¼•ç”¨</h2>\n<p>æœ€æ™®éçš„å¼•ç”¨ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡<strong>å…·æœ‰</strong>å¼ºå¼•ç”¨ï¼ŒGC ç»ä¸ä¼šå›æ”¶ã€‚å¦‚æœä¸ä½¿ç”¨ï¼Œè¦å¼±åŒ–å¼•ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Object</span> o <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>o <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// help GC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Object</span> o <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>test æ–¹æ³•å†…éƒ¨æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå¼•ç”¨ä¿å­˜åœ¨æ ˆä¸­ï¼Œnew çš„å¯¹è±¡ä¿å­˜åœ¨</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>å †ä¸­ï¼Œå½“æ–¹æ³•è¿è¡Œç»“æŸä¼šé€€å‡ºæ–¹æ³•æ ˆï¼Œåˆ™å¼•ç”¨å†…å®¹çš„å¼•ç”¨ä¸å­˜åœ¨ï¼ŒObject</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>å°±ä¼šè¢«å›æ”¶ã€‚</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>*/</span></pre></td></tr></table></figure><blockquote>\n<p>å¦‚æœ o æ˜¯å…¨å±€å˜é‡ï¼Œéœ€è¦åœ¨ä¸ç”¨å¯¹è±¡æ—¶èµ‹å€¼ä¸º nullã€‚</p>\n</blockquote>\n<h2 id=\"è½¯å¼•ç”¨\"><a class=\"anchor\" href=\"#è½¯å¼•ç”¨\">#</a> è½¯å¼•ç”¨</h2>\n<p>ä¸€ä¸ªå¯¹è±¡åªæœ‰è½¯å¼•ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¸ä¼šå›æ”¶å®ƒï¼›å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚</p>\n<blockquote>\n<p>è½¯å¼•ç”¨å¯ä»¥ç”¨äºå®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// å¼±å¼•ç”¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">SoftReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> softReference <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SoftReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼Œåé€€æ—¶æ˜¾ç¤ºçš„ç½‘é¡µåº”è¯¥æ˜¯é‡æ–°è¿›è¡Œè¯·æ±‚è¿˜æ˜¯ä»ç¼“å­˜ä¸­å–å‡ºçš„å–å†³äºå…·ä½“çš„å®ç°ç­–ç•¥ã€‚å¦‚æœå°†æµè§ˆçš„ç½‘é¡µå…¨éƒ¨å¼ºå¼•ç”¨å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼Œå°±ä¼šé€ æˆæµªè´¹ç”šè‡³å†…å­˜æº¢å‡ºã€‚</p>\n<p>æ­¤æ—¶ä½¿ç”¨è½¯å¼•ç”¨ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Browser</span> prev <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Browser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é¡µé¢æµè§ˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// æµè§ˆåè®¾ä¸ºè½¯å¼•ç”¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">SoftReference</span> sr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SoftReference</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>sr<span class=\"token punctuation\">.</span>get <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    rev <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Browser</span><span class=\"token punctuation\">)</span> sr<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    prev <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Broswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å†…å­˜åƒç´§ï¼Œè½¯å¼•ç”¨å¯¹è±¡å›æ”¶</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    sr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SoftReference</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é‡æ–°æ„å»º</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å¼±å¼•ç”¨\"><a class=\"anchor\" href=\"#å¼±å¼•ç”¨\">#</a> å¼±å¼•ç”¨</h2>\n<p>åŒºåˆ«äºè½¯å¼•ç”¨ï¼Œåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">String</span> str<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">WeakReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> abcWeakRef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>str<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// å¯ä»¥æ¢å¤å¼ºå¼•ç”¨</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">String</span> abc <span class=\"token operator\">=</span> abcWeakRef<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"è™šå¼•ç”¨\"><a class=\"anchor\" href=\"#è™šå¼•ç”¨\">#</a> è™šå¼•ç”¨</h2>\n<p>è™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>\n<p>è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ´»åŠ¨ã€‚è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ— ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹ å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p>\n<h1 id=\"weakhashmap\"><a class=\"anchor\" href=\"#weakhashmap\">#</a> WeakHashMap</h1>\n<p>å…ˆçœ‹ä¸€ä¸‹<strong>å¼•ç”¨é˜Ÿåˆ—</strong>ï¼š</p>\n<ul>\n<li>ä¸€èˆ¬æƒ…å†µï¼Œä¸€ä¸ªå¯¹è±¡è¢«æ ‡è®°ä¸ºåƒåœ¾ï¼ˆä¸ä»£è¡¨å›æ”¶äº†ï¼‰ï¼Œä¼šåŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ã€‚</li>\n<li>å¯¹äºè™šå¼•ç”¨æ¥è¯´ï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¼šåªæœ‰è¢«<strong>å›æ”¶å</strong>æ‰ä¼šåŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼ˆå…¶ä»–æ˜¯è¢«æ ‡è®°ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä½œè®°å½•è¯¥å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚</li>\n</ul>\n<p><code>WeakHashMap</code>  ä¸ <code>HashMap</code>  æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯å¼•ç”¨é‡‡å–çš„æ˜¯å¼±å¼•ç”¨çš„ <code>key</code>  å­˜å‚¨ï¼Œ<strong>GC å›æ”¶çš„æ˜¯ <code>key</code> </strong>ã€‚è¿™ç§ç»“æ„é€‚åˆç¼“å­˜å¤„ç†ã€‚åº•å±‚æ˜¯å› ä¸º <code>Entry</code>  ç»§æ‰¿äº† <code>WeakReference</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    \t\t\t\t\t\t\t<span class=\"token class-name\">WeakReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                                <span class=\"token keyword\">implements</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                                <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">V</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> hash<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">V</span> value<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token class-name\">ReferenceQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> queue<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token keyword\">int</span> hash<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hash  <span class=\"token operator\">=</span> hash<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>next  <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸ºäº†å°† <code>key</code>  æ”¹å†™ä¸ºå¼±å¼•ç”¨ï¼Œåœ¨ <code>Entry</code>  ä¸­åˆè°ƒç”¨äº†ä¸€ä¸ª <code>super(key, queue)</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// WeakReference æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">WeakReference</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> referent<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ReferenceQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> q<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>referent<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>WeakHashMap</code>  é™¤äº† <code>WeakReference</code> ï¼Œè¿˜æœ‰ <code>ReferenceQueue</code>  é‡è¦ã€‚</p>\n<blockquote>\n<p>å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œ <code>WeakHashMap</code>  åŸºäºå¼±å¼•ç”¨å¯ä»¥æ·˜æ±°å†…éƒ¨å…ƒç´ ï¼ŒåŒæ ·çš„ï¼Œ <code>LinkedHashMap</code>  ä¹Ÿæ˜¯å…·å¤‡æ·˜æ±°æœºåˆ¶çš„ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡é˜ˆå€¼æ¥é™å®šèŠ‚ç‚¹ä¸ªæ•°çš„å…ˆè¿›å…ˆå‡ºç¼“å­˜ã€‚</p>\n</blockquote>\n<h2 id=\"å¼±å¼•ç”¨å›æ”¶\"><a class=\"anchor\" href=\"#å¼±å¼•ç”¨å›æ”¶\">#</a> å¼±å¼•ç”¨å›æ”¶</h2>\n<p><code>Reference</code>  ç±»æœ‰ä¸€æ®µé™æ€ä»£ç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Lock</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// æœ‰ä¸€ä¸ªå…¨å±€é”</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Lock</span> lock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Reference</span> pending <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">ThreadGroup</span> tg <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getThreadGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadGroup</span> tgn <span class=\"token operator\">=</span> tg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         tgn <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         tg <span class=\"token operator\">=</span> tgn<span class=\"token punctuation\">,</span> tgn <span class=\"token operator\">=</span> tg<span class=\"token punctuation\">.</span><span class=\"token function\">getParent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">Thread</span> handler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReferenceHandler</span><span class=\"token punctuation\">(</span>tg<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Reference Handler\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// ä¼˜å…ˆçº§æœ€é«˜</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    handler<span class=\"token punctuation\">.</span><span class=\"token function\">setPriority</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_PRIORITY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    handler<span class=\"token punctuation\">.</span><span class=\"token function\">setDaemon</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    handler<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å‡è®¾ <code>WeakHashMap</code>  å¯¹è±¡é‡Œé¢ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡å¼•ç”¨ï¼š</p>\n<ul>\n<li>GC æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª CMST çº¿ç¨‹è¿›è¡Œ GCï¼Œè¯¥çº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶è¿˜ä¼šåˆ›å»ºä¸€ä¸ª SLT çº¿ç¨‹å¹¶å¯åŠ¨ã€‚</li>\n<li>CMST å¼€å§‹ GC æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ SLT è®©ä»–å»è·å– Java å±‚ <code>Reference</code>  å¯¹è±¡çš„å…¨å±€é” <code>lock</code> ã€‚</li>\n<li>å½“ GC å®Œæ¯•æ—¶ï¼ŒJVM ä¼šå°† WeakHashMap ä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„ <code>WeakReference</code>  å®¹å™¨å¯¹è±¡æ”¾å…¥åˆ° <code>Reference</code>  çš„ <code>pending</code>  å±æ€§ä¸­ï¼ˆæ¯æ¬¡ GC å®Œæ¯•åï¼Œ <code>pending</code>  å±æ€§åŸºæœ¬ä¸Šä¸ä¼šä¸º null äº†ï¼‰ã€‚</li>\n<li>ç„¶åé€šçŸ¥ SLT é‡Šæ”¾å¹¶ä¸” <code>notify</code>  å…¨å±€é” <code>lock</code> ï¼Œæ­¤æ—¶æ¿€æ´»äº† <code>ReferenceHandler</code>  çº¿ç¨‹çš„ <code>run</code>  æ–¹æ³•ï¼Œè„±ç¦» wait çŠ¶æ€å¼€å§‹è¿è¡Œã€‚</li>\n<li><code>Handler</code>  çº¿ç¨‹ä¼šå°† pending ä¸­æ‰€æœ‰ <code>WeakReference</code>  å¯¹è±¡ç§»åŠ¨åˆ°å„è‡ªé˜Ÿåˆ—ä¸­ï¼ˆæ¯”å¦‚å½“å‰è¿™ä¸ª <code>WeakReference</code>  å±äºæŸä¸ª <code>WeakHashMap</code>  å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ <code>ReferenceQueue</code>  åˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ï¼‰ã€‚</li>\n</ul>\n<p>æœ€åçœ‹ä¸€ä¸‹ <code>ReferenceHandler</code>  çš„æºç ï¼Œå¦‚ä½•å°† <code>WeakRenference</code>  å‹å…¥é˜Ÿåˆ—ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReferenceHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token class-name\">ReferenceHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadGroup</span> g<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token class-name\">Reference</span> r<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>             <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pending <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>             r <span class=\"token operator\">=</span> pending<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>             <span class=\"token class-name\">Reference</span> rn <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>             pending <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rn <span class=\"token operator\">==</span> r<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> rn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>             r<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> r<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>             <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                 lock<span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>             <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token comment\">// Fast path for cleaners</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Cleaner</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>             <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cleaner</span><span class=\"token punctuation\">)</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>             <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token class-name\">ReferenceQueue</span> q <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span>queue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">!=</span> <span class=\"token class-name\">ReferenceQueue</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> q<span class=\"token punctuation\">.</span><span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨ <code>get()</code> ï¼Œ <code>replaceAll()</code> ï¼Œ <code>put()</code> ï¼Œ <code>remove()</code>  ç­‰æ–¹æ³•æ—¶ï¼ˆéƒ½éœ€è¦è·å– <code>table</code> ï¼‰, ä¸æ˜¯ç›´æ¥æ‹¿åˆ° <code>table</code>  æ•°ç»„ï¼Œè€Œæ˜¯é€šè¿‡ <code>getTable()</code>  æ–¹æ³•å…ˆæŠŠæ•°ç»„ä¸­ <code>key</code>  ä¸º <code>null</code>  çš„ <code>Entry</code>  åˆ é™¤æ‰åœ¨è¿”å›ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// çœŸæ­£åˆ é™¤ Entry çš„æ‰§è¡Œè€… </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">expungeStaleEntries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> table<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>expungeStaleEntries()</code>  æ–¹æ³•ä¸­ï¼Œå­˜å‚¨è¢« GC å›æ”¶å¯¹è±¡çš„ <code>queue</code>  ä¼šæ¥æ”¶ GC å‘é€çš„å›æ”¶æ¶ˆæ¯ï¼Œå°† queueï¼ˆé€šè¿‡ <code>synchronized</code>  ä¸Šé”ï¼‰ä¸­çš„ <code>key</code>  å¯¹åº”çš„ <code>value</code>  èµ‹å€¼ä¸º <code>null</code> ï¼Œå³ <code>help GC</code> ã€‚</p>\n<blockquote>\n<p><code>Entry</code>  ä¸­ä¿å­˜äº† hash ç ï¼Œå³ä½¿ <code>key</code>  è¢« GC äº†ï¼Œä»å¯ä»¥é€šè¿‡ hash ç æ¥å®šä½éœ€è¦è¢«åˆ é™¤çš„ <code>Entry</code> ã€‚é€šè¿‡ <code>Entry</code>  çš„åœ°å€åœ¨å†²çªé“¾è¡¨ä¸­å®šä½ï¼ˆå…¶å®æˆ‘è§‰å¾—ä¹Ÿå¯ä»¥åˆ¤æ–­ <code>Entry.key == null</code> ã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vcGhsaXZlL3AvNjAzMDQ0Ni5odG1s\">https://www.cnblogs.com/phlive/p/6030446.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8yYmE1NTM0NWZkOTQ=\">https://www.jianshu.com/p/2ba55345fd94</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Noa3N0YXJ0L2FydGljbGUvZGV0YWlscy8xMDcwMTkzNzE/c3BtPTEwMDEuMjEwMS4zMDAxLjY2NTAuMiZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3JlbGV2YW50Lm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQmxvZ0NvbW1lbmRGcm9tQmFpZHUlN0VSYXRlLTItMTA3MDE5MzcxLWJsb2ctMTA2NTQ1MzQwLnBjX3JlbGV2YW50X211bHRpX3BsYXRmb3JtX3doaXRlbGlzdHY0JmFtcDtkZXB0aF8xLXV0bV9zb3VyY2U9ZGlzdHJpYnV0ZS5wY19yZWxldmFudC5ub25lLXRhc2stYmxvZy0yJTdFZGVmYXVsdCU3RUJsb2dDb21tZW5kRnJvbUJhaWR1JTdFUmF0ZS0yLTEwNzAxOTM3MS1ibG9nLTEwNjU0NTM0MC5wY19yZWxldmFudF9tdWx0aV9wbGF0Zm9ybV93aGl0ZWxpc3R2NCZhbXA7dXRtX3JlbGV2YW50X2luZGV4PTM=\">ä¸€æ–‡å¸¦ä½ äº†è§£ WeakHashMap</span>.</p>\n<p>è¿™ç¯‡è®²å¾—å¯ä»¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zMzc3NDg4My9hcnRpY2xlL2RldGFpbHMvODk2MTMyNzE=\">https://blog.csdn.net/weixin_33774883/article/details/89613271</span></p>\n</blockquote>\n",
            "tags": [
                "JavaåŸºç¡€"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/03/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(4)-TreeMap/",
            "url": "https://cecilia.cool/2022/10/03/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(4)-TreeMap/",
            "title": "Javaé›†åˆ(4)-TreeMap",
            "date_published": "2022-10-03T13:55:25.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>é¦–å…ˆï¼Œ <code>TreeMap</code>  ä¸å“ˆå¸Œæ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå…¶æ¬¡ï¼Œå“ˆå¸Œå’Œ Map ä¹Ÿä¸æ˜¯ä¸€å›äº‹ï¼Œè¯·ä¸è¦å…ˆå…¥ä¸ºä¸»ã€‚Map åªæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå“ˆå¸Œæ˜¯å°†å¯¹è±¡è®¡ç®—å“ˆå¸Œç çš„ä¸€ç§ç®—æ³•ã€‚ <code>TreeMap</code>  åªæ˜¯é€šè¿‡çº¢é»‘æ ‘å°†é”®å€¼å¯¹å­˜èµ·æ¥ï¼Œä¸€æ–¹é¢å®ç°äº†äºŒå‰æœç´¢æ ‘çš„æ’åºæ€§ï¼Œå¦ä¸€æ–¹é¢ç»´æŠ¤äº†æ•´æ£µæ ‘çš„å¹³è¡¡æ€§ï¼Œé˜²æ­¢æ ‘é€€åŒ–ä¸ºé“¾è¡¨å¢å¤§æŸ¥è¯¢ / æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ã€‚</p>\n<h1 id=\"æ’åºæ–¹å¼\"><a class=\"anchor\" href=\"#æ’åºæ–¹å¼\">#</a> æ’åºæ–¹å¼</h1>\n<p><code>TreeMap</code>  å¯¹æ’å…¥æ•°æ®å®ç°äº†æ’åºï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰æ•°æ®ï¼Œè¦ä¹ˆè¯¥ç±»å®ç° <code>Comparable</code>  æ¥å£ï¼Œè¦ä¹ˆ TreeMap åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ <code>Comparator</code>  æ¥å£ã€‚</p>\n<h2 id=\"comparable\"><a class=\"anchor\" href=\"#comparable\">#</a> Comparable</h2>\n<p>ä»¥ <code>Student</code>  ç±»æ¥è¯´æ˜ï¼Œç»§æ‰¿ <code>Comparable</code>  å¹¶é‡å†™ <code>compareTo()</code>  æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Student</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Comparable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸ºäº†ç®€å•ï¼Œå°±å†™ä¸€ä¸ª id å±æ€§ï¼Œå¹¶è®¾ä¸º public æ–¹ä¾¿è·å–</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Student</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">// å¯¹æ¯”æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Student</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// æŒ‰ç…§ id ä»å°åˆ°å¤§æ’åº</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">-</span> o<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>CompareTo()</code>  ä¸­ï¼Œæ˜¯ä¼ å…¥çš„å¯¹è±¡å’Œå½“å‰å¯¹è±¡è¿›è¡Œå¯¹æ¯”ï¼š</p>\n<ul>\n<li>å¦‚æœå¯¹æ¯”å¤§äº 0ï¼Œé™åºæ’åºã€‚</li>\n<li>å¦‚æœå¯¹æ¯”å°äº 0ï¼Œå‡åºã€‚</li>\n</ul>\n<blockquote>\n<p>å…¶å®è®°ä½å½“å‰å¯¹è±¡ - ä¼ å…¥å¯¹è±¡å°±æ˜¯å‡åºï¼Œåä¹‹åˆ™é™åºã€‚</p>\n</blockquote>\n<h2 id=\"comparator\"><a class=\"anchor\" href=\"#comparator\">#</a> Comparator</h2>\n<p>é€šè¿‡å¤–éƒ¨ç±»çš„æ–¹å¼è¿›è¡Œç¼–å†™ï¼Œå¯¹äº <code>Comparator</code>  æ¥å£çš„ä¼ å…¥ä¹Ÿå¯ä»¥ç”¨ <code>Lambda</code>  è¡¨è¾¾å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Comparator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Student</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">compare</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Student</span> o1<span class=\"token punctuation\">,</span><span class=\"token class-name\">Student</span> o2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// ç¬¬ä¸€ä¸ªå‚æ•° - ç¬¬äºŒä¸ªå‚æ•°ï¼šå‡åº</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">.</span>id <span class=\"token operator\">-</span> o2<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// ä¹Ÿå¯ä»¥ä¼ å…¥ Lambda è¡¨è¾¾å¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Student</span> o1<span class=\"token punctuation\">,</span><span class=\"token class-name\">Student</span> <span class=\"token number\">02</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> o1<span class=\"token punctuation\">.</span>id <span class=\"token operator\">-</span> o2<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>TreeMap</code>  çš„éƒ¨åˆ†å±æ€§å’Œæ„é€ æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TreeMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NavigableMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Cloneable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>Serializable</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Comparator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">K</span><span class=\"token punctuation\">></span></span> comparator<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// ä¼ å…¥ä¸€ä¸ª Comparator æ¥å£</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TreeMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>comparator <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TreeMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Comparator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">K</span><span class=\"token punctuation\">></span></span> comparator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>comparator <span class=\"token operator\">=</span> comparator<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ä¼ å…¥ <code>Comparator</code>  æ¥å£å®ç°ï¼Œé‚£ä¹ˆä¼ å…¥çš„ <code>Key</code>  å¿…é¡»å®ç° <code>Comparable</code> ã€‚</p>\n<blockquote>\n<p><code>TreeMap</code>  åº•å±‚ç”¨çº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘è¿‘ä¼¼å¹³è¡¡ï¼Œæœ€é•¿è·¯å¾„ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„çš„ 2 å€ã€‚</p>\n</blockquote>\n<h1 id=\"treemap\"><a class=\"anchor\" href=\"#treemap\">#</a> TreeMap</h1>\n<p><code>TreeMap</code>  çš„ UML ç±»å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/03/a6778fc1ccf85111.jpg\" alt=\"\" /></p>\n<p>å› ä¸ºåº•å±‚ä½¿ç”¨äº†çº¢é»‘æ ‘ï¼Œæ‰€ä»¥èŠ‚ç‚¹å°±æ˜¯ <code>Entry</code> ï¼Œè®°å½•äº†å·¦å³èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹æŒ‡é’ˆï¼Œä»¥åŠèŠ‚ç‚¹é¢œè‰²ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">K</span> key<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">V</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> left<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> right<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> parent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">boolean</span> color <span class=\"token operator\">=</span> <span class=\"token constant\">BLACK</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// æ„é€ æ–¹æ³•ï¼Œæ­¤å¤„ä¸å†™</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>å…³äºçº¢é»‘æ ‘ï¼Œè¯¦ç»†çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹å¦‚ä½•å˜è‰²ï¼Œå¦‚ä½•å·¦æ—‹å³æ—‹æ¥ç»´æŒè¿‘ä¼¼å¹³è¡¡ï¼Œå¯ä»¥çœ‹ã€Šç®—æ³•å¯¼è®ºã€‹ï¼Œæœ¬æ–‡ä¸ä¼šè¯¦ç»†å»è®²ï¼Œä½œè€…æ›¾ç»ä¹Ÿè‡ªå·±çœ‹ç€ä¹¦å†™è¿‡çº¢é»‘æ ‘ï¼Œå½“æˆ C++ æœŸæœ«ä½œä¸šäº¤ä¸Šå»äº†ï¼Œä½†æ˜¯è¿‡äº†ä¸¤ä¸‰å¤©åˆå¿˜äº†ï¼Œè¿™ç©æ„å§ï¼Œçœ‹ä¸ªäººå…´è¶£å§ï¼Œhhhhhhã€‚</p>\n</blockquote>\n<h2 id=\"put\"><a class=\"anchor\" href=\"#put\">#</a> put()</h2>\n<p>ç›´æ¥ç»™å‡º <code>put</code>  çš„æ‰§è¡Œæµç¨‹ï¼š</p>\n<ul>\n<li>åˆ¤æ–­å½“å‰æ ¹èŠ‚ç‚¹ä¸º nullï¼Œé‚£ä¹ˆæ’å…¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ ¹èŠ‚ç‚¹ã€‚</li>\n<li>å¦‚æœå­˜åœ¨æ ¹èŠ‚ç‚¹ï¼Œåˆ¤æ–­æ’å…¥å…ƒç´ åœ¨å·¦ä¾§è¿˜æ˜¯å³ä¾§ï¼Œå¦‚æœå¯¹æ¯”ä¸º 0ï¼Œè¯´æ˜å½“å‰å…ƒç´ å­˜åœ¨äº <code>TreeMap</code>  ä¸­ï¼Œå°†å…¶è¦†ç›–ï¼š<strong>åœ¨ TreeMap ä¸­ï¼Œä¸ä¼šå­˜åœ¨é‡å¤å…ƒç´ </strong>ã€‚</li>\n<li>æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œæ’å…¥ã€‚</li>\n<li>èŠ‚ç‚¹å˜è‰²å’Œæ—‹è½¬æ“ä½œã€‚</li>\n</ul>\n<blockquote>\n<p>ä»£ç å¤ªé•¿äº†ï¼Œè¦çœ‹æºç è‡ªå·±æ‰“å¼€ IDEA æŸ¥çœ‹ã€‚ä» <code>put</code>  æµç¨‹ä¹Ÿå¯çŸ¥ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<em> logN</em>ã€‚</p>\n</blockquote>\n<h2 id=\"get\"><a class=\"anchor\" href=\"#get\">#</a> get()</h2>\n<p>ä¹Ÿå°±æ˜¯ä¸æ–­åœ°å¯¹æ¯”ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾èŠ‚ç‚¹ã€‚</p>\n<h1 id=\"treeset\"><a class=\"anchor\" href=\"#treeset\">#</a> TreeSet</h1>\n<p>è¿™ä¸ªå°±æ˜¯å¯¹ TreeMap è¿›è¡Œäº†ç®€å•åŒ…è£…ï¼Œä¸è¿‡å¤šè®²è§£</p>\n<blockquote>\n<p>é¢ï¼Œå…¶å®å…³äº <code>TreeMap</code>  çš„è¯¦è§£åº”è¯¥æ˜¯å¯¹çº¢é»‘æ ‘çš„è¯¦è§£ï¼Œä½†æ˜¯æˆ‘çœŸçš„ä¸æƒ³å†™ï¼Œå•Šå•Šå•Šå•Šå•Šï¼Œä»¥åæœ‰æ—¶é—´å°±å•ç‹¬å†™ä¸€ç¯‡åšå®¢è§£é‡Šä¸€ä¸‹çº¢é»‘æ ‘ï¼Œé¡ºä¾¿æ”¾ä¸€ä¸ªæºç æ¨¡æ¿æ–¹ä¾¿å„ä½ä½¿ç”¨ï¼ˆç­‰æˆ‘æƒ³èµ·äº†å†è¯´å§ï¼‰ã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MTE5MjUwNC9hcnRpY2xlL2RldGFpbHMvMTA5Nzc1Nzk3\">https://blog.csdn.net/weixin_51192504/article/details/109775797</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9jb2xsZWN0aW9uL2phdmEtbWFwLVRyZWVNYXAmYW1wO1RyZWVTZXQuaHRtbA==\">https://pdai.tech/md/java/collection/java-map-TreeMap&amp;TreeSet.html</span></p>\n</blockquote>\n",
            "tags": [
                "JavaåŸºç¡€"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/02/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(3)-LinkedHashMap/",
            "url": "https://cecilia.cool/2022/10/02/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(3)-LinkedHashMap/",
            "title": "Javaé›†åˆ3-LinkedHashMap",
            "date_published": "2022-10-02T13:36:18.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>LinkedHashSet</code>  ä¹Ÿæ˜¯ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Œå¯¹ <code>LinkedHashMap</code>  è¿›è¡ŒåŒ…è£…ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸»è¦åˆ†æ <code>LinkedHashMap</code> ã€‚</p>\n<p>ä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºå®¹å™¨æ˜¯<em> Linked list</em> å’Œ<em> HashMap</em> çš„æ··åˆä½“ï¼Œ<strong>å¯ä»¥å°†<em> LinkedHashMap</em> çœ‹ä½œé‡‡ç”¨<em> linked list</em> å¢å¼ºçš„<em> HashMap</em></strong>ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>LinkedHashMap</code>  æ˜¯ <code>HashMap</code>  çš„ç›´æ¥å­ç±»ï¼Œå®ƒçš„åŒºåˆ«åœ¨äºåœ¨ <code>HashMap</code>  çš„åŸºç¡€ä¸Šé‡‡ç”¨åŒå‘é“¾è¡¨å°†æ‰€æœ‰çš„æ•°æ®èŠ‚ç‚¹éƒ½é“¾æ¥èµ·æ¥äº†ï¼Œå°±æ˜¯ä¸ºäº†<strong>ä¿è¯å…ƒç´ çš„è¿­ä»£é¡ºåºå’Œæ’å…¥é¡ºåºç›¸åŒ</strong>ã€‚</p>\n<p>è¿˜æœ‰ä¸ªå¥½å¤„å°±æ˜¯é›†åˆè¿­ä»£æ—¶ä¸éœ€è¦éå†æ•´ä¸ª <code>table</code> ï¼Œé€®ç€åŒå‘é“¾è¡¨çš„ <code>header</code>  éå†å³å¯ã€‚</p>\n<blockquote>\n<p><code>LinkedHashMap</code>  ä¸ºäº†æ€§èƒ½ï¼Œæ˜¯éåŒæ­¥çš„ï¼Œå¤šçº¿ç¨‹ä¸‹éœ€è¦æ‰‹åŠ¨åŒæ­¥</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä¹Ÿå¯ä»¥æ‰“åŒ…æˆåŒæ­¥çš„</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Map</span> m <span class=\"token operator\">=</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">synchronizedMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"æ–¹æ³•å‰–æ\"><a class=\"anchor\" href=\"#æ–¹æ³•å‰–æ\">#</a> æ–¹æ³•å‰–æ</h1>\n<blockquote>\n<p><code>get</code>  æ–¹æ³•å’Œ <code>HashMap</code>  é‡Œçš„æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¸å¤šè¯´ã€‚</p>\n</blockquote>\n<h2 id=\"put\"><a class=\"anchor\" href=\"#put\">#</a> put()</h2>\n<p>æ’å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>\n<ul>\n<li>å°†å…ƒç´ æ’å…¥ <code>table</code>  ä¸­ï¼Œå¦‚æœæœ‰å“ˆå¸Œå†²çªï¼Œå¤´æ’æ³•æ’å…¥åˆ°å¤´éƒ¨ã€‚</li>\n<li>å°†å…ƒç´ æ’å…¥åŒå‘é“¾è¡¨ä¸­ï¼Œé“¾è¡¨å°¾éƒ¨ã€‚</li>\n</ul>\n<p>å…¶å®å°±æ˜¯åœ¨ <code>HashMap</code>  ä¸ŠåŠ å…¥é“¾è¡¨çš„å¼•ç”¨çš„ä¿®æ”¹ã€‚</p>\n<p><code>LinkedHashMap</code>  ä½¿ç”¨çš„èŠ‚ç‚¹æ˜¯ <code>Entrty</code> ï¼Œè¯¥ç±»ç»§æ‰¿äº† <code>HashMap</code>  çš„ <code>Node</code>  ç±»ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HashMap<span class=\"token punctuation\">.</span>Node</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> before<span class=\"token punctuation\">,</span> after<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> hash<span class=\"token punctuation\">,</span> <span class=\"token class-name\">K</span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">V</span> value<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"remove\"><a class=\"anchor\" href=\"#remove\">#</a> remove()</h2>\n<p>åˆ é™¤ä¹Ÿæœ‰ä¸¤éƒ¨åˆ†ï¼š</p>\n<ul>\n<li>å°†å…ƒç´ ä» <code>table</code>  ä¸­åˆ é™¤ã€‚</li>\n<li>å°†å…ƒç´ ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ã€‚</li>\n</ul>\n<h1 id=\"ç»å…¸ç”¨æ³•\"><a class=\"anchor\" href=\"#ç»å…¸ç”¨æ³•\">#</a> ç»å…¸ç”¨æ³•</h1>\n<p>å®ç° FIFO æ›¿æ¢ç­–ç•¥çš„ç¼“å­˜ï¼Œ <code>LinkedHashMap</code>  æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ Map åˆ é™¤æœ€è€çš„ <code>Entry</code> ï¼Œä¹Ÿå°±æ˜¯æœ€æ—©æ’å…¥ Map çš„ Entryã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">removeEldestEntry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> eldest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¯æ¬¡æ’å…¥æ–°å…ƒç´ æ—¶ <code>LinkedHashMap</code>  éƒ½ä¼šè¯¢é—®è¯¥å‡½æ•°æ˜¯å¦è¦åˆ é™¤æœ€è€çš„å…ƒç´ ï¼Œ</p>\n<blockquote>\n<p><code>LinkedHashMap</code>  å¹¶æ²¡æœ‰é‡å†™ <code>put</code>  æ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™çš„ <code>newNode</code>  æ–¹æ³•ï¼Œå› ä¸º <code>newNode</code>  å°±æ˜¯å°†è¦æ’å…¥çš„é”®å€¼å¯¹æ’æ”¾åˆ°æ–°åˆ›å»ºçš„èŠ‚ç‚¹ä¸­ï¼Œåœ¨åˆ›å»ºèŠ‚ç‚¹åé©¬ä¸Šå°†å…¶åŠ å…¥åˆ°åŒå‘é“¾è¡¨ä¸­å³å¯ã€‚</p>\n</blockquote>\n<p>åªè¦åœ¨å­ç±»ä¸­é‡è½½è¯¥æ–¹æ³•ï¼Œå½“å…ƒç´ ä¸ªæ•°è¶…è¿‡ä¸€å®šæ•°é‡æ—¶è®© <code>removeEldestEntry</code>  è¿”å› <code>true</code> ï¼Œå°±èƒ½å®ç°ä¸€ä¸ªå›ºå®šå¤§å°çš„ FIFO ç­–ç•¥çš„ç¼“å­˜ã€‚å…¶å®æˆ‘ä»¬å†™ä¸ªå­ç±»ç»§æ‰¿ <code>LinkedList</code>  å¹¶é‡å†™ä¸€ä¸‹ <code>add</code>  æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œåªæ˜¯è¯´ï¼Œæ˜¯å“Ÿä¸ª <code>LinkedHashMap</code>  æ›´åŠ æ–¹ä¾¿ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/** ä¸€ä¸ªå›ºå®šå¤§å°çš„ FIFO æ›¿æ¢ç­–ç•¥çš„ç¼“å­˜ */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">FIFOCache</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> cacheSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FIFOCache</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> cacheSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cacheSize <span class=\"token operator\">=</span> cacheSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å½“ Entry ä¸ªæ•°è¶…è¿‡ cacheSize æ—¶ï¼Œåˆ é™¤æœ€è€çš„ Entry</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">removeEldestEntry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> eldest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>       <span class=\"token keyword\">return</span> <span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> cacheSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9jb2xsZWN0aW9uL2phdmEtbWFwLUxpbmtlZEhhc2hNYXAmYW1wO0xpbmtlZEhhc2hTZXQuaHRtbA==\">https://pdai.tech/md/java/collection/java-map-LinkedHashMap&amp;LinkedHashSet.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQyMDM0NDkvYXJ0aWNsZS9kZXRhaWxzLzgwMTk0NzA0\">https://blog.csdn.net/u014203449/article/details/80194704</span></p>\n</blockquote>\n",
            "tags": [
                "JavaåŸºç¡€"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/02/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(2)-HashMap/",
            "url": "https://cecilia.cool/2022/10/02/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(2)-HashMap/",
            "title": "Javaé›†åˆ(2)--HashMap",
            "date_published": "2022-10-02T07:59:51.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>å…³äºè¿™äº›é›†åˆçš„è®²è§£ï¼Œä½œè€…é»˜è®¤è¯»è€…éƒ½çŸ¥é“è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šä»æœ€åŸºç¡€çš„å¼€å§‹è®²èµ·ï¼Œä¼šç›´æ¥è·³è¿‡ä»€ä¹ˆæ˜¯æ˜ å°„å…³ç³»ï¼Œå“ˆå¸Œå€¼ç­‰æ¦‚å¿µçš„è®²è§£ã€‚å¯¹äºæºç çš„è§£æä¹Ÿæ˜¯æœ€ä¸»è¦ä½¿ç”¨çš„é‚£äº›æ–¹æ³•ã€‚</p>\n<h1 id=\"ä¸€äº›æ¦‚å¿µ\"><a class=\"anchor\" href=\"#ä¸€äº›æ¦‚å¿µ\">#</a> ä¸€äº›æ¦‚å¿µ</h1>\n<ul>\n<li>è´Ÿè½½å› å­ï¼šé›†åˆå®¹é‡éƒ½æœ‰ä¸Šé™ï¼Œå¦‚æœåŠ å…¥é›†åˆçš„æ•°é‡è¶…è¿‡ä¸€å®šå…è®¸å€¼ï¼Œé›†åˆå°±ä¼šæ‰©å®¹ã€‚è´Ÿè½½å› å­å°±æ˜¯è¡¡é‡å½“å‰æƒ…å†µæ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹çš„æ ‡å‡†ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å¦‚æœæ•°æ®å ç”¨ç‡è¾¾åˆ° 75%ï¼Œå°±ä¼šæ‰©å®¹ï¼Œæ‰©å®¹ä¼šé‡æ–°è®¡ç®—å“ˆå¸Œå€¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">float</span> <span class=\"token constant\">DEFAULT_LOAD_FACTOR</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.75f</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>çº¢é»‘æ ‘ï¼šä¸€ç§æ•°æ®ç»“æ„ï¼Œåœ¨ <code>HashMap</code>  é‡Œé¢æŸ¥è¯¢æ•ˆç‡æ˜¯<em> logN</em>ï¼Œæ•´æ£µæ ‘åœ¨æ’å…¥æ•°æ®æ—¶å§‹ç»ˆä¿æŒè¿‘ä¼¼å¹³è¡¡ï¼ˆä¸æ˜¯çœŸçš„å¹³è¡¡ï¼‰ã€‚JDK1.8 åå°±ç”¨çº¢é»‘æ ‘ä»£æ›¿ <code>HashMap</code>  é‡Œé¢çš„é•¿åº¦è¶…è¿‡ 8 çš„å†²çªé“¾è¡¨äº†ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/02/760aca61cab61cfc.jpg\" alt=\"\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TreeNode</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LinkedHashMap<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>TreeNode</code>  å°±æ˜¯ä¸ºäº†å®ç°çº¢é»‘æ ‘è€Œè®¾è®¡çš„å†…éƒ¨ç±»ã€‚</p>\n<blockquote>\n<p><code>HashMap</code>  çš„åˆå§‹å®¹é‡æ˜¯å¦åº”è¯¥è®¾çš„æ¯”è¾ƒå¤§ï¼Œåœ¨ JDK1.7 ä»¥å‰ï¼ŒHashMap ç”¨çš„æ˜¯å†²çªé“¾è¡¨ï¼ŒHashMap åœ¨è¿­ä»£æ—¶ï¼Œéœ€è¦éå†æ•´ä¸ªæ•°ç»„å’Œå†²çªé“¾è¡¨ã€‚å¦‚æœè¿­ä»£é¢‘ç¹çš„è¯ï¼Œå°±ä¸å®œå°†åˆå§‹å¤§å°è®¾çš„è¿‡å¤§ã€‚</p>\n</blockquote>\n<ul>\n<li><code>modCount</code> ï¼šé›†åˆåªè¦å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ï¼Œéƒ½éœ€è¦ <code>modCount</code>  æ¥è®°å½•ä¿®æ”¹æ¬¡æ•°ã€‚</li>\n<li>å®ç° <code>Map</code>  æ¥å£ï¼šå…è®¸ <code>key</code>  å’Œ <code>value</code>  éƒ½æ˜¯ <code>null</code> ã€‚</li>\n</ul>\n<h1 id=\"æ ¸å¿ƒæ–¹æ³•\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•\">#</a> æ ¸å¿ƒæ–¹æ³•</h1>\n<p>æœ‰æ—¶ä¼šå°† Java7 çš„æ–¹æ³•æ‹¿å‡ºæ¥å’Œ Java8 ä½œæ¯”è¾ƒã€‚</p>\n<p>åœ¨ Java7 ä½¿ç”¨ Entry ä»£è¡¨æ•°æ®èŠ‚ç‚¹ï¼ŒJava8 ä½¿ç”¨ Nodeï¼ŒåŸºæœ¬æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ <code>key</code> ï¼Œ <code>value</code> ï¼Œ <code>hash</code> ï¼Œ <code>next</code>  å››ä¸ªå±æ€§ã€‚ <code>Node</code>  åªèƒ½é€‚ç”¨äºé“¾è¡¨ï¼Œ <code>TreeNode</code>  ç”¨äºçº¢é»‘æ ‘ã€‚</p>\n<h2 id=\"put\"><a class=\"anchor\" href=\"#put\">#</a> put()</h2>\n<blockquote>\n<p><code>put</code>  æ–¹æ³•é‡ç‚¹ä¹Ÿæ˜¯åœ¨äºå¾—åˆ°å“ˆå¸Œå€¼ï¼Œç„¶åå°±æ˜¯å¤„ç†ä¸€ä¸‹<strong>æ‰©å®¹</strong>ï¼Œ<strong>å“ˆå¸Œå†²çª</strong>ï¼Œ<strong>é“¾è¡¨è½¬åŒ–çº¢é»‘æ ‘</strong>ç­‰é—®é¢˜ã€‚</p>\n</blockquote>\n<p>Java7 æ˜¯å…ˆæ‰©å®¹å†æ’å…¥å€¼ï¼ŒJava8 æ˜¯å…ˆæ’å…¥å€¼å†æ‰©å®¹ã€‚ç¬¬ä¸€æ¬¡ <code>put</code>  éœ€è¦åˆå§‹åŒ–ä¸€ä¸‹ <code>table</code>  æ•°ç»„ï¼ˆä» <code>null</code>  åˆå§‹åŒ–åˆ°é»˜è®¤å®¹é‡ 16 æˆ–è€…è‡ªå®šä¹‰å®¹é‡ï¼‰ï¼Œæ‰èƒ½åŠ å…¥æ•°æ®ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸¤æ¬¡ä½¿ç”¨ <code>put</code>  æ—¶ï¼ŒåŠ å…¥çš„ <code>key</code>  éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡çš„ <code>value</code>  åº”è¯¥è¦†ç›–ç¬¬ä¸€æ¬¡çš„ï¼Œæ‰€ä»¥åœ¨ <code>put</code>  æ—¶ä¹Ÿåº”è¯¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œ<strong>å‘ç”Ÿå“ˆå¸Œå†²çªåº”è¯¥é¦–å…ˆæ£€æŸ¥ Key æ˜¯ä¸æ˜¯ç›¸åŒçš„å†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</strong>ã€‚</p>\n<p>é‡ç‚¹è®²ä¸€ä¸‹æ‰©å®¹æ“ä½œï¼šæ‰©å®¹æ—¶éœ€è¦é‡æ–° <code>hash</code> ï¼Œå¹¶ä¸æ˜¯è¯´è¦é‡æ–°è°ƒç”¨ <code>hash</code>  è¿™ä¸ªå‡½æ•°ï¼Œ <code>Node(TreeNode)</code>  èŠ‚ç‚¹ä¹‹å‰å°±ä¿å­˜äº† <code>hash</code>  å€¼çš„ã€‚</p>\n<p>å¦‚æœ <code>hash</code>  å€¼è¶…è¿‡äº†å®¹é‡ <code>cap</code> ï¼Œéœ€è¦å–ä½™æ“ä½œï¼Œå› ä¸º <code>cap</code>  éƒ½æ˜¯ 2 çš„æŒ‡æ•°ï¼Œæ‰€ä»¥ <code>cap-1</code> ï¼ˆæœ€å¤§ä¸‹æ ‡ï¼‰çš„ä½ä½å°±å…¨æ˜¯ 1ï¼Œå–ä½™æ“ä½œå°±å¯ä»¥ä¸ºï¼š <code>hash &amp; (cap - 1)</code> ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/02/d1b17259fca6ec00.jpg\" alt=\"\" /></p>\n<p>æ‰€ä»¥ä¸€æ¡å†²çªé“¾è¡¨ä¸Šçš„æ•°æ®èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å¹¶ä¸ä¸€å®šéƒ½æ˜¯ç›¸åŒçš„ï¼Œå¯èƒ½æ˜¯å–ä½™åæ‰å¯¼è‡´ä¸‹æ ‡ç›¸åŒã€‚æ‰€ä»¥åœ¨é‡æ–°å“ˆå¸Œçš„è¿‡ç¨‹ä¸­ï¼Œå°±éœ€è¦å¯¹å†²çªé“¾è¡¨æ‹†åˆ†ä¸ºä¸¤æ¡é“¾è¡¨ï¼Œä¸€æ¡é“¾è¡¨æ˜¯å“ˆå¸Œå€¼æœ¬æ¥å°±æ˜¯å½“å‰ä¸‹æ ‡ï¼Œå¦ä¸€ä¸ªæ˜¯å“ˆå¸Œå€¼è¢«å–ä½™äº†çš„ï¼ˆè¿™æ¡é“¾è¡¨ä¸Šä¹Ÿå¹¶ä¸æ˜¯å“ˆå¸Œå€¼éƒ½ç›¸åŒï¼Œåªæ˜¯å–ä½™åå€¼éƒ½ç›¸åŒï¼Œ5 å’Œ 7 è¢« 2 å–ä½™å€¼ä¹Ÿç›¸åŒå˜›ï¼‰ã€‚</p>\n<p>å› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯å®¹é‡ä¹˜ 2ï¼Œæ‰€ä»¥åä¸€æ¡é“¾è¡¨çš„æ–°ä¸‹æ ‡å°±æ˜¯ <code>i+cap</code> ã€‚</p>\n<blockquote>\n<p><code>i&lt;capï¼Œ(i+cap) % 2cap = i+cap</code> ã€‚</p>\n</blockquote>\n<h2 id=\"get\"><a class=\"anchor\" href=\"#get\">#</a> get()</h2>\n<blockquote>\n<p><code>get</code>  æ–¹æ³•å†…éƒ¨æœ€é‡è¦çš„å°±æ˜¯ <code>hash()</code>  å¾—åˆ°å…¶å“ˆå¸Œå€¼ï¼Œç„¶åå†é€šè¿‡ <code>equals()</code>  æ‰¾åˆ°å¯¹åº”çš„å€¼ã€‚</p>\n</blockquote>\n<p>ç†è§£äº† <code>put</code>  çš„æœºåˆ¶å’Œå“ˆå¸Œå€¼å–ä½™åŸç†åï¼Œ <code>get</code>  åˆ†æå°±æ¯”è¾ƒç®€å•äº†ã€‚</p>\n<ul>\n<li>\n<p>è®¡ç®— key çš„ hash å€¼ï¼Œæ ¹æ® hash å€¼æ‰¾åˆ°å¯¹åº”æ•°ç»„ä¸‹æ ‡: hash &amp; (length-1)ã€‚</p>\n</li>\n<li>\n<p>åˆ¤æ–­æ•°ç»„è¯¥ä½ç½®å¤„çš„å…ƒç´ æ˜¯å¦åˆšå¥½å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œèµ°ç¬¬ä¸‰æ­¥ã€‚</p>\n</li>\n<li>\n<p>åˆ¤æ–­è¯¥å…ƒç´ ç±»å‹æ˜¯å¦æ˜¯ TreeNodeï¼Œå¦‚æœæ˜¯ï¼Œç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å–æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œèµ°ç¬¬å››æ­¥ã€‚</p>\n</li>\n<li>\n<p>éå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰ (== æˆ– equals) çš„ keyã€‚</p>\n</li>\n</ul>\n<h1 id=\"hashset\"><a class=\"anchor\" href=\"#hashset\">#</a> HashSet</h1>\n<p><code>HashSet</code>  ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Œå¯¹ <code>HashMap</code>  è¿›è¡Œäº†ç®€å•çš„åŒ…è£…ï¼Œå¯¹ <code>HashSet</code>  çš„å‡½æ•°è°ƒç”¨éƒ½ä¼šè½¬æ¢æˆåˆé€‚çš„ <code>HashMap</code>  æ–¹æ³•ã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œä¸éœ€è¦è¿‡å¤šèµ˜è¿°ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//HashSet æ˜¯å¯¹ HashMap çš„ç®€å•åŒ…è£…</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map<span class=\"token punctuation\">;</span><span class=\"token comment\">//HashSet é‡Œé¢æœ‰ä¸€ä¸ª HashMap</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// Dummy value to associate with an Object in the backing Map</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Object</span> <span class=\"token constant\">PRESENT</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HashSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// ç®€å•çš„æ–¹æ³•è½¬æ¢</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> <span class=\"token constant\">PRESENT</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9jb2xsZWN0aW9uL2phdmEtbWFwLUhhc2hNYXAmYW1wO0hhc2hTZXQuaHRtbA==\">https://pdai.tech/md/java/collection/java-map-HashMap&amp;HashSet.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL3N5eTRyeiNiMmI1MWU0MQ==\">https://www.yuque.com/qingkongxiaguang/javase/syy4rz#b2b51e41</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NhcnBlbnRlckxlZS9KQ0ZJbnRlcm5hbHMvYmxvYi9tYXN0ZXIvbWFya2Rvd24vNi1IYXNoU2V0JTIwYW5kJTIwSGFzaE1hcC5tZCNnZXQ=\">https://github.com/CarpenterLee/JCFInternals/blob/master/markdown/6-HashSet and HashMap.md#get</span></p>\n</blockquote>\n",
            "tags": [
                "JavaåŸºç¡€"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/01/Java/%E5%B9%B6%E5%8F%91/Java%E5%85%B3%E9%94%AE%E5%AD%97-volatile/",
            "url": "https://cecilia.cool/2022/10/01/Java/%E5%B9%B6%E5%8F%91/Java%E5%85%B3%E9%94%AE%E5%AD%97-volatile/",
            "title": "Javaå…³é”®å­—volitale",
            "date_published": "2022-10-01T07:20:23.000Z",
            "content_html": "<h1 id=\"volatileå…³é”®å­—\"><a class=\"anchor\" href=\"#volatileå…³é”®å­—\">#</a> volatile å…³é”®å­—</h1>\n<p>å¹¶å‘å­˜åœ¨çš„é—®é¢˜ä¸»è¦æ˜¯å¯è§æ€§ï¼ŒåŸå­æ€§ï¼Œæœ‰åºæ€§ã€‚åŸå­æ€§å¯ä»¥é€šè¿‡ <code>synchronized</code>  å®ç°åŒæ­¥ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§é€šè¿‡ <code>volatile</code>  è§£å†³ã€‚</p>\n<p>å¯è§æ€§ï¼šCPU ç›´æ¥å’Œå†…å­˜äº¤äº’å¤ªæ…¢äº†ï¼Œæ‰€ä»¥ CPU ç›´æ¥å’Œç¼“å­˜äº¤äº’ã€‚åœ¨å¤šæ ¸ CPU ä¸­ï¼Œæ¯ä¸ª CPU å„è‡ªæœ‰ä¸€ä¸ªç¼“å­˜ï¼Œåœ¨ A ä¿®æ”¹äº†æŸä¸€å˜é‡æ—¶ï¼Œå¯èƒ½æ¥ä¸åŠå†™å…¥å†…å­˜å¹¶è®©å…¶ä»– CPU è¯»å–ï¼Œé€ æˆä¿®æ”¹çš„ä¸å¯è§ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/01/14eaf6c457e413c7.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>ç¼“å­˜ä¸€è‡´æ€§åè®®å°±æ˜¯ä¸ºäº†è§£å†³ä¸€è‡´æ€§é—®é¢˜ã€‚</p>\n</blockquote>\n<p><code>volatile</code>  å¯ä»¥ä¿è¯å¯è§æ€§ï¼Œå½“æŸä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¢« <code>volatile</code>  ä¿®é¥°çš„å˜é‡åï¼Œå…¶ä»–çº¿ç¨‹ä¼šé©¬ä¸Šæ›´æ–°è¿™ä¸ªå˜é‡ã€‚ä½†æ˜¯å®ƒä¾ç„¶ä¸èƒ½è§£å†³åŸå­æ€§é—®é¢˜ï¼Œå°±åƒé‚£ä¸ªæœ€ç»å…¸çš„å¤šä¸ªçº¿ç¨‹ <code>i++</code>  ä¸€æ ·ï¼Œè‡ªå¢æ“ä½œæ˜¯è¢«ç“œåˆ†ä¸ºäº†å¤šä¸ªæ­¥éª¤å®Œæˆçš„ï¼Œè™½ç„¶ä¿è¯äº†å¯è§æ€§ï¼Œä½†æ˜¯åªè¦æ‰‹é€Ÿå¤Ÿå¿«ï¼Œä¾ç„¶ä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å†™åŒä¸€ä¸ªå€¼çš„é—®é¢˜ï¼ˆæ¯”å¦‚çº¿ç¨‹ 1 åˆšåˆšå°† a çš„å€¼æ›´æ–°ä¸º 100ï¼Œè¿™æ—¶çº¿ç¨‹ 2 å¯èƒ½ä¹Ÿå·²ç»æ‰§è¡Œåˆ°æ›´æ–° a çš„å€¼è¿™æ¡æŒ‡ä»¤äº†ï¼Œ<strong>å·²ç»åˆ¹ä¸ä½è½¦äº†</strong>ï¼Œæ‰€ä»¥ä¾ç„¶ä¼šå°† a çš„å€¼å†æ›´æ–°ä¸ºä¸€æ¬¡ 100ï¼‰ã€‚</p>\n<p>æ­¤å¤„é¡ºä¾¿ä»‹ç»ä¸€ä¸‹<strong> Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</strong>ï¼šé‡‡ç”¨äº†ç±»ä¼¼çš„æ¨¡å‹æ”¯æŒå¤šçº¿ç¨‹</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/01/4d01a61364ae80bf.jpg\" alt=\"\" /></p>\n<ul>\n<li>æ‰€æœ‰çš„å˜é‡å…¨éƒ¨å­˜å‚¨åœ¨ä¸»å†…å­˜ã€‚</li>\n<li>æ¯æ¡çº¿ç¨‹æœ‰ç€è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼Œå¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ä¸­çš„æ•°æ®ã€‚</li>\n<li>ä¸åŒçº¿ç¨‹ä¹‹é—´çš„å·¥ä½œå†…å­˜ç›¸äº’éš”ç¦»ï¼Œå¦‚æœéœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’å†…å®¹ï¼Œåªèƒ½é€šè¿‡ä¸»å†…å­˜å®Œæˆï¼Œæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜ã€‚</li>\n</ul>\n<p>æœ‰åºæ€§ï¼šä¸ºäº†ä¼˜åŒ–ç¨‹åºï¼Œç¼–è¯‘æ—¶ä¼šå¯¹æŒ‡ä»¤è¿›è¿›è¡Œé‡æ’åºï¼Œæœ‰å¯èƒ½æš´éœ²å‡ºæœªåˆå§‹åŒ–çš„ç©ºå†…å­˜å‡ºæ¥ã€‚ä»¥åŒé‡æ£€æŸ¥çš„å•ä¾‹æ¨¡å¼ä¸ºä¾‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SingleInstance</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SignleInstance</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">SignleInstance</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token comment\">// é”ä½è¿™ä¸ªç±»ï¼Œæ— è®ºå“ªä¸ªå®ä¾‹æ¥æ‰§è¡Œè¿™æ®µä»£ç éƒ½è¦æ‹¿åˆ°é”</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">synchronized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SignleInstance</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SingleInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹äº <code>instance = new SingeInstance()</code> ï¼Œæ­£å¸¸çš„ CPU æŒ‡ä»¤ä¸ºï¼š</p>\n<ol>\n<li>åˆ†é…å†…å­˜ç©ºé—´</li>\n<li>åˆå§‹åŒ–å¯¹è±¡</li>\n<li>å°† instance å¼•ç”¨æŒ‡å‘å†…å­˜ç©ºé—´</li>\n</ol>\n<p>ä½†æ˜¯é‡æ’åºåå¯èƒ½æ‰§è¡Œé¡ºåºå°±æ˜¯ï¼š</p>\n<ol>\n<li>åˆ†é…å†…å­˜ç©ºé—´</li>\n<li>å°† instance å¼•ç”¨æŒ‡å‘å†…å­˜ç©ºé—´</li>\n<li>åˆå§‹åŒ–å¯¹è±¡</li>\n</ol>\n<p>å¦‚æœçº¿ç¨‹åœ¨æ‰§è¡Œå®Œ 2 åä¸­æ–­ï¼Œå…¶ä»–çš„çº¿ç¨‹å†æ¥æ‰§è¡Œ <code>getInstance()</code>  æ–¹æ³•ï¼Œå°±ä¼šæ‹¿åˆ°ä¸€ä¸ªæ²¡æœ‰åˆå§‹åŒ–çš„ instanceã€‚</p>\n<blockquote>\n<p><code>volaitle</code>  å…³é”®å­—å¯ä»¥äº§ç”Ÿå†…å­˜å±éšœé˜²æ­¢é‡æ’åºã€‚</p>\n</blockquote>\n<h1 id=\"åº”ç”¨åœºæ™¯\"><a class=\"anchor\" href=\"#åº”ç”¨åœºæ™¯\">#</a> åº”ç”¨åœºæ™¯</h1>\n<p>ä¸Šé¢å•ä¾‹æ¨¡å¼ä¸­ä¸ºäº†è§£å†³é‡æ’åºå°±å¯ä»¥ä½¿ç”¨ <code>volatie</code> ã€‚</p>\n<h2 id=\"æ¨¡å¼1çŠ¶æ€æ ‡å¿—\"><a class=\"anchor\" href=\"#æ¨¡å¼1çŠ¶æ€æ ‡å¿—\">#</a> æ¨¡å¼ 1ï¼šçŠ¶æ€æ ‡å¿—</h2>\n<p>ç”¨äºæŒ‡ç¤ºå‘ç”Ÿäº†ä¸€ä¸ªé‡è¦çš„ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œä¾‹å¦‚å®Œæˆåˆå§‹åŒ–æˆ–è¯·æ±‚åœæœºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">volatile</span> <span class=\"token keyword\">boolean</span> shutdownRequest<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> shutdownRequested <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>shutdownRequested<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// do stuff</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ¨¡å¼2ç‹¬ç«‹è§‚å¯Ÿ\"><a class=\"anchor\" href=\"#æ¨¡å¼2ç‹¬ç«‹è§‚å¯Ÿ\">#</a> æ¨¡å¼ 2ï¼šç‹¬ç«‹è§‚å¯Ÿ</h2>\n<p>å®‰å…¨ä½¿ç”¨ volatile çš„å¦ä¸€ç§ç®€å•æ¨¡å¼æ˜¯å®šæœŸ å‘å¸ƒ è§‚å¯Ÿç»“æœä¾›ç¨‹åºå†…éƒ¨ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ç§ç¯å¢ƒä¼ æ„Ÿå™¨èƒ½å¤Ÿæ„Ÿè§‰ç¯å¢ƒæ¸©åº¦ã€‚ä¸€ä¸ªåå°çº¿ç¨‹å¯èƒ½ä¼šæ¯éš”å‡ ç§’è¯»å–ä¸€æ¬¡è¯¥ä¼ æ„Ÿå™¨ï¼Œå¹¶æ›´æ–°åŒ…å«å½“å‰æ–‡æ¡£çš„ volatile å˜é‡ã€‚ç„¶åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å–è¿™ä¸ªå˜é‡ï¼Œä»è€Œéšæ—¶èƒ½å¤Ÿçœ‹åˆ°æœ€æ–°çš„æ¸©åº¦å€¼ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">String</span> lastUser<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">boolean</span> valid <span class=\"token operator\">=</span> <span class=\"token function\">passwordIsValid</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>valid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">User</span> u <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            activeUsers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            lastUser <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> valid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ¨¡å¼3volatile-beanæ¨¡å¼\"><a class=\"anchor\" href=\"#æ¨¡å¼3volatile-beanæ¨¡å¼\">#</a> æ¨¡å¼ 3ï¼švolatile bean æ¨¡å¼</h2>\n<p>åœ¨ volatile bean æ¨¡å¼ä¸­ï¼ŒJavaBean æ‰€æœ‰æ•°æ®æˆå‘˜éƒ½æ˜¯ volatile ç±»å‹ï¼Œå¹¶ä¸” getterï¼Œsetter æ–¹æ³•å¿…é¡»éå¸¸æ™®é€š â€”â€” é™¤äº†è·å–æˆ–è®¾ç½®ç›¸åº”çš„å±æ€§å¤–ï¼Œä¸èƒ½åŒ…å«ä»»ä½•é€»è¾‘ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@ThreadSafe</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">String</span> firstName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">String</span> lastName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getFirstName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> firstName<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getLastName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> lastName<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getAge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> age<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setFirstName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> firstName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">=</span> firstName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setLastName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> lastName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastName <span class=\"token operator\">=</span> lastName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAge</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>å†°æ²³ã€Šæ·±å…¥ç†è§£é«˜å¹¶å‘ç¼–ç¨‹ã€‹ç¬¬ä¸€ç‰ˆ</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1rZXktdm9sYXRpbGUuaHRt\">https://pdai.tech/md/java/thread/java-thread-x-key-volatile.htm</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL3ZkNjBnNSMyMWNkOTQ1Ng==\">https://www.yuque.com/qingkongxiaguang/javase/vd60g5#21cd9456</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/10/01/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%B7%A5%E5%85%B7/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/10/01/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%B7%A5%E5%85%B7/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/",
            "title": "ç½‘ç»œåè®®",
            "date_published": "2022-10-01T01:58:30.000Z",
            "content_html": "<blockquote>\n<p>æ•´ä¸ªç½‘ç»œåè®®ä¸å·¥å…·çº¿è·¯å‚ç…§ pdai çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2ZWxvcC9wcm90b2NvbC9kZXYtcHJvdG9jb2wtb3ZlcnZpZXcuaHRtbA==\"> Java å…¨æ ˆçŸ¥è¯†ä½“ç³»</span>å­¦ä¹ ï¼Œå‰åŠéƒ¨åˆ†å…³äºè®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œpadi ä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨äº†åšå®¢å›­çš„åšä¸»<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ob21lLmNuYmxvZ3MuY29tL3UvZ29vZ255Lw==\">æ¡‚åŸè€æ‰˜å°¼</span>å…³äºã€Šè®¡ç®—æœºç½‘ç»œç¬¬äº”ç‰ˆã€‹ï¼ˆè°¢å¸Œä»ï¼‰çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ29vZ255L3AvMzY4MjI4MC5odG1s\">è¯»ä¹¦ç¬”è®°</span>ï¼Œåœ¨å­¦ä¹ æœŸé—´ï¼Œä½œè€…ä¹Ÿä¼šå‚è€ƒã€Šè®¡ç®—æœºç½‘ç»œ - è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹è¿›è¡Œå†…å®¹è¡¥å……ã€‚</p>\n</blockquote>\n<h1 id=\"è®¡ç®—æœºç½‘ç»œåŸºç¡€\"><a class=\"anchor\" href=\"#è®¡ç®—æœºç½‘ç»œåŸºç¡€\">#</a> è®¡ç®—æœºç½‘ç»œåŸºç¡€</h1>\n<blockquote>\n<p>å¦‚æœå­¦è®¡ç®—æœºç½‘ç»œè§‰å¾—çœ‹æ–‡å­—è¿‡äºæ¯ç‡¥ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸­ç§‘å¤§çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUpWNDExdDdvdy8/c3BtX2lkX2Zyb209MzMzLjMzNy5zZWFyY2gtY2FyZC5hbGwuY2xpY2smYW1wO3ZkX3NvdXJjZT01YWNmNWE3YjIzZDI4ZTc2MzNlNWE5YjM4MWM1N2M0Mg==\">éƒ‘çƒ‡è€å¸ˆ</span>çš„è®¡ç®—æœºç½‘ç»œçš„è¯¾ã€‚</p>\n</blockquote>\n<h2 id=\"å› ç‰¹ç½‘æ¦‚è¿°\"><a class=\"anchor\" href=\"#å› ç‰¹ç½‘æ¦‚è¿°\">#</a> å› ç‰¹ç½‘æ¦‚è¿°</h2>\n<p>ä¸€ä¸ªç½‘ç»œå¯èƒ½ç”±å…‰çº¤ï¼Œè·¯ç”±å™¨ï¼Œè®¡ç®—æœºï¼ˆåŒ…æ‹¬æœåŠ¡å™¨ï¼‰ç­‰ç»„æˆï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ç»“ç‚¹å’Œé“¾è·¯çš„ç»„æˆã€‚è€Œ<strong>å› ç‰¹ç½‘åˆ™æ˜¯æŠŠè®¸å¤šç½‘ç»œè¿æ¥åœ¨ä¸€èµ·</strong>ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/01/4851be18068b1041.jpg\" alt=\"\" /></p>\n<p>ç»„æˆï¼š</p>\n<ul>\n<li>è¾¹ç¼˜éƒ¨åˆ†ï¼šç”±æ‰€æœ‰è¿æ¥åœ¨å› ç‰¹ç½‘çš„ä¸»æœºç»„æˆï¼Œè¿™äº›ä¸»æœºåˆå«åšç«¯ç³»ç»Ÿ (end system)ã€‚</li>\n<li>æ ¸å¿ƒéƒ¨åˆ†ï¼šå¤§é‡ç½‘ç»œå’Œè¿æ¥è¿™äº›ç½‘ç»œçš„<strong>è·¯ç”±å™¨</strong>ç»„æˆï¼Œä¸ºè¾¹ç¼˜éƒ¨åˆ†æä¾›æœåŠ¡çš„ã€‚</li>\n</ul>\n<p>è®¡ç®—æœºé€šä¿¡æ–¹å¼ï¼š</p>\n<ul>\n<li>å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ --C/S æ–¹å¼ï¼Œä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯å‘èµ·é€šä¿¡ï¼Œå¦åˆ™æœåŠ¡ç«¯ä¸çŸ¥é“å®¢æˆ·ç«¯ IPã€‚</li>\n<li>å¯¹ç­‰æ–¹å¼ --P2P æ–¹å¼ï¼ˆPeer-to-Peerï¼‰ï¼Œä¸¤ä¸ªä¸»æœºéƒ½è¿è¡Œäº†å¯¹ç­‰è¿æ¥è½¯ä»¶ï¼Œå¯ä»¥å¹³ç­‰ï¼Œå¯¹ç­‰è¿æ¥é€šä¿¡ã€‚</li>\n</ul>\n<p>å› ç‰¹ç½‘ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†æœ€å¤æ‚ï¼Œèµ·ç‰¹æ®Šä½œç”¨çš„æ˜¯è·¯ç”±å™¨ï¼ˆRouterï¼‰ï¼Œå®ç°åˆ†ç»„äº¤æ¢ã€‚æ¯”å¦‚æŸä¸€ä¸»æœºç°éœ€è¦å‘é€ä¸€æ®µè¾ƒé•¿çš„æ•°æ®ï¼Œå‘é€æ—¶å°±ä¼šå°†è¿™æ®µæ•°æ®åˆ†ä¸ºä¸€ä¸ªä¸ªçš„åˆ†ç»„ï¼ŒåŠ ä¸Šé¦–éƒ¨ï¼ˆäº‹å®ä¸Šï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªåˆ†ç»„æ—¶ï¼Œå·²ç»è®¤ä¸ºå…¶åŒ…å«äº†é¦–éƒ¨ï¼‰ã€‚é¦–éƒ¨åŒ…å«äº†ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™ä¸ªåˆ†ç»„å®é™…æ‰¿è½½çš„æ•°æ®å¤šå¤§ï¼Œç›®æ ‡åœ°å€ç­‰ã€‚</p>\n<p>åˆ†ç»„äº¤æ¢ç½‘ä¸­çš„ç»“ç‚¹äº¤æ¢æœºæ ¹æ®æ”¶åˆ°çš„åˆ†ç»„çš„é¦–éƒ¨ä¸­çš„åœ°å€ä¿¡æ¯ï¼ŒæŠŠåˆ†ç»„è½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹äº¤æ¢æœºã€‚ç”¨è¿™æ ·çš„å­˜å‚¨è½¬å‘æ–¹å¼ï¼Œæœ€ååˆ†ç»„å°±èƒ½åˆ°è¾¾æœ€ç»ˆç›®çš„åœ°ã€‚æ¥æ”¶ç«¯æ”¶åˆ°åˆ†ç»„åå‰¥å»é¦–éƒ¨è¿˜åŸæˆæŠ¥æ–‡ã€‚æœ€åï¼Œåœ¨æ¥æ”¶ç«¯æŠŠæ”¶åˆ°çš„æ•°æ®æ¢å¤æˆä¸ºåŸæ¥çš„æŠ¥æ–‡ã€‚</p>\n<h2 id=\"è·¯ç”±å™¨\"><a class=\"anchor\" href=\"#è·¯ç”±å™¨\">#</a> è·¯ç”±å™¨</h2>\n<p>è·¯ç”±å™¨å¤„ç†åˆ†ç»„è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>æŠŠæ”¶åˆ°çš„åˆ†ç»„å…ˆæ”¾å…¥ç¼“å­˜ï¼ˆæš‚æ—¶å­˜å‚¨ï¼‰ï¼›</li>\n<li>æŸ¥æ‰¾è½¬å‘è¡¨ï¼Œæ‰¾å‡ºåˆ°æŸä¸ªç›®çš„åœ°å€åº”ä»å“ªä¸ªç«¯å£è½¬å‘ï¼›</li>\n<li>æŠŠåˆ†ç»„é€åˆ°é€‚å½“çš„ç«¯å£è½¬å‘å‡ºå»ã€‚</li>\n</ul>\n<blockquote>\n<p>è¯·åŒºåˆ†å¥½è·¯ç”±å™¨å’Œä¸»æœºçš„åŒºåˆ«ï¼Œå°½ç®¡éƒ½æ˜¯å› ç‰¹ç½‘çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>\n</blockquote>\n<p>åˆ†ç»„äº¤æ¢ä¹Ÿå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚è®¸å¤šèŠ‚ç‚¹åœ¨ç»è¿‡åŒä¸€ä¸ªè·¯ç”±å™¨åˆ†ç»„è½¬å‘æ—¶ï¼Œéœ€è¦æ’é˜Ÿï¼Œä¼šé€ æˆä¸€å®šæ—¶å»¶ï¼Œåˆ†ç»„çš„é¦–éƒ¨ä¹Ÿé€ æˆä¸€å®šå¼€é”€ã€‚</p>\n<blockquote>\n<p>é™¤äº†åˆ†ç»„äº¤æ¢ï¼Œè¿˜æœ‰ç”µè·¯äº¤æ¢ï¼Œåœ¨å‘é€ä¿¡æ¯å‰ï¼ŒåŒæ–¹å¿…é¡»å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œè·¯å¾„ä¸Šçš„äº¤æ¢æœºéƒ½å°†ä¸ºè¯¥è¿æ¥ç»´æŠ¤çŠ¶æ€ï¼Œå¹¶ä¸”é¢„ç•™äº†å¸¦å®½ï¼Œæ•°æ®èƒ½å¤Ÿä»¥æ’å®šé€Ÿç‡å‘é€ã€‚</p>\n</blockquote>\n<p>å¯¹æ¯”ï¼š</p>\n<p>æ—©æœŸé¢å‘ç»ˆç«¯çš„è®¡ç®—æœºç½‘ç»œæ˜¯<strong>ä»¥å•ä¸ªä¸»æœºä¸ºä¸­å¿ƒçš„æ˜Ÿå½¢ç½‘</strong>ï¼Œå„ç»ˆç«¯é€šè¿‡é€šä¿¡çº¿è·¯å…±äº«æ˜‚è´µçš„ä¸­å¿ƒä¸»æœºçš„ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºã€‚åˆ†ç»„äº¤æ¢ç½‘åˆ™æ˜¯ä»¥ç½‘ç»œä¸ºä¸­å¿ƒï¼Œä¸»æœºéƒ½å¤„åœ¨ç½‘ç»œçš„å¤–å›´ã€‚</p>\n<h2 id=\"ç½‘ç»œåˆ†ç±»\"><a class=\"anchor\" href=\"#ç½‘ç»œåˆ†ç±»\">#</a> ç½‘ç»œåˆ†ç±»</h2>\n<p>ä¸åŒä½œç”¨èŒƒå›´ï¼š</p>\n<ul>\n<li>å¹¿åŸŸç½‘ WANï¼ˆWide Area Networkï¼‰ï¼Œæ‰‹æœºç«¯ç§»åŠ¨è®¾å¤‡æ˜¯é€šè¿‡èœ‚çªç½‘æä¾›å•†è¿è¥çš„åŸºç«™æ¥å‘é€å’Œæ¥æ”¶åˆ†ç»„ã€‚ç”¨äºä»…éœ€ä½äºåŸºç«™çš„æ•°ä¸‡ç±³èŒƒå›´ã€‚</li>\n<li>å±€åŸŸç½‘ LANï¼ˆLocal Area Network)ï¼Œä¸ªäººçƒ­ç‚¹å°±æ˜¯å±€åŸŸç½‘ï¼Œç§°ä¸º wlan-- æ— çº¿å±€åŸŸç½‘ï¼ˆWirelessï¼‰ï¼ŒWiFi æ˜¯åŸºäº IEEEE 802.11 æŠ€æœ¯çš„æ— çº¿ LAN æ¥å…¥ï¼Œç”¨æˆ·å¿…é¡»åœ¨æ¥å…¥ç‚¹å‡ åç±³èŒƒå›´å†…ã€‚</li>\n<li>åŸåŸŸç½‘ MAN</li>\n<li>ä¸ªäººåŒºåŸŸç½‘ PAN</li>\n</ul>\n<p>æ ¹æ®ä½¿ç”¨è€…ä¹Ÿå¯ä»¥åˆ†ä¸ºå…¬ç”¨ç½‘å’Œä¸“ç”¨ç½‘ã€‚</p>\n<blockquote>\n<p>é‡ç‚¹éœ€è¦æçš„æ˜¯æ¥å…¥ç½‘ ANï¼ˆAccessï¼‰ï¼Œç”± ISP--Internet Service Provider æä¾›ï¼Œèµ·åˆ°è®©ç”¨æˆ·åŸŸå› ç‰¹ç½‘è¿æ¥çš„æ¡¥æ¢ä½œç”¨ã€‚æ¯ä¸ª ISP è‡ªèº«å°±æ˜¯ä¸€ä¸ªç”±å¤šå°åˆ†ç»„äº¤æ¢æœºå’Œå¤šæ®µé€šä¿¡é“¾è·¯ç»„æˆçš„ç½‘ç»œã€‚</p>\n</blockquote>\n<p>åˆ†ç»„äº¤æ¢æœºé™¤äº†è·¯ç”±å™¨å’Œé“¾è·¯å±‚äº¤æ¢æœºï¼Œåè€…é€šå¸¸ç”¨äºæ¥å…¥ç½‘ï¼Œè·¯ç”±å™¨ç”¨äºç½‘ç»œæ ¸å¿ƒä¸­ã€‚</p>\n<h2 id=\"ç›¸å…³æœ¯è¯­\"><a class=\"anchor\" href=\"#ç›¸å…³æœ¯è¯­\">#</a> ç›¸å…³æœ¯è¯­</h2>\n<p><strong>å¸¦å®½</strong>ï¼šæ•°å­—ä¿¡é“æ‰€èƒ½ä¼ é€çš„æœ€<strong>é«˜æ•°æ®ç‡</strong>ï¼Œå•ä½æ˜¯<strong>æ¯”ç‰¹æ¯ç§’ b/s</strong>ã€‚</p>\n<p><strong>ååé‡</strong>ï¼šå•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œï¼ˆä¿¡é“ï¼Œæ¥å£ï¼‰çš„æ•°æ®é‡ã€‚</p>\n<p><strong>ä¼ è¾“æ—¶å»¶ï¼ˆå‘é€æ—¶å»¶ ï¼‰</strong>ï¼š  å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®å—ä»ç»“ç‚¹è¿›å…¥åˆ°ä¼ è¾“åª’ä½“æ‰€éœ€è¦çš„æ—¶é—´ã€‚ä»å‘é€æ•°æ®å¸§çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ç®—èµ·ï¼Œåˆ°è¯¥å¸§çš„æœ€åä¸€ä¸ªæ¯”ç‰¹å‘é€å®Œæ¯•æ‰€éœ€çš„æ—¶é—´ï¼Œ<strong>å‘é€æ—¶å»¶ = æ•°æ®å—é•¿åº¦ / å¸¦å®½</strong>ã€‚</p>\n<p><strong>ä¼ æ’­æ—¶å»¶</strong>  ç”µç£æ³¢åœ¨ä¿¡é“ä¸­éœ€è¦ä¼ æ’­ä¸€å®šçš„è·ç¦»è€ŒèŠ±è´¹çš„æ—¶é—´ï¼Œ<strong>ä¼ æ’­æ—¶å»¶ = ä¿¡é“é•¿åº¦ / ä¿¡å·åœ¨ä¿¡é“ä¸Šçš„ä¼ æ’­é€Ÿç‡</strong>ã€‚</p>\n<p>å¤„ç†æ—¶å»¶å’Œæ’é˜Ÿæ—¶å»¶æ¯”è¾ƒç®€å•ï¼Œè·Ÿè·¯ç”±å™¨æœ‰å…³ã€‚</p>\n<h2 id=\"ä½“ç³»ç»“æ„\"><a class=\"anchor\" href=\"#ä½“ç³»ç»“æ„\">#</a> ä½“ç³»ç»“æ„</h2>\n<p>ç»å¸¸ä½¿ç”¨çš„ TCP/IP åè®®æ˜¯å››å±‚ä½“ç³»ç»“æ„ï¼šåº”ç”¨å±‚ï¼Œè¿è¾“å±‚ï¼Œç½‘é™…å±‚ï¼Œç½‘ç»œæ¥å£å±‚ã€‚å’Œ ISO æŠ˜ä¸­ä¹‹åï¼Œé‡‡ç”¨ä¸€ç§äº”å±‚åè®®çš„ä½“ç³»ç»“æ„ï¼šåº”ç”¨å±‚ï¼Œè¿è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç‰©ç†å±‚ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/10/01/cd33ff3621dde413.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>è¿˜æœ‰ UDPï¼Œè¿™ç§ä¼ è¾“åè®®ä¸èƒ½å¯¹æ•°æ®åšå‡ºä»»ä½•ä¿è¯ï¼Œå³ä½¿åœ¨ä¼ æ’­è¿‡ç¨‹ä¸­å‡ºç°ä¸¢å¤±ï¼Œæ¯”ç‰¹çªå˜ï¼Œéƒ½ä¸ä¼šåšä»»ä½•å¼¥è¡¥æªæ–½ï¼Œä¸€èˆ¬ç”¨äºå®æ—¶åª’ä½“è½¯ä»¶ï¼Œæ¯”å¦‚ç›´æ’­ï¼ˆæ•°æ®ä¸¢äº†å°±ä¸¢äº†ï¼Œæ— æ‰€è°“ï¼‰ã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ29vZ255L3AvMzY4MjI4MC5odG1s\">https://www.cnblogs.com/googny/p/3682280.html</span></p>\n<p>ã€Šè®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ã€‹ç¬¬ä¸€ç« </p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œåè®®ä¸å·¥å…·"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/29/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(1)-PriorityQueue/",
            "url": "https://cecilia.cool/2022/09/29/Java/Java%E5%9F%BA%E7%A1%80/Java%E9%9B%86%E5%90%88(1)-PriorityQueue/",
            "title": "Javaé›†åˆ(1)--PriorityQueue",
            "date_published": "2022-09-29T07:07:41.000Z",
            "content_html": "<h1 id=\"å…¶ä»–é›†åˆ\"><a class=\"anchor\" href=\"#å…¶ä»–é›†åˆ\">#</a> å…¶ä»–é›†åˆ</h1>\n<p>å› ä¸ºåƒ ArrayListï¼ŒLinkedList ä¹‹ç±»çš„å®¹å™¨æ¯”è¾ƒç®€å•ï¼Œæ­¤å¤„ä¸ä¼šè¿‡å¤šè§£é‡Šï¼Œåªä¼šåˆ—å‡ºä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ã€‚</p>\n<p><strong>ArrayList</strong>ï¼š</p>\n<ul>\n<li>ArrayList ä¸ºäº†æ•ˆç‡æ²¡æœ‰å®ç°åŒæ­¥ï¼Œæœ‰éœ€æ±‚çš„æƒ…å†µä¸‹éœ€è¦è‡ªå·±å®ç°ã€‚</li>\n<li>å‘ ArrayList ä¸­åŠ å…¥å…ƒç´ ï¼ˆaddï¼‰æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œå®¹é‡æ£€æŸ¥ï¼Œæ‰©å®¹éƒ½ä¼šäº¤ç»™ grow æ–¹æ³•ã€‚</li>\n<li><code>remove</code>  å‡½æ•°ä¸­ï¼Œåˆ é™¤ä¸­é—´æŸä¸€ä¸ªå…ƒç´ ä¼šå¯¼è‡´åé¢çš„å…ƒç´ å‘å‰ç§»åŠ¨ï¼Œéœ€è¦å°†æœ€åä¸€ä¸ªä½ç½®èµ‹ä¸º nullï¼ˆä¸ºäº†è®© GC èµ·ä½œç”¨ï¼‰ã€‚</li>\n<li><code>tirmToSize()</code> ï¼Œå°†æ•°ç»„å®¹é‡ä¿®æ”¹ä¸ºå½“å‰å…ƒç´ ä¸ªæ•°å¤§å°ï¼› <code>indexOf()</code>  ä¸ <code>lastIndexOf()</code> <br />\n å°±æ˜¯è·å–å…ƒç´ ç¬¬ä¸€æ¬¡ / æœ€åä¸€æ¬¡å‡ºç°çš„ indexã€‚</li>\n<li><code>modCount</code>  æ˜¯æŒ‡é›†åˆåˆ›å»ºä»¥æ¥ä¿®æ”¹çš„æ¬¡æ•°ï¼Œä»–ä¿è¯åœ¨è¿­ä»£å™¨å¾ªç¯ä¸­ï¼Œå¦‚æœå‡ºç°é›†åˆçš„ä¿®æ”¹å°±åœæ­¢è¿­ä»£ã€‚</li>\n</ul>\n<p><strong>LinkedList</strong>ï¼š</p>\n<ul>\n<li>LinkedList å¯ä»¥è€ƒè™‘ä½œä¸ºæ ˆ / é˜Ÿåˆ—ï¼ŒJava å®˜æ–¹ä¸å»ºè®®ä½¿ç”¨ Stackã€‚ä½†æ˜¯ ArrayDeque æ˜¯æ ˆæˆ–è€…é˜Ÿåˆ—çš„<br />\né¦–é€‰ï¼Œæ€§èƒ½æ›´å¥½ã€‚</li>\n<li>LinkedList æ²¡æœ‰å“‘èŠ‚ç‚¹ï¼Œå½“é“¾è¡¨ä¸ºç©ºçš„æ—¶å€™ first å’Œ last éƒ½æŒ‡å‘ nullã€‚</li>\n</ul>\n<p><strong>ArrayDeque</strong>ï¼š</p>\n<ul>\n<li>\n<p><code>Deque</code>  æ˜¯ &quot;double ended queue&quot;, è¡¨ç¤ºåŒå‘çš„é˜Ÿåˆ—ï¼Œè‹±æ–‡è¯»ä½œ &quot;deck&quot;.ã€‚</p>\n</li>\n<li>\n<p>ArrayDeque æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å…è®¸åŠ å…¥ nullã€‚</p>\n</li>\n</ul>\n<h1 id=\"priorityqueue\"><a class=\"anchor\" href=\"#priorityqueue\">#</a> PriorityQueue</h1>\n<p>ä¼˜å…ˆé˜Ÿåˆ—ä¿è¯æ¯æ¬¡å–å‡ºçš„å…ƒç´ éƒ½æ˜¯é˜Ÿåˆ—ä¸­æœ€å°çš„ï¼ˆæ„é€ æ—¶å¯ä»¥ä¼ å…¥æ¯”è¾ƒå™¨ <code>Comparator</code> ï¼Œæ‰€ä»¥æƒ³è¦æ¯æ¬¡å–å‡ºéƒ½æ˜¯æœ€å¤§çš„ï¼Œåªéœ€è¦åè¿‡æ¥å³å¯ï¼‰ã€‚</p>\n<p>PriorityQueue ä¸å…è®¸æ”¾å…¥ <code>null</code>  å…ƒç´ ï¼Œ<strong>å†…éƒ¨é€šè¿‡æ•°ç»„å®ç°å°æ ¹å †</strong>ï¼Œå°æ ¹å †æŠ½è±¡ä¸Šå¯ä»¥ç†è§£ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚</p>\n<p>æ•°ç»„æ˜ å°„å®Œå…¨äºŒå‰æ ‘çš„ç®—æ•°å…³ç³»ä¸ºï¼š</p>\n<ul>\n<li><code>leftNode = ParentNode*2 + 1</code></li>\n<li><code>rightNode = ParentNode*2 + 2</code></li>\n<li><code>ParentNode = (node - 1)/2</code></li>\n</ul>\n<blockquote>\n<p><em>PriorityQueue</em> çš„ <code>peek()</code>  å’Œ <code>element</code>  æ“ä½œæ˜¯å¸¸æ•°æ—¶é—´ï¼Œ <code>add()</code> ,  <code>offer()</code> , æ— å‚æ•°çš„ <code>remove()</code>  ä»¥åŠ <code>poll()</code>  æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<em> log (N)</em>ã€‚</p>\n</blockquote>\n<p><code>add()</code>  å’Œ <code>remove()</code>  å¤±è´¥åå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ <code>offer()</code>  å’Œ <code>poll()</code>  å°±æ˜¯è¿”å› <code>false</code> ã€‚</p>\n<h2 id=\"å°æ ¹å †è§£æ\"><a class=\"anchor\" href=\"#å°æ ¹å †è§£æ\">#</a> å°æ ¹å †è§£æ</h2>\n<p>æ­¤å¤„ä¸è®²è§£ PriorityQueue æºç ï¼Œè€Œæ˜¯ç†è§£å°æ ¹å †çš„ç»´æŠ¤æµç¨‹</p>\n<p><strong>åŠ å…¥èŠ‚ç‚¹</strong>ï¼šé˜Ÿåˆ—åªå…è®¸ä»é˜Ÿå°¾åŠ å…¥å…ƒç´ ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/29/a2497ab926b94de8.jpg\" alt=\"\" /></p>\n<p>åˆ é™¤èŠ‚ç‚¹ï¼š</p>\n<ul>\n<li>ä¼˜å…ˆé˜Ÿåˆ—å‡ºé˜Ÿæ“ä½œä¼šå¯¼è‡´æ ¹èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œæ­¤æ—¶éœ€è¦å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®åœ¨è¿›è¡Œä¸‹é™è°ƒæ•´ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/29/0681d1a809288d78.jpg\" alt=\"\" /></p>\n<ul>\n<li>å¦‚æœæ˜¯å…¶ä»–å…³äºå°æ ¹å †çš„åˆ é™¤ï¼Œå½“åˆ é™¤èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹æ—¶ï¼Œç›´æ¥åˆ é™¤å³å¯ã€‚</li>\n<li>å½“èŠ‚ç‚¹åœ¨ä¸­é—´ï¼Œæˆ‘ä»¬å°±åªçœ‹ä»¥è¯¥èŠ‚ç‚¹å°¾æ ¹èŠ‚ç‚¹çš„å­æ ‘ï¼Œå°†æ•°ç»„æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå†è°ƒæ•´ã€‚</li>\n</ul>\n<h1 id=\"å°æ ¹å †ä»£ç \"><a class=\"anchor\" href=\"#å°æ ¹å †ä»£ç \">#</a> å°æ ¹å †ä»£ç </h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ¨¡æ‹Ÿå°æ ¹å †çš„å¢åŠ </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> minHeap <span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> size <span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> val<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// å‡è®¾å‚æ•°åˆæ³•ï¼Œæ•°ç»„ä¸å‡ºç°è¶Šç•Œ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>size <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> minHeap<span class=\"token punctuation\">[</span>size<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// å½“å‰çˆ¶èŠ‚ç‚¹ï¼Œindex æ˜¯å½“å‰ val ä½äºçš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">int</span> p <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>size <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>index <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>minHeap<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> val<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minHeap<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            index <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            p <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        minHeap<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> minHeap <span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size <span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>size<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">==</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>minHeap<span class=\"token punctuation\">[</span>size<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token comment\">// å‡è®¾ - 1 ä¸º null</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">/** å°æ ¹å †æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œå·¦èŠ‚ç‚¹ä¸‹æ ‡ä¸ºå¥‡æ•°ï¼Œå³èŠ‚ç‚¹ä¸ºå¶æ•°</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            ä¸€ç›´å‘ä¸‹æ‰¾å³èŠ‚ç‚¹ç›´åˆ°åˆ°è¾¾æœ€åä¸€å±‚ï¼Œåœ¨å€’æ•°ç¬¬äºŒå±‚ä¼šå‡ºç°</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            1ï¼‰ è¯¥å±‚ä¸å­˜åœ¨å³å­©å­</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            2ï¼‰ è¯¥å±‚å­˜åœ¨å³å­©å­</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minHeap<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">int</span> l <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>r <span class=\"token operator\">=</span> l <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// æƒå€¼å¤§çš„èŠ‚ç‚¹å‘ä¸‹æ²‰</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>l <span class=\"token operator\">&lt;</span> size <span class=\"token operator\">&amp;&amp;</span> r <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>minHeap<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minHeap<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                index <span class=\"token operator\">=</span> l<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                l <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>r <span class=\"token operator\">=</span> l <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>minHeap<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minHeap<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                index <span class=\"token operator\">=</span> r<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                l <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>r <span class=\"token operator\">=</span> l <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœå½“å‰èŠ‚ç‚¹å°äºå·¦å³å­èŠ‚ç‚¹ï¼Œåˆ™å®Œæˆ</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>l <span class=\"token operator\">&lt;</span> size <span class=\"token operator\">&amp;&amp;</span> minHeap<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            minHeap<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> minHeap<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            minHeap<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jbmJsb2dzLmNvbS9DYXJwZW50ZXJMZWUvcC81NDg4MDcwLmh0bWw=\">http://www.cnblogs.com/CarpenterLee/p/5488070.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9jb2xsZWN0aW9uL2phdmEtY29sbGVjdGlvbi1Qcmlvcml0eVF1ZXVlLmh0bWw=\">https://pdai.tech/md/java/collection/java-collection-PriorityQueue.html</span></p>\n</blockquote>\n",
            "tags": [
                "JavaåŸºç¡€"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/28/Docker/Docker(7)-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/",
            "url": "https://cecilia.cool/2022/09/28/Docker/Docker(7)-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/",
            "title": "Docker(7)--èµ„æºç®¡ç†",
            "date_published": "2022-09-28T08:16:58.000Z",
            "content_html": "<h1 id=\"å®¹å™¨æ§åˆ¶æ“ä½œ\"><a class=\"anchor\" href=\"#å®¹å™¨æ§åˆ¶æ“ä½œ\">#</a> å®¹å™¨æ§åˆ¶æ“ä½œ</h1>\n<blockquote>\n<p>è¡¥å……ä¸€äº› Docker çš„å‘½ä»¤ï¼Œå¯¹äºè¿™ç§å•çº¯çš„å‘½ä»¤æŸ¥çœ‹ï¼Œå»ºè®®ç›´æ¥çœ‹èœé¸Ÿæ•™ç¨‹ã€‚</p>\n</blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿›å…¥å®¹å™¨ï¼Œé€€å‡ºï¼šctrl+Pï¼Œctrl+Qï¼›ç»ˆæ­¢å®¹å™¨è¿è¡Œçš„ç¨‹åºï¼šctrl+C</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> attach å®¹å™¨ID/åç§°</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œæ‰§è¡Œçš„æ˜¯ bashï¼Œå¹¶å¼€å¯ä¸€ä¸ªå¯è¾“å…¥ç»ˆç«¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> å®¹å™¨ID/åç§° <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># ï¼ˆå‡è®¾å®¹å™¨å¯ä»¥æ‰§è¡Œ javaï¼‰ï¼Œå°±ç›¸å½“äºè®©å®¹å™¨æ‰§è¡Œ java -version</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> å®¹å™¨ID/åç§° <span class=\"token function\">java</span> <span class=\"token parameter variable\">-version</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># å…è®¸å®¹å™¨å¤„ç†å–„åå†åœæ­¢è¿è¡Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">kill</span> å®¹å™¨ID/åç§°</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># ç›´æ¥å¼ºåˆ¶åœæ­¢å®¹å™¨</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">docker</span> stop å®¹å™¨ID/åç§°</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># å¯åŠ¨å®¹å™¨ï¼ˆä¸€èˆ¬æ˜¯å®¹å™¨è¢« stop ä¹‹åï¼‰</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">docker</span> start å®¹å™¨ID/åç§°</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">docker</span> restart å®¹å™¨ID/åç§°</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># æš‚åœå®¹å™¨ (unpause-- å–æ¶ˆæš‚åœ)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">docker</span> pause å®¹å™¨ID/åç§°</pre></td></tr></table></figure><h1 id=\"ç‰©ç†èµ„æºç®¡ç†\"><a class=\"anchor\" href=\"#ç‰©ç†èµ„æºç®¡ç†\">#</a> ç‰©ç†èµ„æºç®¡ç†</h1>\n<ul>\n<li>å†…å­˜åˆ†é…ï¼š</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-m</span> 50M --memory-swap<span class=\"token operator\">=</span>100M nagocoler/springboot-test:1.0</pre></td></tr></table></figure><p><code>-m</code>  å¯¹å®¹å™¨çš„ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œ <code>--memory-swap</code>  å¯¹å†…å­˜å’Œäº¤æ¢åˆ†åŒºæ€»å’Œçš„é™åˆ¶ã€‚é»˜è®¤éƒ½æ˜¯ - 1ï¼Œå³æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚å¦‚æœä»…æŒ‡å®š <code>-m</code> ï¼Œé‚£ä¹ˆäº¤æ¢å†…å­˜çš„é™åˆ¶ä¹Ÿä¸º <code>-m</code>  æŒ‡å®šçš„å‚æ•°ã€‚</p>\n<ul>\n<li>CPU è¿›è¡Œé™é¢ï¼š</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-c</span> <span class=\"token number\">1024</span> ubuntu</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-c</span> <span class=\"token number\">512</span> ubuntu</pre></td></tr></table></figure><p>å¯¹ CPU çš„åˆ†é…åªæœ‰å¤šå®¹å™¨æ‰ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯ 1024ï¼Œå¦‚æœ CPU ä¸ç´§å¼ ï¼Œä¾ç„¶å¯ä»¥ä½¿ç”¨å…¨éƒ¨ CPU èµ„æºã€‚</p>\n<blockquote>\n<p>é€šè¿‡ Ubuntu å‘½ä»¤ï¼š <code>sudo apt install stress</code>  åœ¨å®¹å™¨ä¸­ä¸‹è½½å‹åŠ›æµ‹è¯•å·¥å…·æ¥çœ‹ä¸€ä¸‹è¿›ç¨‹åˆ†é…æƒé‡å¯¹è¿›ç¨‹è·å¾— CPU èµ„æºçš„å½±å“ã€‚</p>\n</blockquote>\n<p>è¿˜å¯ä»¥é™åˆ¶å®¹å™¨ä½¿ç”¨ CPUï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> --cpuset-cpus<span class=\"token operator\">=</span><span class=\"token number\">1</span> ubuntu</pre></td></tr></table></figure><blockquote>\n<p>é€‰é¡¹åé¢çš„å€¼ä¸æ˜¯ CPU çš„æ•°é‡ï¼Œè€Œæ˜¯ CPU çš„ â€œç¼–å·â€ï¼Œå³è¿™ä¸ªå®¹å™¨åªç”¨ 1 è¿™ä¸ª CPUï¼Œæ‰€ä»¥æŒ‡å®šä¸¤ä¸ª CPU æ—¶ä¹Ÿå¯ä»¥è¿™æ ·ï¼š <code>docker run -it --cpuset-cpus=0,1 ubuntu</code> ã€‚</p>\n</blockquote>\n<p>å‘½ä»¤ <code>--cpus</code>  æ¥é™åˆ¶ä½¿ç”¨ CPU èµ„æºæ•°ï¼ˆä¸ªæ•°ï¼‰ï¼š <code>docker run -it --cpus=1 ubuntu</code> ã€‚</p>\n<h1 id=\"å®¹å™¨ç›‘æ§\"><a class=\"anchor\" href=\"#å®¹å™¨ç›‘æ§\">#</a> å®¹å™¨ç›‘æ§</h1>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> stats</pre></td></tr></table></figure><p>å¯ä»¥å®æ—¶å¯¹å®¹å™¨çš„å„é¡¹çŠ¶æ€è¿›è¡Œç›‘æ§ï¼ŒåŒ…æ‹¬å†…å­˜ä½¿ç”¨ã€CPU å ç”¨ã€ç½‘ç»œ I/Oã€ç£ç›˜ I/O ç­‰ä¿¡æ¯ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/2e4f267ce01df490.jpg\" alt=\"\" /></p>\n<p><code>top</code>  å‘½ä»¤å¯ä»¥æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">top</span> å®¹å™¨ID/åç§°</pre></td></tr></table></figure><p>å¯¹äºå®¹å™¨ç›‘ç®¡ï¼Œä¹Ÿæœ‰é¡µé¢ç‰ˆæœ¬çš„ï¼Œå®˜æ–¹<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnBvcnRhaW5lci5pby9zdGFydC9pbnN0YWxsL3NlcnZlci9kb2NrZXIvbGludXg=\">ä¸‹è½½æ•™ç¨‹</span>ï¼Œæ­¤å¤„ä¸è¿‡å¤šè®²è§£ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3Vhbmcvendoa3BpL2txNnJsZw==\">https://www.yuque.com/qingkongxiaguang/zwhkpi/kq6rlg</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kb2NrZXIvZG9ja2VyLXN0YXJ0LXN0b3AtcmVzdGFydC1jb21tYW5kLmh0bWw=\">https://www.runoob.com/docker/docker-start-stop-restart-command.html</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/27/Docker/Docker(6)-%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%AE%A1%E7%90%86/",
            "url": "https://cecilia.cool/2022/09/27/Docker/Docker(6)-%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%AE%A1%E7%90%86/",
            "title": "Docker(6)--æ•°æ®å·ç®¡ç†",
            "date_published": "2022-09-27T08:46:08.000Z",
            "content_html": "<h1 id=\"æ•°æ®å·\"><a class=\"anchor\" href=\"#æ•°æ®å·\">#</a> æ•°æ®å·</h1>\n<blockquote>\n<p>åŸºäºåˆ†å±‚æœºåˆ¶ï¼Œåœ¨å®¹å™¨ä¸­æ“ä½œçš„æ–‡ä»¶éƒ½æ˜¯åœ¨æœ€é¡¶å±‚è¿›è¡Œï¼Œè¿™ä¹Ÿå¯¼è‡´å®¹å™¨çš„é”€æ¯ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚é€šè¿‡æ•°æ®å·å¯ä»¥å®ç°æ•°æ®å…±äº«å’ŒæŒä¹…åŒ–ã€‚</p>\n</blockquote>\n<h2 id=\"æ–‡ä»¶æŒ‚è½½\"><a class=\"anchor\" href=\"#æ–‡ä»¶æŒ‚è½½\">#</a> æ–‡ä»¶æŒ‚è½½</h2>\n<p>Linux æ ¹ç›®å½•ä»¥å¤–çš„æ–‡ä»¶æƒ³è¦è¢«è®¿é—®ï¼Œå°±éœ€è¦å°†å…¶å…³è”åˆ°æ ¹ç›®å½•ä¸‹çš„æŸä¸ªç›®å½•å®ç°ï¼Œè¿™ç§å…³è”å°±å«æŒ‚è½½ï¼Œç›®å½•å°±æ˜¯æŒ‚è½½ç‚¹ï¼Œè§£é™¤å…³è”å°±æ˜¯å¸è½½ã€‚</p>\n<blockquote>\n<p>æœ€ç›´æ¥çš„å°±æ˜¯è¯»å– U ç›˜çš„æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‚è½½æ“ä½œï¼Œå°±åªèƒ½åœ¨å›¾å½¢åŒ–ç•Œé¢ä½¿ç”¨ U ç›˜ï¼Œåœ¨å‘½ä»¤è¡Œæ‰¾ä¸åˆ°çš„ã€‚</p>\n</blockquote>\n<p>è¿›è¡ŒæŒ‚è½½æ—¶å»ºè®®é‡æ–°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚æœä½¿ç”¨äº†ç³»ç»Ÿæ–‡ä»¶å¤¹ï¼ˆetc ä¹‹ç±»çš„ï¼‰ï¼ŒæŒ‚è½½æ“ä½œä¼šä½¿å¾—åŸæœ‰ç›®å½•ä¸­æ–‡ä»¶è¢«éšè—ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mount</span> è®¾å¤‡å· æŒ‚è½½ç‚¹ç›®å½•</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">umount</span> æŒ‚è½½ç‚¹ç›®å½•</pre></td></tr></table></figure><h2 id=\"å®¹å™¨æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#å®¹å™¨æŒä¹…åŒ–\">#</a> å®¹å™¨æŒä¹…åŒ–</h2>\n<blockquote>\n<p>æˆ‘ä»¬å¯ä»¥è®©å®¹å™¨å°†æ–‡ä»¶ä¿å­˜åˆ°å®¿ä¸»ä¸»æœºä¸Šï¼Œè¿™æ ·å°±ç®—å®¹å™¨é”€æ¯ï¼Œæ–‡ä»¶ä¹Ÿä¼šåœ¨å®¿ä¸»ä¸»æœºä¸Šä¿ç•™ï¼Œä¸‹æ¬¡åˆ›å»ºå®¹å™¨æ—¶ï¼Œä¾ç„¶å¯ä»¥ä»å®¿ä¸»ä¸»æœºä¸Šè¯»å–åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>åœ¨å®¿ä¸»æœºåˆ›å»ºéœ€è¦æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># éšä¾¿åˆ›å»ºç‚¹æ–‡ä»¶è¡¨ç¤ºæœ‰å†…å®¹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">vim</span> test/hello.txt</pre></td></tr></table></figure><p>å°† test ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„æŸä¸ªç›®å½•ä¸Š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-v</span> ~test:/root/test ubuntu</pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨å®¹å™¨ä¸­å°±å¯ä»¥è®¿é—®å®¿ä¸»ä¸»æœºçš„æ–‡ä»¶ï¼Œå¯¹æŒ‚è½½ç›®å½•çš„æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå°±ç›¸å½“äºç¼–è¾‘å®¿ä¸»ä¸»æœºçš„æ•°æ®ã€‚åœ¨å®¹å™¨ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œå®¿ä¸»ä¸»æœºä¹Ÿä¼šåˆ›å»ºç›¸åº”æ–‡ä»¶ã€‚</p>\n<blockquote>\n<p>åœ¨å®¹å™¨ä¸­åˆ é™¤æ–‡ä»¶ï¼Œä¸ä¼šå½±å“ä¸»æœºçš„æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>å¯ä»¥éƒ¨ç½² Nginxï¼Œåœ¨å®¿ä¸»ä¸»æœºä¸Šä¿å­˜å‰ç«¯é¡µé¢ï¼Œç„¶åå°†è¿™ä¸ªå‰ç«¯é¡µé¢ç›®å½•æŒ‚è½½åˆ° Nignx å®¹å™¨ä¸Šï¼Œè¿™æ · Nginx é•œåƒæœ‰å‡çº§ï¼Œå®¹å™¨éœ€è¦åˆ é™¤é‡æ–°åˆ›å»ºä¹Ÿä¸ä¼šå½±å“å‰ç«¯é¡µé¢ã€‚</p>\n<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„å‰ç«¯æ¨¡æ¿æ˜¯<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ib290c3RyYXBtYWRlLmNvbS8=\"> Arsha</span>ï¼ˆå¦‚ä½•å°†æ–‡ä»¶ä¼ åˆ° linux ä¸Šå¾…ä¼šè®²ï¼‰ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-v</span> /win_data/Arsha:/usr/share/nginx/html/ <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 <span class=\"token parameter variable\">-d</span> nginx</pre></td></tr></table></figure><p>å°†è§£å‹å‡ºæ¥çš„ç›®å½•æŒ‚è½½åˆ° Nginx çš„é»˜è®¤ç«™ç‚¹ç›®å½• <code>/usr/share/nginx/html/</code> ï¼Œå› ä¸ºæŒ‚åœ¨åä½äºé¡¶å±‚ï¼Œä¼šæ›¿ä»£é•œåƒåŸæœ‰çš„æ–‡ä»¶ã€‚</p>\n<p>è¿›å…¥å®¹å™¨å°† Nginx æœåŠ¡å¯åŠ¨ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl start nginx</pre></td></tr></table></figure><blockquote>\n<p>åœ¨ windos æµè§ˆå™¨ä¸­è¾“å…¥ <code>IP:80</code> ï¼Œå³å¯è®¿é—® nginx æœåŠ¡ï¼Œå¦‚æœè®¿é—®è¶…æ—¶ï¼Œå¯èƒ½æ˜¯ linux80 ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œæœ€ç®€å•çš„å°±æ˜¯é‡å¯ä¸€ä¸‹ linuxï¼Œå†å¯åŠ¨ nginxã€‚</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/72cd9dda6c186381.jpg\" alt=\"\" /></p>\n<p>å¦‚æœåœ¨æŒ‚è½½æ—¶æ²¡æœ‰æŒ‡å®šå®¿ä¸»ä¸»æœºçš„ç›®å½•ï¼ŒDocker å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”ä¼šå°†å®¹å™¨ä¸­å¯¹åº”è·¯å¾„ä¸‹çš„å†…å®¹æ‹·è´åˆ°è¿™ä¸ªè‡ªåŠ¨åˆ›å»ºçš„ç›®å½•ä¸­ï¼Œæœ€åæŒ‚åœ¨åˆ°å®¹å™¨ä¸­ï¼Œè¿™ç§å°±æ˜¯ç”± Docker ç®¡ç†çš„æ•°æ®å·äº†ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-v</span> /root/abc ubuntu</pre></td></tr></table></figure><p>è¦æŸ¥çœ‹ Docker å°†æ–‡ä»¶æ”¾åœ¨äº†å®¿ä¸»æœºå“ªä¸ªä½ç½®</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> inspect å®¹å™¨åå­—/ID</pre></td></tr></table></figure><p>ä¸»è¦æ˜¯çœ‹ Mount è¿™ä¸ªéƒ¨åˆ†</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/efea66dac14a3326.jpg\" alt=\"\" /></p>\n<p>Docker æ”¯æŒä»å®¿ä¸»ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ä¸­ï¼ˆæˆ–è€…å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»ä¸»æœºï¼‰</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">cp</span> ä¸»æœºæ–‡ä»¶ å®¹å™¨å/ID:æ–‡ä»¶å¤¹è·¯å¾„</pre></td></tr></table></figure><h3 id=\"winæ–‡ä»¶ä¼ è¾“åˆ°linux\"><a class=\"anchor\" href=\"#winæ–‡ä»¶ä¼ è¾“åˆ°linux\">#</a> win æ–‡ä»¶ä¼ è¾“åˆ° Linux</h3>\n<blockquote>\n<p>å¦‚æœ linux è£…åœ¨è™šæ‹Ÿæœºä¸Šï¼Œè™šæ‹Ÿæœºå®‰è£…äº† VMwareTools åï¼Œä¸€èˆ¬å¯ä»¥å®ç°æ–‡ä»¶ç›´æ¥ä» win æ‹–åŠ¨åˆ°è™šæ‹Ÿæœºç³»ç»Ÿé‡Œé¢ï¼Œä½†æ˜¯æœ‰æ—¶å€™æŠ½é£åˆä¸èƒ½æ‹–åŠ¨ã€‚ä¹Ÿå¯ä»¥å°†æ–‡ä»¶æ”¾åˆ° U ç›˜é‡Œé¢ï¼Œç„¶å U ç›˜æŒ‚è½½åˆ° Linux ä¸Šï¼Œå†å°†æ–‡ä»¶ç§»åŠ¨åˆ° Linux å…¶ä»–æ–‡ä»¶å¤¹é‡Œé¢ä½¿ç”¨ã€‚ï¼ˆæ— è¯­çš„æ˜¯æˆ‘è¿™ U ç›˜æŒ‚è½½ä¹Ÿå‡ºäº†é—®é¢˜ï¼‰</p>\n</blockquote>\n<p>è¿™é‡Œè®²é€šè¿‡ pscpï¼Œå‘½ä»¤è¡Œä¼ è¾“æ–‡ä»¶ã€‚</p>\n<ul>\n<li>åœ¨ Linux ä¸­è®¾ç½®å¥½ root çš„å¯†ç ï¼š <code>sudo passwd</code> ã€‚åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>win_data</code>  æ–‡ä»¶å¤¹ï¼ˆåå­—å…¶å®éšä¾¿ï¼‰</li>\n<li>ä¿®æ”¹ <code>sshd_config</code>  æ–‡ä»¶ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veHVsaWFuZ3hpbmcvcC83NDI4NzM3Lmh0bWw=\">https://www.cnblogs.com/xuliangxing/p/7428737.html</span></li>\n<li>åœ¨ windos ä¸‹è½½å¥½éœ€è¦çš„æ–‡ä»¶</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/29425736a49aebd9.jpg\" alt=\"\" /></p>\n<ul>\n<li>ä¸‹è½½ pscpï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2hpYXJrLmdyZWVuZW5kLm9yZy51ay9+c2d0YXRoYW0vcHV0dHkvbGF0ZXN0Lmh0bWw=\">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</span></li>\n<li>å°† <code>pscp.exe</code>  æ”¾åœ¨ C:\\Windows\\System32 æ–‡ä»¶å¤¹ä¸‹</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/0879d6517d9f457d.jpg\" alt=\"\" /></p>\n<ul>\n<li>åœ¨ C:Windows\\System32 ä¸‹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼š</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">scp</span> ä¸‹è½½æ–‡ä»¶è·¯å¾„ root@IP:/win_data</pre></td></tr></table></figure><p>è¾“å…¥å¯†ç åå°±å¯ä»¥ä¼ è¾“äº†ï¼Œè¿™é‡Œå¿…é¡»è¦ä½¿ç”¨ rootï¼Œä½¿ç”¨ä¸€èˆ¬ç”¨æˆ·çš„è¯ï¼Œæƒé™ä¸å¤Ÿä¼šæ‹’ç»è®¿é—®ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/28/6d1d04a4f34aac95.jpg\" alt=\"\" /></p>\n<ul>\n<li>æœ€ååœ¨ <code>/win_data</code>  ç›®å½•é‡Œè§£å‹å‹ç¼©åŒ…å°±å¯ä»¥ä½¿å°†å…¶æŒ‚è½½åˆ° nginx ä¸Šäº†</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">unzip</span> Arsha.zip</pre></td></tr></table></figure><h2 id=\"å®¹å™¨æ•°æ®å…±äº«\"><a class=\"anchor\" href=\"#å®¹å™¨æ•°æ®å…±äº«\">#</a> å®¹å™¨æ•°æ®å…±äº«</h2>\n<blockquote>\n<p>å®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«</p>\n</blockquote>\n<p>ä¸€èˆ¬æ€è·¯æ˜¯åœ¨å®¿ä¸»ä¸»æœºä¸Šåˆ›å»ºå…¬å‘Šç›®å½•ï¼Œè®©éœ€è¦å…±äº«çš„å®¹å™¨æŒ‚è½½åˆ°è¿™ä¸ªå…¬å…±ç›®å½•ã€‚ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ä¸“é—¨ç”¨äºå­˜æ”¾æ•°æ®ï¼Œå³æ•°æ®å·å®¹å™¨ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">-v</span> ~/test:/root/test <span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>data_test ubuntu</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> --volumes-from data_test ubuntu</pre></td></tr></table></figure><p>ä½¿ç”¨ <code>--volumes-from</code>  æŒ‡å®šå¦ä¸€ä¸ªå®¹å™¨ï¼Œæ•°æ®å·å®¹å™¨æŒ‚è½½çš„å†…å®¹ï¼Œåœ¨å½“å‰å®¹å™¨ä¹Ÿå­˜åœ¨ï¼Œå°±ç®—æ•°æ®å·å®¹å™¨è¢«åˆ é™¤ï¼Œä¹Ÿä¸ä¼šå½±å“è¿™è¾¹ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯è®©ä¸¤ä¸ªå®¹å™¨æŒ‚è½½äº†åŒæ ·çš„ç›®å½•å®ç°æ•°æ®å…±äº«ã€‚</p>\n<p>è¿˜å¯ä»¥å°†æ•°æ®å®Œå…¨æ”¾åˆ°å®¹å™¨ä¸­ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªå®¹å™¨å°†æ‰“åŒ…å¥½çš„æ•°æ®åˆ†äº«ç»™å…¶ä»–å®¹å™¨</p>\n<pre><code class=\"language-Dockerfile\">FROM ubuntu\nADD data.tar.gz /usr/share/nginx/html\nVOLUME /usr/share/nginx/html\n</code></pre>\n<p>æŒ‡ä»¤ ADDï¼Œå®ƒè·Ÿ COPY å‘½ä»¤ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ä¸­ï¼Œä½†æ˜¯å®ƒå¯ä»¥è‡ªåŠ¨å¯¹å‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œè¿™é‡Œåªéœ€è¦å°†å‹ç¼©å¥½çš„æ–‡ä»¶å¡«å…¥å³å¯ï¼Œåé¢çš„ VOLUME æŒ‡ä»¤å°±åƒæˆ‘ä»¬ä½¿ç”¨ <code>-v</code>  å‚æ•°ä¸€æ ·ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹åœ¨å®¹å™¨ä¸­</p>\n<p>ç„¶åæ„å»º</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> é•œåƒå <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªé•œåƒåˆ›å»ºæŒ‰å‡ºæ¥çš„å®¹å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº†ï¼ˆå‡è®¾å®¹å™¨åæ˜¯ ubuntu_testï¼‰</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 --volumes-from<span class=\"token operator\">=</span>ubuntu_test <span class=\"token parameter variable\">-d</span> nginx</pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Linux æ–‡ä»¶æŒ‚è½½ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWljb2Rlci5uZXQvbGludXgvbGludXgtZmlsZS1tb3VudC5odG1s\">https://haicoder.net/linux/linux-file-mount.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmJzbWF4LmNvbS9BL2dWZG5PS1A4elcv\">https://www.bbsmax.com/A/gVdnOKP8zW/</span></p>\n<p>ä¿®æ”¹ sshd_config æ–‡ä»¶ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veHVsaWFuZ3hpbmcvcC83NDI4NzM3Lmh0bWw=\">https://www.cnblogs.com/xuliangxing/p/7428737.html</span></p>\n<p>å‰ç«¯æ¨¡æ¿ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ib290c3RyYXBtYWRlLmNvbS8=\">https://bootstrapmade.com/</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/24/Docker/Docker(5)-%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/",
            "url": "https://cecilia.cool/2022/09/24/Docker/Docker(5)-%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/",
            "title": "Docker(5)--ç½‘ç»œé…ç½®",
            "date_published": "2022-09-24T04:28:58.000Z",
            "content_html": "<h1 id=\"dockeré»˜è®¤ç½‘æ¡¥\"><a class=\"anchor\" href=\"#dockeré»˜è®¤ç½‘æ¡¥\">#</a> Docker é»˜è®¤ç½‘æ¡¥</h1>\n<p>å®‰è£… Docker æœåŠ¡ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ª docker0 ç½‘æ¡¥ï¼Œå®ƒåœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±<strong>å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°åŒä¸€ä¸ªç‰©ç†ç½‘ç»œ</strong>ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/26/6cd3d7a5835ed737.jpg\" alt=\"\" /></p>\n<p>å®¹å™¨æœ‰ä¸‰ç§ç½‘ç»œç±»å‹ï¼Œåˆ†åˆ«æ˜¯ <code>bridge</code> , <code>host</code> , <code>none</code> ï¼Œåˆ›å»ºå®¹å™¨æ—¶é»˜è®¤æ˜¯ <code>bridge</code> ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network <span class=\"token function\">ls</span></pre></td></tr></table></figure><p>å…ˆåˆ›å»ºä¸€ä¸ªå®¹å™¨å†æ¥è®²è§£</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> ubuntu</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">apt</span> update</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> net-tools iputils-ping <span class=\"token function\">curl</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/26/30f79fa9a2b0bfe5.jpg\" alt=\"\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå®¹å™¨çš„ <code>IP</code>  æ˜¯ <code>172.17.0.3</code> ã€‚è¯¥ ubuntu å®¹å™¨å¯åŠ¨æ—¶æ²¡æœ‰æŒ‡å®šç½‘ç»œç±»å‹ï¼Œé»˜è®¤å°±æ˜¯ <code>bridge</code> ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>bridge</code>  çš„ç½‘ç»œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@w2d:~$ <span class=\"token function\">docker</span> network inspect bridge</pre></td></tr></table></figure><p>çœ‹å…³é”®éƒ¨åˆ†</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"Config\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"Subnet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"172.17.0.0/16\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"Gateway\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"172.17.0.1\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><blockquote>\n<p>æˆ‘çš„ç»ˆç«¯å€’æ˜¯æ²¡æœ‰æ˜¾ç¤º Gateway ç½‘å…³ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯ docker0 çš„ IPï¼Œæˆ‘ä»¬åˆ›å»ºçš„å®¹å™¨é»˜è®¤å°±æ˜¯é€šè¿‡ docker0 æ¡¥æ¥å®¿ä¸»æœºçš„ç½‘ç»œã€‚</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/26/726c5b32968c34d6.jpg\" alt=\"\" /></p>\n<h2 id=\"åˆ›å»ºå®¹å™¨\"><a class=\"anchor\" href=\"#åˆ›å»ºå®¹å™¨\">#</a> åˆ›å»ºå®¹å™¨</h2>\n<p>Docker åœ¨åˆ›å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>\n<p>åˆ›å»ºä¸€å¯¹è™šæ‹Ÿæ¥å£ / ç½‘å¡ï¼Œä¹Ÿå°±æ˜¯ veth pairï¼Œåˆ†åˆ«æ”¾åˆ°æœ¬åœ°ä¸»æœºå’Œæ–°å®¹å™¨ä¸­ï¼›</p>\n</li>\n<li>\n<p>æœ¬åœ°ä¸»æœºä¸€ç«¯æ¡¥æ¥åˆ°é»˜è®¤çš„ docker0 æˆ–æŒ‡å®šç½‘æ¡¥ä¸Šï¼Œå¹¶å…·æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œå¦‚ vethxxxxxï¼›</p>\n</li>\n<li>\n<p>å®¹å™¨ä¸€ç«¯æ”¾åˆ°æ–°å®¹å™¨ä¸­ï¼Œå¹¶ä¿®æ”¹åå­—ä½œä¸º eth0ï¼Œè¿™ä¸ªç½‘å¡ / æ¥å£åªåœ¨å®¹å™¨çš„åå­—ç©ºé—´å¯è§ï¼›</p>\n</li>\n<li>\n<p>ä»ç½‘æ¡¥å¯ç”¨åœ°å€æ®µä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¸è¯¥ bridge å¯¹åº”çš„ networkï¼‰è·å–ä¸€ä¸ªç©ºé—²åœ°å€åˆ†é…ç»™å®¹å™¨çš„ eth0ï¼Œå¹¶é…ç½®é»˜è®¤è·¯ç”±åˆ°æ¡¥æ¥ç½‘å¡ vethxxxxã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>å¦‚æœä¸æŒ‡å®š --networkï¼Œåˆ›å»ºçš„å®¹å™¨é»˜è®¤éƒ½ä¼šæŒ‚åˆ° docker0 ä¸Šï¼Œä½¿ç”¨æœ¬åœ°ä¸»æœºä¸Š docker0 æ¥å£çš„ IP ä½œä¸ºæ‰€æœ‰å®¹å™¨çš„é»˜è®¤ç½‘å…³</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/26/324896ddff4fdafc.jpg\" alt=\"\" /></p>\n<h1 id=\"ç½‘ç»œç±»å‹\"><a class=\"anchor\" href=\"#ç½‘ç»œç±»å‹\">#</a> ç½‘ç»œç±»å‹</h1>\n<h2 id=\"é»˜è®¤ç½‘ç»œç±»å‹\"><a class=\"anchor\" href=\"#é»˜è®¤ç½‘ç»œç±»å‹\">#</a> é»˜è®¤ç½‘ç»œç±»å‹</h2>\n<p>ä¹‹å‰ä½¿ç”¨ <code>docker network ls</code>  æŸ¥çœ‹ä¸‰ç§ç½‘ç»œç±»å‹ï¼Œæœ‰ <code>bridge</code> ï¼Œ <code>host</code> ï¼Œ <code>none</code> ã€‚ï¼Œä½¿ç”¨ <code>--network</code>  å¯ä»¥æŒ‡å®šç½‘ç»œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--network</span><span class=\"token operator\">=</span>none ubuntu</pre></td></tr></table></figure><ul>\n<li><strong>none ç½‘ç»œ</strong>ï¼šåªæœ‰ä¸€ä¸ªæœ¬åœ°ç¯å›ç½‘ç»œï¼Œé€šè¿‡ <code>ifconfig</code>  æŸ¥çœ‹ï¼Œåªæœ‰ä¸€ä¸ªæœ¬åœ°ç¯å› <code>lo</code>  ç½‘ç»œè®¾å¤‡ï¼š</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/26/ba906a10862142e3.jpg\" alt=\"\" /></p>\n<p>åœ¨è¿™ç§ç½‘ç»œæ¨¡å¼ä¸‹ï¼Œå®¹å™¨æ— æ³•è¿æ¥åˆ°äº’è”ç½‘ï¼šæ¯”å¦‚ï¼Œ <code>ping</code>  ä¸é€šï¼Œçº¯çº¯å•æœºè¿è¡Œã€‚</p>\n<ul>\n<li><strong>bridger ç½‘ç»œ</strong>ï¼šå®¹å™¨é»˜è®¤ä½¿ç”¨çš„ç½‘ç»œç±»å‹ï¼Œä¸Šæ–‡æˆ‘ä»¬å·²ç»è®²äº†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</li>\n<li><strong>host ç½‘ç»œ</strong>ï¼šå½“å®¹å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œï¼Œä¼šå…±äº«å®¿ä¸»ä¸»æœºçš„ç½‘ç»œï¼Œç½‘ç»œé…ç½®æ˜¯å®Œå…¨ä¸€æ ·ã€‚</li>\n</ul>\n<h2 id=\"è‡ªå®šä¹‰ç½‘ç»œç±»å‹\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰ç½‘ç»œç±»å‹\">#</a> è‡ªå®šä¹‰ç½‘ç»œç±»å‹</h2>\n<p>Docker é»˜è®¤æä¾›ä¸‰ç§ç½‘ç»œé©±åŠ¨ï¼š <code>bridge</code> ã€ <code>overlay</code> ã€ <code>macvlan</code> ï¼Œä¸åŒçš„é©±åŠ¨å¯¹åº”ç€ä¸åŒçš„ç½‘ç»œè®¾å¤‡é©±åŠ¨ï¼Œå®ç°çš„åŠŸèƒ½ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ bridge ç±»å‹çš„ï¼Œå…¶å®å°±å’Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„æ¡¥æ¥ç½‘ç»œæ˜¯ä¸€æ ·çš„ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create <span class=\"token parameter variable\">--driver</span> bridge <span class=\"token builtin class-name\">test</span></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æœ¬æ–‡æœ€å¼€å§‹çš„ <code>ifconfig</code>  å¤šæ˜¾ç¤ºäº†ä¸€ä¸ªç½‘ç»œè®¾å¤‡ï¼Œä¸åŒç½‘ç»œä¹‹é—´çš„é€šä¿¡æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ— æ³•è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨é»˜è®¤ç½‘ç»œç±»å‹çš„ ubuntu å®¹å™¨ï¼Œæœ‰ä¸€ä¸ªåœ¨ test ç½‘ç»œä¸‹çš„ ubuntu å®¹å™¨ï¼Œåè€…çš„ç½‘å…³æ˜¯ <code>172.18.0.1</code> ï¼Œå®¹å™¨ IP ä¸º <code>172.18.0.2</code> ï¼Œåœ¨å‰è€…ä¸­æƒ³è¦æ‰§è¡Œå‘½ä»¤ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ping</span> <span class=\"token number\">172.18</span>.0.2</pre></td></tr></table></figure><p>ä¼šå¤±è´¥ï¼Œæƒ³è¦å®ç°é€šä¿¡ï¼Œéœ€è¦å°†å‰è€…è¿æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨æ‰€å±çš„ç½‘ç»œä¸‹ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network connect test<span class=\"token punctuation\">(</span>ç½‘ç»œç±»å‹<span class=\"token punctuation\">)</span> å®¹å™¨ID/åç§°</pre></td></tr></table></figure><p>æ­¤æ—¶å®¹å™¨å°±å¯ä»¥äº’ç›¸é€šä¿¡ã€‚Docker çš„ DNS æœåŠ¡å™¨å¯ä»¥ä¸éœ€è¦æŒ‡å®šå®¹å™¨ IPï¼Œæ¯”å¦‚æœ‰ä¸¤ä¸ªå¯ä»¥äº’ç›¸é€šä¿¡çš„å®¹å™¨ï¼Œåœ¨å¯åŠ¨æ—¶åˆ†åˆ«ç”¨ <code>--name</code>  æŒ‡å®šåç§°ï¼Œé€šä¿¡æ—¶å°±å¯ä»¥ä½¿ç”¨åç§°è€Œä¸æ˜¯ IPï¼ˆå°±åƒæœ‰ä¸€ä¸ª DNS ä¸€æ ·å°†åå­—è§£ææˆ IPï¼‰</p>\n<p>ä¸¤ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥å…±äº«ä¸€ä¸ªç½‘ç»œè®¾å¤‡ï¼Œå³ä¸¤ä¸ªå®¹å™¨å…±åŒä½¿ç”¨ä¸€ä¸ª IP åœ°å€ï¼Œåªéœ€è¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>test02 <span class=\"token parameter variable\">--network</span><span class=\"token operator\">=</span>container:test02 ubuntu</pre></td></tr></table></figure><p>ä¸¤ä¸ªå®¹å™¨çš„ IP åœ°å€å’Œç½‘å¡çš„ Mac åœ°å€æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå®ƒä»¬çš„ç½‘ç»œç°åœ¨æ˜¯å…±äº«çŠ¶æ€ï¼Œæ­¤æ—¶åœ¨å®¹å™¨ä¸­è®¿é—®ï¼Œlocalhostï¼Œæ—¢æ˜¯è‡ªå·±ä¹Ÿæ˜¯åˆ«äººã€‚</p>\n<p>å¯ä»¥åœ¨å®¹å™¨ 1 ä¸­ï¼Œå®‰è£… Nginxï¼Œç„¶åå†å®¹å™¨ 2 ä¸­è®¿é—®ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> systemctl nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> systemctl start nginx</pre></td></tr></table></figure><p>è®¿é—®åˆ°å¦ä¸€ä¸ªå®¹å™¨ä¸­çš„ Nginx æœåŠ¡å™¨ã€‚</p>\n<blockquote>\n<p>å¦å¤–ä¸¤ç§ç±»å‹çš„ç½‘ç»œç”¨äºå¤šä¸»æœºé€šä¿¡ï¼Œå¤šä¸»æœºé€šä¿¡ä¼šä½¿ç”¨ç‰©ç†äº¤æ¢æœºï¼Œä¸åŒä¸»æœºçš„ç½‘å¡è¿æ¥åˆ°åŒä¸€å°äº¤æ¢æœºï¼Œå°±ç›¸å½“äºå„è‡ªç½‘æ¡¥åœ¨åŒä¸€ç‰©ç†ç½‘ç»œäº†ã€‚</p>\n</blockquote>\n<h2 id=\"å®¹å™¨å¤–éƒ¨ç½‘ç»œ\"><a class=\"anchor\" href=\"#å®¹å™¨å¤–éƒ¨ç½‘ç»œ\">#</a> å®¹å™¨å¤–éƒ¨ç½‘ç»œ</h2>\n<p>åœ¨é»˜è®¤çš„ä¸‰ç§çš„ç½‘ç»œä¸‹ï¼Œåªæœ‰å…±äº«æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼å¯ä»¥è¿æ¥åˆ°å¤–ç½‘ï¼Œå…±äº«æ¨¡å¼å®é™…ä¸Šå°±æ˜¯ç›´æ¥ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°äº’è”ç½‘ï¼Œè¿™é‡Œä¸»è¦æ¥çœ‹ä¸€ä¸‹æ¡¥æ¥æ¨¡å¼ã€‚</p>\n<blockquote>\n<p>æ¡¥æ¥æ¨¡å¼å®¹å™¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œå…³é”®éƒ¨åˆ†å°±æ˜¯ NAT (Netwirk Address Translation)ï¼Œå°†åœ°å€è¿›è¡Œè½¬æ¢ï¼Œå†åˆ©ç”¨å®¿ä¸»ä¸»æœºçš„ IP åœ°å€å‘é€æ•°æ®åŒ…å‡ºå»ã€‚</p>\n</blockquote>\n<p>æ¯”å¦‚æˆ‘ä»¬è¦è®¿é—®äº’è”ç½‘ä¸Šçš„æŸä¸ªèµ„æºï¼Œè¦å’ŒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†æ•°æ®åŒ…å‘é€å‡ºå»ï¼ŒåŒæ—¶æœåŠ¡å™¨ä¹Ÿè¦å°†æ•°æ®åŒ…å‘é€å›æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»è¿æ¥ï¼Œå› ä¸ºæœåŠ¡å™¨çš„ IP åœ°å€æ˜¯æš´éœ²åœ¨äº’è”ç½‘ä¸Šçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å±€åŸŸç½‘å°±ä¸ä¸€æ ·äº†ï¼Œå®ƒä»…ä»…å±€é™åœ¨æˆ‘ä»¬çš„å®¶é‡Œï¼Œæ¯”å¦‚æˆ‘ä»¬è¿æ¥äº†å®¶é‡Œçš„è·¯ç”±å™¨ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ª IP åœ°å€ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œè¿™ä¸ª IP å…¬ç½‘æ˜¯æ— æ³•ç›´æ¥è®¿é—®åˆ°æˆ‘ä»¬çš„ï¼Œå› ä¸ºè¿™ä¸ª IP åœ°å€ä»…ä»…æ˜¯ä¸€ä¸ªå±€åŸŸç½‘çš„ IP åœ°å€ï¼Œä¿—ç§°å†…ç½‘ IPã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/27/dab39643f8e2041e.jpg\" alt=\"\" /></p>\n<p>è¿™é‡Œå°±å€ŸåŠ©äº† NAT åœ¨å¸®åŠ©æˆ‘ä»¬ä¸äº’è”ç½‘ä¸Šçš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡ NATï¼Œå¯ä»¥å®ç°å°†å±€åŸŸç½‘çš„ IP åœ°å€ï¼Œæ˜ å°„ä¸ºå¯¹åº”çš„å…¬ç½‘ IP åœ°å€ï¼Œè€Œ NAT è®¾å¤‡ä¸€ç«¯è¿æ¥å¤–ç½‘ï¼Œå¦ä¸€ç«¯è¿æ¥å†…ç½‘çš„æ‰€æœ‰è®¾å¤‡ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¸å¤–ç½‘è¿›è¡Œé€šä¿¡æ—¶ï¼Œå°±å¯ä»¥å°†æ•°æ®åŒ…å‘é€ç»™ NAT è®¾å¤‡ï¼Œç”±å®ƒæ¥å°†æ•°æ®åŒ…çš„æºåœ°å€æ˜ å°„ä¸ºå®ƒåœ¨å¤–ç½‘ä¸Šçš„åœ°å€ï¼Œè¿™æ ·æœåŠ¡å™¨å°±èƒ½å¤Ÿå‘ç°å®ƒäº†ï¼Œèƒ½å¤Ÿç›´æ¥ä¸å®ƒå»ºç«‹é€šä¿¡ã€‚å½“æœåŠ¡å™¨å‘é€æ•°æ®å›æ¥æ—¶ï¼Œä¹Ÿæ˜¯ç›´æ¥äº¤ç»™ NAT è®¾å¤‡ï¼Œç„¶åå†æ ¹æ®åœ°å€æ˜ å°„ï¼Œè½¬å‘ç»™å¯¹åº”çš„å†…ç½‘è®¾å¤‡ï¼ˆå½“ç„¶ç”±äºå…¬ç½‘ IP åœ°å€æœ‰é™ï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨ IP + ç«¯å£ç»“åˆä½¿ç”¨çš„å½¢å¼ ANPTï¼‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/27/e05a018b5df6da55.jpg\" alt=\"\" /></p>\n<p>ç”¨ç™¾åº¦æŸ¥å‡ºæ¥çš„ IP å’Œåœ¨å‘½ä»¤è¡Œä½¿ç”¨ <code>ipconfig(windows)</code>  æŸ¥å‡ºæ¥çš„ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯ NAT è®¾å¤‡çš„å…¬ç½‘åœ°å€ã€‚</p>\n<p>Docker ä¸­ï¼Œå†…ç½‘æ•°æ®åŒ…æƒ³è¦å‘é€åˆ°äº’è”ç½‘ä¸Šçš„æµç¨‹ä¸ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/27/e4ebfbc4ba947097.jpg\" alt=\"\" /></p>\n<p>å•çº¯ä¾é  NATï¼Œåªæœ‰ä¸»åŠ¨ä¸å¤–ç•Œè”ç³»æ—¶ï¼Œå¤–ç•Œæ‰çŸ¥é“æˆ‘ä»¬ã€‚ä½†æ˜¯å¦‚æœå®¹å™¨ä¸­éƒ¨ç½²äº†ä¸€äº›æœåŠ¡ï¼Œéœ€è¦å¤–ç•Œä¸»åŠ¨è¿æ¥å®¹å™¨çš„æœåŠ¡ï¼Œå°±éœ€è¦ä½¿ç”¨ç«¯å£æ˜ å°„é…ç½®ã€‚</p>\n<blockquote>\n<p>å¤–ç•Œè¿æ¥ï¼ŒåªçŸ¥é“ linux çš„ IP è€Œä¸çŸ¥é“å®¹å™¨çš„ IPï¼Œå°±éœ€è¦é€šè¿‡ç«¯å£æ˜ å°„è®¿é—®ã€‚ç«¯å£æ˜ å°„å¯ä»¥å°†å®¹å™¨éœ€è¦å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»ä¸»æœºçš„ç«¯å£ä¸Šï¼Œè¿™æ ·ï¼Œå½“å¤–éƒ¨è®¿é—®åˆ°å®¿ä¸»ä¸»æœºçš„å¯¹åº”ç«¯å£æ—¶ï¼Œå°±ä¼šç›´æ¥è½¬å‘ç»™å®¹å™¨å†…æ˜ å°„çš„ç«¯å£äº†ã€‚</p>\n</blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å…ˆéƒ¨ç½²ä¸€ä¸ª nginx æœåŠ¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 nginx</pre></td></tr></table></figure><p><code>-p</code>  å‚æ•°æ˜¯è¿›è¡Œç«¯å£æ˜ å°„é…ç½®ï¼Œè§„åˆ™ä¸º <code>å®¿ä¸»ç«¯å£:å®¹å™¨ç«¯å£</code> ï¼Œå…¶å®å…³äºç«¯å£æ˜ å°„ä¹‹å‰çš„æ–‡ç« å·²ç»è®²è¿‡äº†ã€‚</p>\n<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š <code>Linux IP:80</code>  å³å¯è®¿é—® nignx æœåŠ¡ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2b3BzL2RvY2tlci9kb2NrZXItMDctbmV0d29yay5odG1s\">https://pdai.tech/md/devops/docker/docker-07-network.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3Vhbmcvendoa3BpL2txNnJsZyM2N2ZiOTdlYQ==\">https://www.yuque.com/qingkongxiaguang/zwhkpi/kq6rlg#67fb97ea</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaXQxMzUyLmNvbS8yMDUyODkyLmh0bWw=\">https://www.it1352.com/2052892.html</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/24/Docker/Docker(4)-webapp%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B/",
            "url": "https://cecilia.cool/2022/09/24/Docker/Docker(4)-webapp%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B/",
            "title": "Docker(4)--webappåº”ç”¨å®ä¾‹",
            "date_published": "2022-09-24T03:34:17.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>æœ¬æ–‡é€šè¿‡ web åº”ç”¨å±•ç¤ºä¸»æœºå¦‚ä½•ä¸ wen å®¹å™¨ä¹‹é—´é€šä¿¡ï¼Œä¸ºåç»­è®²è§£ç½‘ç»œæä¾›åŸºç¡€ã€‚</p>\n<h1 id=\"webçš„è¿è¡Œä¸è®¿é—®\"><a class=\"anchor\" href=\"#webçš„è¿è¡Œä¸è®¿é—®\">#</a> web çš„è¿è¡Œä¸è®¿é—®</h1>\n<h2 id=\"è¿è¡Œ\"><a class=\"anchor\" href=\"#è¿è¡Œ\">#</a> è¿è¡Œ</h2>\n<blockquote>\n<p>æ‰¾åˆ°ä¸€ä¸ª webapp é•œåƒå³å¯ã€‚</p>\n</blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull training/webapp</pre></td></tr></table></figure><p>ä¸‹è½½å®ŒæˆåæŸ¥çœ‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> images <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> webapp</pre></td></tr></table></figure><blockquote>\n<p>æˆ‘ä»¬éœ€è¦è·‘ä¸€ä¸‹è¿™ä¸ª webapp é‡Œé¢çš„ app.py æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ hello world</p>\n</blockquote>\n<p>å¯åŠ¨ webapp</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-P</span> training/webapp python app.py</pre></td></tr></table></figure><blockquote>\n<p><code>-d</code> ï¼šè®©å®¹å™¨åœ¨åå°è¿è¡Œ</p>\n<p><code>-P</code> ï¼šå°†å®¹å™¨å†…éƒ¨ä½¿ç”¨çš„ç½‘ç»œç«¯å£æ˜ å°„åˆ°ä¸»æœºä¸Š</p>\n</blockquote>\n<p>æŸ¥çœ‹ä¸€ä¸‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@w2d:~$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONTAINER ID          PORTS                                   </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>e7a994ce697c     <span class=\"token number\">0.0</span>.0.0:49153-<span class=\"token operator\">></span><span class=\"token number\">5000</span>/tcp, :::49153-<span class=\"token operator\">></span><span class=\"token number\">5000</span>/tcp</pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºç•Œé¢æ˜¾ç¤ºä¸å¤Ÿï¼Œæˆ‘å°±åªä¿ç•™äº† ID å’Œç«¯å£å·çš„ç›¸å…³ä¿¡æ¯ã€‚</p>\n<h2 id=\"è®¿é—®\"><a class=\"anchor\" href=\"#è®¿é—®\">#</a> è®¿é—®</h2>\n<p>ä¸Šæ–‡ç«¯å£å·çš„è§£è¯»æ˜¯ï¼šDocker å¼€æ”¾ 5000 ç«¯å£ï¼ˆPython Flask é»˜è®¤ç«¯å£ï¼‰æ˜ å°„åˆ°ä¸»æœºç«¯å£ 49153.</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä» 49153 è¿™ä¸ªç«¯å£æ¥è®¿é—®è¿™ä¸ªç•Œé¢</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-nltp</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">49153</span></pre></td></tr></table></figure><blockquote>\n<p><code>netstat</code>  å‘½ä»¤ç”¨äºæ˜¾ç¤ºç½‘ç»œçŠ¶æ€</p>\n</blockquote>\n<p>åœ¨å‘½ä»¤è¡Œï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> localhost:49153</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æˆ–è€…åœ¨æµè§ˆå™¨ä¸Šè®¿é—®ï¼Œip æ˜¯è™šæ‹Ÿæœº - Ubuntu çš„ ip</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/24/1d9b4aa085083f9e.jpg\" alt=\"\" /></p>\n<p>å®¹å™¨æ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£æ˜¯éšæœºçš„ï¼Œä½†æ˜¯å¯ä»¥ç”¨ - P é€‰é¡¹æ¥æŒ‡å®šç«¯å£</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-P</span> <span class=\"token number\">5001</span>:500 training/webapp python app.py</pre></td></tr></table></figure><blockquote>\n<p>å¦‚æœæµè§ˆå™¨è®¿é—®ä¸ä¸Šï¼ŒæŠŠé•œåƒåˆ äº†é‡æ–°ä¸‹è½½è¯•è¯•ï¼Œåæ­£æ˜¯å¯ä»¥çš„</p>\n</blockquote>\n<h1 id=\"å…¶ä»–åŠŸèƒ½\"><a class=\"anchor\" href=\"#å…¶ä»–åŠŸèƒ½\">#</a> å…¶ä»–åŠŸèƒ½</h1>\n<blockquote>\n<p>åæ­£éƒ½æ˜¯å‘½ä»¤ï¼Œå¿«é€Ÿè¿‡ä¸€ä¸‹</p>\n</blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹å®¹å™¨ (æ˜ å°„) ç«¯å£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> port ID</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> logs ID</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹å®¹å™¨è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">top</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># æ£€æŸ¥åº”ç”¨åº•å±‚ä¿¡æ¯ï¼Œè¿”å› JSON æ–‡ä»¶è®°å½•</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># å®¹å™¨é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">docker</span> inspect ID</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># åœæ­¢åº”ç”¨å®¹å™¨</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">docker</span> stop ID</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># é‡å¯å®¹å™¨</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">docker</span> restart/start ID</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># ç§»é™¤å®¹å™¨ï¼Œ-f å°±æ˜¯å¼ºåˆ¶åˆ é™¤ï¼Œä¸€èˆ¬å®¹å™¨åˆ é™¤éœ€è¦ </span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">rm</span> ID</pre></td></tr></table></figure><h2 id=\"å®¹å™¨äº’è”\"><a class=\"anchor\" href=\"#å®¹å™¨äº’è”\">#</a> å®¹å™¨äº’è”</h2>\n<blockquote>\n<p>åˆ é™¤æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å®¹å™¨ï¼š <code>docker container prune</code> ã€‚</p>\n</blockquote>\n<p>åˆ›å»ºæ•°æ®åº“å®¹å™¨ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> db training/postgres</pre></td></tr></table></figure><p>db å®¹å™¨ä¸ web å®¹å™¨å»ºç«‹äº’è”å…³ç³»</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-P</span> <span class=\"token number\">5001</span>:5000 <span class=\"token parameter variable\">--name</span> web <span class=\"token parameter variable\">--link</span> db:db training/webapp python app.py</pre></td></tr></table></figure><p><code>--link</code>  å‚æ•°æ ¼å¼ä¸º  <code>--link name:alias</code> ï¼Œå…¶ä¸­ name æ˜¯è¦é“¾æ¥çš„å®¹å™¨çš„åç§°ï¼Œalias æ˜¯è¿™ä¸ªè¿æ¥çš„åˆ«åã€‚</p>\n<p>å®¹å™¨ä¹‹é—´çš„è¿æ¥ä¿¡æ¯çš„æŸ¥çœ‹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<ul>\n<li>æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼š</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># webapp å·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œå‡è®¾å…¶åå­—ä¸º web</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> web /bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ====>ï¼Œè¿™é‡Œå‡è®¾ ID æ˜¯ 1cbc9aeba2a8</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>root@1cbc9aeba2a8:/opt/webapp<span class=\"token comment\"># env</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">DB_NAME</span><span class=\"token operator\">=</span>/web/db</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">DB_PORT_5432_TCP_ADDR</span><span class=\"token operator\">=</span><span class=\"token number\">172.17</span>.0.2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">DB_PORT</span><span class=\"token operator\">=</span>tcp://172.17.0.2:5432</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">DB_PORT_5432_TCP</span><span class=\"token operator\">=</span>tcp://172.17.0.2:5432</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">PWD</span></span><span class=\"token operator\">=</span>/opt/webapp</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">DB_PORT_5432_TCP_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5432</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">SHLVL</span></span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/root</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token assign-left variable\">DB_PORT_5432_TCP_PROTO</span><span class=\"token operator\">=</span>tcp</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">DB_ENV_PG_VERSION</span><span class=\"token operator\">=</span><span class=\"token number\">9.3</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token assign-left variable\">_</span><span class=\"token operator\">=</span>/usr/bin/env</pre></td></tr></table></figure><blockquote>\n<p>DB_ å¼€å¤´çš„ç¯å¢ƒå˜é‡æ˜¯ä¾› web å®¹å™¨è¿æ¥ db å®¹å™¨ä½¿ç”¨ï¼Œå‰ç¼€é‡‡ç”¨å¤§å†™çš„è¿æ¥åˆ«åã€‚<strong>åªæœ‰åœ¨å»ºç«‹è¿æ¥ä¹‹åæ‰ä¼šæœ‰ï¼Œæ²¡æœ‰å»ºç«‹è¿æ¥æ˜¯æ²¡æœ‰è¿™å‡ ä¸ªå˜é‡çš„</strong>ã€‚</p>\n</blockquote>\n<ul>\n<li>hosts æ–‡ä»¶</li>\n</ul>\n<p>é™¤äº†ç¯å¢ƒå˜é‡ï¼ŒDocker è¿˜æ·»åŠ  host ä¿¡æ¯åˆ°çˆ¶å®¹å™¨çš„  <code>/etc/hosts</code>  çš„æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯çˆ¶å®¹å™¨ web çš„ hosts æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>root@1cbc9aeba2a8:/opt/webapp<span class=\"token comment\"># cat /etc/hosts</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1       localhost</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>::1     localhost ip6-localhost ip6-loopback</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fe00::0 ip6-localnet</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ff00::0 ip6-mcastprefix</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ff02::1 ip6-allnodes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ff02::2 ip6-allrouters</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">172.17</span>.0.2      db d992e3c761e0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">172.17</span>.0.3      1cbc9aeba2a8</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>root@1cbc9aeba2a8:/opt/webapp<span class=\"token comment\">#</span></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ 2 ä¸ª hosts:</p>\n<ul>\n<li>ç¬¬ä¸€ä¸ªï¼Œ <code>172.17.0.2 db d992e3c761e0</code>  è¡¨ç¤º db å®¹å™¨çš„ ip, ID å’Œ Name</li>\n<li>ç¬¬äºŒä¸ªï¼Œ <code>172.17.0.3 1cbc9aeba2a8</code>  è¡¨ç¤º web å®¹å™¨çš„ ip, ID</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>netstat å‘½ä»¤ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9saW51eC9saW51eC1jb21tLW5ldHN0YXQuaHRtbD9pdmtfc2E9MTAyNDMyMHU=\">https://www.runoob.com/linux/linux-comm-netstat.html?ivk_sa=1024320u</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2b3BzL2RvY2tlci9kb2NrZXItMDMtYmFzaWMtd2ViLWFwcC5odG1s\">https://pdai.tech/md/devops/docker/docker-03-basic-web-app.html</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/22/Docker/Docker(3)-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%8E%E5%8F%91%E5%B8%83/",
            "url": "https://cecilia.cool/2022/09/22/Docker/Docker(3)-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%8E%E5%8F%91%E5%B8%83/",
            "title": "Docker(3)--é•œåƒæ„å»ºä¸å‘å¸ƒ",
            "date_published": "2022-09-22T02:46:18.000Z",
            "content_html": "<h1 id=\"æ„å»ºé•œåƒ\"><a class=\"anchor\" href=\"#æ„å»ºé•œåƒ\">#</a> æ„å»ºé•œåƒ</h1>\n<p>æœ‰äº›å†·é—¨çš„è½¯ä»¶ä¸åœ¨è¿œç¨‹ä»“åº“é‡Œï¼Œæ­¤æ—¶å°±éœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚æˆ‘ä»¬ä»¥ Ubuntu çš„ base é•œåƒä¸­å®‰è£… Java ç¯å¢ƒï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆæ–°çš„é•œåƒï¼ˆè¿™ä¸ªæ–°çš„é•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å« Java ç¯å¢ƒçš„ Ubuntu ç³»ç»Ÿé•œåƒï¼‰ã€‚</p>\n<p>æ‹‰å–å¯åŠ¨ Ubuntuï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull ubuntu</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> ubuntu</pre></td></tr></table></figure><p>æ›´æ–° aptï¼ˆå› ä¸ºåªæœ‰ base é•œåƒï¼‰</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> update</pre></td></tr></table></figure><blockquote>\n<p>è¿™ä¸€æ­¥æˆ‘ä¹‹å‰æ¢ä¸æ¢æºéƒ½ä¼šå‡ºé”™ï¼Œåæ­£å°±æ˜¯æ›´æ–°å¤±è´¥ï¼Œåæ¥æŠ˜è…¾äº†ä¸¤ä¸‰å¤©ï¼Œéƒ½æ²¡ä»€ä¹ˆæ•ˆæœã€‚æœ€åæŠŠ wifi æ¢æˆçƒ­ç‚¹å°±æ›´æ–°æˆåŠŸäº†ã€‚æ‰€ä»¥ä½ å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå¯ä»¥è¯•ç€æ£€æŸ¥ä¸€ä¸‹ç½‘ç»œé—®é¢˜ã€‚</p>\n<p>ä¹Ÿä¸ç”¨æ€€ç–‘ç‰ˆæœ¬é—®é¢˜ï¼Œæœ¬äººç”¨ Ubuntu 15 å’Œ Ubuntu22 éƒ½æ›´æ–°æˆåŠŸè¿‡ã€‚</p>\n</blockquote>\n<p>å®‰è£… <code>jdk</code> ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> openjdk-8-jdk</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å¦‚æœ apt æ›´æ–°å¤±è´¥ï¼Œåé¢çš„ä¹Ÿä¼šå¤±è´¥</span></pre></td></tr></table></figure><p>é€€å‡ºå®¹å™¨ï¼Œå°†å…¶æ„å»ºä¸ºæ–°çš„é•œåƒï¼Œä½¿ç”¨ commit å°†å®¹å™¨ä¿å­˜ä¸ºæ–°çš„é•œåƒï¼š</p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>docker commit å®¹å™¨åç§°/ID æ–°çš„é•œåƒåç§°</pre></td></tr></table></figure><p>æ­¤æ—¶å†ä½¿ç”¨ <code>docker images</code>  å°±å¯ä»¥çœ‹åˆ°æ–°æ„å»ºçš„é•œåƒäº†ã€‚</p>\n<blockquote>\n<p>ä½†æ˜¯è¿™ç§æ„å»ºæ–¹å¼ Docker å®˜æ–¹å¹¶ä¸æ¨èã€‚æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨ Dockerfile æ„å»ºä¸Šè¿°é•œåƒ</p>\n</blockquote>\n<p>åˆ›å»ºåä¸º <code>Dockerfile</code>  çš„æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">touch</span> Dockerfile</pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦åœ¨ <code>Dockerfile</code>  æ–‡ä»¶å†…éƒ¨ç¼–å†™æŒ‡ä»¤æ¥å‘Šè¯‰ Docker éœ€è¦æ„å»ºé•œåƒçš„ç›¸å…³ä¿¡æ¯</p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> &lt;åŸºç¡€é•œåƒ></span></pre></td></tr></table></figure><p><code>FROM</code>  æŒ‡ä»¤é€‰æ‹©å½“å‰é•œåƒçš„åŸºç¡€é•œåƒï¼ˆå¿…é¡»ä»¥è¯¥æŒ‡ä»¤å¼€å§‹ï¼‰ã€‚å¦‚æœä¸éœ€è¦ä»»ä½•åŸºç¡€é•œåƒï¼Œä½¿ç”¨ <code>scratch</code>  è¡¨ç¤ºä»é›¶å¼€å§‹åŸºç¡€æ„å»ºã€‚</p>\n<p>åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤å®‰è£… Java ç¯å¢ƒ</p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt update</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt install -y openjdk-8-jdk</span></pre></td></tr></table></figure><p>æ„å»ºï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> <span class=\"token operator\">&lt;</span>é•œåƒåç§°<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>æ„å»ºç›®å½•<span class=\"token operator\">></span></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼ŒDocker ä¼šåœ¨æ„å»ºç›®å½•ä¸­å¯»æ‰¾ Dockerfile æ–‡ä»¶ï¼Œç„¶åå¼€å§‹ä¾æ¬¡æ‰§è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/23/97bff6ac9d64700f.jpg\" alt=\"\" /></p>\n<p>æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåœ¨é•œåƒä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ï¼Œ <code>-t</code>  æŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒåï¼Œ <code>.</code>  æ˜¯ Dockerfile æ‰€åœ¨ç›®å½•ã€‚</p>\n<h1 id=\"å‘å¸ƒé•œåƒ\"><a class=\"anchor\" href=\"#å‘å¸ƒé•œåƒ\">#</a> å‘å¸ƒé•œåƒ</h1>\n<p>æˆ‘ä»¬å¯ä»¥å°†é•œåƒä¸Šä¼ åˆ°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yZXBvc2l0b3JpZXM=\">https://hub.docker.com/repositories</span></p>\n<p>å…ˆåœ¨ hub.docker.com ä¸Šåˆ›å»ºå…¬å…±çš„é•œåƒä»“åº“ï¼Œå†å°†æœ¬åœ°é•œåƒä¸Šä¼ ï¼Œä¸Šä¼ å‰å¯ä»¥å°†é•œåƒåç§°ä¿®æ”¹è§„èŒƒï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> tag ubuntu-java-file:latest ç”¨æˆ·å/ä»“åº“åç§°:ç‰ˆæœ¬</pre></td></tr></table></figure><p>ç„¶åæœ¬åœ°ä¸Šä¼ ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> push nagocoler/ubuntu-java:1.0</pre></td></tr></table></figure><blockquote>\n<p>è¿™é‡Œå‚è€ƒçš„é’ç©ºã®éœå…‰çš„ç”¨æˆ·å nagocoler å’Œä»“åº“å ubuntu-java</p>\n</blockquote>\n<p>å…¬å…±ä»“åº“æ˜¯å¯ä»¥è¢«æœç´¢å’Œä¸‹è½½çš„ï¼Œæœç´¢ä½¿ç”¨ <code>search</code>  å‘½ä»¤å³å¯ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> search nagocoler/ubuntu-java</pre></td></tr></table></figure><p>å†ä½¿ç”¨ pull å‘½ä»¤ä¸‹è½½ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull nagocoler/ubuntu-java:1.0</pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3Vhbmcvendoa3BpL2txNnJsZw==\">https://www.yuque.com/qingkongxiaguang/zwhkpi/kq6rlg</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2b3BzL2RvY2tlci9kb2NrZXItMDMtYmFzaWMyLmh0bWw=\">https://pdai.tech/md/devops/docker/docker-03-basic2.html</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/21/Docker/Docker(2)-%E9%95%9C%E5%83%8F%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/09/21/Docker/Docker(2)-%E9%95%9C%E5%83%8F%E5%9F%BA%E7%A1%80/",
            "title": "Docker(2)--é•œåƒåŸºç¡€",
            "date_published": "2022-09-21T11:56:42.000Z",
            "content_html": "<h1 id=\"hello-world\"><a class=\"anchor\" href=\"#hello-world\">#</a> hello-world</h1>\n<p>è¦ä½¿ç”¨é‚£äº›å®¹å™¨ï¼Œé¦–å…ˆéœ€è¦æ‹‰å–é•œåƒåˆ°æœ¬åœ°ä»“åº“ï¼Œç„¶åå†è¿è¡Œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ‹‰å– hello-world</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> pull hello-world:latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹æœ¬åœ°ä»“åº“çš„é•œåƒ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> images</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># åœ¨å®¹å™¨ä¸­è¿è¡Œ hello-world å®ä¾‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">(</span>--name<span class=\"token operator\">=</span>XXX<span class=\"token punctuation\">)</span> hello-world</pre></td></tr></table></figure><blockquote>\n<p>æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼š <code>docker pull åç§°:ç‰ˆæœ¬</code> ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚run å‘½ä»¤ hi è‡ªåŠ¨ç»™å®¹å™¨åˆ†é…åç§°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å”¯ä¸€åç§°æŒ‡å®šã€‚</p>\n</blockquote>\n<p>å¦‚æœæ²¡æœ‰è°ƒæ•´ docker çš„é•œåƒæºï¼Œé‚£ä¹ˆ docker å°±æ˜¯ä»<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8=\"> Docker Hub</span> æ‹‰å–çš„é•œåƒåˆ°æœ¬åœ°ä»“åº“ã€‚ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ <code>run</code>  æ¥è¿è¡Œå®ä¾‹ï¼Œå¦‚æœæœ¬åœ°ä»“åº“æ²¡æœ‰è¿™ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šä»è¿œç«¯æ‹‰å–é•œåƒåˆ°ä»“åº“ä¸­ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/6378a12818c5974f.jpg\" alt=\"\" /></p>\n<blockquote>\n<p><code>docker images</code>  çš„ç»“æœæœ‰ä¸€åˆ—æ˜¯ IDï¼Œå¦‚æœå¸Œæœ›åˆ é™¤ä¸€ä¸ªé•œåƒï¼š <code>docker rmi -f  &lt;ID&gt;</code> ã€‚</p>\n</blockquote>\n<p>Docker å…è®¸åœ¨å®¹å™¨å†…è¿è¡Œåº”ç”¨ç¨‹åºï¼š <code>docker run</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run centos:latest /bin/echo <span class=\"token string\">\"Hello world\"</span></pre></td></tr></table></figure><p>å¦‚æœæœ¬åœ°ä»“åº“æ²¡æœ‰ centos çš„é•œåƒï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‹‰å– centos é•œåƒã€‚çœ‹ä¸€ä¸‹å‚æ•°çš„å«ä¹‰ï¼š</p>\n<ul>\n<li>\n<p><code>docker</code> : Docker çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ã€‚</p>\n</li>\n<li>\n<p><code>run</code> : ä¸å‰é¢çš„ docker ç»„åˆæ¥è¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚</p>\n</li>\n<li>\n<p><code>ubuntu:latest</code>  æŒ‡å®šè¦è¿è¡Œçš„é•œåƒï¼ŒDocker é¦–å…ˆä»æœ¬åœ°ä¸»æœºä¸ŠæŸ¥æ‰¾é•œåƒæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼ŒDocker å°±ä¼šä»é•œåƒä»“åº“ Docker Hub ä¸‹è½½å…¬å…±é•œåƒã€‚</p>\n</li>\n<li>\n<p><code>/bin/echo &quot;Hello world&quot;</code> : åœ¨å¯åŠ¨çš„å®¹å™¨é‡Œæ‰§è¡Œçš„å‘½ä»¤</p>\n</li>\n</ul>\n<blockquote>\n<p>åæ§½ï¼šæˆ‘è¿™æ‹‰å– centos é•œåƒæ–‡ä»¶å¥½æ…¢ã€‚ã€‚ã€‚</p>\n</blockquote>\n<p>å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³åˆ›å»ºå®¹å™¨è€Œä¸æ˜¯å»è¿è¡Œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> create hello-world</pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦æŸ¥çœ‹<strong>æ‰€æœ‰å®¹å™¨</strong>ï¼ˆä¸è®ºæ˜¯å¦è¿è¡Œï¼‰</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># linux çš„ ps æ˜¯æŸ¥çœ‹è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># ä¸åŠ  - a å°±åªèƒ½æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-a</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/7bcf577b1cbd289f.jpg\" alt=\"\" /></p>\n<p>æƒ³è¦åœæ­¢æˆ–è€…åˆ é™¤å®¹å™¨ï¼Œå°±éœ€è¦ä½¿ç”¨ ID æˆ–è€… NAMES æ¥æŒ‡å®šå®¹å™¨ï¼Œå…³äºå®¹å™¨çš„ç›¸å…³æ“ä½œï¼š</p>\n<ul>\n<li>\n<p>åˆ é™¤å®¹å™¨ï¼š <code>docker rm &lt;å®¹å™¨å/ID&gt;</code> ã€‚</p>\n</li>\n<li>\n<p>åœæ­¢å®¹å™¨ï¼š <code>docker stop &lt;XXX&gt;</code> ã€‚</p>\n</li>\n<li>\n<p>è¿è¡Œåœæ­¢çš„å®¹å™¨ï¼š <code>docker start &lt;XXX&gt;</code> ã€‚å› ä¸ºæœ‰äº›å®¹å™¨æ˜¯æ‰§è¡Œå®Œåé©¬ä¸Šåœæ­¢ï¼Œè€Œä¸æ˜¯åƒæœåŠ¡å™¨é‚£æ ·é˜»å¡ä»è€Œä¸€ç›´ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚</p>\n</li>\n<li>\n<p>é‡å¯å®¹å™¨ï¼š <code>docker restart &lt;XXX&gt;</code> ã€‚</p>\n</li>\n<li>\n<p>åœæ­¢åè‡ªåŠ¨åˆ é™¤ï¼š <code>docker run --rm &lt;XXX&gt;</code> ã€‚</p>\n</li>\n</ul>\n<p>åœ¨æŒ‡å®š ID æ—¶ï¼Œå¯ä»¥ä¸ç”¨å°† ID å®Œæ•´æ‰“å‡ºæ¥ï¼Œåªè¦å‰é¢ä¸€éƒ¨åˆ†èƒ½å¤Ÿ<strong>å”¯ä¸€æ ‡è¯†</strong>è¯¥å®¹å™¨å³å¯ã€‚</p>\n<blockquote>\n<p>è¯¥éƒ¨åˆ†é€šè¿‡ hello-world çš„ä¾‹å­è®²è§£äº†ä¸€äº›å‘½ä»¤å’Œå®¹å™¨æ“ä½œ</p>\n</blockquote>\n<h1 id=\"é•œåƒç»“æ„\"><a class=\"anchor\" href=\"#é•œåƒç»“æ„\">#</a> é•œåƒç»“æ„</h1>\n<p>å…ˆå›é¡¾ä¸€ä¸‹é•œåƒï¼Œå®¹å™¨ä¸ä»“åº“çš„å…³ç³»ï¼Œè¿™æ˜¯å®˜ç½‘çš„å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/8ef2d678187a6499.jpg\" alt=\"\" /></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨çš„å»ºç«‹ï¼ˆå®ä¾‹åŒ–ï¼‰ä¾èµ–äºé•œåƒï¼Œé¡¹ç›®æ‰“åŒ…éœ€è¦ä¸€ä¸ªåŸºæœ¬çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œè¿™æ ·æ‰èƒ½åœ¨æ“ä½œç³»ç»Ÿä¸­å®‰è£…ä¾èµ–ï¼Œè¿™ç§åŸºæœ¬çš„ç³»ç»Ÿé•œåƒï¼Œå«åš<strong> base é•œåƒ</strong>ã€‚ä¸€èˆ¬ base é•œåƒå°±æ˜¯å„ä¸ª Linux æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¦‚æœä½ æ‰§è¡Œè¿‡ä¸Šé¢çš„ centos çš„ hello world</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å°±ä¸éœ€è¦å†æ‰§è¡Œè¯¥è¯­å¥</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> pull centos</pre></td></tr></table></figure><p>è¿™å°±æ˜¯ centos çš„ base é•œåƒï¼Œ<strong>base é•œåƒçœå»äº†å†…æ ¸</strong>ï¼Œå†…å­˜å¾ˆå°ã€‚<img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/2ccdcf9b038c620c.png\" alt=\"\" /></p>\n<h2 id=\"baseé•œåƒæœºåˆ¶\"><a class=\"anchor\" href=\"#baseé•œåƒæœºåˆ¶\">#</a> base é•œåƒæœºåˆ¶</h2>\n<p><strong>Linux æ“ä½œç³»ç»Ÿ</strong>æœ‰å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ç»„æˆï¼Œè¿™é‡Œéœ€è¦äº†è§£ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼š</p>\n<ul>\n<li>bootfs åŒ…å« BootLoader å’Œ Linux å†…æ ¸ï¼Œåœ¨å†…æ ¸å¯åŠ¨åï¼Œbootfs ä¼šè‡ªåŠ¨å¸è½½ã€‚</li>\n<li>rootfs åŒ…å«ç³»ç»Ÿå¸¸è§ç›®å½•ç»“æ„ï¼ŒåŒ…æ‹¬ <code>/dev</code> ï¼Œ <code>/bin</code>  ç­‰ä»¥åŠä¸€äº›åŸºæœ¬çš„æ–‡ä»¶å’Œå‘½ä»¤ã€‚</li>\n</ul>\n<p><strong>base é•œåƒåº•å±‚ä¼šç›´æ¥ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„å†…æ ¸</strong>ï¼Œè€Œ rootfs å¯ä»¥åœ¨ä¸åŒå®¹å™¨ä¸­è¿è¡Œå¤šç§ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å®é™…ä¸Š base é•œåƒåªåŒ…å« CentOS çš„ rootfsã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># uname æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-r</span></pre></td></tr></table></figure><p>å› æ­¤ï¼ŒDocker èƒ½å¤ŸåŒæ—¶æ¨¡æ‹Ÿå¤šç§ Linux æ“ä½œç³»ç»Ÿç¯å¢ƒã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¯åŠ¨ base é•œåƒ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> centos</pre></td></tr></table></figure><p>å‚æ•° <code>-it</code>  è¿›è¡Œå¯åŠ¨ï¼Œå…¶ä¸­ <code>-i</code>  è¡¨ç¤ºåœ¨å®¹å™¨ä¸Šæ‰“å¼€ä¸€ä¸ªæ ‡å‡†è¾“å…¥ï¼ˆSTDINï¼‰æ¥å£ï¼Œ <code>-t</code>  è¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ª tty è®¾å¤‡ï¼Œå¯ä»¥æ”¯æŒç»ˆç«¯ç™»å½•ï¼ˆç†è§£ä¸ºä¼ªç»ˆç«¯ï¼‰ï¼Œä¸€èˆ¬è¿™ä¸¤ä¸ªæ˜¯ä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™ base å®¹å™¨å¯åŠ¨åå°±è‡ªåŠ¨åœæ­¢äº†ã€‚</p>\n<blockquote>\n<p>ä¸¤ä¸ªåˆèµ·æ¥çš„æ„æ€å°±æ˜¯ä¼šå¼¹å‡ºä¸€ä¸ªå¯ä»¥æ ‡å‡†è¾“å…¥çš„ç»ˆç«¯æç¤ºç¬¦ã€‚</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/e0ad3e663ad0fd3e.jpg\" alt=\"\" /></p>\n<p>ä½¿ç”¨ <code>exit</code>  é€€å‡ºåï¼ˆ<strong>CTRL+D ä¹Ÿå¯ä»¥</strong>ï¼‰ï¼Œå®¹å™¨ä¹Ÿä¼šåœæ­¢ï¼Œå†æ¬¡å¯åŠ¨æ—¶ï¼Œ<strong>éœ€è¦åŠ ä¸Š <code>-i</code>  å‚æ•°æ‰èƒ½è¾“å…¥è¿›è¡Œäº¤äº’ï¼Œå¦åˆ™å°±æ˜¯åå°è¿è¡Œ</strong>ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> start <span class=\"token parameter variable\">-i</span> <span class=\"token operator\">&lt;</span>å®¹å™¨ID<span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"å®‰è£…é•œåƒ\"><a class=\"anchor\" href=\"#å®‰è£…é•œåƒ\">#</a> å®‰è£…é•œåƒ</h2>\n<p>å‰é¢æåˆ°ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªåŸºæœ¬çš„æ“ä½œç³»ç»Ÿï¼ŒåŸºäº base é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™åŸºç¡€ä¸Šå®‰è£…å„ç§è½¯ä»¶ï¼Œä½¿ç”¨åˆ†å±‚ç»“æ„ï¼Œæ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ base é•œåƒä¸Šå åŠ ä¸Šå»ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/21/2600c8683f6fa6f4.jpg\" alt=\"\" /></p>\n<p>** æ‰€æœ‰çš„é•œåƒä¼šå èµ·æ¥ç»„æˆä¸€ä¸ªç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æœä¸åŒå±‚ä¸­å­˜åœ¨ç›¸åŒä½ç½®çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸Šå±‚çš„ä¼šè¦†ç›–æ‰ä¸‹å±‚çš„æ–‡ä»¶ï¼Œæœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå åŠ ä¹‹åçš„æ–‡ä»¶ç³»ç»Ÿã€‚** å½“éœ€è¦ä¿®æ”¹å®¹å™¨ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šå¯¹é•œåƒè¿›è¡Œç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯åœ¨æœ€é¡¶ä¸Šçš„å®¹å™¨å±‚ï¼ˆæœ€ä¸Šé¢ä¸€èˆ¬ç§°ä¸ºå®¹å™¨å±‚ï¼Œä¸‹é¢éƒ½æ˜¯é•œåƒå±‚ï¼‰è¿›è¡Œä¿®æ”¹ã€‚</p>\n<p>å„ä¸ªæ“ä½œå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>\n<p>æ–‡ä»¶è¯»å–ï¼šè¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼ŒDocker ä¼š<strong>æœ€ä¸Šå±‚å¾€ä¸‹</strong>ä¾æ¬¡å¯»æ‰¾ï¼Œæ‰¾åˆ°ååˆ™æ‰“å¼€æ–‡ä»¶ã€‚</p>\n</li>\n<li>\n<p>æ–‡ä»¶åˆ›å»ºå’Œä¿®æ”¹ï¼šåˆ›å»ºæ–°æ–‡ä»¶ä¼šç›´æ¥æ·»åŠ åˆ°å®¹å™¨å±‚ä¸­ï¼Œä¿®æ”¹æ–‡ä»¶ä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡å¯»æ‰¾å„ä¸ªé•œåƒä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°†å…¶å¤åˆ¶åˆ°å®¹å™¨å±‚ï¼Œå†è¿›è¡Œä¿®æ”¹ã€‚</p>\n</li>\n<li>\n<p>åˆ é™¤æ–‡ä»¶ï¼šåˆ é™¤æ–‡ä»¶ä¹Ÿä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡å¯»æ‰¾å„ä¸ªé•œåƒä¸­çš„æ–‡ä»¶ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œå¹¶ä¸ä¼šç›´æ¥åˆ é™¤é•œåƒä¸­çš„æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å®¹å™¨å±‚æ ‡è®°è¿™ä¸ªåˆ é™¤æ“ä½œã€‚</p>\n</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2b3BzL2RvY2tlci9kb2NrZXItMDItYmFzaWMuaHRtbA==\">https://pdai.tech/md/devops/docker/docker-02-basic.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3Vhbmcvendoa3BpL2txNnJsZyNhMzI3ZGRmMg==\">https://www.yuque.com/qingkongxiaguang/zwhkpi/kq6rlg#a327ddf2</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/20/Docker/Docker(1)-%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8/",
            "url": "https://cecilia.cool/2022/09/20/Docker/Docker(1)-%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8/",
            "title": "Docker(1)--å®¹å™¨æŠ€æœ¯å…¥é—¨",
            "date_published": "2022-09-20T03:56:30.000Z",
            "content_html": "<h1 id=\"è™šæ‹ŸåŒ–æŠ€æœ¯\"><a class=\"anchor\" href=\"#è™šæ‹ŸåŒ–æŠ€æœ¯\">#</a> è™šæ‹ŸåŒ–æŠ€æœ¯</h1>\n<p>Virtualization æ˜¯ä¸€ç§èµ„æºç®¡ç†æŠ€æœ¯ï¼Œå°†è®¡ç®—æœºå„ç§å®ä½“èµ„æºï¼ˆæœåŠ¡å™¨ï¼Œå†…å­˜ï¼Œç½‘ç»œï¼‰äºˆä»¥æŠ½è±¡ï¼Œæ‰“ç ´å®ä½“ç»“æ„é—´ä¸å¯åˆ‡å‰²çš„éšœç¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ›´å¥½çš„æ–¹å¼åˆ©ç”¨èµ„æºã€‚ä»è€Œå®ç°åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªç³»ç»Ÿæˆ–åº”ç”¨ã€‚</p>\n<p>è½¯ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯åˆ©ç”¨è½¯ä»¶æŠ€æœ¯ï¼Œåœ¨ç°æœ‰çš„ç‰©ç†å¹³å°ä¸Šå®ç°å¯¹ç‰©ç†å¹³å°è®¿é—®çš„æˆªè·å’Œæ¨¡æ‹Ÿã€‚æœ‰äº›è½¯ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯éœ€è¦ä¾èµ–ç¡¬ä»¶æ”¯æŒï¼Œæ¯”å¦‚ï¼šVMwareï¼ŒKVMã€‚</p>\n<p>Docker å°±æ˜¯è½¯ä»¶è™šæ‹ŸåŒ–ï¼Œè½¯ä»¶è™šæ‹ŸåŒ–åˆ†ä¸ºå¥½å‡ ç±»ï¼ŒDocker å®é™…æ˜¯æ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ–ã€‚<strong>æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–ä¹Ÿè¢«ç§°ä¸ºå®¹å™¨åŒ–</strong>ï¼Œå®ƒå…è®¸å¤šä¸ªç›¸äº’éš”ç¦»çš„ç”¨æˆ·ç©ºé—´å®ä¾‹å­˜åœ¨ï¼Œè¿™äº›ç”¨æˆ·ç©ºé—´å®ä¾‹ä¹Ÿè¢«<strong>å®¹å™¨</strong>ã€‚</p>\n<blockquote>\n<p>æ™®é€šçš„è¿›ç¨‹å¯ä»¥çœ‹åˆ°è®¡ç®—æœºæ‰€æœ‰èµ„æºè€Œå®¹å™¨åªèƒ½çœ‹åˆ°åˆ†é…ç»™è¯¥å®¹å™¨çš„èµ„æº</p>\n</blockquote>\n<p>å®ç°æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–éœ€è¦ç”¨åˆ°<strong> Namespace</strong> åŠ<strong> cgroups</strong> æŠ€æœ¯ã€‚</p>\n<p>å› ä¸ºä¸æ˜¯ä¸»è¦è®²è§£è™šæ‹ŸåŒ–æŠ€æœ¯çš„åº•å±‚å®ç°ï¼Œæ‰€ä»¥è¯¦ç»†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9rZWx2aW54dXB0L2Jsb2cvMTYwMjk5MA==\">æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–æ¦‚è¿°</span>ã€‚</p>\n<h2 id=\"dockerè™šæ‹ŸåŒ–\"><a class=\"anchor\" href=\"#dockerè™šæ‹ŸåŒ–\">#</a> Docker è™šæ‹ŸåŒ–</h2>\n<p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°å®‰è£…äº†ä»»ä½• Linux å‘è¡Œç‰ˆæœ¬çš„æœºå™¨ä¸Šã€‚Docker æ˜¯ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„ä¸€ä¸ªå®¹å™¨ï¼ˆæ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–ï¼‰ï¼Œ<strong>æ‰€æœ‰å®¹å™¨ç”¨çš„éƒ½æ˜¯å®¿ä¸»æ“ä½œç³»ç»Ÿçš„å†…æ ¸</strong>ã€‚</p>\n<p>Docker èƒ½å¿«é€Ÿæ­å»ºå¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”æ¯ä¸ªå®¹å™¨ç›¸äº’éš”ç¦»ï¼šæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›ç¯å¢ƒæ‰“åŒ…æˆé•œåƒï¼Œåˆ°éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ—¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½é•œåƒå®ç°ä¸€é”®éƒ¨ç½²ã€‚</p>\n<h2 id=\"dockerä¸è™šæ‹ŸæœºåŒºåˆ«\"><a class=\"anchor\" href=\"#dockerä¸è™šæ‹ŸæœºåŒºåˆ«\">#</a> Docker ä¸è™šæ‹ŸæœºåŒºåˆ«</h2>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/20/204f57e058964113.jpg\" alt=\"\" /></p>\n<p><strong>è™šæ‹Ÿæœº</strong></p>\n<ul>\n<li>åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰ï¼šä¸ªäººç”µè„‘ï¼ŒæœåŠ¡å™¨ï¼Œäº‘ä¸»æœºã€‚</li>\n<li>ä¸»æ“ä½œç³»ç»Ÿï¼ˆHost Operating Systemï¼‰ï¼šåŸºç¡€è®¾æ–½ä¸Šè¿è¡Œçš„ MacOSï¼ŒWindows æˆ–è€…æŸä¸ª Linux å‘è¡Œç‰ˆã€‚</li>\n<li>è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿï¼ˆHypervisorï¼‰ï¼šåˆ©ç”¨ Hypervisorï¼Œå¯ä»¥åœ¨ä¸»æ“ä½œç³»ç»Ÿä¹‹ä¸Šè¿è¡Œå¤šä¸ªä¸åŒçš„ä»æ“ä½œç³»ç»Ÿã€‚ç±»å‹ 1 çš„ Hypervisor æœ‰æ”¯æŒ MacOS çš„ HyperKitï¼Œæ”¯æŒ Windows çš„ Hyper-V ä»¥åŠæ”¯æŒ Linux çš„ KVMã€‚ç±»å‹ 2 çš„ Hypervisor æœ‰ VirtualBox å’Œ VMWareã€‚</li>\n<li><strong>æ“ä½œç³»ç»Ÿï¼ˆGuest Operating Systemï¼‰</strong>ï¼šå‡è®¾ä½ éœ€è¦è¿è¡Œ 3 ä¸ªç›¸äº’éš”ç¦»çš„åº”ç”¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨ Hypervisor å¯åŠ¨ 3 ä¸ªä»æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ 3 ä¸ªè™šæ‹Ÿæœºã€‚è¿™äº›è™šæ‹Ÿæœºéƒ½éå¸¸å¤§ï¼Œä¹Ÿè®¸æœ‰ 700MBï¼Œè¿™å°±æ„å‘³ç€å®ƒä»¬å°†å ç”¨ 2.1GB çš„ç£ç›˜ç©ºé—´ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒä»¬è¿˜ä¼šæ¶ˆè€—å¾ˆå¤š CPU å’Œå†…å­˜ã€‚</li>\n<li>å„ç§ä¾èµ–ï¼šæ¯ä¸€ä¸ªä»æ“ä½œç³»ç»Ÿéƒ½éœ€è¦å®‰è£…è®¸å¤šä¾èµ–ã€‚å¦‚æœä½ çš„çš„åº”ç”¨éœ€è¦è¿æ¥ PostgreSQL çš„è¯ï¼Œåˆ™éœ€è¦å®‰è£… libpq-devï¼›å¦‚æœä½ ä½¿ç”¨ Ruby çš„è¯ï¼Œåº”è¯¥éœ€è¦å®‰è£… gemsï¼›å¦‚æœä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ Python æˆ–è€… Node.jsï¼Œéƒ½ä¼šéœ€è¦å®‰è£…å¯¹åº”çš„ä¾èµ–åº“ã€‚</li>\n</ul>\n<p><strong>Docker å®¹å™¨</strong></p>\n<ul>\n<li>ä¸»æ“ä½œç³»ç»Ÿï¼ˆHost Operating Systemï¼‰ï¼šæ‰€æœ‰ä¸»æµçš„ Linux å‘è¡Œç‰ˆéƒ½å¯ä»¥è¿è¡Œ Dockerã€‚å¯¹äº MacOS å’Œ Windowsï¼Œä¹Ÿæœ‰ä¸€äº›åŠæ³• &quot;è¿è¡Œ&quot;Dockerã€‚</li>\n<li>Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆDocker Daemonï¼‰ï¼šDocker å®ˆæŠ¤è¿›ç¨‹å–ä»£äº† Hypervisorï¼Œå®ƒæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åå°è¿›ç¨‹ï¼Œ<strong>è´Ÿè´£ç®¡ç† Docker å®¹å™¨</strong>ã€‚</li>\n<li>å„ç§ä¾èµ–ã€‚å¯¹äº Dockerï¼Œ<strong>åº”ç”¨çš„æ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼ŒDocker å®¹å™¨æ˜¯åŸºäº Docker é•œåƒåˆ›å»ºçš„</strong>ã€‚</li>\n<li>åº”ç”¨ã€‚åº”ç”¨çš„æºä»£ç ä¸å®ƒçš„ä¾èµ–éƒ½æ‰“åŒ…åœ¨ Docker é•œåƒä¸­ï¼Œä¸åŒçš„åº”ç”¨éœ€è¦ä¸åŒçš„ Docker é•œåƒã€‚ä¸åŒçš„åº”ç”¨è¿è¡Œåœ¨ä¸åŒçš„ Docker å®¹å™¨ä¸­ï¼Œå®ƒä»¬æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</li>\n</ul>\n<blockquote>\n<p>Docker å®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç›´æ¥ä¸ä¸»æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œä¸ºå„ä¸ª Docker å®¹å™¨åˆ†é…èµ„æºï¼›å®ƒè¿˜å¯ä»¥å°†å®¹å™¨ä¸ä¸»æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨äº’ç›¸éš”ç¦»ã€‚</p>\n</blockquote>\n<h1 id=\"dockeræ¶æ„\"><a class=\"anchor\" href=\"#dockeræ¶æ„\">#</a> Docker æ¶æ„</h1>\n<p>Docker æ˜¯ C/S æ¶æ„ï¼Œé€šè¿‡è¿œç¨‹ API æ¥ç®¡ç†å’Œåˆ›å»ºå®¹å™¨ã€‚</p>\n<p>å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨ Docker SDK å’Œ Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚</p>\n<p>ä¸»æœºï¼šç‰©ç†æˆ–è™šæ‹Ÿæœºå™¨ï¼Œç”¨äºæ‰§è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨ã€‚</p>\n<p>å…¶ä»–çš„åŸºæœ¬æ¦‚å¿µï¼š</p>\n<ul>\n<li>\n<p><strong>é•œåƒï¼ˆImageï¼‰</strong>ï¼šDocker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚</p>\n</li>\n<li>\n<p><strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚</p>\n</li>\n<li>\n<p><strong>ä»“åº“ï¼ˆRepositoryï¼‰</strong>ï¼šä»“åº“å¯çœ‹ç€ä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒã€‚</p>\n</li>\n</ul>\n<h1 id=\"dockerå®‰è£…\"><a class=\"anchor\" href=\"#dockerå®‰è£…\">#</a> Docker å®‰è£…</h1>\n<blockquote>\n<p>æˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ Ubuntu 20.04.3 ç‰ˆæœ¬</p>\n</blockquote>\n<p>å…ˆå®‰è£…ä¸€äº›å·¥å…·</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> ca-certificates <span class=\"token function\">curl</span> gnupg lsb-release</pre></td></tr></table></figure><p>å†å®‰è£…å®˜æ–¹çš„ GPG keyï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /etc/apt/keyrings</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> gpg <span class=\"token parameter variable\">--dearmor</span> <span class=\"token parameter variable\">-o</span> /etc/apt/keyrings/docker.gpg</pre></td></tr></table></figure><p>å°† Docker çš„åº“æ·»åŠ åˆ° apt èµ„æºåˆ—è¡¨ä¸­ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb [arch=<span class=\"token variable\"><span class=\"token variable\">$(</span>dpkg --print-architecture<span class=\"token variable\">)</span></span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu <span class=\"token variable\"><span class=\"token variable\">$(</span>lsb_release <span class=\"token parameter variable\">-cs</span><span class=\"token variable\">)</span></span> stable\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/docker.list <span class=\"token operator\">></span> /dev/null</pre></td></tr></table></figure><p>æ›´æ–° aptï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update</pre></td></tr></table></figure><p>å®‰è£… Docker CE ç‰ˆæœ¬</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> docker-ce</pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…åï¼ŒæŸ¥çœ‹ Docker ç‰ˆæœ¬</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨äº† sudo å‘½ä»¤ï¼ˆå› ä¸ºå½“å‰ç”¨æˆ·ä½¿ç”¨æƒé™å¯èƒ½ä¸è¶³ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å°†å½“å‰ç”¨æˆ·åŠ å…¥åˆ° Docker ç»„é‡Œé¢</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-aG</span> <span class=\"token function\">docker</span> <span class=\"token operator\">&lt;</span>ç”¨æˆ·å<span class=\"token operator\">></span></pre></td></tr></table></figure><p>é€€å‡º ssh ç»ˆç«¯ï¼Œé‡æ–°è¿æ¥å³å¯ç”Ÿæ•ˆã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ Docker è¿™ä¸ªç»„</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿™é‡ŒæŠŠæç¤ºç¬¦éƒ¨åˆ†ä¹Ÿå†™å‡ºæ¥æ˜¯ä¸ºäº†å±•ç¤ºä¸€ä¸‹æˆ‘çš„ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">cat</span> /etc/group</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æœ€åä¸€æ’ï¼šdocker:x:998:cyan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># æˆ‘å·²ç»æ‰§è¡Œè¿‡ usermod å‘½ä»¤äº†ï¼Œæ‰€ä»¥ docker ç»„æœ‰ cyan è¿™ä¸ªç”¨æˆ·</span></pre></td></tr></table></figure><p>å…³äºè¯¦ç»†çš„ Linux ç»„çš„çŸ¥è¯†ï¼Œä½ å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href=\"https://cecilia.cool/2022/07/31/Shell/Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/\">Linux æ–‡ä»¶æƒé™</a>ã€‚</p>\n<blockquote>\n<p>å¦‚æœåŠ å…¥ç»„åæƒé™ä¾ç„¶ä¸å¤Ÿï¼Œæ‰§è¡Œï¼š <code>newgrp docker</code> ã€‚newgrp å‘½ä»¤æ˜¯ç™»å…¥ç¾¤ç»„ã€‚</p>\n</blockquote>\n<p>å‰æ–‡æåˆ° Docker æ¶æ„ï¼ˆC/Sï¼‰ï¼Œç°åœ¨éƒ¨ç½² Nginx æœåŠ¡å™¨</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 nginx</pre></td></tr></table></figure><p>ä¼šä»é•œåƒä»“åº“é‡Œé¢ä¸‹è½½å¯¹åº”çš„é•œåƒï¼Œä¸‹è½½å®Œæˆåå°±åœ¨åå°è¿è¡Œäº†</p>\n<blockquote>\n<p>åœ¨æµè§ˆå™¨çš„ url ä¸­è¾“å…¥è™šæ‹Ÿæœº IPï¼Œå°±èƒ½çœ‹åˆ° Nginx å¯åŠ¨äº†</p>\n</blockquote>\n<p>è¯¥å‘½ä»¤æµç¨‹ï¼š</p>\n<ol>\n<li>Docker å®¢æˆ·ç«¯å°†æ“ä½œå‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘Šè¯‰æœåŠ¡ç«¯æˆ‘ä»¬è¦è¿è¡Œ nginx è¿™ä¸ªé•œåƒã€‚</li>\n<li>Docker æœåŠ¡ç«¯å…ˆçœ‹çœ‹æœ¬åœ°æœ‰æ²¡æœ‰è¿™ä¸ªé•œåƒï¼Œå‘ç°æ²¡æœ‰ã€‚</li>\n<li>æ¥ç€åªèƒ½ä»å…¬å…±ä»“åº“ Docker Hub å»æŸ¥æ‰¾ä¸‹è½½é•œåƒäº†ã€‚</li>\n<li>ä¸‹è½½å®Œæˆï¼Œé•œåƒæˆåŠŸä¿å­˜åˆ°æœ¬åœ°ã€‚</li>\n<li>Docker<strong> æœåŠ¡ç«¯åŠ è½½ Nginx é•œåƒ</strong>ï¼Œå¯åŠ¨å®¹å™¨å¼€å§‹æ­£å¸¸è¿è¡Œã€‚</li>\n</ol>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2b3BzL2RvY2tlci9kb2NrZXItMDEtZG9ja2VyLXZtLmh0bWw=\">https://pdai.tech/md/devops/docker/docker-01-docker-vm.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3Vhbmcvendoa3BpL2txNnJsZw==\">https://www.yuque.com/qingkongxiaguang/zwhkpi/kq6rlg</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9rZWx2aW54dXB0L2Jsb2cvMTYwMjk5MA==\">https://my.oschina.net/kelvinxupt/blog/1602990</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vamllLWZhbmcvcC8xMDI3OTYyOS5odG1s\">https://www.cnblogs.com/jie-fang/p/10279629.html</span></p>\n</blockquote>\n",
            "tags": [
                "Docker"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/19/%E4%BA%91%E8%AE%A1%E7%AE%97/%E4%BA%91%E8%AE%A1%E7%AE%97%E4%BD%9C%E4%B8%9A/",
            "url": "https://cecilia.cool/2022/09/19/%E4%BA%91%E8%AE%A1%E7%AE%97/%E4%BA%91%E8%AE%A1%E7%AE%97%E4%BD%9C%E4%B8%9A/",
            "title": "äº‘è®¡ç®—ä½œä¸š",
            "date_published": "2022-09-19T07:30:33.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ç”¨ MapReduce å®ç° wordCountï¼ˆå•è¯è®¡æ•°ï¼‰</p>\n<blockquote>\n<p>è½¯ä»¶ 2004-20207127 äº‘è®¡ç®—ä½œä¸š</p>\n</blockquote>\n<h1 id=\"ç›¸å…³ç±»\"><a class=\"anchor\" href=\"#ç›¸å…³ç±»\">#</a> ç›¸å…³ç±»</h1>\n<h2 id=\"wordcountmapper\"><a class=\"anchor\" href=\"#wordcountmapper\">#</a> WordCountMapper</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>example</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IntWritable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LongWritable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>mapreduce<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mapper</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WordCountMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Mapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LongWritable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Text</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LongWritable</span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Text</span> value<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">String</span> line<span class=\"token operator\">=</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> words<span class=\"token operator\">=</span>line<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> word <span class=\"token operator\">:</span> words<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            context<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"wordcountreduce\"><a class=\"anchor\" href=\"#wordcountreduce\">#</a> WordCountReduce</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>example</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IntWritable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>mapreduce<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Reducer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WordCountReduce</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Reducer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Text</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Text</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Text</span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Iterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">></span></span> values<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Context</span> context<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">int</span> total<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntWritable</span> value <span class=\"token operator\">:</span> values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            total<span class=\"token operator\">+=</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        context<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">(</span>total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"wordcountmain\"><a class=\"anchor\" href=\"#wordcountmain\">#</a> WordCountMain</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>example</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>fs<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Path</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IntWritable</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Text</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>mapreduce<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Job</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>mapreduce<span class=\"token punctuation\">.</span>lib<span class=\"token punctuation\">.</span>input<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileInputFormat</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>hadoop<span class=\"token punctuation\">.</span>mapreduce<span class=\"token punctuation\">.</span>lib<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileOutputFormat</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WordCountMain</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">//1. å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Configuration</span> cfg<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Job</span> job<span class=\"token operator\">=</span><span class=\"token class-name\">Job</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span>cfg<span class=\"token punctuation\">,</span><span class=\"token string\">\"wc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setJarByClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WordCountMain</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">//2. æŒ‡å®š mapper å’Œ reduce</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setMapperClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WordCountMapper</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setReducerClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WordCountReduce</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// æŒ‡å®š mapper è¾“å‡ºç±»å‹</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setMapOutputKeyClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Text</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setMapOutputValueClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// æŒ‡å®š reduce è¾“å‡ºç±»å‹</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setOutputKeyClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Text</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        job<span class=\"token punctuation\">.</span><span class=\"token function\">setMapOutputValueClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntWritable</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// æŒ‡å®šè¾“å‡ºè·¯å¾„</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">FileInputFormat</span><span class=\"token punctuation\">.</span><span class=\"token function\">setInputPaths</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"S:/test/data.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">FileOutputFormat</span><span class=\"token punctuation\">.</span><span class=\"token function\">setOutputPath</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"S:/test/M\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">//3. è¿è¡Œ</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">boolean</span> result<span class=\"token operator\">=</span>job<span class=\"token punctuation\">.</span><span class=\"token function\">waitForCompletion</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>result<span class=\"token operator\">?</span><span class=\"token string\">\"æˆåŠŸ\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span>result<span class=\"token operator\">?</span><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"è¿è¡Œç»“æœ\"><a class=\"anchor\" href=\"#è¿è¡Œç»“æœ\">#</a> è¿è¡Œç»“æœ</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/19/fc49e140e301e8d5.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "äº‘è®¡ç®—"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/15/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(5)-Http%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/",
            "url": "https://cecilia.cool/2022/09/15/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(5)-Http%E5%8D%8F%E8%AE%AE%E9%80%9A%E4%BF%A1/",
            "title": "Nettyæ¡†æ¶(5)--Httpåè®®é€šä¿¡",
            "date_published": "2022-09-15T03:07:20.000Z",
            "content_html": "<h1 id=\"é€šä¿¡åè®®è®¾è®¡\"><a class=\"anchor\" href=\"#é€šä¿¡åè®®è®¾è®¡\">#</a> é€šä¿¡åè®®è®¾è®¡</h1>\n<p>åœ¨ TCP ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„æ•°æ®åŒ…æ ¼å¼éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå‘é€æ–¹å°†å¯¹è±¡è½¬åŒ–æˆäºŒè¿›åˆ¶æµå‘é€ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹è·å¾—<strong>äºŒè¿›åˆ¶æ•°æ®</strong>åéœ€è¦çŸ¥é“å¦‚ä½•è§£ææˆå¯¹è±¡ã€‚</p>\n<p>ä¸€ä¸ªå®Œå¤‡çš„ç½‘ç»œåè®®éœ€è¦å…·å¤‡ä»¥ä¸‹åŸºæœ¬è¦ç´ </p>\n<h2 id=\"é­”æ•°\"><a class=\"anchor\" href=\"#é­”æ•°\">#</a> é­”æ•°</h2>\n<p>ä½œç”¨æ˜¯é˜²æ­¢ä»»ä½•äººéšä¾¿å‘æœåŠ¡å™¨ç«¯å£å‘é€æ•°æ®ã€‚æœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®æ—¶ä¼šè§£æå‡ºå‰å‡ ä¸ªå›ºå®šå­—èŠ‚çš„é­”æ•°åšå¯¹æ¯”ï¼Œå¦‚æœå’Œçº¦å®šçš„é­”æ•°ä¸åŒ¹é…ï¼Œå°±ä¼šè®¤ä¸ºæ˜¯éæ³•æ•°æ®ã€‚</p>\n<p>é­”æ•°çš„æ€æƒ³åœ¨å‹ç¼©ç®—æ³•ï¼ŒJava Class æ–‡ä»¶å°±æœ‰é­”æ•° <code>0XCAFFBABE</code> ï¼Œè°ƒä¾ƒä¸ºå’–å•¡å®è´ï¼Œåœ¨åŠ è½½ Class æ–‡ä»¶æ—¶å°±ä¼šé¦–å…ˆéªŒè¯é­”æ•°çš„æ­£ç¡®æ€§ã€‚</p>\n<h2 id=\"åºåˆ—åŒ–ç®—æ³•\"><a class=\"anchor\" href=\"#åºåˆ—åŒ–ç®—æ³•\">#</a> åºåˆ—åŒ–ç®—æ³•</h2>\n<p>åºåˆ—åŒ–ç®—æ³•è¡¨ç¤ºæ•°æ®å‘é€æ–¹åº”è¯¥ç”¨ä½•ç§æ–¹æ³•å°†è¯·æ±‚çš„å¯¹è±¡è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œä»¥åŠå¦‚ä½•å°†äºŒè¿›åˆ¶è½¬åŒ–ä¸ºå¯¹è±¡ç­‰ï¼Œå¦‚ JSONï¼ŒHessianï¼ŒJava è‡ªå¸¦åºåˆ—åŒ–ç­‰ã€‚</p>\n<blockquote>\n<p>å¯ä»¥ä» Http åè®®ä¸­çœ‹å‡ºï¼Œå®Œæ•´çš„ç½‘ç»œåè®®è¿˜éœ€è¦é•¿åº¦åŸŸå­—æ®µï¼Œè¯·æ±‚æ•°æ®ï¼ŒçŠ¶æ€ï¼Œä¿ç•™å­—æ®µï¼ŒæŠ¥æ–‡ç±»å‹ï¼Œåè®®ç‰ˆæœ¬å·ç­‰ã€‚</p>\n</blockquote>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">+</span><span class=\"token comment\">---------------------------------------------------------------+</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">|</span> é­”æ•° <span class=\"token number\">2</span>byte <span class=\"token operator\">|</span> åè®®ç‰ˆæœ¬å· <span class=\"token number\">1</span>byte <span class=\"token operator\">|</span> åºåˆ—åŒ–ç®—æ³• <span class=\"token number\">1</span>byte <span class=\"token operator\">|</span> æŠ¥æ–‡ç±»å‹ <span class=\"token number\">1</span>byte  <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">+</span><span class=\"token comment\">---------------------------------------------------------------+</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">|</span> çŠ¶æ€ <span class=\"token number\">1</span>byte <span class=\"token operator\">|</span>        ä¿ç•™å­—æ®µ <span class=\"token number\">4</span>byte     <span class=\"token operator\">|</span>      æ•°æ®é•¿åº¦ <span class=\"token number\">4</span>byte     <span class=\"token operator\">|</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">+</span><span class=\"token comment\">---------------------------------------------------------------+</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">|</span>                   æ•°æ®å†…å®¹ ï¼ˆé•¿åº¦ä¸å®šï¼‰                          <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">+</span><span class=\"token comment\">---------------------------------------------------------------+</span></pre></td></tr></table></figure><h1 id=\"å®ç°httpåè®®é€šä¿¡\"><a class=\"anchor\" href=\"#å®ç°httpåè®®é€šä¿¡\">#</a> å®ç° Http åè®®é€šä¿¡</h1>\n<p>éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬ä¸Šä¸€ç¯‡è®²åˆ°çš„è§£ç å™¨å’Œç¼–ç å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequestDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">//Http è¯·æ±‚è§£ç å™¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token comment\">// çœ‹çœ‹æ˜¯ä¸ªå•¥ç±»å‹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>              \t<span class=\"token comment\">// æ”¶åˆ°æµè§ˆå™¨è¯·æ±‚åï¼Œæˆ‘ä»¬éœ€è¦ç»™ä¸€ä¸ªå“åº”å›å»</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">//HTTP ç‰ˆæœ¬ä¸º 1.1ï¼ŒçŠ¶æ€ç å°± OKï¼ˆ200ï¼‰å³å¯</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">FullHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token class-name\">DefaultFullHttpResponse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpVersion</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HTTP_1_1</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                                            <span class=\"token class-name\">HttpResponseStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>              \t<span class=\"token comment\">// ç›´æ¥å‘å“åº”å†…å®¹ä¸­å†™å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                response<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                                                     <span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// å‘é€å“åº”</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//HTTP è¯·æ±‚æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ‰€ä»¥è®°å¾—å…³é—­</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpResponseEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// å“åº”è®°å¾—ä¹Ÿè¦ç¼–ç åå‘é€å“¦</span></pre></td></tr></table></figure><p>ç”¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/15/baca09d46ab8eb8c.jpg\" alt=\"\" /></p>\n<p>æ§åˆ¶å°æ‰“å°çš„ç±»å‹ä¸ºï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">class<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>handler<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span>DefaultHttpRequest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">class<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>neety<span class=\"token punctuation\">.</span>handler<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span>LastHttpContent</span>$<span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">class<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>handler<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span>DefaultHttpRequest</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\"><span class=\"token namespace\">class<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>neety<span class=\"token punctuation\">.</span>handler<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span>LastHttpContent</span>$<span class=\"token number\">1</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸€æ¬¡è¯·æ±‚æ˜¯ä¸€ä¸ª <code>DefaultHttpRequest</code> + <code>LastHttpContent$1</code> ï¼Œè¿™é‡Œæœ‰ä¸¤ç»„æ˜¯å› ä¸ºæµè§ˆå™¨è¯·æ±‚äº†ä¸€ä¸ªåœ°å€åç´§æ¥ç€åˆè¯·æ±‚äº†ç½‘ç«™çš„ favicon å›¾æ ‡ã€‚</p>\n<p>å¦‚æœä¸å¸Œæœ›ä¸€æ¬¡è¯·æ±‚è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªï¼Œå¯ä»¥åœ¨ <code>HttpRequestDecoder</code>  åé¢åŠ ä¸Šèšåˆå™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å°†å†…å®¹èšåˆä¸ºä¸€ä¸ª FullHttpRequestï¼Œå‚æ•°æ˜¯æœ€å¤§å†…å®¹é•¿åº¦</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpObjectAggregator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ”¹ä¸€ä¸‹ channelRead é‡Œçš„å†…å®¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">FullHttpRequest</span> request <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FullHttpRequest</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æµè§ˆå™¨è¯·æ±‚è·¯å¾„ï¼š\"</span><span class=\"token operator\">+</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ç›´æ¥è·å–è¯·æ±‚ç›¸å…³ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">FullHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultFullHttpResponse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpVersion</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HTTP_1_1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                                            <span class=\"token class-name\">HttpResponseStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    response<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// æµè§ˆå™¨æ€»å…±å‘é€äº†ä¸¤æ¬¡è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// æµè§ˆå™¨è¯·æ±‚è·¯å¾„ï¼š/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// æµè§ˆå™¨è¯·æ±‚è·¯å¾„ï¼š/favicon.ico</span></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ˜¯è¯·æ±‚æœåŠ¡å™¨ç½‘é¡µèµ„æºï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªè§£æå™¨ï¼ˆæœ¬è´¨å°±æ˜¯é€šè¿‡è¯·æ±‚è·¯å¾„æ‹¿åˆ°ç›¸å…³èµ„æºï¼‰</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PageResolver</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t<span class=\"token comment\">// ç›´æ¥å•ä¾‹æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PageResolver</span> <span class=\"token constant\">INSTANCE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PageResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">PageResolver</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">INSTANCE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  \t<span class=\"token comment\">// è¯·æ±‚è·¯å¾„ç»™è¿›æ¥ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†é¡µé¢æ‹¿åˆ°ï¼Œç„¶åè½¬æ¢æˆå“åº”æ•°æ®åŒ…å‘å›å»</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FullHttpResponse</span> <span class=\"token function\">resolveResource</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯æ­£å¸¸çš„è·¯å¾„è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>             <span class=\"token comment\">// å¦‚æœæ˜¯ç›´æ¥è¯·æ±‚æ ¹è·¯å¾„ï¼Œé‚£å°±é»˜è®¤è¿”å› index é¡µé¢ï¼Œå¦åˆ™å°±è¯¥è¿”å›ä»€ä¹ˆè·¯å¾„çš„æ–‡ä»¶å°±è¿”å›ä»€ä¹ˆ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            path <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"index.html\"</span> <span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InputStream</span> stream <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>stream <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// æ‹¿åˆ°æ–‡ä»¶è¾“å…¥æµä¹‹åï¼Œæ‰å¯ä»¥è¿”å›é¡µé¢</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>stream<span class=\"token punctuation\">.</span><span class=\"token function\">available</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    stream<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">packet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpResponseStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">,</span> bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                    <span class=\"token comment\">// æ•°æ®å…ˆè¯»å‡ºæ¥ï¼Œç„¶åäº¤ç»™ä¸‹é¢çš„æ–¹æ³•æ‰“åŒ…</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      \t<span class=\"token comment\">// å…¶ä»–æƒ…å†µä¸€å¾‹è¿”å› 404</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">packet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpResponseStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NOT_FOUND</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                           <span class=\"token string\">\"404 Not Found!\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  \t<span class=\"token comment\">// åŒ…è£…æˆ FullHttpResponseï¼ŒæŠŠçŠ¶æ€ç å’Œæ•°æ®å†™è¿›å»</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">FullHttpResponse</span> <span class=\"token function\">packet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpResponseStatus</span> status<span class=\"token punctuation\">,</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">FullHttpResponse</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">DefaultFullHttpResponse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpVersion</span><span class=\"token punctuation\">.</span><span class=\"token constant\">HTTP_1_1</span><span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        response<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeBytes</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>channelRead</code>  æ–¹æ³•ä¸­ä½¿ç”¨è¯¥ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">FullHttpRequest</span> request <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FullHttpRequest</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// è¯·æ±‚è¿›æ¥äº†ç›´æ¥èµ°è§£æ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">PageResolver</span> resolver <span class=\"token operator\">=</span> <span class=\"token class-name\">PageResolver</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolveResource</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å…¶ä»–å†…ç½®handler\"><a class=\"anchor\" href=\"#å…¶ä»–å†…ç½®handler\">#</a> å…¶ä»–å†…ç½® Handler</h1>\n<p>Netty å†…ç½®äº†å…¶ä»–å¾ˆæœ‰ç”¨çš„ Handlerï¼Œæ¯”å¦‚æ—¥å¿—æ‰“å°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequestDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpObjectAggregator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoggingHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LogLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INFO</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \t<span class=\"token comment\">// æ·»åŠ ä¸€ä¸ªæ—¥å¿— Handlerï¼Œåœ¨è¯·æ±‚åˆ°æ¥æ—¶ä¼šè‡ªåŠ¨æ‰“å°ç›¸å…³æ—¥å¿—</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure><p>æ¯æ¬¡è¯·æ±‚çš„å†…å®¹å’Œè¯¦ç»†ä¿¡æ¯éƒ½ä¼šåœ¨æ—¥å¿—ä¸­å‡ºç°ï¼ŒåŒ…æ‹¬è¯¦ç»†çš„æ•°æ®åŒ…è§£æè¿‡ç¨‹ï¼Œè¯·æ±‚å¤´ä¿¡æ¯éƒ½æ˜¯å®Œæ•´åœ°æ‰“å°åœ¨æ§åˆ¶å°ä¸Šçš„ã€‚</p>\n<p>è¿˜å¯ä»¥ä½¿ç”¨ Handler å¯¹ IP åœ°å€è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸å¸Œæœ›æŸäº› IP åœ°å€è¿æ¥æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequestDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpObjectAggregator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RuleBasedIpFilter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IpFilterRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">matches</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InetSocketAddress</span> inetSocketAddress<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>inetSocketAddress<span class=\"token punctuation\">.</span><span class=\"token function\">getHostName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>              \t<span class=\"token comment\">// è¿›è¡ŒåŒ¹é…ï¼Œè¿”å› false è¡¨ç¤ºåŒ¹é…å¤±è´¥</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>              \t<span class=\"token comment\">// å¦‚æœåŒ¹é…å¤±è´¥ï¼Œé‚£ä¹ˆä¼šæ ¹æ®ä¸‹é¢çš„ç±»å‹å†³å®šè¯¥å¹²ä»€ä¹ˆï¼Œ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">// æ¯”å¦‚è¿™é‡Œåˆ¤æ–­æ˜¯ä¸æ˜¯æœ¬åœ°è®¿é—®çš„ï¼Œå¦‚æœæ˜¯é‚£å°±æ‹’ç»</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">IpFilterRuleType</span> <span class=\"token function\">ruleType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">IpFilterRuleType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REJECT</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token comment\">// ç±»å‹ï¼ŒREJECT è¡¨ç¤ºæ‹’ç»è¿æ¥ï¼ŒACCEPT è¡¨ç¤ºå…è®¸è¿æ¥</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>IdleStateHandler</code>  å¯ä»¥å¯¹ç©ºé—²çš„è¿æ¥è¿›è¡Œå¤„ç†ï¼ˆidle-- é—²ç½®çš„ï¼‰</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IdleStateHandler</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// ä¾¦æµ‹è¿æ¥ç©ºé—²çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¿æ¥å¤šå°‘ç§’æ²¡æœ‰è¯»æ“ä½œæ—¶è§¦å‘äº‹ä»¶ï¼Œç¬¬äºŒä¸ªæ˜¯å†™æ“ä½œï¼Œ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \t<span class=\"token comment\">// ç¬¬ä¸‰ä¸ªæ˜¯è¯»å†™æ“ä½œéƒ½ç®—ï¼Œ0 è¡¨ç¤ºç¦ç”¨</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// äº‹ä»¶éœ€è¦åœ¨ ChannelInboundHandlerAdapter ä¸­è¿›è¡Œç›‘å¬å¤„ç†</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">userEventTriggered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> evt<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token comment\">// è¿™ä¸ªæ–¹æ³•åŸæ¥æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ç”¨çš„</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>evt <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">IdleStateEvent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token class-name\">IdleStateEvent</span> event <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IdleStateEvent</span><span class=\"token punctuation\">)</span> evt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">IdleState</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WRITER_IDLE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é•¿æ—¶é—´æ²¡æœ‰å†™æ“ä½œ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">IdleState</span><span class=\"token punctuation\">.</span><span class=\"token constant\">READER_IDLE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é•¿æ—¶é—´æ²¡æœ‰è¯»æ“ä½œ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5saWFuZ2xpYW5nbGVlLmNvbS8lRTQlQjglOTMlRTYlQTAlOEYvTmV0dHklMjAlRTYlQTAlQjglRTUlQkYlODMlRTUlOEUlOUYlRTclOTAlODYlRTUlODklOTYlRTYlOUUlOTAlRTQlQjglOEUlMjBSUEMlMjAlRTUlQUUlOUUlRTglQjclQjUtJUU1JUFFJThDLzA3JTIwJTIwJUU2JThFJUE1JUU1JUE0JUI0JUU2JTlBJTk3JUU4JUFGJUFEJUVGJUJDJTlBJUU1JUE2JTgyJUU0JUJEJTk1JUU1JTg4JUE5JUU3JTk0JUE4JTIwTmV0dHklMjAlRTUlQUUlOUUlRTclOEUlQjAlRTglODclQUElRTUlQUUlOUElRTQlQjklODklRTUlOEQlOEYlRTglQUUlQUUlRTklODAlOUElRTQlQkYlQTElRUYlQkMlOUYubWQ=\">åˆ©ç”¨ Netty å®ç°è‡ªå®šä¹‰åè®®é€šä¿¡</span></p>\n<p>è¯­é›€ãƒ»é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2lieDZ1ZyMzNzY1MzU4OA==\">https://www.yuque.com/qingkongxiaguang/javase/ibx6ug#37653588</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/14/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(4)-%E7%BC%96%E7%A0%81%E5%99%A8%E4%B8%8E%E8%A7%A3%E7%A0%81%E5%99%A8/",
            "url": "https://cecilia.cool/2022/09/14/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(4)-%E7%BC%96%E7%A0%81%E5%99%A8%E4%B8%8E%E8%A7%A3%E7%A0%81%E5%99%A8/",
            "title": "Netty(4)--ç¼–ç å™¨ä¸è§£ç å™¨",
            "date_published": "2022-09-14T01:22:06.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ç¼–è§£ç å™¨åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè§£ç å™¨è´Ÿè´£å…¥ç«™ï¼ˆå¯ä»¥ç†è§£ä¸ºå°†å­—èŠ‚æµè½¬ä¸ºåŸæ¥çš„æ ¼å¼ï¼‰ï¼›ç¼–ç å™¨è´Ÿè´£å‡ºç«™ã€‚</p>\n<ul>\n<li>è§£ç å™¨è´Ÿè´£å…¥ç«™æ“ä½œï¼Œéœ€è¦å®ç° <code>ChannelInboundHandler</code>  æ¥å£ï¼Œè§£ç å™¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯ <code>ChannelInboundHandler</code> ã€‚</li>\n<li>ç¼–ç å™¨è´Ÿè´£å‡ºç«™æ“ä½œï¼Œéœ€è¦å®ç° <code>ChannelOutboundhandler</code>  æ¥å£ï¼Œç¼–ç å™¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯ <code>ChannelOutboundHandler</code> ã€‚</li>\n</ul>\n<h1 id=\"è§£ç å™¨\"><a class=\"anchor\" href=\"#è§£ç å™¨\">#</a> è§£ç å™¨</h1>\n<p>Netty æä¾›äº†ä¸€äº›å¸¸ç”¨çš„<strong>è§£ç å™¨</strong>ï¼Œä»–ä»¬éƒ½ç»§æ‰¿äº† <code>ByteToMessageDecoder</code>  ç±» ï¼š</p>\n<ul>\n<li><code>RedisDecoder</code>  åŸºäº Redis åè®®çš„è§£ç å™¨ã€‚</li>\n<li><code>XmlDecoder</code>  åŸºäº XML æ ¼å¼çš„è§£ç å™¨ã€‚</li>\n<li><code>JosnObjectDecoder</code>  åŸºäº json æ•°æ®æ ¼å¼çš„è§£ç å™¨</li>\n<li><code>HttpObjectDecoder</code> : åŸºäº http åè®®çš„è§£ç å™¨</li>\n</ul>\n<p>Netty ä¹Ÿæä¾›äº† <code>MessageToMeMessageDecoder</code> ï¼Œå°†ä¸€ç§æ ¼å¼è½¬åŒ–ä¸ºå¦ä¸€ç§æ ¼å¼çš„è§£ç å™¨ã€‚ä¸‹é¢çš„ç±»éƒ½ç»§æ‰¿äº†è¯¥æŠ½è±¡ç±»ã€‚</p>\n<ul>\n<li><code>StringDecoder</code>  å°†æ¥æ”¶åˆ° <code>ByteBuf</code>  è½¬åŒ–å­—ç¬¦ä¸²</li>\n<li><code>ByteArrayDecoder</code>  å°†æ¥æ”¶åˆ° <code>ByteBuf</code>  è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„</li>\n<li><code>Base64Decoder</code>  å°†ç”± <code>ByteBuf</code>  æˆ– <code>US-ASCII</code>  å­—ç¬¦ä¸²ç¼–ç çš„ Base64 è§£ç ä¸º <code>ByteBuf</code> ã€‚</li>\n</ul>\n<p>è§£ç å™¨æœ¬è´¨å°±æ˜¯ <code>ChannelInboundHandler</code>  æ¥å£ï¼Œæ‰€ä»¥ä¸Šé¢æ‰€æœ‰çš„ç±»å…¶å®éƒ½æ˜¯å®ç°äº†è¯¥æ¥å£ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬åœ¨æµæ°´çº¿ä¸Šå°±å¯ä»¥ç›´æ¥å°†è§£ç å™¨ï¼ˆç¼–ç å™¨ä¹Ÿæ˜¯ï¼‰å½“æˆ <code>ChannelHandler</code>  æ¥ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token comment\">// è§£ç å™¨æœ¬è´¨ä¸Šä¹Ÿç®—æ˜¯ä¸€ç§ ChannelInboundHandlerAdapterï¼Œç”¨äºå¤„ç†å…¥ç«™è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token comment\">// ç»è¿‡ StringDecoder è½¬æ¢åï¼Œmsg ç›´æ¥å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ‰“å°å°±è¡Œäº†</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ <code>StringDecoder</code>  ç±»å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/14/c48d5bdb8a78fd87.jpg\" alt=\"\" /></p>\n<p>è¦ä½¿ç”¨è‡ªå®šä¹‰çš„è§£ç å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿ <code>MessageToMeMessage</code>  ç±»ï¼Œé‡å†™ <code>decode</code>  æ–¹æ³•å³å¯ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestDecoder</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MessageToMessageDecoder</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> channelHandlerContext<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                          <span class=\"token class-name\">ByteBuf</span> buf<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®å·²æ”¶åˆ°ï¼Œæ­£åœ¨è¿›è¡Œè§£ç ...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ç›´æ¥è½¬æ¢ä¸º UTF8 å­—ç¬¦ä¸²</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// è§£ç åéœ€è¦å°†è§£æåçš„æ•°æ®ä¸¢è¿› List ä¸­ï¼Œå¦‚æœä¸¢è¿›å»å¤šä¸ªæ•°æ®ï¼Œ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ç›¸å½“äºæ•°æ®è¢«åˆ†æˆäº†å¤šä¸ªï¼Œåé¢çš„ Handler å°±éœ€è¦æ¯ä¸ªéƒ½å¤„ç†ä¸€æ¬¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ç¼–ç å™¨\"><a class=\"anchor\" href=\"#ç¼–ç å™¨\">#</a> ç¼–ç å™¨</h1>\n<p>Netty æä¾›äº†ä¸€äº›å¸¸ç”¨<strong>ç¼–ç å™¨</strong>ç±»å‹ï¼Œå®ƒä»¬ç»§æ‰¿äº† <code>MessageToByteEncoder</code>  ç±»ï¼š</p>\n<ul>\n<li><code>ObjectEncoder</code> ï¼šå¯¹è±¡ï¼ˆéœ€è¦å®ç° <code>Serializable</code>  æ¥å£ï¼‰ç¼–ç æˆå­—èŠ‚æµã€‚</li>\n<li><code>SocketMessageEncoder</code> ï¼šå°† <code>SocketMessage</code>  ç¼–ç ä¸ºå­—èŠ‚æµã€‚</li>\n<li><code>HAProxyMessageEncoder</code> ï¼šå°† <code>HAProxyMessage</code>  ç¼–ç æˆå­—èŠ‚æµã€‚</li>\n</ul>\n<p>Netty ä¹Ÿæä¾›äº† <code>MessageToMessageEncoder</code> ï¼Œå°†ä¸€ç§æ ¼å¼è½¬åŒ–ä¸ºå¦ä¸€ç§æ ¼å¼çš„ç¼–ç å™¨ï¼Œä¸‹é¢ç±»éƒ½æ˜¯ç»§æ‰¿æ­¤ç±»ï¼š</p>\n<ul>\n<li><code>RedisEncoder</code> ï¼šå°† Redis åè®®çš„å¯¹è±¡è¿›è¡Œç¼–ç ã€‚</li>\n<li><code>StringEncoder</code> ï¼šå°†å­—ç¬¦ä¸²è¿›è¡Œç¼–ç æ“ä½œã€‚</li>\n<li><code>Base64Encoder</code> ï¼šå°† Base64 å­—ç¬¦ä¸²è¿›è¡Œç¼–ç æ“ä½œã€‚</li>\n</ul>\n<p>æˆ‘ä»¬ç¼–å†™ä¸€ä¸‹å®¢æˆ·ç«¯çš„ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Bootstrap</span> bootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> socketChannel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                        socketChannel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è§£ç å™¨</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                                    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> channelHandlerContext<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                                                            <span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\">> æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span> <span class=\"token operator\">+</span> o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                                <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Scanner</span> in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;&lt; è¯·è¾“å…¥è¦å‘é€ç»™æœåŠ¡ç«¯çš„å†…å®¹ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                channel<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ç›´æ¥å‘é€å­—ç¬¦ä¸²å°±è¡Œ</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯æ–­å¼€è¿æ¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ç¼–è§£ç å™¨\"><a class=\"anchor\" href=\"#ç¼–è§£ç å™¨\">#</a> ç¼–è§£ç å™¨</h1>\n<p>å®ƒæ˜¯æ—¢ç»§æ‰¿äº† <code>ChannelInboundHandlerAdapter</code>  ä¹Ÿå®ç°äº† <code>ChannelOutboundHandler</code>  æ¥å£ï¼Œåˆèƒ½å¤„ç†å‡ºç«™ä¹Ÿèƒ½å¤„ç†å…¥ç«™è¯·æ±‚ï¼Œå®é™…ä¸Šå°±æ˜¯å°†ä¹‹å‰çš„ç»™ç»„åˆåˆ°ä¸€èµ·äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªç¼åˆåœ¨ä¸€èµ·çš„ <code>StringCodec</code>  ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// éœ€è¦æŒ‡å®šä¸¤ä¸ªæ³›å‹ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…¥ç«™çš„æ¶ˆæ¯ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å‡ºç«™çš„æ¶ˆæ¯ç±»å‹ï¼Œå‡ºç«™æ˜¯ String ç±»å‹ï¼Œæˆ‘ä»¬è¦è½¬æˆ ByteBuf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StringCodec</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MessageToMessageCodec</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> buf<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ­£åœ¨å¤„ç†å‡ºç«™æ•°æ®...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// åŒæ ·çš„ï¼Œæ·»åŠ çš„æ•°é‡å°±æ˜¯å‡ºç«™çš„æ¶ˆæ¯æ•°é‡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ByteBuf</span> buf<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ­£åœ¨å¤„ç†å…¥ç«™æ•°æ®...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å’Œä¹‹å‰ä¸€æ ·ï¼Œç›´æ¥ä¸€è¡Œè§£å†³</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å¸¸ç”¨çš„è§£ç å™¨\"><a class=\"anchor\" href=\"#å¸¸ç”¨çš„è§£ç å™¨\">#</a> å¸¸ç”¨çš„è§£ç å™¨</h1>\n<h2 id=\"fixedlengthframedecoder\"><a class=\"anchor\" href=\"#fixedlengthframedecoder\">#</a> FixedLengthFrameDecoder</h2>\n<p>å›ºå®šé•¿åº¦è§£ç å™¨ï¼šé€šè¿‡æ„é€ å‡½æ•°è®¾ç½®å›ºå®šé•¿åº¦çš„å¤§å° <code>frameLength</code> ï¼Œæ— è®ºæ¥æ”¶æ–¹ä¾æ¬¡è·å–å¤šå¤§çš„æ•°æ®ï¼Œéƒ½ä¼šä¸¥æ ¼æŒ‰ç…§è¯¥å¤§å°è¿›è¡Œè§£ç ï¼Œå¦‚æœç§¯ç´¯è¯»å–åˆ°é•¿åº¦å¤§å° <code>frameLength</code>  çš„æ¶ˆæ¯ï¼Œè§£ç å™¨æ‰ä¼šå¤„ç†ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æœ‰æ•ˆè§£å†³ç²˜åŒ…æ‹†åŒ…é—®é¢˜</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FixedLengthFrameDecoder</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"delimiterbasedframedecoder\"><a class=\"anchor\" href=\"#delimiterbasedframedecoder\">#</a> DelimiterBasedFrameDecoder</h2>\n<p>ç‰¹æ®Šåˆ†éš”ç¬¦è§£ç å™¨ï¼Œå…¶é‡è¦å±æ€§ï¼š</p>\n<ul>\n<li><code>delimiters</code> ï¼šæŒ‡å®šç‰¹æ®Šåˆ†éš”ç¬¦ï¼Œé€šè¿‡å†™å…¥ <code>ByteBuf</code>  ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ <code>delimiters</code>  çš„ç±»å‹æ˜¯ <code>ByteBuf</code>  æ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªåˆ†éš”ç¬¦ã€‚</li>\n<li><code>maxLength</code> ï¼šæŠ¥æ–‡æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡è¯¥é•¿åº¦è¿˜æ²¡æœ‰æ£€æµ‹åˆ°åˆ†éš”ç¬¦ï¼Œå°±ä¼šæŠ›å‡º <code>TooLongFrameException</code>  å¼‚å¸¸ï¼Œæ˜¯å¯¹ç¨‹åºåœ¨æç«¯æƒ…å†µä¸‹çš„ä¸€ç§ä¿æŠ¤ã€‚</li>\n<li><code>failFast</code> ï¼šè®¾ç½® <code>failFast</code>  å¯ä»¥æ§åˆ¶æŠ›å‡º <code>TooLongFrameException</code>  çš„æ—¶æœºã€‚å¦‚æœ <code>failFast = true</code> ï¼Œå°±ä¼šåœ¨è¶…è¿‡ <code>maxLength</code>  ç«‹å³æŠ›å‡ºã€‚åä¹‹ï¼Œå°±ä¼šç­‰åˆ°è§£ç å‡ºä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>\n<li><code>StripDelimiter</code> ï¼šæ˜¯åˆ¤æ–­è§£ç åå¾—åˆ°çš„æ¶ˆæ¯æ˜¯å¦å»é™¤åˆ†éš”ç¬¦</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DelimiterBasedFrameDecoder</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"!\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„åˆ†éš”ç¬¦ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œä»¥æ„Ÿå¹å·ä¸ºåˆ†éš”ç¬¦</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  \t\t<span class=\"token comment\">// åœ¨æ”¶åˆ°åˆ†éš”ç¬¦ä¹‹å‰çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½ä½œä¸ºåŒä¸€ä¸ªæ•°æ®åŒ…çš„å†…å®¹</span></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ByteBuf</span> delimiter <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">copiedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">new</span> <span class=\"token class-name\">DelimiterBasedFrameDecoder</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> delimiter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"lengthfieldbasedframedecoder\"><a class=\"anchor\" href=\"#lengthfieldbasedframedecoder\">#</a> LengthFieldBasedFrameDecoder</h2>\n<p>é•¿åº¦åŸŸè§£ç å™¨ï¼šè§£å†³ TCP æ‹†åŒ… / ç²˜åŒ…é—®é¢˜æœ€å¸¸ç”¨çš„è§£ç å™¨ã€åŸºæœ¬å¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†åŸºäºé•¿åº¦æ‹†åŒ…åœºæ™¯ã€‚</p>\n<p>å±æ€§ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é•¿åº¦å­—æ®µçš„åç§»é‡ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾é•¿åº¦æ•°æ®çš„èµ·å§‹ä½ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> lengthFieldOffset<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// é•¿åº¦å­—æ®µæ‰€å ç”¨çš„å­—èŠ‚æ•°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> lengthFieldLength<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/* æ¶ˆæ¯é•¿åº¦çš„ä¿®æ­£å€¼</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   åœ¨å¾ˆå¤šè¾ƒä¸ºå¤æ‚ä¸€äº›çš„åè®®è®¾è®¡ä¸­ï¼Œé•¿åº¦åŸŸä¸ä»…ä»…åŒ…å«æ¶ˆæ¯çš„é•¿åº¦ï¼Œè€Œä¸”åŒ…å«å…¶ä»–çš„æ•°æ®ï¼Œ</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   å¦‚ç‰ˆæœ¬å·ã€æ•°æ®ç±»å‹ã€æ•°æ®çŠ¶æ€ç­‰ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨ lengthAdjustment è¿›è¡Œä¿®æ­£</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   lengthAdjustment = åŒ…ä½“çš„é•¿åº¦å€¼ - é•¿åº¦åŸŸçš„å€¼</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> lengthAdjustment<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// è§£ç åéœ€è¦è·³è¿‡çš„åˆå§‹å­—èŠ‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯å†…å®¹å­—æ®µçš„èµ·å§‹ä½ç½®</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> initialBytesToStrip<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// é•¿åº¦å­—æ®µç»“æŸçš„åç§»é‡ï¼Œ</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// lengthFieldEndOffset = lengthFieldOffset + lengthFieldLength</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> lengthFieldEndOffset<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ä¹Ÿæœ‰ä¸€äº›å’Œä¸Šé¢ä¸¤ä¸ªè§£ç å™¨ç›¸ä¼¼çš„å±æ€§ã€‚</p>\n<p>å…¶å®ï¼Œå¦‚æœå¯¹è®¡ç®—æœºç½‘ç»œçš„ TCP åè®®å’ŒæŠ¥æ–‡æ®µä¼ è¾“æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå°±çŸ¥é“è¯¥è§£ç å™¨çš„å·¥ä½œæœºåˆ¶</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/14/f3327f194dd6c465.jpg\" alt=\"\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>è¯­é›€ãƒ»é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2lieDZ1ZyM5MTA3MWE0Mg==\">https://www.yuque.com/qingkongxiaguang/javase/ibx6ug#91071a42</span></p>\n<p>51CTOï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuNTFjdG8uY29tL2FydGljbGUvNjM2MzQ5Lmh0bWw=\">https://www.51cto.com/article/636349.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5saWFuZ2xpYW5nbGVlLmNvbS8lRTQlQjglOTMlRTYlQTAlOEYvTmV0dHklMjAlRTYlQTAlQjglRTUlQkYlODMlRTUlOEUlOUYlRTclOTAlODYlRTUlODklOTYlRTYlOUUlOTAlRTQlQjglOEUlMjBSUEMlMjAlRTUlQUUlOUUlRTglQjclQjUtJUU1JUFFJThDLzA3JTIwJTIwJUU2JThFJUE1JUU1JUE0JUI0JUU2JTlBJTk3JUU4JUFGJUFEJUVGJUJDJTlBJUU1JUE2JTgyJUU0JUJEJTk1JUU1JTg4JUE5JUU3JTk0JUE4JTIwTmV0dHklMjAlRTUlQUUlOUUlRTclOEUlQjAlRTglODclQUElRTUlQUUlOUElRTQlQjklODklRTUlOEQlOEYlRTglQUUlQUUlRTklODAlOUElRTQlQkYlQTElRUYlQkMlOUYubWQ=\">æŠ€æœ¯æ–‡ç« æ‘˜æŠ„</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5saWFuZ2xpYW5nbGVlLmNvbS8lRTQlQjglOTMlRTYlQTAlOEYvTmV0dHklMjAlRTYlQTAlQjglRTUlQkYlODMlRTUlOEUlOUYlRTclOTAlODYlRTUlODklOTYlRTYlOUUlOTAlRTQlQjglOEUlMjBSUEMlMjAlRTUlQUUlOUUlRTglQjclQjUtJUU1JUFFJThDLzA4JTIwJTIwJUU1JUJDJTgwJUU3JUFFJUIxJUU1JThEJUIzJUU3JTk0JUE4JUVGJUJDJTlBTmV0dHklMjAlRTYlOTQlQUYlRTYlOEMlODElRTUlOTMlQUElRTQlQkElOUIlRTUlQjglQjglRTclOTQlQTglRTclOUElODQlRTglQTclQTMlRTclQTAlODElRTUlOTklQTglRUYlQkMlOUYubWQ=\">å¼€ç®±å³ç”¨ï¼šNetty æ”¯æŒå“ªäº›å¸¸ç”¨çš„è§£ç å™¨ï¼Ÿ</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/13/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(3)-%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/",
            "url": "https://cecilia.cool/2022/09/13/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(3)-%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/",
            "title": "Nettyæ¡†æ¶(3)--ä»»åŠ¡è°ƒåº¦",
            "date_published": "2022-09-13T01:37:47.000Z",
            "content_html": "<h1 id=\"eventloop\"><a class=\"anchor\" href=\"#eventloop\">#</a> EventLoop</h1>\n<p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚çš„ä¾‹å­ä¸­ï¼Œé¦–å…ˆåˆ›å»º bossGroup å’Œ workerGroup ä¸¤ä¸ª <code>EventLoopGroup</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å› ä¸ºåšå®¢æ˜¾ç¤ºé—®é¢˜ï¼Œæˆ‘è¿™é‡Œå†™æˆä¸¤è¡Œ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">EventLoopGroup</span> bossGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">EventLoopGroup</span> workerGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹‹å‰ä¹Ÿæåˆ°ï¼Œè¿™ä¸¤ä¸ªç±»ä¼¼äºä¸»ä» Reactorã€‚ä¹‹å‰åœ¨ç¼–å†™ NIO ä»£ç æ—¶ï¼Œå°±æ˜¯ç”¨äº† <code>while</code>  å¾ªç¯ï¼Œä¸æ–­ä½¿ç”¨ <code>selector</code>  ç›‘å¬æ–°çš„äº‹ä»¶ï¼ŒEventLoop ä¹Ÿæ˜¯è¿™ç§æ€æƒ³ï¼Œæœ¬è´¨æ˜¯äº‹ä»¶ç­‰å¾… / å¤„ç†çº¿ç¨‹ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸ NIO åˆæœ‰ä¸åŒï¼š</p>\n<ul>\n<li><code>EvetnLoopGroup</code>  åŒ…å«å¤šä¸ª <code>EventLoop</code> ã€‚</li>\n<li>ä¸€ä¸ª <code>EventLoop</code>  ç»‘å®šä¸€ä¸ªçº¿ç¨‹ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æ‰ä¼šé€šè¿‡ <code>ThreadFactory</code>  åˆ›å»ºçº¿ç¨‹</li>\n<li>ä¸€ä¸ª <code>Channel</code>  åªä¼šç»‘å®šä¸€ä¸ª <code>EventLoop</code> ï¼Œç»‘å®šåä¸ä¼šä¿®æ”¹ã€‚ä½†æ˜¯ä¸€ä¸ª <code>EventLoop</code>  å¯ä»¥è¢«å¤šä¸ª <code>Channel</code>  ç»‘å®šï¼ˆå¤šå¯¹ä¸€çš„å…³ç³»ï¼‰</li>\n</ul>\n<p>å…ˆçœ‹ä¸€ä¸‹ç¤ºæ„å›¾ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/13/f46a4aa6c8e4214a.jpg\" alt=\"\" /></p>\n<p>æˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç ï¼Œå¤šä¸ª <code>Channel</code>  æ³¨å†Œåˆ°åŒä¸€ä¸ª EventLoop ä¸­ï¼Œæœ¬èº«æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬å°†æ•°æ®çš„è¯»å†™å’Œæ•°æ®çš„å¤„ç†ï¼ˆå…¶ä»–æ“ä½œï¼‰æ”¾åœ¨äº†ä¸€èµ·ï¼Œå¦‚æœæŸä¸€ä¸ª <code>Channel</code>  çš„æ•°æ®å¤„ç†é˜»å¡äº†ï¼Œå°±ä¼šå¯¼è‡´å…¶ä»– <code>Channel</code>  ä¹Ÿé˜»å¡ã€‚<strong>æ‰€ä»¥ä½¿ç”¨ Netty è¿›è¡Œç¨‹åºå¼€å‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ ChannelHandler çš„å®ç°é€»è¾‘æœ‰å……åˆ†çš„é£é™©æ„è¯†</strong>ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                                   buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token comment\">// è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¡ 10 ç§’å‡è£…åœ¨å¤„ç†ä»»åŠ¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token comment\">// å°±ä¼šå¯¼è‡´é˜»å¡ï¼Œå…¶ä»– Channel ä¸èƒ½å¤„ç†</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>åœ¨ IO å¤šè·¯å¤ç”¨è¯¦è§£å°±è¯´è¿‡ï¼ŒReactor æ¨¡å‹æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œåœ¨å®Œæˆè¯»å†™è¯·æ±‚æ—¶ä¸ä¼šé˜»å¡ï¼Œå› ä¸ºåªæœ‰å®¢æˆ·ç«¯çœŸçš„å‘é€äº†è¯»å†™è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ‰ä¼šè¿›è¡Œè¯»å†™æ“ä½œã€‚æ‰€ä»¥ä¼šå‡ºç°é˜»å¡çš„åªæœ‰æ•°æ®å¤„ç†é‚£ä¸€éƒ¨åˆ†ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹å¤šçº¿ç¨‹ Reactor æ¨¡å‹ä¸­ï¼ŒHandler è´Ÿè´£å¤„ç†è¯»å†™ï¼Œå…¶ä»–ä»»åŠ¡ï¼ˆè§£ç ï¼Œç¼–ç ç­‰ï¼‰éƒ½äº¤ç»™çº¿ç¨‹æ± å¤„ç†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token constant\">POOL</span><span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                                   <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                              buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Netty å¤„ç†è¿™ç§æƒ…å†µï¼Œå¯ä»¥å†åˆ›å»ºä¸€ä¸ª <code>EventLoopGroup</code>  æ¥ä¸“é—¨å¤„ç†é˜»å¡äº‹ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">EventLoopGroup</span> handlerGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    handlerGroup<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ç”±äºç»§æ‰¿è‡ª ScheduledExecutorServiceï¼Œç›´æ¥æäº¤ä»»åŠ¡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>å½“ç„¶ä¹Ÿå¯ä»¥å†™æˆæµæ°´çº¿ï¼Œä¸€ä¸ª ChannelHandler å¤„ç†è¯»å†™äº‹ä»¶ï¼Œç„¶åå°†ä»»åŠ¡ä¼ ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¤„ç†é˜»å¡æ—¶é—´</p>\n</blockquote>\n<p>æœ€åé¡ºä¾¿ç»™å‡ºå®¢æˆ·ç«¯ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// å®¢æˆ·ç«¯ä¹Ÿé€šè¿‡ Bootstrap å¯åŠ¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Bootstrap</span> bootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// å®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ª EventLoop å³å¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t\t <span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        \t <span class=\"token punctuation\">.</span><span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                 <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                 <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                     channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelHandlerContextAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                         <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                         <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">ChannelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> thorws <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                             <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Byte</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                             <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\">> æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼š\"</span> <span class=\"token operator\">+</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                                               buf<span class=\"token punctuation\">,</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                     <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                 <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>             <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token class-name\">Channel</span> channel <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Scanner</span> in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;&lt; è¯·è¾“å…¥è¦å‘é€ç»™æœåŠ¡ç«¯çš„å†…å®¹\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>unPooled<span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">getBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å¼‚æ­¥è·å¾—ç»“æœ\"><a class=\"anchor\" href=\"#å¼‚æ­¥è·å¾—ç»“æœ\">#</a> å¼‚æ­¥è·å¾—ç»“æœ</h1>\n<h2 id=\"channelfuture\"><a class=\"anchor\" href=\"#channelfuture\">#</a> ChannelFuture</h2>\n<p>Netty ä¸­çš„ Channel ç›¸å…³æ“ä½œéƒ½æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œå¹¶ä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬ä¸èƒ½ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœã€‚æ‰€ä»¥æƒ³è¦å¾—åˆ°ç»“æœå°±éœ€è¦ä½¿ç”¨ Future</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å…ˆçœ‹ä¸€ä¸‹ä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">ByteBuf</span> buff <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span> <span class=\"token operator\">+</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                      buff<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">ChannelFuture</span> future <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpool</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼š\"</span> <span class=\"token operator\">+</span> funture<span class=\"token punctuation\">.</span><span class=\"token function\">isDone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><code>ChannelFuture</code>  ç»§æ‰¿ <code>Netty</code>  è‡ªå®šä¹‰çš„ <code>Future</code> ï¼Œä½†æ˜¯è¿™ä¸ªè‡ªå®šä¹‰çš„ <code>Future</code>  æ¥å£ä¹Ÿæ˜¯ç»§æ‰¿äº† <code>j.u.c</code>  é‡Œé¢çš„ <code>Future</code>  æ¥å£ã€‚è€Œæˆ‘ä»¬ä¹Ÿæ˜¯ä¸»è¦è®²è§£ <code>ChannelFuture</code> ã€‚</p>\n</blockquote>\n<p>åŒ…æ‹¬æœåŠ¡ç«¯å¯åŠ¨ä¹Ÿæ˜¯è¿”å›çš„ <code>ChannelFuture</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ChannelFuture</span> future <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>future<span class=\"token punctuation\">.</span><span class=\"token function\">isDone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// false</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å¯åŠ¨æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥ä¸€å¼€å§‹ç›´æ¥è·å– <code>isDone</code>  çš„ç»“æœä¼šè¿”å› <code>false</code> ã€‚å¦‚æœéœ€è¦å½“æœåŠ¡ç«¯å¯åŠ¨åæˆ‘ä»¬æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œç›¸å½“äºæŠŠå¼‚æ­¥æ¢å¤æˆåŒæ­¥ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆ</p>\n<ul>\n<li>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ <code>sync</code>  æ–¹æ³•</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ChannelFuture</span> future <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>future<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®©çº¿ç¨‹åŒæ­¥ç­‰å¾…ä»»åŠ¡è¿”å›</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>future<span class=\"token punctuation\">.</span><span class=\"token function\">isDone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// false</span></pre></td></tr></table></figure><ul>\n<li>æ–¹æ¡ˆäºŒï¼šè®¾ç½®ç›‘å¬å™¨</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ChannelFuture</span> future <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// ç›´æ¥æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä½†æ˜¯æ³¨æ„æ‰§è¡Œä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>future<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelFutureListener</span><span class=\"token punctuation\">)</span> channelFuture <span class=\"token operator\">-></span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                   <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æœåŠ¡ç«¯å¯åŠ¨å®Œæˆä¹‹åè¦åšçš„äº‹æƒ…ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>ChannelFuture</code>  ä¸­å®šä¹‰äº†ç›‘å¬æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ChannelFuture</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Channel</span> <span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// æˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–æ­¤ä»»åŠ¡çš„ Channel</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">ChannelFuture</span> <span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GenericFutureListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                              <span class=\"token class-name\">Future</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// å½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œä¼šç›´æ¥æ‰§è¡Œ GenericFutureListener çš„ä»»åŠ¡ï¼Œæ³¨æ„æ‰§è¡Œçš„ä½ç½®ä¹Ÿæ˜¯åœ¨ EventLoop ä¸­</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isVoid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// è¿”å›ç±»å‹æ˜¯å¦ä¸º void</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><code>GenericFutureListener</code>  æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œåªæœ‰ä¸€ä¸ª <code>operationComplete</code>  æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼ã€‚è€Œä¸”ï¼Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹åœ¨å®Œæˆä»»åŠ¡åå°±ä¼šæ‰§è¡Œäº‹ä»¶ç›‘å¬é‡Œçš„ä»»åŠ¡ï¼ˆè€Œä¸æ˜¯åœ¨å®šä¹‰äº‹ä»¶ç›‘å¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼‰ã€‚</p>\n</blockquote>\n<h2 id=\"promise\"><a class=\"anchor\" href=\"#promise\">#</a> Promise</h2>\n<p>è¯¥æ¥å£æ”¯æŒæ‰‹åŠ¨è®¾å®šæˆåŠŸå’Œå¤±è´¥çš„ç»“æœï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ­¤æ¥å£ä¹Ÿæ˜¯ç»§æ‰¿è‡ª Netty ä¸­çš„ Future æ¥å£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">setSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">V</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// æ‰‹åŠ¨è®¾å®šæˆåŠŸ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">trySuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">V</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">setFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// æ‰‹åŠ¨è®¾å®šå¤±è´¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">setUncancellable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token comment\">// è¿™äº›å°±å’Œä¹‹å‰çš„ Future æ˜¯ä¸€æ ·çš„äº†</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GenericFutureListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                           <span class=\"token class-name\">Future</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">addListeners</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GenericFutureListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                            <span class=\"token class-name\">Future</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">removeListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GenericFutureListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                              <span class=\"token class-name\">Future</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">removeListeners</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GenericFutureListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                               <span class=\"token class-name\">Future</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">V</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">awaitUninterruptibly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token class-name\">Promise</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">syncUninterruptibly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥æ¥å£ä¹Ÿæ˜¯å¯ä»¥è·å–å¼‚æ­¥æ‰§è¡Œç»“æœæƒ…å†µ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">ChannelPromise</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultChannelPromise</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">.</span><span class=\"token function\">isSuccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> promise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        promise<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// åŒæ­¥ç­‰å¾…ä¸€ä¸‹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">.</span><span class=\"token function\">isSuccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Netty æºç ä¹‹ EventLoopGroupï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemhpeWkuem9uZS9uZXR0eS9FdmVudExvb3BHcm91cC5odG1sI211bHRpdGhyZWFkZXZlbnRsb29wZ3JvdXA=\">https://www.zhiyi.zone/netty/EventLoopGroup.html#multithreadeventloopgroup</span></p>\n<p>è¯­é›€ãƒ»é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2lieDZ1ZyNiN2RjNmY4Nw==\">https://www.yuque.com/qingkongxiaguang/javase/ibx6ug#b7dc6f87</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5saWFuZ2xpYW5nbGVlLmNvbS8lRTQlQjglOTMlRTYlQTAlOEYvTmV0dHklMjAlRTYlQTAlQjglRTUlQkYlODMlRTUlOEUlOUYlRTclOTAlODYlRTUlODklOTYlRTYlOUUlOTAlRTQlQjglOEUlMjBSUEMlMjAlRTUlQUUlOUUlRTglQjclQjUtJUU1JUFFJThDLzA0JTIwJUU0JUJBJThCJUU0JUJCJUI2JUU4JUIwJTgzJUU1JUJBJUE2JUU1JUIxJTgyJUVGJUJDJTlBJUU0JUI4JUJBJUU0JUJCJTgwJUU0JUI5JTg4JTIwRXZlbnRMb29wJTIwJUU2JTk4JUFGJTIwTmV0dHklMjAlRTclOUElODQlRTclQjIlQkUlRTklQUIlOTMlRUYlQkMlOUYubWQ=\">æŠ€æœ¯æ–‡ç« æ‘˜æŠ„</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/12/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(2)-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/09/12/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(2)-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/",
            "title": "Nettyæ¡†æ¶(2)--Channelé€šé“",
            "date_published": "2022-09-12T13:44:11.000Z",
            "content_html": "<h1 id=\"nettyåŸºç¡€ä»£ç \"><a class=\"anchor\" href=\"#nettyåŸºç¡€ä»£ç \">#</a> Netty åŸºç¡€ä»£ç </h1>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Netty æ­å»ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<p>æœåŠ¡ç«¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ä½¿ç”¨ NioEventLoopGroup å®ç°ç±»ï¼Œåˆ›å»º BossGroup å’Œ WorkerGroup</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">/** å…¶ä»–çš„è¿˜æœ‰ EpollEventLoopGroupï¼Œä½†æ˜¯ä»…æ”¯æŒ Linuxï¼Œè¿™æ˜¯ Netty åŸºäº Linux åº•å±‚</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    \tEpoll å•ç‹¬ç¼–å†™çš„ä¸€å¥—æœ¬åœ°å®ç°ï¼Œæ²¡æœ‰ä½¿ç”¨ NIO é‚£å¥— */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">EventLoopGroup</span> bossGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> workerGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»ºæœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ç±»</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">ServerBootstrap</span> bootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerBootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// å¯é“¾å¼</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    bootstrap</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span>bossGroup<span class=\"token punctuation\">,</span> workerGroup<span class=\"token punctuation\">)</span>   <span class=\"token comment\">// æŒ‡å®šäº‹ä»¶å¾ªç¯ç»„</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// æŒ‡å®šä¸º NIO çš„ ServerSocketChannel</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">childHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">//SocketChannel ä¸æ˜¯ NIO é‡Œé¢çš„ï¼Œæ˜¯ Netty çš„</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                            <span class=\"token comment\">//ctx æ˜¯ä¸Šä¸‹æ–‡ï¼Œmsg æ˜¯æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œé»˜è®¤ä»¥ ByteBuf å½¢å¼ï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å½¢å¼ï¼Œåé¢å†è¯´ï¼‰</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç±»å‹è½¬æ¢ä¸€ä¸‹</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                               <span class=\"token string\">\" >> æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                            <span class=\"token comment\">// é€šè¿‡ä¸Šä¸‹æ–‡å¯ä»¥ç›´æ¥å‘é€æ•°æ®å›å»ï¼Œæ³¨æ„è¦ writeAndFlush æ‰èƒ½è®©å®¢æˆ·ç«¯ç«‹å³æ”¶åˆ°</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// æœ€åç»‘å®šç«¯å£ï¼Œå¯åŠ¨</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²è¿æ¥åˆ°æœåŠ¡ç«¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¾“å…¥è¦å‘é€ç»™æœåŠ¡ç«¯çš„å†…å®¹ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²å‘é€ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç›´æ¥ä»é€šé“ä¸­è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ”¶åˆ°æœåŠ¡å™¨è¿”å›ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å¾ˆå¤šé™Œç”Ÿçš„ç±»ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¹‹åè¦è®²è§£çš„ï¼Œå®¢æˆ·ç«¯çš„ä»£ç åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ã€‚</p>\n<p>æœåŠ¡ç«¯å‰ä¸¤è¡Œä»£ç ï¼Œä¸€ä¸ªæ˜¯åˆ›å»º bossGroup å’Œ workerGroupï¼Œå¦ä¸€ä¸ªæ˜¯åˆ›å»ºæœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ç±» ServerBootstrapã€‚ï¼ˆbootstrap ç¿»è¯‘ä¸ºå¼•å¯¼ç¨‹åºï¼‰ã€‚</p>\n<blockquote>\n<p>çœ‹åé¢çš„é“¾å¼ä»£ç å°±çŸ¥é“ï¼Œæˆ‘ä»¬é€šè¿‡ ServerBootstrap é…ç½®ç›¸å…³ä¿¡æ¯ã€‚æ¯”å¦‚è®¾ç½® groupï¼Œchannelï¼Œhandler ç­‰ã€‚</p>\n</blockquote>\n<h1 id=\"channelé€šé“\"><a class=\"anchor\" href=\"#channelé€šé“\">#</a> Channel é€šé“</h1>\n<p>Netty çš„ Channel æ²¡æœ‰ç›´æ¥ä½¿ç”¨ NIO çš„ Channelï¼Œé€šé“æ”¯æŒ IO æ“ä½œï¼Œä½†æ˜¯æ‰€æœ‰çš„ IO æ“ä½œéƒ½æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼ˆNettyï¼‰ã€‚æ„å‘³ç€ä»»ä½• IO è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ï¼Œä½†ä¸èƒ½ä¿è¯è¯·æ±‚çš„ IO æ“ä½œåœ¨è°ƒç”¨æ—¶å·²ç»å®Œæˆã€‚å®ƒä¼šè¿”å›ä¸€ä¸ª ChannelFuture å®ä¾‹ï¼ˆåœ¨ JUC é‡Œé¢æˆ‘ä»¬å°±å°†ç»“æœå…³äºè¿™ç§å¼‚æ­¥è·å–ç»“æœçš„ FutureTask ç±»ï¼‰ï¼Œè¯¥å®ä¾‹å°†åœ¨è¯·æ±‚çš„ IO æ“ä½œæˆåŠŸï¼Œå¤±è´¥æˆ–å–æ¶ˆæ—¶é€šçŸ¥ä½ ã€‚</p>\n<p>å…³äº <code>Channel</code> ï¼Œåœ¨ Netty ä¸­ï¼Œè¿˜æœ‰ <code>ChannelHandler</code>  å’Œ <code>ChannelPipeline</code>  ä¸¤ä¸ªç»„ä»¶ã€‚</p>\n<ul>\n<li>ChannelHandler è´Ÿè´£ Channel çš„é€»è¾‘å¤„ç†ï¼Œå…¶å®å°±æ˜¯ Reactor é‡Œé¢çš„ Handlerã€‚</li>\n<li>ChannelPipeline è´Ÿè´£ç®¡ç† ChannelHandlerï¼Œä»–æ˜¯ä¸€ä¸ªæµæ°´çº¿å®¹å™¨ï¼Œå­˜å‚¨ç»“æ„ä¸ºåŒå‘é“¾è¡¨ã€‚</li>\n<li>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡é“¾å¼ä»£ç ï¼Œæˆ‘ä»¬ä¸æ–­å°† <code>ChannelInboundHandlerAdapter</code> ï¼ˆå®ç°äº† ChannelHandlerï¼‰åŠ å…¥åˆ° Pipe ä¸­</li>\n</ul>\n<blockquote>\n<p>ä¸€ä¸ª <code>Channel</code>  åŒ…å«ä¸€ä¸ª <code>ChannelPipeline</code> ï¼Œæ‰€æœ‰ <code>ChannelHandler</code>  éƒ½ä¼šé¡ºåºåŠ å…¥åˆ° <code>ChannelPipeline</code>  ä¸­ï¼Œåˆ›å»º <code>Channel</code>  æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>ChannelPipeline</code> ï¼›æ¯ä¸ª <code>Channel</code>  éƒ½ä¼šæœ‰ä¸€ä¸ª <code>ChannelPipeline</code> ï¼Œè¿™ä¸ªå…³è”å…³ç³»æ˜¯æ°¸ä¹…æ€§çš„ã€‚</p>\n</blockquote>\n<p>å…³ç³»å›¾å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/750be0a66f935589.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>å…¶å® <code>ChannelPipeline</code>  ç»´æŠ¤çš„æ˜¯ç”± <code>ChannelHandlerContext</code>  ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œåªæ˜¯æ¯ä¸€ä¸ª <code>ChannelHandlerContext</code>  åˆå…³è”ç€ä¸€ä¸ª <code>ChannelHandler</code> ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹æºç </p>\n<p><code>Channel</code>  æºç ï¼Œé‡Œé¢æ–¹æ³•æ¯”è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªçœ‹å‡ ä¸ªé‡è¦çš„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Channel</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AttributeMap</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ChannelOutboundInvoker</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Comparable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Channel</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">ChannelId</span> <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// é€šé“ ID</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// è·å–æ­¤é€šé“æ‰€å±çš„ EventLoopï¼Œå› ä¸ºä¸€ä¸ª Channel åœ¨å®ƒçš„</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// ç”Ÿå‘½å‘¨æœŸå†…åªèƒ½æ³¨å†Œåˆ°ä¸€ä¸ª EventLoop ä¸­</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">EventLoop</span> <span class=\"token function\">eventLoop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//Channel æ˜¯å…·æœ‰å±‚çº§å…³ç³»çš„ï¼Œè¿™é‡Œæ˜¯è¿”å›çˆ¶ Channel</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Channel</span> <span class=\"token function\">parent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// é€šé“å½“å‰çš„ç›¸å…³çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isRegistered</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// å…³é—­é€šé“ï¼Œä½†æ˜¯ä¼šç”¨åˆ° ChannelFuture</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token class-name\">ChannelFuture</span> <span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// æµæ°´çº¿ï¼Œä¾‹å­ä¸­æˆ‘ä»¬å°±æ˜¯é€šè¿‡ pipeline æ‹¿åˆ°ç®¡é“ï¼Œ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// ç„¶ååŠ å…¥ ChannelHandler</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token class-name\">ChannelPipeline</span> <span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     <span class=\"token comment\">// å¯ä»¥ç›´æ¥ä» Channel æ‹¿åˆ° ByteBufAllocator çš„å®ä¾‹ï¼Œæ¥åˆ†é… ByteBuf</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token class-name\">ByteBufAllocator</span> <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token class-name\">Channel</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token class-name\">Channel</span> <span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// åˆ·æ–°ï¼ŒåŸºæ“</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶ä¸­ <code>pipeline()</code>  æ–¹æ³•åœ¨ä¾‹å­ä¸­ä½¿ç”¨åˆ°äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ <code>ChannelHandler</code> ã€‚è¯¥æ¥å£å®šä¹‰äº†ä¸€äº›è´Ÿè´£å®Œæˆå…·ä½“è¯·æ±‚çš„æ–¹æ³•ï¼Œä¾‹å­ä¸­ä½¿ç”¨åˆ°çš„ <code>ChannelInboundHandlerAdapter</code>  æŠ½è±¡ç±»æ˜¯ <code>ChannelInboundHandler</code>  çš„æ¥å£å®ç°ï¼Œç”¨äºå¤„ç†å…¥ç«™æ•°æ®ï¼ˆInbound è¡¨ç¤ºå…¥ç«™ï¼ŒOutbound è¡¨ç¤ºå‡ºç«™ï¼‰ï¼ŒæŠ½è±¡ç±»é‡å†™å¯¹åº”æ–¹æ³•è¿›è¡Œè¯·æ±‚å¤„ç†ï¼Œè¿™äº›æ–¹æ³•ä¼šåœ¨åˆé€‚çš„æ—¶é—´è¢«è°ƒç”¨ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      \t<span class=\"token comment\">//ctx æ˜¯ä¸Šä¸‹æ–‡ï¼Œmsg æ˜¯æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œä»¥ ByteBuf å½¢å¼</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç±»å‹è½¬æ¢ä¸€ä¸‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                           <span class=\"token operator\">+</span><span class=\"token string\">\" >> æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                           <span class=\"token operator\">+</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// é€šè¿‡ä¸Šä¸‹æ–‡å¯ä»¥ç›´æ¥å‘é€æ•°æ®å›å»ï¼Œæ³¨æ„è¦ writeAndFlush æ‰èƒ½è®©å®¢æˆ·ç«¯ç«‹å³æ”¶åˆ°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrappedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹é¡¶å±‚æ¥å£ <code>ChannelHandler</code> ï¼šåªæœ‰ä¸€äº›æµæ°´çº¿ç›¸å…³çš„å›è°ƒæ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ChannelHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  \t<span class=\"token comment\">// å½“ ChannelHandler è¢«æ·»åŠ åˆ°æµæ°´çº¿ä¸­æ—¶è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">handlerAdded</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// å½“ ChannelHandler ä»æµæ°´çº¿ä¸­ç§»é™¤æ—¶è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">handlerRemoved</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// è¿˜æœ‰ä¸€ä¸ªè¿‡æ—¶æ–¹æ³•ï¼Œä¸ç®¡</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>çœ‹ä¸‹ä¸€çº§æ¥å£ <code>ChannelInboundHandler</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//ChannelInboundHandler ç”¨äºå¤„ç†å…¥ç«™ç›¸å…³äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ChannelInboundHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  \t<span class=\"token comment\">/** å½“ Channel å·²ç»æ³¨å†Œåˆ°è‡ªå·±çš„ EventLoop ä¸Šæ—¶è°ƒç”¨ï¼Œå‰é¢æˆ‘ä»¬è¯´äº†ï¼Œ</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    ä¸€ä¸ª Channel åªä¼šæ³¨å†Œåˆ°ä¸€ä¸ª EventLoop ä¸Šï¼Œæ³¨å†Œåˆ° EventLoop åï¼Œ</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    è¿™æ ·æ‰ä¼šåœ¨å‘ç”Ÿå¯¹åº”äº‹ä»¶æ—¶è¢«é€šçŸ¥ã€‚*/</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// ä» EventLoop ä¸Šå–æ¶ˆæ³¨å†Œæ—¶</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelUnregistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">// å½“ Channel å·²ç»å¤„äºæ´»è·ƒçŠ¶æ€æ—¶è¢«è°ƒç”¨ï¼Œæ­¤æ—¶ Channel å·²ç»è¿æ¥ / ç»‘å®šï¼Œå¹¶ä¸”å·²ç»å°±ç»ª</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// è·Ÿä¸Šé¢ç›¸åï¼Œä¸å†æ´»è·ƒäº†ï¼Œå¹¶ä¸”ä¸åœ¨è¿æ¥å®ƒçš„è¿œç¨‹èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">// å½“ä» Channel è¯»å–æ•°æ®æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®è¢«è‡ªåŠ¨åŒ…è£…æˆäº†ä¸€ä¸ª Objectï¼ˆé»˜è®¤æ˜¯ ByteBufï¼‰</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> var2<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// ä¸Šä¸€ä¸ªè¯»å–æ“ä½œå®Œæˆåè°ƒç”¨</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelReadComplete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token comment\">// æš‚æ—¶ä¸ä»‹ç»</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">userEventTriggered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> var2<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">// å½“ Channel çš„å¯å†™çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶è¢«è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">channelWritabilityChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">// å‡ºç°å¼‚å¸¸æ—¶è¢«è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">exceptionCaught</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> var1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Throwable</span> var2<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼Œ <code>ChannelInboundHandler</code>  è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œæ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚ä¸Šé¢ç”¨åˆ°çš„ <code>ChannelInboundHandlerAdapter</code>  å®é™…ä¸Šå°±æ˜¯å¯¹è¿™äº›æ–¹æ³•å®ç°çš„æŠ½è±¡ç±»ï¼Œç›¸æ¯”ç›´æ¥ç”¨æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åªé‡å†™æˆ‘ä»¬éœ€è¦çš„æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™çš„æ–¹æ³•ä¼šé»˜è®¤å‘æµæ°´çº¿ä¸‹ä¸€ä¸ª <code>ChannelHandler</code>  å‘é€ã€‚</p>\n<blockquote>\n<p>ä¸ä¹‹å¯¹åº”çš„è¿˜æœ‰ <code>ChannelOutboundHandler</code> ï¼Œç”¨äºå¤„ç†å‡ºç«™ç›¸å…³æ“ä½œï¼Œæ­¤å¤„ä¸å†è®²è§£</p>\n</blockquote>\n<p>æœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>ChannelPipeline</code> ï¼Œè¿™ä¸ªåŒå‘é“¾è¡¨å®¹å™¨ä¿å­˜è‘— <code>ChannelHandler</code> ï¼Œé‡Œé¢çš„ <code>ChannelHandler</code>  é¡ºåºå­˜å‚¨ï¼Œä»å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå…¥ç«™ä¼šä¾æ¬¡ç»è¿‡ <code>ChannelHandler</code> ï¼Œç›´åˆ°å®ƒè¢«æŸä¸€ä¸ª <code>handler</code>  å®Œæˆè¯·æ±‚ï¼Œç„¶åå‡ºç«™æ—¶ä¼šç»è¿‡å¤„ç†å‡ºç«™çš„ <code>ChannelHandler</code> ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸¤ä¸ªå…¥ç«™çš„ <code>ChannelHandler</code> ï¼Œä¸€ä¸ªç”¨äºæ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ï¼Œä¸€ä¸ªç”¨äºå¤„ç†å½“å‰æ¥æ”¶è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">childHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    \tchannel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                       buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token comment\">// æ­¤å¤„æ•…æ„äººä¸ºæŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯å¼‚å¸¸\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>               <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exceptionCaught</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span><span class=\"token class-name\">Throwable</span> cause<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¤„ç†å¼‚å¸¸ï¼š\"</span> <span class=\"token operator\">+</span> cause<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸åœ¨ <code>ChannelHandler</code>  é‡å†™å¯¹åº”æ–¹æ³•ï¼Œä»–å°±ä¼šé»˜è®¤ä¼ æ’­åˆ°æµæ°´çº¿ä¸‹ä¸€ä¸ª <code>ChannelHandler</code> ã€‚ä¹Ÿæœ‰äººä¸ºä¼ é€’</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exceptionCaught</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span><span class=\"token class-name\">Throwable</span> cause<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// é€šè¿‡ ChannelHandlerContext æ¥å‘ä¸‹ä¼ é€’ï¼ŒChannelHandlerContext</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// æ˜¯åœ¨ Handler æ·»åŠ è¿› Pipeline ä¸­æ—¶å°±è¢«è‡ªåŠ¨åˆ›å»ºçš„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fireExceptionCaught</span><span class=\"token punctuation\">(</span>cause<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…³äºé€šé“ï¼Œæœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹å‡ºç«™çš„ <code>ChannelHandler</code>  ç›¸å…³çš„æœºåˆ¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    channel<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// ç›´æ¥è·å– pipelineï¼Œç„¶åæ·»åŠ ä¸¤ä¸ª Handler</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fireChannelRead</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UTF_8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¼å…µä¸€å·å¢æœ¬ä¼Ÿ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ channel çš„ write</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelOutboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ChannelPromise</span> promise<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1å·å‡ºç«™ï¼š\"</span><span class=\"token operator\">+</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelOutboundHandlerAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ChannelPromise</span> promise<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2å·å‡ºç«™ï¼š\"</span><span class=\"token operator\">+</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token comment\">// ç»§ç»­ write ç»™å…¶ä»–çš„å‡ºç«™ Handlerï¼Œä¸ç„¶åˆ°è¿™é‡Œå°±æ–­äº†</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡ç‚¹å°±æ˜¯æŒ‰ç…§é¡ºåºå­˜å‚¨ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ª <code>ChannelOutbindHandlerAdapter</code>  å¹¶æ²¡æœ‰ <code>write</code>  æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬å…¥ç«™çš„ <code>ChannelHandler</code>  å®Œæˆæ“ä½œåï¼ˆæ¯”å¦‚å†™è¯·æ±‚ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ª <code>ChannelHandler</code>  è°ƒç”¨ <code>write</code>  æ–¹æ³•ï¼‰ï¼Œå°±ä¼šä»å½“å‰ä½ç½®å€’ç€æ‰¾ <code>ChannelOutbindHandler</code> ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªï¼Œå†è°ƒç”¨ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/13/b7dc75cd969eca8c.jpg\" alt=\"\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>çŸ¥ä¸€ç å›­ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemhpeWkuem9uZS9uZXR0eS9DaGFubmVsLmh0bWw=\">https://www.zhiyi.zone/netty/Channel.html</span></p>\n<p>Netty Channel ç»„ä»¶ä½œç”¨ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHJvZ3JhbW1pbmdodW50ZXIuY29tL2FydGljbGUvMTI3MTIwNDI0NTEv\">https://www.programminghunter.com/article/12712042451/</span></p>\n<p>è¯­é›€ãƒ»é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2lieDZ1ZyNmNDQzYTkzNA==\">https://www.yuque.com/qingkongxiaguang/javase/ibx6ug#f443a934</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/09/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(1)-Netty%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/09/09/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Netty%E6%A1%86%E6%9E%B6(1)-Netty%E5%9F%BA%E7%A1%80/",
            "title": "Nettyæ¡†æ¶(1)--NettyåŸºç¡€",
            "date_published": "2022-09-09T02:53:03.000Z",
            "content_html": "<h1 id=\"nioå­˜åœ¨çš„é—®é¢˜\"><a class=\"anchor\" href=\"#nioå­˜åœ¨çš„é—®é¢˜\">#</a> NIO å­˜åœ¨çš„é—®é¢˜</h1>\n<p>ä¹‹å‰æˆ‘ä»¬å†™çš„ä»£ç ï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼ˆå®¢æˆ·ç«¯è¿è¡Œç»“æŸï¼‰ï¼Œå°±ä¼šæŠ¥é”™</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/09/90e8cc353264d4bf.jpg\" alt=\"NIOå­˜åœ¨çš„é—®é¢˜\" /></p>\n<p>å½“æˆ‘ä»¬çš„å®¢æˆ·ç«¯ä¸»åŠ¨ä¸æœåŠ¡ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä¼šå¯¼è‡´ READ äº‹ä»¶ä¸€ç›´è¢«è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>selector.select()</code>  ä¼šç›´æ¥é€šè¿‡ï¼Œå¹¶ä¸”æ˜¯å¯è¯»çš„çŠ¶æ€ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å®é™…ä¸Šè¯»åˆ°æ˜¯æ•°æ®æ˜¯ä¸€ä¸ªç©ºçš„ï¼ˆä¸Šé¢çš„å›¾ä¸­åœ¨ç©ºè½®è¯¢ä¸¤æ¬¡åæŠ›å‡ºå¼‚å¸¸äº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ— é™çš„å¾ªç¯ä¸‹å»ï¼‰æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¾—ç¨å¾®å¤„ç†ä¸€ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœ read æ“ä½œå¾—åˆ°çš„ç»“æœæ˜¯ - 1ï¼Œé‚£ä¹ˆè¯´æ˜æœåŠ¡ç«¯å·²ç»æ–­å¼€è¿æ¥äº†</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å·²ç»æ–­å¼€è¿æ¥äº†ï¼š\"</span><span class=\"token operator\">+</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç›´æ¥å…³é—­æ­¤é€šé“</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç»§ç»­è¿›è¡Œé€‰æ‹©</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œçš„å¼Šç«¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ–­å¼€çš„å®¢æˆ·ç«¯è¿æ¥ä¼šä¸€ç›´è¿›è¡Œç©ºè½®è¯¢ã€‚</p>\n<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// ç”±äºåº•å±‚ epoll æœºåˆ¶çš„é—®é¢˜ï¼Œå¯¼è‡´ select æ–¹æ³•å¯èƒ½ä¼šä¸€ç›´è¿”å› 0ï¼Œé€ æˆæ— é™å¾ªç¯çš„æƒ…å†µã€‚</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç›‘å¬åˆ° \"</span><span class=\"token operator\">+</span>count<span class=\"token operator\">+</span><span class=\"token string\">\" ä¸ªäº‹ä»¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™ä¸ª BUG ä¹Ÿæ˜¯ç”±å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥å¯¼è‡´çš„ã€‚</p>\n<blockquote>\n<p>è¿™æ˜¯ JDK å®˜æ–¹çš„ BUG åé¦ˆ</p>\n<ol>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHAlM0ElMkYlMkZidWdzLmphdmEuY29tJTJGYnVnZGF0YWJhc2UlMkZ2aWV3X2J1Zy5kbyUzRmJ1Z19pZCUzRDY2NzAzMDI=\">JDK-6670302 : (se) NIO selector wakes up with 0 selected keys infinitely</span></p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmppYW5zaHUuY29tLz90PWh0dHAlM0ElMkYlMkZidWdzLmphdmEuY29tJTJGYnVnZGF0YWJhc2UlMkZ2aWV3X2J1Zy5kbyUzRmJ1Z19pZCUzRDY0MDM5MzM=\">JDK-6403933 : (se) Selector doesn't block on Selector.select(timeout) (lnx)</span></p>\n</li>\n</ol>\n</blockquote>\n<p>JDK NIO API æè¿°çš„ Selector çš„ selector æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° IO äº‹ä»¶åˆ°è¾¾æˆ–è€…è¶…æ—¶ï¼Œä½†æ˜¯ Linux å¹³å°ä¸Šæœ‰æ—¶ä¼šå‡ºç°é—®é¢˜ï¼ŒæŸäº›åœºæ™¯ä¸‹ select æ–¹æ³•ä¼šç›´æ¥è¿”å›ï¼Œå³ä½¿æ²¡æœ‰è¶…æ—¶å¹¶ä¸”ä¹Ÿæ²¡æœ‰ IO äº‹ä»¶åˆ°è¾¾ã€‚å®ƒä¼šå¯¼è‡´çº¿ç¨‹é™·å…¥æ­»å¾ªç¯ï¼Œè®© CPU ä¸Šå‡åˆ° 100%ã€‚ç›´åˆ°ç°åœ¨ JDK éƒ½æ²¡æœ‰å®Œå…¨è§£å†³è¯¥é—®é¢˜ã€‚</p>\n<h1 id=\"nettyæ¡†æ¶\"><a class=\"anchor\" href=\"#nettyæ¡†æ¶\">#</a> Netty æ¡†æ¶</h1>\n<p>è¯¥æ¡†æ¶ API ç®€å•ï¼Œå¼€å‘é—¨æ§›ä½ï¼›åŠŸèƒ½å¼ºå¤§ï¼Œå†…ç½®å¤šç§ç¼–ç è§£ç åŠŸèƒ½ã€‚Java ç‰ˆæœ¬çš„ Minecraft æœåŠ¡å™¨å°±æ˜¯ä½¿ç”¨ Netty æ¡†æ¶ä½œä¸ºç½‘ç»œé€šä¿¡çš„åŸºç¡€</p>\n<p>å…ˆå¯¼åŒ…</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.netty<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>netty-all<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.1.76.Final<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"bytebuf\"><a class=\"anchor\" href=\"#bytebuf\">#</a> ByteBuf</h2>\n<p>Netty ä½¿ç”¨çš„ç¼“å†²åŒºä¸æ˜¯ ByteBufferï¼Œè€Œæ˜¯è‡ªå®šä¹‰çš„ ByteBuf ç±»å…¶ç‰¹ç‚¹æ˜¯ï¼š</p>\n<ul>\n<li>\n<p>å†™æ“ä½œå®Œæˆåæ— éœ€è¿›è¡Œ <code>flip()</code>  ç¿»è½¬ã€‚</p>\n</li>\n<li>\n<p>å…·æœ‰æ¯” ByteBuffer æ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚</p>\n</li>\n<li>\n<p>åŠ¨æ€æ‰©å®¹ã€‚</p>\n</li>\n</ul>\n<p>å†…éƒ¨æ•°ç»„å®é™…çš„è¯»å–æ˜¯ä¸¤ä¸ªæŒ‡é’ˆåœ¨ç»´æŠ¤ï¼ˆè¯»æŒ‡é’ˆå’Œå†™æŒ‡é’ˆï¼‰ï¼Œè¿›è¡Œè¯»å†™æ“ä½œï¼Œç›¸åº”çš„æŒ‡é’ˆå°±ä¼šç§»åŠ¨ï¼Œä½†æ˜¯è¯»æŒ‡é’ˆä¸èƒ½è¶…è¿‡å†™æŒ‡é’ˆã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»ºåˆå§‹å®¹é‡ä¸º 10 çš„ ByteBuf ç¼“å†²åŒºï¼ŒUnpooled æ˜¯ç”¨äºå¿«é€Ÿç”Ÿæˆ ByteBuf çš„å·¥å…·ç±»</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//Unpooled æ˜¯æ± åŒ–çš„æ„æ€ï¼ŒByteBuf æœ‰æ± åŒ–å’Œéæ± åŒ–ä¸¤ç§ï¼ŒåŒºåˆ«åœ¨äºå¯¹å†…å­˜çš„å¤ç”¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">buffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"åˆå§‹çŠ¶æ€ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    buf<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">888888888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// å†™å…¥ä¸€ä¸ª Int æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å†™å…¥Intåï¼š\"</span><span class=\"token operator\">+</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    buf<span class=\"token punctuation\">.</span><span class=\"token function\">readShort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// æ— éœ€ç¿»è½¬ï¼Œç›´æ¥è¯»å–ä¸€ä¸ª short æ•°æ®å‡ºæ¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–Shortåï¼š\"</span><span class=\"token operator\">+</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// ä¸¢å¼ƒæ“ä½œï¼Œä¼šå°†å½“å‰çš„å¯è¯»éƒ¨åˆ†å†…å®¹ä¸¢åˆ°æœ€å‰é¢ï¼Œå¹¶ä¸”è¯»å†™æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸¢å¼ƒçš„è·ç¦»</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    buf<span class=\"token punctuation\">.</span><span class=\"token function\">discardReadBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸¢å¼ƒä¹‹åï¼š\"</span><span class=\"token operator\">+</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    buf<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// æ¸…ç©ºæ“ä½œï¼Œæ¸…ç©ºä¹‹åè¯»å†™æŒ‡é’ˆéƒ½å½’é›¶</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¸…ç©ºä¹‹åï¼š\"</span><span class=\"token operator\">+</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ByteBuf æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹éƒ½ä¼š x2ï¼Œå¦‚æœä¸å¸Œæœ›æ‰©å®¹ï¼Œå¯ä»¥åœ¨ç”Ÿæˆ ByteBuf æ—¶æŒ‡å®š maxCapacity</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// maxCapacity = 30</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">buffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>ç¼“å†²åŒºçš„å®ç°æ¨¡å¼åˆ†ä¸ºï¼šå †ç¼“å†²åŒºæ¨¡å¼ï¼ˆæ•°ç»„å®ç°ï¼‰ï¼Œç›´æ¥ç¼“å†²åŒºæ¨¡å¼ï¼ˆç”³è¯·å †å¤–å†…å­˜ï¼‰ï¼Œç¬¦åˆç¼“å†²åŒºæ¨¡å¼ã€‚</strong></p>\n<p>æƒ³è¦åˆ›å»ºç›´æ¥ç¼“å†²åŒºï¼Œç›´æ¥è°ƒç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">directBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// æ‹¿ä¸åˆ°æ•°ç»„ï¼Œå› ä¸ºåº•å±‚ä¸æ˜¯æ•°ç»„å®ç°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¤åˆæ¨¡å¼å¯ä»¥æ‹¼å‡‘ç»„åˆå…¶ä»–ç¼“å†²åŒºï¼Œå¦‚æœå¸Œæœ›å¯¹ä¸¤ä¸ªç¼“å†²åŒºå†…å®¹è¿›è¡Œæ“ä½œï¼Œä¸éœ€è¦å†å•ç‹¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œè€Œæ˜¯ç›´æ¥å°†å…¶è¿›è¡Œæ‹¼æ¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªå¤åˆç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">CompositeByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">compositeBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>buf<span class=\"token punctuation\">.</span><span class=\"token function\">addComponent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">copiedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>buf<span class=\"token punctuation\">.</span><span class=\"token function\">addComponent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">copiedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"def\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å…³äºç¼“å†²åŒºï¼Œæœ€åçœ‹ä¸€ä¸‹ Unpooled å·¥å…·ç±»æ˜¯å¦‚ä½•åˆ›å»º buffer çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Unpooled</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ByteBufAllocator</span> <span class=\"token constant\">ALLOC</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å†…éƒ¨æ˜¯æœ‰ä¸€ä¸ª ByteBufAllocator å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ByteOrder</span> <span class=\"token constant\">BIG_ENDIAN</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ByteOrder</span> <span class=\"token constant\">LITTLE_ENDIAN</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ByteBuf</span> <span class=\"token constant\">EMPTY_BUFFER</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ByteBuf</span> <span class=\"token function\">buffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">ALLOC</span><span class=\"token punctuation\">.</span><span class=\"token function\">heapBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç¼“å†²åŒºçš„åˆ›å»ºæ“ä½œæ˜¯ä¾é  ByteBufAllocator æ¥è¿›è¡Œçš„</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  \t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">//ALLOC åœ¨é™æ€ä»£ç å—ä¸­è¿›è¡ŒæŒ‡å®šï¼Œå®é™…ä¸ŠçœŸæ­£çš„å®ç°ç±»æ˜¯ UnpooledByteBufAllocator</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token constant\">ALLOC</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">UnpooledByteBufAllocator</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEFAULT</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token constant\">BIG_ENDIAN</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteOrder</span><span class=\"token punctuation\">.</span><span class=\"token constant\">BIG_ENDIAN</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token constant\">LITTLE_ENDIAN</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteOrder</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LITTLE_ENDIAN</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token constant\">EMPTY_BUFFER</span> <span class=\"token operator\">=</span> <span class=\"token constant\">ALLOC</span><span class=\"token punctuation\">.</span><span class=\"token function\">buffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç©ºç¼“å†²åŒºå®¹é‡å’Œæœ€å¤§å®¹é‡éƒ½æ˜¯ 0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">assert</span> <span class=\"token constant\">EMPTY_BUFFER</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">EmptyByteBuf</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"EMPTY_BUFFER must be an EmptyByteBuf.\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ByteBufAllocator è´Ÿè´£åˆ†é…ç¼“å†²åŒºï¼Œæœ‰ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»ï¼š <code>UnpooledByteBufAllocator</code>  å’Œ <code>PooledByteBufAllocator</code> ã€‚ä¸€ä¸ªæ˜¯éæ± åŒ–ç¼“å†²åŒºç”Ÿæˆå™¨ï¼Œå¦ä¸€ä¸ªæ˜¯æ± åŒ–ç¼“å†²åŒºç”Ÿæˆå™¨ã€‚</p>\n<blockquote>\n<p>æ± åŒ–æ˜¯å°†ç¼“å†²åŒºé€šè¿‡è®¾ç½®å†…å­˜æ± è¿›è¡Œå†…å­˜å—å¤ç”¨ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜ç”³è¯·ã€‚å°¤å…¶æ˜¯åœ¨ä½¿ç”¨å †å¤–å†…å­˜æ—¶ï¼Œé¿å…å¤šæ¬¡é‡å¤é€šè¿‡åº•å±‚ malloc () å‡½æ•°ç³»ç»Ÿè°ƒç”¨ç”³è¯·å†…å­˜é€ æˆçš„æ€§èƒ½æŸå¤±ã€‚</p>\n</blockquote>\n<h2 id=\"é›¶æ‹·è´ç®€ä»‹\"><a class=\"anchor\" href=\"#é›¶æ‹·è´ç®€ä»‹\">#</a> é›¶æ‹·è´ç®€ä»‹</h2>\n<blockquote>\n<p>æ­¤å¤„å¯¹é›¶æ‹·è´åšç®€å•çš„è®²è§£</p>\n</blockquote>\n<p>é›¶æ‹·è´æ˜¯ä¸€ç§<strong> I/O æ“ä½œä¼˜åŒ–æŠ€æœ¯</strong>ï¼Œå¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°å°†æ•°æ®ä»æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ°ç½‘ç»œæ¥å£ï¼Œè€Œä¸éœ€è¦å°†å…¶ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p>\n<p>è¿™é‡Œè±¡å¾æ€§å¤ä¹ ä¸€ä¸‹å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ï¼š</p>\n<p>æ—©æœŸæ“ä½œç³»ç»Ÿä¸åŒºåˆ†ç”¨æˆ·ä¸å†…æ ¸ï¼Œä½†æ˜¯ç¨‹åºå¾€å¾€ä¼šå› ä¸ºæŸäº›åŸå› ï¼ˆè¯¯æ“ä½œï¼Œä»£ç æ²¡å†™å¯¹ç­‰ï¼‰åœ¨è®¿é—®ä»»æ„å†…å­˜ç©ºé—´æ—¶é€ æˆæ“ä½œç³»ç»Ÿå´©æºƒï¼Œæ¯”å¦‚æ¸…é™¤æ“ä½œç³»ç»Ÿçš„å†…å­˜æ•°æ®ã€‚æ ¹æ® CPU æŒ‡ä»¤é‡è¦æˆéƒ½å¯¹æŒ‡ä»¤è¿›è¡Œåˆ†çº§ï¼šRing0~Ring3ï¼ˆLinux åªæ˜¯ç”¨ 0 å’Œ 3ï¼‰ã€‚Ring3 åªèƒ½è®¿é—®ç”¨æˆ·ç©ºé—´ï¼ˆè¿è¡Œåœ¨ç”¨æˆ·æ€ï¼‰Ring0 è®¿é—®ä»»æ„ç©ºé—´ï¼ˆè¿è¡Œåœ¨å†…æ ¸æ€ï¼‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/d342892940c2fa14.jpg\" alt=\"\" /></p>\n<p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®é™…æ˜¯è¦äº¤ç»™æ“ä½œç³»ç»Ÿä¸ºæˆ‘ä»¬åˆ†é…ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬å®Œæˆç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¯å†…æ ¸åœ¨å¤„ç†è€Œä¸æ˜¯ç¨‹åºï¼ˆæ­¤æ—¶å°±æ˜¯ç¨‹åºé™·å…¥å†…æ ¸æ€ï¼‰ã€‚å½“æ“ä½œç³»ç»Ÿå®Œæˆåˆ†é…ï¼Œä»£ç è¿”å›å¾—åˆ°çº¿ç¨‹å¯¹è±¡ï¼Œä¹‹ååˆç»§ç»­ç”±ç¨‹åºæ“ä½œï¼ˆå†…æ ¸æ€è½¬å›äº†ç”¨æˆ·æ€ï¼‰</p>\n<p>è€Œæ–‡ä»¶æ“ä½œä¹Ÿæ˜¯è¿™æ ·ï¼Œä¼ ç»Ÿä½¿ç”¨ IOï¼Œå°†ç£ç›˜æ•°æ®å‘é€åˆ°ç½‘ç»œï¼Œæµç¨‹å¦‚ä¸‹</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/25957eee4e014389.jpg\" alt=\"\" /></p>\n<p>æ•´ä¸ªè¿‡ç¨‹æœ‰å››æ¬¡æ‹·è´æ•°æ®ï¼Œæµªè´¹æ—¶é—´ï¼Œå¦‚æœèƒ½è®©è¿‡ç”¨æˆ·ç©ºé—´ï¼Œå‡å°‘æ‹·è´æ¬¡æ•°ã€‚</p>\n<p>å®ç°é›¶æ‹·è´ï¼Œæ¼”ç¤ºä¸‰ç§æ–¹æ¡ˆ</p>\n<ul>\n<li>è™šæ‹Ÿå†…å­˜ï¼šå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€æŒ‡å‘åŒä¸€ä¸ªç‰©ç†åœ°å€ï¼Œç›¸å½“äºç›´æ¥å…±ç”¨äº†ä¸€å—åŒºåŸŸ</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/e6bc56bc0d9c3618.jpg\" alt=\"\" /></p>\n<ul>\n<li>mmap/write å†…å­˜æ˜ å°„ï¼šå°†å†…æ ¸ç©ºé—´ä¸­çš„ç¼“å­˜ç›´æ¥æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ç¼“å­˜ï¼Œå°±æ˜¯ç›´æ¥ä½œä¸ºæ˜ å°„å­˜åœ¨ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†æ•°æ®å‘é€åˆ° Socket ç¼“å†²åŒºæ—¶ï¼Œç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­è¿›è¡Œæ“ä½œå°±è¡Œäº†</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/e67004f84f8769fb.jpg\" alt=\"\" /></p>\n<ul>\n<li>sendfile æ–¹å¼ï¼šåœ¨ Linux2.1 å¼€å§‹ï¼Œå¼•å…¥äº† sendfile æ–¹å¼æ¥ç®€åŒ–æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘Šè¯‰å†…æ ¸è¦æŠŠå“ªä¸ªæ–‡ä»¶æ•°æ®æ‹·è´æ‹·è´åˆ° Socket ä¸Šï¼Œç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­ä¸€æ­¥åˆ°ä½</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/bf6615b7a8e70a35.jpg\" alt=\"\" /></p>\n<h2 id=\"nettyå·¥ä½œæ¨¡å‹\"><a class=\"anchor\" href=\"#nettyå·¥ä½œæ¨¡å‹\">#</a> Netty å·¥ä½œæ¨¡å‹</h2>\n<p>ä½¿ç”¨ä¸»ä» Reactor æ¨¡å‹ï¼Œå…ˆçœ‹å¯¹æ¯”å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/12/b66c2c0d915b3463.jpg\" alt=\"\" /></p>\n<p>Boss Group ç›¸å½“äºä¸» Reactorï¼Œå¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥ï¼ŒWorker Group ç›¸å½“äºä» Reactorï¼Œè´Ÿè´£å¤„ç†è¯»å†™äº‹ä»¶ï¼ˆçš„è½®è¯¢ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œå®é™…çš„è¯»å†™æ“ä½œæ˜¯ Handler è´Ÿè´£å¤„ç†ï¼‰ã€‚ä¸¤ä¸ª Group éƒ½æ˜¯ä½¿ç”¨ EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ã€‚</p>\n<p>ä¸Šå›¾å¯èƒ½ä¸å¤ªé†’ç›®ï¼Œä¹Ÿå¯ä»¥çœ‹è¿™å¼ å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/13/fc36cb17a20f7461.jpg\" alt=\"\" /></p>\n<blockquote>\n<p>æ­¤å¤„ä»…å¯¹å·¥ä½œæ¨¡å‹ç®€å•ä»‹ç»</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9kYTNhY2NmYmUzMTA=\">https://www.jianshu.com/p/da3accfbe310</span></p>\n<p>é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2lieDZ1Zw==\">https://www.yuque.com/qingkongxiaguang/javase/ibx6ug</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/05/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(0)-Socket%E5%85%A5%E9%97%A8/",
            "url": "https://cecilia.cool/2022/09/05/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(0)-Socket%E5%85%A5%E9%97%A8/",
            "title": "ç½‘ç»œç¼–ç¨‹(0)--Socketè¯¦è§£",
            "date_published": "2022-09-05T10:57:04.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>è¯¥éƒ¨åˆ†ä¹‹æ‰€ä»¥ä¸º 0ï¼Œæ˜¯å› ä¸ºåœ¨ä¹‹å <code>NIO</code> ï¼Œ <code>AIO</code>  çš„å­¦ä¹ éƒ½ä¼šå¤§é‡ç”¨åˆ° <code>Socket</code>  çš„çŸ¥è¯†ï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„è®©è¯»è€…é˜…è¯»ä¸‹å»ï¼Œè¿™é‡Œå¼€å§‹å¯¹ <code>Socket</code>  åšå‡ºä¸€ç‚¹è¡¥å……ã€‚</p>\n<p>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥ä¹‹åï¼Œé€šè¿‡å¯¹ <code>Socket</code>  å¯¹è±¡çš„å†™å…¥å’Œè¯»å–è¿›è¡Œé€šä¿¡ã€‚</p>\n<p>è¿æ¥è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>æœåŠ¡å™¨å®ä¾‹åŒ–ä¸€ä¸ª  <code>ServerSocket</code>  å¯¹è±¡ï¼Œè¡¨ç¤ºé€šè¿‡æœåŠ¡å™¨ä¸Šçš„ç«¯å£é€šä¿¡ã€‚</li>\n<li>æœåŠ¡å™¨è°ƒç”¨  <code>ServerSocket</code>  ç±»çš„  <code>accept() </code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šç»™å®šçš„ç«¯å£ã€‚</li>\n<li>æœåŠ¡å™¨æ­£åœ¨ç­‰å¾…æ—¶ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡ï¼ŒæŒ‡å®šæœåŠ¡å™¨åç§°å’Œç«¯å£å·æ¥è¯·æ±‚è¿æ¥ã€‚</li>\n<li><code>Socket</code>  ç±»çš„æ„é€ å‡½æ•°è¯•å›¾å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£å·ã€‚å¦‚æœé€šä¿¡è¢«å»ºç«‹ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡èƒ½å¤Ÿä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚</li>\n<li>åœ¨æœåŠ¡å™¨ç«¯ï¼Œ <code>accept() </code> æ–¹æ³•è¿”å›æœåŠ¡å™¨ä¸Šä¸€ä¸ªæ–°çš„  <code>socket</code>  å¼•ç”¨ï¼Œè¯¥  <code>socket</code>  è¿æ¥åˆ°å®¢æˆ·ç«¯çš„  <code>socket</code> ã€‚</li>\n</ul>\n<p><code>TCP</code>  æ˜¯åŒå‘é€šä¿¡åè®®ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶äº’ç›¸å‘æ¶ˆæ¯ã€‚<strong>å®¢æˆ·ç«¯çš„ Socket çš„è¾“å‡ºæµå°±æ˜¯æœåŠ¡ç«¯çš„è¾“å…¥æµï¼Œå®¢æˆ·ç«¯çš„è¾“å…¥æµå°±æ˜¯æœåŠ¡ç«¯çš„è¾“å‡ºæµ</strong>ã€‚</p>\n<h1 id=\"ç›¸å…³å®ç°ç±»\"><a class=\"anchor\" href=\"#ç›¸å…³å®ç°ç±»\">#</a> ç›¸å…³å®ç°ç±»</h1>\n<h2 id=\"serversocketç±»\"><a class=\"anchor\" href=\"#serversocketç±»\">#</a> ServerSocket ç±»</h2>\n<p>æœåŠ¡å™¨åº”ç”¨ç¨‹åºé€šè¿‡è¯¥ç±»è·å–ç«¯å£ï¼ˆæ„é€ å‡½æ•°ä¼ å…¥ç«¯å£ï¼‰ï¼Œå¹¶ä¸”ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p>\n<p>æ„é€ æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å…¶ä»–ä¸‰ä¸ªæ„é€ æ–¹æ³•ï¼Œä»å³è‡³å·¦ä¾æ¬¡å‡å°‘ä¸€ä¸ªå‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨æŒ‡å®šçš„ç«¯å£ã€ä¾¦å¬ backlog å’Œè¦ç»‘å®šåˆ°çš„æœ¬åœ° IP åœ°å€åˆ›å»ºæœåŠ¡å™¨ã€‚</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> port<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> backlog<span class=\"token punctuation\">,</span> <span class=\"token class-name\">InetAddress</span> address<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span></pre></td></tr></table></figure><p>ç›¸å…³æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è·å–è¯¥ Socket ç›‘å¬çš„ç«¯å£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getLocalPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// ä¾¦å¬å¹¶æ¥å—åˆ°æ­¤å¥—æ¥å­—çš„è¿æ¥</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Socket</span> <span class=\"token function\">accpet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// å°† ServerSocket ç»‘å®šåˆ°ç‰¹å®šåœ°å€ (IP åœ°å€å’Œç«¯å£å·)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketAddress</span> host<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> backlog<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"socketç±»\"><a class=\"anchor\" href=\"#socketç±»\">#</a> Socket ç±»</h2>\n<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡ä½¿ç”¨çš„å¥—æ¥å­—ï¼Œå®¢æˆ·ç«¯è¦è·å–ä¸€ä¸ª <code>Socket</code>  ç›´æ¥å®ä¾‹åŒ–ï¼ŒæœåŠ¡ç«¯é€šè¿‡ <code>accept</code>  æ–¹æ³•è¿”å›å€¼ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è¿æ¥åˆ°æŒ‡å®šä¸»æœºçš„æŒ‡å®šç«¯å£å·ä¸Š</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> host<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// è¿æ¥åˆ°æŒ‡å®š IP åœ°å€çš„æŒ‡å®šç«¯å£å·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InetAddress</span> host<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å½“  <code>Socket</code>  æ„é€ æ–¹æ³•è¿”å›ï¼Œå¹¶æ²¡æœ‰ç®€å•çš„å®ä¾‹åŒ–äº†ä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šä¼šå°è¯•è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å°†æ­¤å¥—æ¥å­—è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè¶…æ—¶å€¼ã€‚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketAddress</span> host<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> timeout<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// è¿”å›å¥—æ¥å­—è¿æ¥çš„åœ°å€ã€‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">InetAddress</span> <span class=\"token function\">getInetAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¿”å›å¥—æ¥å­—è¿æ¥çš„è¿œç¨‹ç«¯å£ï¼Œæœ¬åœ°ç«¯å£æ˜¯ getLocalPort</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// è·å–è¾“å…¥ / è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">OutputStream</span> <span class=\"token function\">getOutpurStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"inetaddressç±»\"><a class=\"anchor\" href=\"#inetaddressç±»\">#</a> InetAddress ç±»</h2>\n<p>è¯¥ç±»è¡¨ç¤ºäº’è”ç½‘åè®®ï¼ˆIPï¼‰ï¼Œè¯¥ç±»çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç›´æ¥åœ¨ IDE é‡Œé¢æ‰“å‡º <code>get</code>  å³å¯ã€‚</p>\n<h1 id=\"ç¤ºä¾‹\"><a class=\"anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h1>\n<p>å®¢æˆ·ç«¯ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// è¾“å‡ºæµï¼Œå‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">OutputStream</span> out <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å…¶å®ä¹Ÿå¯ä»¥æ˜¯è¾“å…¥æµï¼Œæ— éå°±æ˜¯æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> arr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// ä¹Ÿå¯ä»¥ç”¨å…¶ä»–å€ŸåŠ©è£…é¥°è€…ç±»å®ç°æ›´å¤šåŠŸèƒ½çš„ç±»</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        server<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶å®æœåŠ¡ç«¯åº”è¯¥æ˜¯ <code>while</code>  å¾ªç¯ä¸æ–­è·å–å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„è¿æ¥ã€‚æˆ‘ä»¬çœ‹åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥ä¼ è¾“æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯ IO æµï¼Œæ¯”å¦‚æœåŠ¡ç«¯è¦è·å–å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œå°±éœ€è¦è°ƒç”¨ <code>read</code>  æ–¹æ³•ï¼Œå¦‚æœå®¢æˆ·ç«¯é‚£è¾¹æ•°æ®æ²¡å‡†å¤‡å¥½ï¼Œå°±ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œã€‚</p>\n<p>å®¢æˆ·ç«¯æ˜¯ä¸€æ ·çš„é“ç†ã€‚æ—¢ç„¶å­˜åœ¨é˜»å¡ï¼Œé‚£ä¹ˆåœ¨è®¾è®¡çš„æ—¶å€™å°±å­˜åœ¨åŒæ­¥å¼‚æ­¥é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¹‹åæ¶‰åŠçš„ NIOï¼ŒAIO ç­‰çŸ¥è¯†ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9qYXZhL2phdmEtbmV0d29ya2luZy5odG1s\">https://www.runoob.com/java/java-networking.html</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/04/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(5)-AIO%E5%9F%BA%E6%9C%AC%E8%AF%A6%E8%A7%A3/",
            "url": "https://cecilia.cool/2022/09/04/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(5)-AIO%E5%9F%BA%E6%9C%AC%E8%AF%A6%E8%A7%A3/",
            "title": "ç½‘ç»œç¼–ç¨‹(5)--AIOåŸºæœ¬è¯¦è§£",
            "date_published": "2022-09-04T07:58:57.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>å‰é¢ä¸‰ç§ IO æ¨¡å‹ï¼šé˜»å¡å¼åŒæ­¥ï¼Œéé˜»å¡å¼åŒæ­¥ï¼Œå¤šè·¯å¤ç”¨éƒ½æ˜¯é‡‡ç”¨çš„åº”ç”¨ä¸»åŠ¨è¯¢é—®æ“ä½œç³»ç»Ÿã€‚ä¹Ÿå°±å¯¼è‡´ä»–ä»¬éƒ½ä¼šåœ¨æ‰§è¡Œ <code>read</code>  å‡½æ•°ä¸­é˜»å¡ä½ã€‚</p>\n<p>å¼‚æ­¥ IO é‡‡ç”¨çš„æ˜¯ â€œè®¢é˜… - é€šçŸ¥â€ æ¨¡å¼ï¼šåº”ç”¨ç¨‹åºå‘æ“ä½œç³»ç»Ÿæ³¨å†Œ IO ç›‘å¬ï¼Œç„¶åç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ï¼Œå½“æ“ä½œç³»ç»Ÿå‘ç”Ÿ IO äº‹ä»¶ï¼Œå¹¶ä¸”å‡†å¤‡å¥½æ•°æ®åï¼Œå†ä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œè§¦å‘ç›¸åº”çš„å‡½æ•°ã€‚</p>\n<p>å¼‚æ­¥ IO ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œæ”¯æŒçš„ï¼ŒWindows ç³»ç»Ÿæä¾›çš„å¼‚æ­¥ IO æŠ€æœ¯ä¸º <code>IOCP</code> ï¼ˆI/O Completion Portï¼ŒI/O å®Œæˆç«¯å£ï¼‰ã€‚Linux ä½¿ç”¨çš„æ˜¯ <code>epoll</code>  å¤šè·¯å¤ç”¨ IO æŠ€æœ¯æ¨¡æ‹Ÿå¼‚æ­¥ IOã€‚</p>\n<h1 id=\"javaå¯¹å¼‚æ­¥ioçš„æ”¯æŒ\"><a class=\"anchor\" href=\"#javaå¯¹å¼‚æ­¥ioçš„æ”¯æŒ\">#</a> Java å¯¹å¼‚æ­¥ IO çš„æ”¯æŒ</h1>\n<p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ± ç”¨äºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œæäº¤ä»»åŠ¡çš„çº¿ç¨‹è®²ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± å°±å¯ä»¥ç«‹é©¬è¿”å›ï¼Œä¸å¿…ç­‰åˆ°ä»»åŠ¡æ­£åœ¨å®Œæˆï¼Œç­‰æˆ‘ä»¬éœ€è¦æ‰§è¡Œç»“æœæ—¶ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°çš„æ–¹å¼ï¼Œä»»åŠ¡ç»“æŸåè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ˆ<a href=\"https://cecilia.cool/2022/08/24/Java/%E5%B9%B6%E5%8F%91/Java%E7%BA%BF%E7%A8%8B%E6%B1%A02-FutureTask/\">FutureTask</a>ï¼‰ã€‚</p>\n<p>Java ä¸­çš„å¼‚æ­¥ IO ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ± æ¥è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œç„¶åä½¿ç”¨å›è°ƒæˆ–è‡ªå·±å»æŸ¥è¯¢ç»“æœã€‚</p>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/02/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(4)-NIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E8%AF%A6%E8%A7%A3/",
            "url": "https://cecilia.cool/2022/09/02/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(4)-NIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E8%AF%A6%E8%A7%A3/",
            "title": "ç½‘ç»œç¼–ç¨‹(4)--IOå¤šè·¯å¤ç”¨è¯¦è§£",
            "date_published": "2022-09-02T01:20:52.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>å…³äºå¤šè·¯å¤ç”¨ï¼ˆwindows ä¸‹ä½¿ç”¨ selectï¼‰çš„ç®€å•ä»‹ç»å·²ç»åœ¨<strong> Unix IO æ¨¡å‹</strong>å’Œ<strong> NIO åŸºç¡€è¯¦è§£</strong>ä¸­å¤§è‡´æåˆ°ï¼Œå¹¶ç»™å‡ºäº†ä»£ç å®ç°ã€‚æœ¬æ–‡ä¼šå¯¹ç›¸å…³æ–¹æ³•å’Œæ¨¡å‹è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</p>\n<p>å¤šè·¯å¤ç”¨ IO æŠ€æœ¯æœ€é€‚ç”¨çš„æ˜¯ â€œé«˜å¹¶å‘â€ åœºæ™¯ï¼Œæ‰€è°“<strong>é«˜å¹¶å‘æ˜¯æŒ‡ 1 æ¯«ç§’å†…è‡³å°‘åŒæ—¶æœ‰ä¸Šåƒä¸ªè¿æ¥è¯·æ±‚å‡†å¤‡å¥½</strong>ã€‚</p>\n<pre><code>try(ServerSocket server = new ServerSocket(8888)) &#123;\n    Socket s = server.accept();\n\n    System.out.println(&quot;æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥&quot;);\n\n    BufferedReader reader = new BufferedReader(new InputStreamReader(s.getInputStream()));\n\n    System.out.println(&quot;æœåŠ¡ç«¯è¯»å–æ•°æ®ï¼š &quot; + reader.readLine());\n\n    OutputStreamWriter write = new OutputStreamWriter(s.getOutputStream());\n\n    write.write(&quot;æœåŠ¡ç«¯å·²æ”¶åˆ°æ•°æ®&quot;);\n    write.flush();\n&#125;\n</code></pre>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">OutputStreamWriter</span> write <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutputStreamWriter</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    write<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼šxyz\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    write<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å‘é€æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®ï¼š \"</span><span class=\"token operator\">+</span>reader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"æ¨¡å‹\"><a class=\"anchor\" href=\"#æ¨¡å‹\">#</a> æ¨¡å‹</h1>\n<h2 id=\"ä¼ ç»Ÿioæ¨¡å‹\"><a class=\"anchor\" href=\"#ä¼ ç»Ÿioæ¨¡å‹\">#</a> ä¼ ç»Ÿ IO æ¨¡å‹</h2>\n<p>ä¸€ä¸ª <code>Server</code>  å¯¹æ¥ N ä¸ªå®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥ä¹‹åï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½åˆ†é…ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/02/d6855af86b51f707.jpg\" alt=\"ä¼ ç»ŸIOæ¨¡å‹\" /></p>\n<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå…¶ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°è¾¾ä¹‹åï¼ŒæœåŠ¡ç«¯ä¼šåˆ†é…ä¸€ä¸ªçº¿ç¨‹ç»™è¯¥å®¢æˆ·ç«¯ï¼Œè¯¥çº¿ç¨‹ä¼šå¤„ç†åŒ…æ‹¬è¯»å–æ•°æ®ï¼Œè§£ç ï¼Œä¸šåŠ¡è®¡ç®—ï¼Œç¼–ç ï¼Œä»¥åŠå‘é€æ•°æ®æ•´ä¸ªè¿‡ç¨‹ï¼›</li>\n<li>åŒä¸€æ—¶åˆ»ï¼ŒæœåŠ¡ç«¯çš„ååé‡ä¸æœåŠ¡å™¨æ‰€æä¾›çš„çº¿ç¨‹æ•°é‡æ˜¯å‘ˆçº¿æ€§å…³ç³»çš„ã€‚</li>\n</ul>\n<p>ä½†æ˜¯è¿™ä¹Ÿæœ‰å¾ˆå¤§é—®é¢˜ï¼š</p>\n<ul>\n<li>\n<p>æœåŠ¡å™¨å¹¶å‘é‡ä¸¥é‡ä¾èµ–äºæœåŠ¡ç«¯èƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°ã€‚</p>\n</li>\n<li>\n<p>æœåŠ¡ç«¯åœ¨è·å–å®¢æˆ·ç«¯è¿æ¥ï¼Œè¯»å–æ•°æ®ï¼Œä»¥åŠå†™å…¥æ•°æ®çš„è¿‡ç¨‹éƒ½æ˜¯é˜»å¡ç±»å‹çš„ï¼Œåœ¨ç½‘ç»œçŠ¶å†µä¸å¥½çš„æƒ…å†µä¸‹ï¼Œè¿™å°†æå¤§çš„é™ä½æœåŠ¡å™¨æ¯ä¸ªçº¿ç¨‹çš„åˆ©ç”¨ç‡ï¼Œä»è€Œé™ä½æœåŠ¡å™¨ååé‡ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>å¦‚æœæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½ç»´æŒä¸€ä¸ªä¸ç™»é™†æœåŠ¡å™¨çš„è¿æ¥ã€‚é‚£ä¹ˆæœåŠ¡å™¨å°†<strong>ç»´æŠ¤</strong>å¤šä¸ªå’Œå®¢æˆ·ç«¯çš„è¿æ¥ä»¥å‡ºæ¥å’Œå®¢æˆ·ç«¯çš„ contnect ã€readã€write ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé•¿é“¾æ¥çš„æœåŠ¡ï¼Œæœ‰å¤šå°‘ä¸ª c ç«¯ï¼Œå°±éœ€è¦åœ¨ s ç«¯ç»´æŠ¤åŒç­‰çš„ IO è¿æ¥ã€‚è¿™å¯¹æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¼€é”€ã€‚</p>\n</blockquote>\n<p>ä»£ç å®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æœåŠ¡ç«¯ -- å…¶å®è¿™é‡Œåº”è¯¥å†™æ­»å¾ªç¯çš„</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocket</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">Socket</span> s <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯è¯»å–æ•°æ®ï¼š \"</span> <span class=\"token operator\">+</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">OutputStreamWriter</span> write <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutputStreamWriter</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// ä¸¤è¾¹æ¥æ”¶æ•°æ®éƒ½æ˜¯ readLineï¼Œæ‰€ä»¥å¿…é¡»åŠ æ¢è¡Œç¬¦</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            write<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡ç«¯å·²æ”¶åˆ°æ•°æ®\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            write<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// å®¢æˆ·ç«¯</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NIOClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">OutputStreamWriter</span> write <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutputStreamWriter</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// ä¸¤è¾¹æ¥æ”¶æ•°æ®éƒ½æ˜¯ readLineï¼Œæ‰€ä»¥å¿…é¡»åŠ æ¢è¡Œç¬¦</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            write<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼šxyz\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            write<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å‘é€æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®ï¼š \"</span><span class=\"token operator\">+</span>reader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>ä½ ä¹Ÿå¯ä»¥è¯•ç€ä½¿ç”¨é€šé“å’Œç¼“å†²åŒºå®ç°ï¼Œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tsNjh0eSNkZDkzZDcxNA==\">å‚è€ƒé“¾æ¥</span>ã€‚</p>\n</blockquote>\n<h2 id=\"ioå¤šè·¯å¤ç”¨\"><a class=\"anchor\" href=\"#ioå¤šè·¯å¤ç”¨\">#</a> I/O å¤šè·¯å¤ç”¨</h2>\n<p>ä¹‹å‰è®²äº† I/O å¤šè·¯å¤ç”¨çš„æ¨¡å‹ä»‹ç»å¤§æ¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™å‡ºæºç å®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span> serverChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// å¼€å¯ä¸€ä¸ªæ–°çš„ Selectorï¼Œè¿™ç©æ„ä¹Ÿæ˜¯è¦å…³é—­é‡Šæ”¾èµ„æºçš„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// è¦ä½¿ç”¨é€‰æ‹©å™¨è¿›è¡Œæ“ä½œï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡çš„æ–¹å¼ï¼Œè¿™æ ·æ‰ä¸ä¼šåƒé˜»å¡ IO é‚£æ ·å¡åœ¨ accept ()ï¼Œ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">// è€Œæ˜¯ç›´æ¥é€šè¿‡ï¼Œè®©é€‰æ‹©å™¨å»è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å°† ServerChannel æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œæ­¤æ—¶åªæœ‰é€‰æ‹©å™¨åªä¼šç›‘å¬è¿™ä¸€ä¸ªé€šé“</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å› ä¸ºæ˜¯ ServerSocketChannel è¿™é‡Œæˆ‘ä»¬å°±ç›‘å¬ accept å°±å¯ä»¥äº†ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// æ— é™å¾ªç¯ç­‰å¾…æ–°çš„ç”¨æˆ·ç½‘ç»œæ“ä½œ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// æ¯æ¬¡é€‰æ‹©éƒ½å¯èƒ½ä¼šé€‰å‡ºå¤šä¸ªå·²ç»å°±ç»ªçš„ç½‘ç»œæ“ä½œï¼Œæ²¡æœ‰æ“ä½œæ—¶ä¼šæš‚æ—¶é˜»å¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç›‘å¬åˆ° \"</span><span class=\"token operator\">+</span>count<span class=\"token operator\">+</span><span class=\"token string\">\" ä¸ªäº‹ä»¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œæ‹¿åˆ°çš„äº‹ä»¶ SelectionKey ç»‘å®šçš„é€šé“éƒ½æ˜¯ ServerChannel</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token comment\">// æ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Œæ‰§è¡Œä¸åŒçš„æ“ä½œå³å¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// è¯¥äº‹ä»¶ç»‘å®šçš„é€šé“å°±æ˜¯ ServerChannel</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// å¦‚æœ ServerSocketChannel å·²ç»åšå¥½å‡†å¤‡å¤„ç† Accept</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token comment\">// æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦è¿æ¥ï¼ˆä¹‹åå¯èƒ½ä¼šå‘é€æ•°æ®ç»™æœåŠ¡ç«¯ï¼‰</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token comment\">// æ‰€ä»¥æˆ‘ä»¬å°†å®¢æˆ·ç«¯çš„é€šé“åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å·²è¿æ¥ï¼ŒIPåœ°å€ä¸ºï¼š\"</span><span class=\"token operator\">+</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token comment\">// ç°åœ¨è¿æ¥å°±å»ºç«‹å¥½äº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†è¿æ¥ä¹Ÿæ³¨å†Œé€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token comment\">// è¿™æ ·å°±åœ¨è¿æ¥å»ºç«‹æ—¶å®Œæˆäº†æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>    <span class=\"token comment\">// å¦‚æœå½“å‰è¿æ¥æœ‰å¯è¯»çš„æ•°æ®å¹¶ä¸”å¯ä»¥å†™ï¼Œé‚£ä¹ˆå°±å¼€å§‹å¤„ç†</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                    <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                    <span class=\"token comment\">// ç›´æ¥å‘é€šé“ä¸­å†™å…¥æ•°æ®å°±è¡Œ</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token comment\">// åˆ«å…³ï¼Œè¯´ä¸å®šç”¨æˆ·è¿˜è¦ç»§ç»­é€šä¿¡å‘¢</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token comment\">// å¤„ç†å®Œæˆåï¼Œä¸€å®šè®°å¾—ç§»å‡ºè¿­ä»£å™¨ï¼Œä¸ç„¶ä¸‹æ¬¡è¿˜æœ‰</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                iterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯å…³äºæœåŠ¡å™¨çš„ä»£ç ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯ <code>SelectionKey</code> ï¼Œå®ƒåŒ…å«äº†ç›‘å¬äº‹ä»¶æ³¨å†Œæ—¶çš„é€šé“ï¼Œæ¯”å¦‚ä¸€å¼€å§‹æˆ‘ä»¬å°†é€šé“ <code>ServerSocketChannel</code>  æ³¨å†Œåˆ°é€‰æ‹©å™¨ï¼Œç„¶ååœ¨ <code>if</code>  é€‰æ‹©è¯­å¥ä¸­æ‹¿åˆ°çš„ <code>key</code>  å°±åŒ…å« <code>ServerSocket</code> ã€‚</p>\n<p><code>SelectionKey</code>  æœ‰ä¸€ä¸ª <code>channel()</code>  æ–¹æ³•ï¼Œä½¿ç”¨æ—¶éœ€è¦å¼ºè½¬ä¸€ä¸‹ã€‚å› ä¸ºç¬¬ä¸€ä¸ª <code>if</code>  å·²ç»æœ‰äº† <code>ServerSocketChannel</code>  çš„å¼•ç”¨ï¼Œå°±æ²¡å¿…è¦è°ƒç”¨ <code>cahnel()</code> ã€‚</p>\n<p>ä¹‹åçš„å®¢æˆ·ç«¯ä»£ç å°±æ¯”è¾ƒç®€å•äº†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªæ–°çš„ SocketChannelï¼Œé€šè¿‡é€šé“è¿›è¡Œé€šä¿¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²è¿æ¥åˆ°æœåŠ¡ç«¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// å’±ç»™å®ƒå¥—ä¸ªæ— é™å¾ªç¯ï¼Œè¿™æ ·å°±èƒ½ä¸€ç›´å‘æ¶ˆæ¯äº†</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·è¾“å…¥è¦å‘é€ç»™æœåŠ¡ç«¯çš„å†…å®¹ï¼š\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">String</span> text <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// ç›´æ¥å‘é€šé“ä¸­å†™å…¥æ•°æ®ï¼ŒçœŸèˆ’æœ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²å‘é€ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç›´æ¥ä»é€šé“ä¸­è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ”¶åˆ°æœåŠ¡å™¨è¿”å›ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯·è¯»è€…å°†è¿™éƒ¨åˆ†ä»£ç å¼„æ¸…æ¥šï¼Œä¸æ¸…æ¥šå°±å»æŸ¥ï¼Œä¸‹é¢ç»™å¤§å®¶å‡ ç¯‡å†™çš„æ¯”è¾ƒå¥½çš„åšå®¢</p>\n<blockquote>\n<p>ç”°å®ˆæ Java æŠ€æœ¯åšå®¢ï¼ˆè®²è§£ç»†è‡´ï¼Œå»ºè®®æ”¶è—ï¼‰ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50aWFuc2hvdXpoaS5jb20vYXBpL3R1dG9yaWFscy9uZXR0eS8zMTg=\">http://www.tianshouzhi.com/api/tutorials/netty/318</span></p>\n<p>å¹¶å‘ç¼–ç¨‹ç½‘ï¼ˆå¾ˆçŸ­ï¼Œæ¨èçœ‹ä¸€ä¸‹ï¼‰ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2lmZXZlLmNvbS9zZXJ2ZXItc29ja2V0LWNoYW5uZWwv\">http://ifeve.com/server-socket-channel/</span></p>\n<p>CSDNï¼ˆè¿™ç¯‡åšå®¢æˆ‘åªçœ‹äº†å‰é¢å‡ å¥è¯ï¼Œæåˆ°äº†æˆ‘å¿½ç•¥çš„ç‚¹ï¼‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvbGRfX19wbGF5L2FydGljbGUvZGV0YWlscy8xMDY2NjM3NzY=\">https://blog.csdn.net/cold___play/article/details/106663776</span></p>\n</blockquote>\n<p>ä½†æ˜¯è¿™ä¸ªä¹Ÿå­˜åœ¨é—®é¢˜ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å¿™ä¸è¿‡æ¥ï¼ˆçœŸå®ï¼‰ï¼Œæ‰€ä»¥ä¹‹åçš„ <code>Reactor</code>  æ¨¡å‹ä¼šä½¿ç”¨åˆ°çº¿ç¨‹æ± ã€‚</p>\n<h2 id=\"å•çº¿ç¨‹reactoræ¨¡å‹\"><a class=\"anchor\" href=\"#å•çº¿ç¨‹reactoræ¨¡å‹\">#</a> å•çº¿ç¨‹ Reactor æ¨¡å‹</h2>\n<p><code>Reactor</code>  æ¨¡å‹ä¸»è¦æ˜¯å¯¹æœåŠ¡å™¨è¿›è¡Œä¼˜åŒ–ï¼Œé¦–å…ˆæˆ‘ä»¬æŠ½è±¡å‡ºä¸¤ä¸ªç»„ä»¶</p>\n<ul>\n<li><code>Reactor</code>  çº¿ç¨‹ï¼šè´Ÿè´£å“åº” IO äº‹ä»¶ï¼Œå¹¶åˆ†å‘åˆ° <code>Handler</code>  å¤„ç†å™¨ã€‚æ–°çš„äº‹ä»¶åŒ…å«è¿æ¥å»ºç«‹å°±ç»ªï¼Œè¯»å°±ç»ªï¼Œå†™å°±ç»ªç­‰ã€‚</li>\n<li>Handler å¤„ç†å™¨ï¼šæ‰§è¡Œ<strong>éé˜»å¡</strong>çš„æ“ä½œï¼ˆå› ä¸º <code>Selector</code>  åªæœ‰ç›‘å¬åˆ°äº†çœŸæ­£è¦æ‰§è¡Œçš„äº‹ä»¶ï¼Œæ‰ä¼šå°†è¯¥äº‹ä»¶äº¤ç»™ <code>Handler</code>  æ‰§è¡Œï¼Œæ‰€ä»¥ä¸å­˜åœ¨é˜»å¡æ“ä½œï¼‰ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/07/315c775016584c9b.jpg\" alt=\"å›¾ç‰‡æºè‡ªé’ç©ºã®éœå…‰\" /></p>\n<p><code>JDK1.4</code>  æä¾›äº†ä¸€å¥—éé˜»å¡ <code>IO</code>  çš„ <code>API</code> ï¼Œæœ¬è´¨æ˜¯ä»¥<strong>äº‹ä»¶é©±åŠ¨</strong>æ¥å¤„ç†ç½‘ç»œäº‹ä»¶çš„ï¼Œ <code>Reactor</code>  æ˜¯åŸºäºè¯¥ <code>API</code>  æå‡ºçš„ä¸€å¥— <code>IO</code>  æ¨¡å‹ã€‚</p>\n<p>è¯¥æ¨¡å‹ä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šå®¢æˆ·ç«¯è¿æ¥ï¼ŒReactorï¼ŒAcceptorï¼ŒHandlerã€‚</p>\n<p><code>Reactor</code>  æ¨¡å‹æ˜¯ä»¥äº‹ä»¶è¿›è¡Œé©±åŠ¨çš„ï¼ˆåº”è¯¥å·²ç»å¾ˆäº†è§£äº‹ä»¶é©±åŠ¨äº†å§ï¼‰ï¼Œå…¶èƒ½å¤Ÿå°†æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œ+ ç½‘ç»œè¯»å’Œç½‘ç»œå†™ï¼Œä»¥åŠ<strong>ä¸šåŠ¡è®¡ç®—è¿›è¡Œæ‹†åˆ†</strong>ï¼Œä»è€Œæå¤§çš„æå‡å¤„ç†æ•ˆç‡ï¼›Reactor æ¨¡å‹æ˜¯å¼‚æ­¥<strong>éé˜»å¡</strong>æ¨¡å‹ï¼Œå·¥ä½œçº¿ç¨‹åœ¨æ²¡æœ‰ç½‘ç»œäº‹ä»¶æ—¶å¯ä»¥å¤„ç†å…¶ä»–çš„ä»»åŠ¡ï¼Œè€Œä¸ç”¨åƒä¼ ç»Ÿ IO é‚£æ ·å¿…é¡»é˜»å¡ç­‰å¾…ã€‚</p>\n<blockquote>\n<p><code>Acceptor</code>  å¤„ç†å®¢æˆ·ç«¯æ–°è¿æ¥ï¼Œå¹¶åˆ†æ´¾è¯·æ±‚åˆ°å¤„ç†å™¨é“¾ï¼ˆ <code>Reactor</code> ï¼‰</p>\n</blockquote>\n<p>ä¸‹å›¾æ˜¯æ¯”è¾ƒæ­£ç»ï¼ˆéš¾æ‡‚ï¼‰çš„å›¾ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/03/b23b2105c197fe2f.jpg\" alt=\"Reactoræ¨¡å‹\" /></p>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>Handler</code>  ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ‰§è¡Œéé˜»å¡æ“ä½œï¼Œè¯·è®°ä½ï¼Œread åœ¨è¿™é‡Œä¹Ÿæ˜¯éé˜»å¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                               <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¥ç€æ˜¯ <code>Acceptor</code> ï¼Œéå¸¸å¿«å°±èƒ½çœ‹å®Œã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Acceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ServerSocketChannel</span> serverChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Acceptor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span> serverChannel<span class=\"token punctuation\">,</span><span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serverChannel <span class=\"token operator\">=</span> serverChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>selector <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯å·²è¿æ¥ï¼ŒIPåœ°å€ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                              channel<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// æ³¨å†Œæ—¶ï¼Œåˆ›å»ºå¥½å¯¹åº”çš„ Handlerï¼Œè¿™æ ·åœ¨ Reactor ä¸­åˆ†å‘çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥è°ƒç”¨ Handler</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span><span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€åçœ‹ä¸€ä¸‹ <code>Reactor</code>  çš„å®ç°ï¼Œè¿™é‡Œçš„ <code>dispatch</code>  ä½¿ç”¨äº† <code>attachment</code>  æ–¹æ³•</p>\n<blockquote>\n<p>é€‰æ‹©é”®æ”¯æŒå°†å•ä¸ªä»»æ„å¯¹è±¡é™„åŠ åˆ°æŸä¸ªé”®çš„æ“ä½œã€‚å¯é€šè¿‡ <code>attach()</code>  æ–¹æ³•é™„åŠ å¯¹è±¡ï¼Œç„¶åé€šè¿‡ <code>attachment()</code>  æ–¹æ³•è·å–è¯¥å¯¹è±¡ã€‚æˆ‘ä»¬åœ¨ Acceptor å’Œ Handler éƒ½æ²¡æœ‰ä½¿ç”¨ <code>attach</code>  æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨æ³¨å†Œæ—¶ç»‘å®š <code>SelectionKey key=channel.register(selector,SelectionKey.OP_READ,theObject);</code></p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Reactor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Closeable</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ServerSocketChannel</span> serverChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Reactor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        serverChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token class-name\">Public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒReactor å¹¶ä¸å¤„ç†è¿æ¥ï¼Œè€Œæ˜¯å°†éœ€è¦è¿æ¥çš„</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// äº‹ä»¶äº¤ç»™ acceptor å¤„ç†</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEP</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Acceptor</span><span class=\"token punctuation\">(</span>serverChannel<span class=\"token punctuation\">,</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç›‘å¬åˆ° \"</span> <span class=\"token operator\">+</span> count <span class=\"token operator\">+</span> <span class=\"token string\">\" ä¸ªäº‹ä»¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> set <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectionKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> set<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasnext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token comment\">// é€šè¿‡ dispatch æ–¹æ³•åˆ†å‘å‡ºå»</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    iterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>selectionKey key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token class-name\">Object</span> att  <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>att <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token comment\">// Handler å’Œ Acceptor éƒ½å®ç°è‡ª Runnable æ¥å£ï¼Œè¿™é‡Œå°±ç»Ÿä¸€è°ƒç”¨ä¸€ä¸‹</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">)</span> att<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        selector<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>     </pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯å•çº¿ç¨‹æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReactor å’Œ Hander éƒ½æ˜¯å¤„äºä¸€æ¡çº¿ç¨‹æ‰§è¡Œã€‚ç”±äºæ˜¯å•çº¿ç¨‹ï¼Œåªè¦æœ‰ä¸€ä¸ª handler å‡ºç°é˜»å¡ï¼Œå…¶ä»–çš„ Client éƒ½ä¼šè¢«é˜»å¡ï¼Œå¹¶ä¸”ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸èµ„æºã€‚æ‰€ä»¥å•çº¿ç¨‹æ¨¡å‹ä»…ä»…é€‚ç”¨äº handler ä¸­ä¸šåŠ¡å¤„ç†ç»„ä»¶èƒ½å¿«é€Ÿå®Œæˆçš„åœºæ™¯ã€‚</p>\n</blockquote>\n<p>æ‰€ä»¥æ•´ä¸ªæµç¨‹å›¾ä¹Ÿå¯ä»¥è¿™ä¹ˆç”»ï¼ˆå…¶å®è¿™ä¸ªå›¾ç”»çš„ä¸å‡†ç¡®ï¼Œ <code>client</code>  åº”è¯¥æŒ‡å‘ <code>Reactor</code> ï¼Œè€Œä¸”æ­¤å¤„ä¹Ÿçœç•¥äº† <code>dispatch</code> ï¼‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/04/1fd0e8d34115ad66.jpg\" alt=\"Reactorå•çº¿ç¨‹æ¨¡å‹\" /></p>\n<h2 id=\"å¤šçº¿ç¨‹reactoræ¨¡å‹\"><a class=\"anchor\" href=\"#å¤šçº¿ç¨‹reactoræ¨¡å‹\">#</a> å¤šçº¿ç¨‹ Reactor æ¨¡å‹</h2>\n<p>å…ˆçœ‹ä¸€ä¸‹<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzc3MzcxNjEvP3NwbV9pZF9mcm9tPTMzMy45OTkuMC4w\">é’ç©ºã®éœå…‰</span>ç»™çš„å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/07/c06c6ae8afed08f1.jpg\" alt=\"\" /></p>\n<p>ç›¸å…³æ”¹è¿›ä¸ºï¼š</p>\n<ul>\n<li>å°† <code>Handler</code>  å¤„ç†å™¨çš„æ‰§è¡Œæ”¾å…¥çº¿ç¨‹æ± ï¼Œå¤šçº¿ç¨‹è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚<strong>æ­¤æ—¶ handler å¤„ç†çš„æ˜¯éé˜»å¡ä»»åŠ¡</strong>ã€‚æ‰€ä»¥è¿™ä¸ªæ¨¡å‹åˆå«åšï¼š<strong>ä¸šåŠ¡å¤„ç†ä¸ IO åˆ†ç¦»</strong>ã€‚</li>\n<li>å¯¹äº <code>Reactor</code>  è€Œè¨€ï¼Œä»ç„¶æ˜¯å•çº¿ç¨‹ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/04/76186bdd3784f6b0.jpg\" alt=\"Reactorå¤šçº¿ç¨‹æ¨¡å‹\" /></p>\n<p>ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>\n<p>æœ‰ä¸€ä¸ªä¸“é—¨çš„ NIO çº¿ç¨‹ç”¨äºç›‘å¬æœåŠ¡å™¨ï¼Œæ¥æ”¶å®¢æˆ·ç«¯çš„ TCP è¿æ¥è¯·æ±‚ä»¥åŠç½‘ç»œè¯»å†™äº‹ä»¶çš„å¤„ç†ï¼ˆå¯ä»¥çœ‹åˆ° <code>read</code>  å’Œ <code>send</code>  ä»ç„¶æ˜¯ <code>Reactor</code>  åœ¨å¤„ç†ï¼‰ã€‚</p>\n</li>\n<li>\n<p>æ¥æ”¶åˆ°è¿æ¥ä¹‹åï¼Œå°†è¯¥é“¾æ¥äº¤ç»™çº¿ç¨‹æ± ï¼Œè¿™äº› NIO çº¿ç¨‹è´Ÿè´£æ¶ˆæ¯çš„è¯»å–ï¼Œè§£ç ï¼Œç¼–ç å’Œå‘é€ã€‚</p>\n</li>\n</ul>\n<p>åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒReactor å¤šçº¿ç¨‹æ¨¡å‹å¯ä»¥æ»¡è¶³æ€§èƒ½éœ€æ±‚ï¼Œä½†æ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª NIO çº¿ç¨‹è´Ÿè´£ç›‘å¬å’Œå¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥åŒæ—¶è¿˜è¦è´Ÿè´£å¤„ç†ç½‘ç»œè¯»å†™å¯èƒ½ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚<strong>ç™¾ä¸‡å®¢æˆ·ç«¯å¹¶å‘è¿æ¥ï¼Œæˆ–åˆ™æœåŠ¡ç«¯éœ€è¦å¤šå®¢æˆ·ç«¯çš„æ¡æ‰‹ä¿¡æ¯è¿›è¡Œå®‰å…¨è®¤è¯ï¼Œè®¤è¯æœ¬èº«éå¸¸æ¶ˆè€—æ€§èƒ½</strong>ã€‚</p>\n<p>ä»£ç ï¼šæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ <code>Handler</code>  å³å¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// æŠŠçº¿ç¨‹æ± ç»™å®‰æ’äº†ï¼Œ10 ä¸ªçº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// çœŸæ­£é¡¹ç›®å¼€å‘ï¼Œçº¿ç¨‹æ± ä¸€èˆ¬æ˜¯è‡ªå®šä¹‰çš„ã€‚</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ExecutorService</span> <span class=\"token constant\">POOL</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>channel <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token constant\">POOL</span><span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼š\"</span><span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²æ”¶åˆ°ï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"ä¸»ä»reactorå¤šçº¿ç¨‹æ¨¡å‹\"><a class=\"anchor\" href=\"#ä¸»ä»reactorå¤šçº¿ç¨‹æ¨¡å‹\">#</a> ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹</h2>\n<p>å…ˆçœ‹ä¸€ä¸‹ç®€åŒ–å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/07/bbcf85b18177c5c2.jpg\" alt=\"\" /></p>\n<p>ä¹‹å‰çš„æ¨¡å‹æ—¢è¦å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆè¦å¤„ç†ç½‘ç»œè¯»å†™ï¼Œä½†æ˜¯ç½‘ç»œè¯»å†™åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¼šæˆä¸ºç³»ç»Ÿçš„ä¸€ä¸ªç“¶é¢ˆã€‚æ‰€ä»¥å°† <code>Reactor</code>  æ‹†åˆ†ä¸º <code>mainReactor</code>  å’Œ <code>subReactor</code> ã€‚å³ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œç½‘ç»œè¯»å†™ï¼Œåªæ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ã€‚</p>\n<ul>\n<li><code>mainReactor</code>  ä¸»è¦è¿›è¡Œå®¢æˆ·ç«¯è¿æ¥çš„å¤„ç†ï¼Œå¤„ç†å®Œæˆä¹‹åå°†è¯¥é“¾æ¥äº¤ç»™ <code>subReactor</code>  å¤„ç†å®¢æˆ·ç«¯çš„ç½‘ç»œè¯»å†™ã€‚</li>\n<li><code>subReactor</code>  ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ± æ¥æ”¯æ’‘ï¼Œè€Œå…¶ä»–ä¸šåŠ¡æ“ä½œä¹Ÿæ˜¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/04/f9e540e1a225450d.jpg\" alt=\"ä¸»ä»Reactoræ¨¡å‹\" /></p>\n<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡å™¨çš„æ€§èƒ½å°†ä¼šå¤§å¤§æå‡ï¼Œåœ¨å¯è§æƒ…å†µä¸‹ï¼Œå…¶åŸºæœ¬ä¸Šå¯ä»¥æ”¯æŒç™¾ä¸‡è¿æ¥ã€‚å¦‚æœæƒ³çœ‹å…·ä½“çš„å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0phY2tfX2lUL2FydGljbGUvZGV0YWlscy8xMDcwMTA0ODY=\">æ·±å…¥ç†è§£ä¸»ä» Reactor å¤šçº¿ç¨‹æ¨¡å‹</span>ã€‚</p>\n<p>è¿™æ¬¡æ”¹åŠ¨æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬é¦–å…ˆè®¾è®¡ä¸€ä¸‹ä» <code>Reactor</code> ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//SubReactor ä½œä¸ºä» Reactor</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SubReactor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Closeable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// æ¯ä¸ªä» Reactor ä¹Ÿæœ‰ä¸€ä¸ª Selector</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Selector</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  \t<span class=\"token comment\">// åˆ›å»ºä¸€ä¸ª 4 çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯å››ä¸ªä» Reactor å·¥ä½œ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ExecutorService</span> <span class=\"token constant\">POOL</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">SubReactor</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> reactors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SubReactor</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> selectedIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// é‡‡ç”¨è½®è¯¢æœºåˆ¶ï¼Œæ¯æ¥å—ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå°±è½®è¯¢åˆ†é…ç»™å››ä¸ªä» Reactor</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// åœ¨ä¸€å¼€å§‹çš„æ—¶å€™å°±è®© 4 ä¸ªä» Reactor è·‘èµ·æ¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                reactors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SubReactor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// ä¸€å¼€å°±å°†ä» Reactor æ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token constant\">POOL</span><span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span>reactors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// è½®è¯¢è·å–ä¸‹ä¸€ä¸ª Selectorï¼ˆAcceptor ç”¨ï¼‰</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Selector</span> <span class=\"token function\">nextSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> reactors<span class=\"token punctuation\">[</span>selectedIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        selectedIndex <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>selectedIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SubReactor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// å¯åŠ¨åç›´æ¥ç­‰å¾… selector ç›‘å¬åˆ°å¯¹åº”çš„äº‹ä»¶å³å¯ï¼Œå…¶ä»–çš„æ“ä½œé€»è¾‘å’Œ Reactor ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\" >> ç›‘å¬åˆ° \"</span><span class=\"token operator\">+</span>count<span class=\"token operator\">+</span><span class=\"token string\">\" ä¸ªäº‹ä»¶\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    iterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">Object</span> att <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>att <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">)</span> att<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        selector<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>æˆ‘ä»¬è®¾è®¡çš„ <code>SubReactor</code>  æ²¡æœ‰ <code>ServerSocketChannel</code> ï¼Œè€Œæ˜¯æ¯ä¸ªä» <code>Reactor</code>  éƒ½æœ‰ä¸€ä¸ª <code>Selector</code> ï¼Œåœ¨ä¸» <code>Reactor</code>  ä¸­é€šè¿‡ <code>nextSelector</code>  é™æ€æ–¹æ³•è½®æµè·å¾—ä¸åŒä» <code>Reactor</code>  çš„ <code>Selector</code> ã€‚</p>\n</blockquote>\n<p>æœ€åä¿®æ”¹ä¸€ä¸‹ <code>Acceptor</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Acceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ServerSocketChannel</span> serverChannel<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// åªéœ€è¦ä¸€ä¸ª ServerSocketChannel å°±è¡Œäº†</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Acceptor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span> serverChannel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serverChannel <span class=\"token operator\">=</span> serverChannel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> channel <span class=\"token operator\">=</span> serverChannel<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// è¿˜æ˜¯æ­£å¸¸è¿›è¡Œ Accept æ“ä½œï¼Œå¾—åˆ° SocketChannel</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\" >> å®¢æˆ·ç«¯å·²è¿æ¥ï¼ŒIPåœ°å€ä¸ºï¼š\"</span><span class=\"token operator\">+</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">SubReactor</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// é€‰å–ä¸‹ä¸€ä¸ªä» Reactor çš„ Selector</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            selector<span class=\"token punctuation\">.</span><span class=\"token function\">wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// åœ¨æ³¨å†Œä¹‹å‰å”¤é†’ä¸€ä¸‹é˜²æ­¢å¡æ­»</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            channel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// æ³¨æ„ç°åœ¨æ³¨å†Œçš„æ˜¯ä» Reactor çš„ Selector</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>éœ€è¦æ³¨æ„ï¼Œä¸åŒçš„äººè®¾è®¡åœ¨ä»£ç å®ç°æ–¹é¢å¯èƒ½ä¸åŒï¼Œé‡ç‚¹æ˜¯ <code>Reactor</code>  çš„æ€æƒ³ï¼Œä¸» <code>Reactor</code>  å¤„ç†è¿æ¥ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨ <code>Acceptor</code> ï¼‰å°† <code>SocketChannel</code>  æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼ˆå› ä¸ºä¹‹åå°±è¦è¿›è¡Œè¯»å†™æ“ä½œï¼‰ï¼Œæ­¤æ—¶è¿™ä¸ªè¿æ¥ä¹‹åçš„è¯»å†™è¯·æ±‚éƒ½ä¼šå‘é€ç»™ä» <code>Reactor</code>  çš„é€‰æ‹©å™¨ï¼Œè¿™ä¹Ÿå°±è§„é¿äº†ä¸» <code>Reactor</code>  å¤„ç†è¯»å†™è¯·æ±‚ã€‚ä½†æ˜¯æœ€ç»ˆå»å®Œæˆè¿™ä¸ªè¯·æ±‚çš„è¿˜æ˜¯ <code>Handler</code> ã€‚</p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubW9kYi5wcm8vZGIvNTAwMTY=\">ç†è§£ Reactor æ¨¡å‹</span>ï¼ˆè¿™ç¯‡æ–‡ç« å…³äºå¤šçº¿ç¨‹ Reactor çš„å›¾æœ‰äº›ä¸å‡†ç¡®ï¼‰</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLW5pby1zZWxlY3QtZXBvbGwuaHRtbA==\">https://pdai.tech/md/java/io/java-io-nio-select-epoll.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0phY2tfX2lUL2FydGljbGUvZGV0YWlscy8xMDcwMTA0ODY=\">https://blog.csdn.net/Jack__iT/article/details/107010486</span></p>\n<p>é’ç©ºã®éœå…‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tsNjh0eQ==\">https://www.yuque.com/qingkongxiaguang/javase/kl68ty</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/09/01/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(3)-NIO%E5%9F%BA%E7%A1%80%E8%AF%A6%E8%A7%A3/",
            "url": "https://cecilia.cool/2022/09/01/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(3)-NIO%E5%9F%BA%E7%A1%80%E8%AF%A6%E8%A7%A3/",
            "title": "ç½‘ç»œç¼–ç¨‹(3)--NIOåŸºç¡€è¯¦è§£",
            "date_published": "2022-09-01T03:13:56.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>BIO</code>  æ˜¯é˜»å¡çš„ï¼Œå¦‚æœæ²¡æœ‰å¤šçº¿ç¨‹ï¼Œ <code>BIO</code>  å°±éœ€è¦ä¸€ç›´å ç”¨ <code>CPU</code> ï¼Œè€Œ <code>NIO</code>  åˆ™æ˜¯éé˜»å¡ <code>IO</code> ï¼Œ <code>NIO</code>  åœ¨è·å–è¿æ¥æˆ–è€…è¯·æ±‚æ—¶ï¼Œå³ä½¿æ²¡æœ‰å–å¾—è¿æ¥å’Œæ•°æ®ï¼Œä¹Ÿä¸ä¼šé˜»å¡ç¨‹åºã€‚NIO çš„æœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚</p>\n<p><code>I/O</code>  ä¸  <code>NIO</code>  æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼Œ <code>I/O</code>  ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ  <code>NIO </code> ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p>\n<p>é¢å‘æµçš„  <code>I/O</code>  ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„  <code>I/O</code>  é€šå¸¸ç›¸å½“æ…¢ã€‚</p>\n<h1 id=\"ç›¸å…³çŸ¥è¯†\"><a class=\"anchor\" href=\"#ç›¸å…³çŸ¥è¯†\">#</a> ç›¸å…³çŸ¥è¯†</h1>\n<h2 id=\"é€šé“\"><a class=\"anchor\" href=\"#é€šé“\">#</a> é€šé“</h2>\n<p>é€šé“ï¼ˆ <code>Channel</code>  æ¥å£ï¼‰æ˜¯å¯¹æµçš„æ¨¡æ‹Ÿï¼Œæ—¢å¯ä»¥ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ä»¥ç”¨æ¥è¿›è¡Œå†™æ“ä½œã€‚</p>\n<p>é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨ (ä¸€ä¸ªæµå¿…é¡»æ˜¯  <code>InputStream</code>  æˆ–è€…  <code>OutputStream</code>  çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p>\n<p><code>NIO</code>  ä¸­å¸¸ç”¨çš„ <code>Channel</code>  æœ‰ï¼š</p>\n<ul>\n<li>\n<p>FileChannel: ä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›</p>\n</li>\n<li>\n<p>DatagramChannel: é€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</p>\n</li>\n<li>\n<p>SocketChannel: é€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</p>\n</li>\n<li>\n<p>ServerSocketChannel: å¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚</p>\n</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>Channel</code>  å†…éƒ¨ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Channel</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Closeable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// é€šé“æ˜¯å¦å¤„äºå¼€å¯çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// å› ä¸ºé€šé“å¼€å¯ä¹Ÿéœ€è¦å…³é—­ï¼Œæ‰€ä»¥å®ç°äº† Closeable æ¥å£ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ‡‚çš„éƒ½æ‡‚</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/06/a30745dcd72b9009.jpg\" alt=\"é€šé“æ¥å£ç»“æ„\" /></p>\n<p>æœ€åæ•´åˆä¸º <code>ByteChannel</code>  æ¥å£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ByteChannel</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ReadableByteChannel</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">WritableByteChannel</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸ä½¿ç”¨é€šé“å’Œä½¿ç”¨é€šé“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä¸ä½¿ç”¨é€šé“</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fun1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// å°† System.in ä½œä¸ºè¾“å…¥æµ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data = \"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span>en<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨é€šé“</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fun2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token class-name\">ReadableByteChannel</span> readChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">Channels</span><span class=\"token punctuation\">.</span><span class=\"token function\">newChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Syetem</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// å°†é€šé“ä¸­çš„æ•°æ®å†™åˆ°ç¼“å†²åŒºï¼Œç¼“å†²åŒºæœ€å¤šä¸€æ¬¡è£… 10 ä¸ª</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        readChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ç¿»è½¬ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"filechannel\"><a class=\"anchor\" href=\"#filechannel\">#</a> FileChannel</h4>\n<p>é€šé“ä¸€ä¸ªé‡è¦çš„ç‰¹ç‚¹å°±æ˜¯èƒ½å¤ŸåŒå‘ä¼ è¾“æ•°æ®ã€‚ä½†æ˜¯ <code>FileInputStream</code>  å¾—åˆ°çš„é€šé“åªèƒ½è¾“å…¥ï¼Œ <code>FileOutputStream</code>  å¾—åˆ°çš„é€šé“åªèƒ½è¾“å‡ºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">FileInputStream</span> in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">FileChannel</span> channel <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>RandomAccessFile</code>  åˆ›å»ºé€šé“</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      é€šè¿‡ RandomAccessFile è¿›è¡Œåˆ›å»ºï¼Œæ³¨æ„åé¢çš„ mode æœ‰å‡ ç§ï¼š</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      r        ä»¥åªè¯»çš„æ–¹å¼ä½¿ç”¨</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      rw   è¯»æ“ä½œå’Œå†™æ“ä½œéƒ½å¯ä»¥</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      rws  æ¯å½“è¿›è¡Œå†™æ“ä½œï¼ŒåŒæ­¥çš„åˆ·æ–°åˆ°ç£ç›˜ï¼Œåˆ·æ–°å†…å®¹å’Œå…ƒæ•°æ®</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      rwd  æ¯å½“è¿›è¡Œå†™æ“ä½œï¼ŒåŒæ­¥çš„åˆ·æ–°åˆ°ç£ç›˜ï¼Œåˆ·æ–°å†…å®¹</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// è¿™é‡Œè®¾å®šä¸ºæ”¯æŒè¯»å†™ï¼Œè¿™æ ·åˆ›å»ºçš„é€šé“æ‰èƒ½å…·æœ‰è¿™äº›åŠŸèƒ½</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RandomAccessFile</span> f <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RandomAccessFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rw\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">FileChannel</span> channel <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// é€šè¿‡ RandomAccessFile åˆ›å»ºä¸€ä¸ªé€šé“</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¼å…µäºŒå·é©¬é£é£å‡†å¤‡å°±ç»ªï¼\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// æ³¨æ„è¯»å–ä¹Ÿæ˜¯ä»ç°åœ¨çš„ä½ç½®å¼€å§‹</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å†™æ“ä½œå®Œæˆä¹‹åæ–‡ä»¶è®¿é—®ä½ç½®ï¼š\"</span><span class=\"token operator\">+</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// éœ€è¦å°†ä½ç½®å˜å›åˆ°æœ€å‰é¢ï¼Œè¿™æ ·ä¸‹é¢æ‰èƒ½ä»æ–‡ä»¶çš„æœ€å¼€å§‹è¿›è¡Œè¯»å–</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        channel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>é™¤äº†åŸºæœ¬çš„è¯»å†™æ“ä½œï¼Œä¹Ÿå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œæˆªæ–­ï¼š <code>channel.truncate(20)</code> ã€‚å°±åªä¼šä¿ç•™å‰ 20 ä¸ªå­—èŠ‚</p>\n</blockquote>\n<p>ç¤ºä¾‹ï¼šæ–‡ä»¶æ‹·è´</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åœ¨ç¼“å†²åŒºä¹Ÿæœ‰æ–‡ä»¶å¤åˆ¶çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯æ­¤å¤„æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å†™å¥½çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileInputStream</span> in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>       <span class=\"token class-name\">FileOutputStream</span> out <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">FileChannel</span> inChannel <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        inChannel<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>inChannel<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ä¹Ÿå¯ä»¥åå‘æ“ä½œ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>inChannel<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>inChannel<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"æ–‡ä»¶é”filelock\"><a class=\"anchor\" href=\"#æ–‡ä»¶é”filelock\">#</a> æ–‡ä»¶é” FileLock</h4>\n<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè·¨è¿›ç¨‹æ–‡ä»¶é”æ¥é˜²æ­¢å¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„æ–‡ä»¶äº‰æŠ¢æ“ä½œï¼ˆæ³¨æ„è¿™é‡Œæ˜¯è¿›ç¨‹ï¼Œä¸æ˜¯çº¿ç¨‹ï¼‰FileLock æ˜¯æ–‡ä»¶é”ï¼Œå®ƒèƒ½ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰èƒ½å¤Ÿä¿®æ”¹å®ƒï¼Œæˆ–è€…éƒ½åªå¯ä»¥è¯»ï¼Œè¿™æ ·å°±è§£å†³äº†å¤šè¿›ç¨‹é—´çš„åŒæ­¥æ–‡ä»¶ï¼Œä¿è¯äº†å®‰å…¨æ€§ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒè¿›ç¨‹çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ï¼Œä»–å¯ä»¥è§£å†³å¤šä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒä¸é€‚ç”¨äºæ§åˆ¶åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¤šä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªæ–‡ä»¶çš„è®¿é—®ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">RandomAccessFile</span> f <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RandomAccessFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"rw\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">FileChannel</span> <span class=\"token class-name\">Channel</span> <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// ä¸Šé”ï¼šå¯¹ 0~6 ä¸ªå­—èŠ‚ä¸Šé”ï¼Œfalse è¡¨ç¤ºç‹¬å é”ï¼Œå…¶ä»–è¿›ç¨‹è¿è¯»éƒ½ä¸å¯ä»¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">FileLock</span> lock <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// ä¹Ÿå¯ä»¥ï¼šchannel.getLock (0,channel.size (),false);</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    lock<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸ºäº†å¿«é€Ÿè®²å®Œè¿™éƒ¨åˆ†å†…å®¹ï¼Œç¬”è€…ç®€åŒ–äº†ä¸€äº›ç»†èŠ‚</p>\n<blockquote>\n<p>ç‹¬å é”å¦‚æœå‡ºç°äº†äº¤å‰éƒ¨åˆ†ï¼Œä¹Ÿä¼šè¢«é˜»å¡ï¼ˆäººä¹‹å¸¸æƒ…å˜›ï¼‰ã€‚å…±äº«é”å°±æ˜¯å°†å‚æ•°è®¾ç½®ä¸º trueã€‚è¿˜æœ‰ä¸€ä¸ª <code>trylock</code>  çš„æ–¹æ³•ï¼Œå®ƒä¼šå°è¯•å»è·å¾—é”ï¼Œå¦‚æœå¤±è´¥å°±è¿”å› <code>null</code> ï¼ˆè¿™è®©æˆ‘æƒ³èµ· <code>AQS</code>  é‡Œé¢çš„ <code>tryAccquire</code>  æ–¹æ³•ï¼‰ã€‚</p>\n</blockquote>\n<h2 id=\"ç¼“å†²åŒº\"><a class=\"anchor\" href=\"#ç¼“å†²åŒº\">#</a> ç¼“å†²åŒº</h2>\n<p>å‘é€ç»™é€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œä»é€šé“è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºã€‚ä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚</p>\n<p>ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>æ•°ç»„</strong>ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯» / å†™è¿›ç¨‹ã€‚</p>\n<p>ç¼“å†²åŒºçŠ¶æ€å˜é‡ï¼š</p>\n<ul>\n<li><code>capacity</code> : æœ€å¤§å®¹é‡ï¼›</li>\n<li><code>position</code> : å½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›</li>\n<li><code>limit</code> : è¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚</li>\n</ul>\n<p>å¸¸è§çš„ç¼“å†²åŒºæœ‰ï¼ˆéƒ½æ˜¯ <code>Buffer</code>  æŠ½è±¡ç±»çš„å­ç±»ï¼‰ï¼š</p>\n<ul>\n<li>ByteBuffer</li>\n<li>CharBuffer</li>\n<li>ShortBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>FloatBuffer</li>\n<li>DoubleBuffer</li>\n</ul>\n<h3 id=\"ç›¸å…³æ–¹æ³•\"><a class=\"anchor\" href=\"#ç›¸å…³æ–¹æ³•\">#</a> ç›¸å…³æ–¹æ³•</h3>\n<h4 id=\"è·å–å¯¹è±¡\"><a class=\"anchor\" href=\"#è·å–å¯¹è±¡\">#</a> è·å–å¯¹è±¡</h4>\n<p>è¿™é‡Œä»¥ <code>IntBuffer</code>  ä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è¦è·å¾—ä¸€ä¸ª <code>IntBuffer</code>  çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œéœ€è¦è°ƒç”¨ <code>allocate</code>  æ–¹æ³•æˆ–è€… <code>wrap</code>  æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 1. ç”³è¯·å®¹é‡ä¸º 10 çš„ int ç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">IntBuffer</span> buffer1 <span class=\"token operator\">=</span> <span class=\"token class-name\">IntBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 2. å°†ç°æœ‰æ•°ç»„ç›´æ¥è½¬æ¢ä¸ºç¼“å†²åŒº</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> arr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">IntBuffer</span> buffer2 <span class=\"token operator\">=</span> <span class=\"token class-name\">IntBuffer</span><span class=\"token punctuation\">,</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// çœ‹ä¸€ä¸‹å†…éƒ¨ä¸¤ä¸ªæ–¹æ³•çš„ç›¸å…³å®ç°</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> capacity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>capacity <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HeapIntBuffer</span><span class=\"token punctuation\">(</span>capacity<span class=\"token punctuation\">,</span> capacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// è¿™é‡Œä¹Ÿèƒ½è¯´æ˜ HeapIntBuffer æ˜¯ IntBuffer å­ç±»</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  \t<span class=\"token comment\">//HeapIntBuffer æ˜¯åœ¨å †å†…å­˜ä¸­å­˜æ”¾æ•°æ®ï¼Œæœ¬è´¨ä¸Šå°±æ•°ç»„ï¼Œä¸€ä¼šæˆ‘ä»¬å¯ä»¥åœ¨æ·±å…¥çœ‹ä¸€ä¸‹</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> array<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> array<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> array<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> offset<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      \t<span class=\"token comment\">// åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ HeapIntBuffer å¯¹è±¡ï¼Œå¹¶ä¸”ç»™äº†åˆå§‹æ•°ç»„ä»¥åŠæˆªå–çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HeapIntBuffer</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IllegalArgumentException</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexOutOfBoundsException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„ç±»ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ€»ä½“çš„ç±»ç»“æ„</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/06/2c96523c4e767ff8.jpg\" alt=\"ç±»ç»“æ„\" /></p>\n<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸¤ä¸ªç±»çš„æ„é€ æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// IntBuffer æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hb<span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// åªæœ‰åœ¨å †ç¼“å†²åŒºå®ç°æ—¶æ‰ä¼šä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> offset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">boolean</span> isReadOnly<span class=\"token punctuation\">;</span>                 <span class=\"token comment\">// åªæœ‰åœ¨å †ç¼“å†²åŒºå®ç°æ—¶æ‰ä¼šä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">IntBuffer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> mark<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> lim<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cap<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> hb<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> offset<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>mark<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">,</span> lim<span class=\"token punctuation\">,</span> cap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// è°ƒç”¨ Buffer ç±»çš„æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hb <span class=\"token operator\">=</span> hb<span class=\"token punctuation\">;</span>    <span class=\"token comment\">//hb å°±æ˜¯çœŸæ­£æˆ‘ä»¬è¦å­˜æ”¾æ•°æ®çš„æ•°ç»„ï¼Œå †ç¼“å†²åŒºåº•å±‚å…¶å®å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ•°ç»„</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offset <span class=\"token operator\">=</span> offset<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// èµ·å§‹åç§»ä½ç½®</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// HeapIntBuffer æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token class-name\">HeapIntBuffer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buf<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> off<span class=\"token punctuation\">,</span> off <span class=\"token operator\">+</span> len<span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  \t<span class=\"token comment\">//mark æ˜¯æ ‡è®°ï¼Œoff æ˜¯å½“å‰èµ·å§‹ä¸‹æ ‡ä½ç½®ï¼Œoff+len æ˜¯æœ€å¤§ä¸‹æ ‡ä½ç½®ï¼Œ</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">//buf.length æ˜¯åº•å±‚ç»´æŠ¤çš„æ•°ç»„çœŸæ­£é•¿åº¦ï¼Œbuf å°±æ˜¯æ•°ç»„ï¼Œæœ€åä¸€ä¸ª 0 æ˜¯èµ·å§‹åç§»ä½ç½®</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"å†™æ“ä½œ\"><a class=\"anchor\" href=\"#å†™æ“ä½œ\">#</a> å†™æ“ä½œ</h4>\n<p><code>Buffer</code>  ä¸­æ‰€æœ‰çš„ <code>put</code>  å‡½æ•°ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// åœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// ç›´æ¥å°† src å…¨éƒ¨æ’å…¥ç¼“å†²åŒºï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡ç¼“å†²åŒºå¤§å°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// ç›´æ¥å­˜æ”¾æ•°ç»„ä¸­çš„å†…å®¹ï¼ŒåŒä¸Šï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šå­˜æ”¾ä¸€æ®µèŒƒå›´</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> src<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> offset<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// ç›´æ¥å­˜æ”¾å¦ä¸€ä¸ªç¼“å†²åŒºä¸­çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntBuffer</span> src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åšç®€å•çš„ <code>put</code>  æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    hb<span class=\"token punctuation\">[</span><span class=\"token function\">ix</span><span class=\"token punctuation\">(</span><span class=\"token function\">nextPutIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// å°† i çš„å€¼åŠ ä¸Šæˆ‘ä»¬ä¹‹å‰è®¾å®šçš„ offset åç§»é‡å€¼ï¼Œä½†æ˜¯é»˜è®¤æ˜¯ 0ï¼ˆé 0 çš„æƒ…å†µåé¢ä¼šä»‹ç»ï¼‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> <span class=\"token function\">ix</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> i <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">nextPutIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">int</span> p <span class=\"token operator\">=</span> position<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// è·å– Buffer ç±»ä¸­çš„ position ä½ç½®ï¼ˆä¸€å¼€å§‹ä¹Ÿæ˜¯ 0ï¼‰</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">>=</span> limit<span class=\"token punctuation\">)</span>    <span class=\"token comment\">// ä½ç½®è‚¯å®šä¸èƒ½è¶…è¿‡åº•å±‚æ•°ç»„æœ€å¤§é•¿åº¦ï¼Œå¦åˆ™è¶Šç•Œ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferOverflowException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    position <span class=\"token operator\">=</span> p <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// è·å–ä¹‹åä¼šä½¿å¾— Buffer ç±»ä¸­çš„ position+1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> p<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// è¿”å›å½“å‰çš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœå°† <code>offset</code>  çœ‹ä¸º 0ï¼Œé‚£ä¹ˆæ•´ä¸ªå‡½æ•°å°±æ˜¯åœ¨æ•°ç»„ <code>hb</code>  çš„ <code>position</code>  ä½ç½®åŠ å…¥å…ƒç´ </p>\n<p>ç¤ºä¾‹ï¼šå¿«é€Ÿå¤åˆ¶æ–‡ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fastCopy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> src<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> dist<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">/* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">FileInputStream</span> fin <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">FileChannel</span> fcin <span class=\"token operator\">=</span> fin<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">FileOutputStream</span> fout <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>dist<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">/* è·å–è¾“å‡ºå­—èŠ‚æµçš„é€šé“ */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token class-name\">FileChannel</span> fcout <span class=\"token operator\">=</span> fout<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">/* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocateDirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">/* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">int</span> r <span class=\"token operator\">=</span> fcin<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">/* read () è¿”å› -1 è¡¨ç¤º EOF */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">/* åˆ‡æ¢è¯»å†™ */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">/* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        fcout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">/* æ¸…ç©ºç¼“å†²åŒº */</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹æ•´ä¸ª <code>buffer</code>  çš„çŠ¶æ€å˜åŒ–ï¼Œæ­¤å¤„æˆ‘ä»¬å‡è®¾å¤§å°ä¸º 8 å­—èŠ‚</p>\n<p>â‘ æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/77fb2a16735a25dc.jpg\" alt=\"bufferå˜åŒ–1\" /></p>\n<p>â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ç§»åŠ¨è®¾ç½®ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/6df58dfb355cd5fd.jpg\" alt=\"bufferå˜åŒ–2\" /></p>\n<p>â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip () æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/fc7668224747f135.jpg\" alt=\"bufferå˜åŒ–3\" /></p>\n<p>â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/e41dc8148e004937.jpg\" alt=\"bufferå˜åŒ–4\" /></p>\n<p>â‘¤ æœ€åéœ€è¦è°ƒç”¨ clear () æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/34a021e1ad767087.jpg\" alt=\"bufferå˜åŒ–5\" /></p>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆç¼“å†²åŒºåœ¨å†™ä¹‹åè¯»éœ€è¦ä½¿ç”¨ <code>flip</code>  å‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¬ä»å›¾ä¸­çœ‹å‡º <code>flip</code>  ä¹‹åä¼šå°† Position ç½®ä¸º 0ã€‚ä»è¯»åˆ°å†™ä¸éœ€è¦ç¿»è½¬ï¼ˆå¦‚æœæ˜¯è¦†ç›–å†™çš„è¯ï¼‰</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Buffer</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ä¿®æ”¹ limit å€¼ï¼Œå½“å‰å†™åˆ°å“ªé‡Œï¼Œä¸‹æ¬¡è¯»çš„æœ€ç»ˆä½ç½®å°±æ˜¯è¿™é‡Œ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    limit <span class=\"token operator\">=</span> position<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//position å½’é›¶</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    mark <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// æ ‡è®°è¿˜åŸä¸º - 1ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡ç”¨åˆ°</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ <code>put</code>  æ–¹æ³•æ¥æ·±å…¥ç†è§£ä¸€ä¸‹ <code>flip</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntBuffer</span> src<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>src <span class=\"token operator\">==</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isReadOnly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReadOnlyBufferException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// éå¸¸é‡è¦ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ç¡®å®š src çš„å…ƒç´ ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// ä½ ç°åœ¨æ˜¯è¯» srcï¼Œä½ åº”è¯¥å°† src è½¬æ¢ä¸ºè¯»çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> src<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">></span> <span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferOverflowException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><code>remaining()</code>  åœ¨è¯»ç¼“å†²åŒºæ—¶çš„ç»“æœæœŸæœ›æ˜¯ç¼“å†²åŒºæ•°æ®ä¸ªæ•°ï¼Œåœ¨å†™ç¼“å†²åŒºæ—¶çš„ç»“æœæœŸæœ›æ˜¯ç¼“å†²åŒºçš„å‰©ä½™å®¹é‡ã€‚</p>\n</blockquote>\n<p>ä¸ºä»€ä¹ˆæˆ‘è¦å¼ºè°ƒæœŸæœ›å‘¢ï¼Ÿå› ä¸ºå¦‚æœä¸æ°å½“ä½¿ç”¨ <code>flip</code> ï¼Œå¾—åˆ°çš„ç»“æœå°±ä¸æ˜¯æœŸæœ›å€¼ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// è®¡ç®—å¹¶è·å–å½“å‰ç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> rem <span class=\"token operator\">=</span> limit <span class=\"token operator\">-</span> position<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// æœ€å¤§å®¹é‡å‡å»å½“å‰ä½ç½®ï¼Œå°±æ˜¯å‰©ä½™ç©ºé—´</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> rem <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> rem <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// æ²¡å®¹é‡å°±è¿”å› 0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å†™ç¼“å†²åŒºï¼Œ <code>limit-position</code>  å°±æ˜¯å‰©ä½™å®¹é‡ï¼›ä½¿ç”¨ <code>flip</code>  ä¹‹åï¼Œ <code>limit-position</code>  å°±æ˜¯ç¼“å†²åŒºåŒ…å«çš„æ•°æ®ä¸ªæ•°ã€‚æ‰€ä»¥ï¼Œ <code>flip</code>  çš„æœ¬è´¨å°±æ˜¯é€šè¿‡æ”¹å˜ <code>limit</code>  å’Œ <code>position</code>  çš„å€¼æ¥æ”¹å˜äºŒè€…ä¹‹å·®çš„å«ä¹‰ã€‚ãƒ»</p>\n<h4 id=\"è¯»æ“ä½œ\"><a class=\"anchor\" href=\"#è¯»æ“ä½œ\">#</a> è¯»æ“ä½œ</h4>\n<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç¿»è½¬æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬è¯»å†™æ•°æ®éƒ½æ˜¯ä¾æ‰˜äº <code>position</code>  å®šä½çš„ã€‚å†™å…¥ / è¯»å–ï¼ˆ <code>get()</code>  æ–¹æ³•ï¼‰éƒ½ä¼šä½¿ <code>position</code>  åŠ ä¸€ã€‚å¦‚æœè¶…å‡ºèŒƒå›´æŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ <code>get(i)</code>  æ¥æŒ‡å®šè¯»å–ç¬¬ <code>i</code>  ä¸ªå…ƒç´ ã€‚</p>\n<p>çœ‹ä¸€ä¸‹æœ‰å“ªäº›é‡è½½çš„ <code>get</code>  æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// åªæœ‰è¿™ä¸ªæ–¹æ³•ä¸ä¼šæ”¹å˜ position</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> dst<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å®é™…æ˜¯è°ƒç”¨ä¸‹é¢é‚£ä¸ªæ–¹æ³•</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> dst<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> offset<span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>array()</code>  æ–¹æ³•ç›´æ¥è¿”å› <code>hb</code>  æ•°ç»„ã€‚ä½†æ˜¯è¿™ç›´æ¥å°† <code>hb</code>  åº•å±‚æ•°ç»„æš´éœ²åœ¨å¤–é¢ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½ä¼šç”Ÿæ•ˆåœ¨ç¼“å†²åŒºã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hb <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">// ä¸ºç©ºé‚£è¯´æ˜åº•å±‚ä¸æ˜¯æ•°ç»„å®ç°çš„ï¼Œè‚¯å®šå°±æ²¡æ³•è½¬æ¢äº†</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isReadOnly<span class=\"token punctuation\">)</span>   <span class=\"token comment\">// åªè¯»ä¹Ÿæ˜¯ä¸è®©ç›´æ¥å–å‡ºçš„ï¼Œå› ä¸ºä¸€æ—¦å–å‡ºå»å²‚ä¸æ˜¯å°±èƒ½è¢«ä¿®æ”¹äº†</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReadOnlyBufferException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> hb<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// ç›´æ¥è¿”å› hb</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€åï¼Œç¼“å†²åŒºè¿˜æœ‰ä¸€ä¸ª <code>mark</code>  æ“ä½œï¼Œç±»ä¼¼åŸç†åœ¨ç¼“å†²æµå·²ç»è®²è¿‡äº†ï¼Œæ­¤å¤„ä¸åŠ èµ˜è¿°ã€‚å½“ç„¶ç¼“å†²åŒºè¿˜æœ‰å…¶ä»–ä¸€äº›æ“ä½œï¼Œè¿™é‡Œç¬”è€…è§‰å¾—ä¸å®œå†™å¤ªå¤šï¼Œå»ºè®®å°±æ˜¯é‡åˆ°äº†ä¸æ‡‚å°±å»æµè§ˆå™¨æœã€‚</p>\n<p>åªè¯»ç¼“å†²åŒºï¼š <code>HeapIntBufferR</code>  æ˜¯ <code>HeapIntBuffer</code>  çš„å­ç±»ï¼Œåˆå§‹åŒ–ä¸º</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">IntBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">IntBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">IntBuffer</span> readBuffer <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">asReadOnlyBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">IntBuffer</span> <span class=\"token function\">asReadOnlyBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// æ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯ç›´æ¥åˆ›å»ºäº† HeapIntBufferï¼Œè€Œæ˜¯ HeapIntBufferRï¼Œå¹¶ä¸”ç›´æ¥å¤åˆ¶çš„ hb æ•°ç»„</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HeapIntBufferR</span><span class=\"token punctuation\">(</span>hb<span class=\"token punctuation\">,</span>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                 <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">markValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                                 <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                                 <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                                 <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                                 offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"é€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#é€‰æ‹©å™¨\">#</a> é€‰æ‹©å™¨</h2>\n<p>è¿™ä¸ªå…¶å®å°±æ˜¯<strong> Unix IO æ¨¡å‹</strong>è®²åˆ°çš„å¤šè·¯å¤ç”¨ï¼Œ <code>NIO</code>  å®ç°äº† <code>IO</code>  å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ <code>Channel</code>  ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</p>\n<p>é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚</p>\n<blockquote>\n<p>åªæœ‰å¥—æ¥å­— Channel æ‰èƒ½é…ç½®éé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼ˆFileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼‰ã€‚</p>\n</blockquote>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/01/c631fb000c1a9630.jpg\" alt=\"é€‰æ‹©å™¨\" /></p>\n<h3 id=\"åˆ›å»ºé€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#åˆ›å»ºé€‰æ‹©å™¨\">#</a> åˆ›å»ºé€‰æ‹©å™¨</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨\">#</a> é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>é€šé“é…ç½®å¿…é¡»ä¸ºéé˜»å¡æ¨¡å¼ï¼Œæœ€åä¸€è¡Œä»£ç éœ€è¦æŒ‡å®šæ³¨å†Œçš„å…·ä½“äº‹ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åœ¨ SelectionKey ä¸­å®šä¹‰</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">OP_READ</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">OP_WRITE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">OP_CONNECT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">OP_ACCEPT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"ç›‘å¬äº‹ä»¶\"><a class=\"anchor\" href=\"#ç›‘å¬äº‹ä»¶\">#</a> ç›‘å¬äº‹ä»¶</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ä½¿ç”¨  <code>select()</code>  æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚</p>\n<h3 id=\"è·å–åˆ°è¾¾çš„äº‹ä»¶\"><a class=\"anchor\" href=\"#è·å–åˆ°è¾¾çš„äº‹ä»¶\">#</a> è·å–åˆ°è¾¾çš„äº‹ä»¶</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> leys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keyIterator <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"äº‹ä»¶å¾ªç¯\"><a class=\"anchor\" href=\"#äº‹ä»¶å¾ªç¯\">#</a> äº‹ä»¶å¾ªç¯</h3>\n<p>ä¸€æ¬¡ <code>select()</code>  è°ƒç”¨ä¸èƒ½å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keyIterator <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å¥—æ¥å­—-nio-å®ä¾‹\"><a class=\"anchor\" href=\"#å¥—æ¥å­—-nio-å®ä¾‹\">#</a> å¥—æ¥å­— NIO å®ä¾‹</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NIOServer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»ºé€‰æ‹©å™¨</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼ˆè®¾ç½®éé˜»å¡ï¼‰</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">ServerSocketChannel</span> ssChannel <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_ACCEPT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> ssChannel<span class=\"token punctuation\">.</span><span class=\"token function\">socket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">InetSocketAddress</span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keyIterator <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token class-name\">ServerSocketChannel</span> ssChannel1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                    <span class=\"token comment\">// é›¾æµ®èµ·ä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> ssChannel1<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token comment\">// è¯¥è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ®</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OP_READ</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token class-name\">SocketChannel</span> sChannel <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">readDataFromSocketChannel</span><span class=\"token punctuation\">(</span>sChannel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                keyIterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">readDataFromSocketChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> sChannel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token class-name\">StringBuilder</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> sChannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">int</span> limit <span class=\"token operator\">=</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> dst <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span>limit<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> limit<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                dst<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            data<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>dst<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NIOClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">OutputStream</span> out <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒæ–‡ç« \"><a class=\"anchor\" href=\"#å‚è€ƒæ–‡ç« \">#</a> å‚è€ƒæ–‡ç« </h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLW5pby5odG1s\">https://pdai.tech/md/java/io/java-io-nio.html</span></p>\n<p>è¯­é›€ï¼ˆé’ç©ºã®éœå…‰ï¼‰ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3Fpbmdrb25neGlhZ3VhbmcvamF2YXNlL2tsNjh0eSNlNGY1MmViYw==\">https://www.yuque.com/qingkongxiaguang/javase/kl68ty#e4f52ebc</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3R1dG9yaWFscy5qZW5rb3YuY29tL2phdmEtbmlvL2luZGV4Lmh0bWw=\">Java NIO Tutorial  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tL25pby5odG1s\">Java NIO æµ…æ  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9lZHVjYXRpb24vamF2YS9qLW5pby9qLW5pby5odG1s\">IBM: NIO å…¥é—¨  (opens new window)</span></p>\n<p>Eckel B, åŸƒå…‹å°”ï¼Œæ˜Šé¹ï¼Œç­‰. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2002.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9lZHVjYXRpb24vamF2YS9qLW5pby9qLW5pby5odG1s\">IBM: NIO å…¥é—¨  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9qYXZhL2otbG8tamF2YWlvL2luZGV4Lmh0bWw=\">IBM: æ·±å…¥åˆ†æ Java I/O çš„å·¥ä½œæœºåˆ¶  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9qYXZhL2otbG8tY2hpbmVzZWNvZGluZy9pbmRleC5odG0=\">IBM: æ·±å…¥åˆ†æ Java ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9qYXZhL2otbG8tc2VyaWFsL2luZGV4Lmh0bWw=\">IBM: Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯†  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hpbWlzby9hcnRpY2xlL2RldGFpbHMvMjQ5OTA0OTk=\">NIO ä¸ä¼ ç»Ÿ IO çš„åŒºåˆ«  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3N0Zy10dWQuZ2l0aHViLmlvL3NlZGMvTGVjdHVyZS93czEzLTE0LzUuMy1EZWNvcmF0b3IuaHRtbCNtb2RlPWRvY3VtZW50\">Decorator Design Pattern  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xhYm9qYXZhLmJsb2dzcG90LmNvbS8yMDEyLzEyL3NvY2tldC1tdWx0aWNhc3QuaHRtbA==\">Socket Multicast</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTc0MTkxNjI0MzMxMTAwMTc0\">https://juejin.cn/post/6974191624331100174</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/31/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(2)-BIO%E8%AF%A6%E8%A7%A3/",
            "url": "https://cecilia.cool/2022/08/31/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(2)-BIO%E8%AF%A6%E8%A7%A3/",
            "title": "ç½‘ç»œç¼–ç¨‹(2)--BIOè¯¦è§£",
            "date_published": "2022-08-31T10:47:08.000Z",
            "content_html": "<h1 id=\"é‡è¦æ¦‚å¿µ\"><a class=\"anchor\" href=\"#é‡è¦æ¦‚å¿µ\">#</a> é‡è¦æ¦‚å¿µ</h1>\n<ul>\n<li><code>é˜»å¡IO</code>  å’Œ  <code>éé˜»å¡IO</code></li>\n</ul>\n<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ <code>ç¨‹åºçº§åˆ«</code> çš„ã€‚ä¸»è¦æè¿°çš„æ˜¯ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»Ÿ IO æ“ä½œåï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆç¨‹åºè¯¥å¦‚ä½•å¤„ç†çš„é—®é¢˜ï¼šå‰è€…ç­‰å¾…ï¼›åè€…ç»§ç»­æ‰§è¡Œ (å¹¶ä¸”ä½¿ç”¨çº¿ç¨‹ä¸€ç›´è½®è¯¢ï¼Œç›´åˆ°æœ‰ IO èµ„æºå‡†å¤‡å¥½äº†)ã€‚</p>\n<p>ç¨‹åºçº§åˆ«çš„å·®å¼‚è¡¨ç°åœ¨å¼€å‘äººå‘˜å¦‚ä½•ç¼–å†™ä»£ç æ¥å®ç°ä¸åŒåŠŸèƒ½ã€‚</p>\n<ul>\n<li><code>åŒæ­¥IO</code>  å’Œ  <code>éåŒæ­¥IO</code></li>\n</ul>\n<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ <code>æ“ä½œç³»ç»Ÿçº§åˆ«</code> çš„ã€‚ä¸»è¦æè¿°çš„æ˜¯æ“ä½œç³»ç»Ÿåœ¨æ”¶åˆ°ç¨‹åºè¯·æ±‚ IO æ“ä½œåï¼Œå¦‚æœ IO èµ„æºæ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¯¥å¦‚ä½•å“åº”ç¨‹åºçš„é—®é¢˜ï¼šå‰è€…ä¸å“åº”ï¼Œç›´åˆ° IO èµ„æºå‡†å¤‡å¥½ä»¥åï¼›åè€…è¿”å›ä¸€ä¸ªæ ‡è®° (å¥½è®©ç¨‹åºå’Œè‡ªå·±çŸ¥é“ä»¥åçš„æ•°æ®å¾€å“ªé‡Œé€šçŸ¥)ï¼Œå½“ IO èµ„æºå‡†å¤‡å¥½ä»¥åï¼Œå†ç”¨äº‹ä»¶æœºåˆ¶è¿”å›ç»™ç¨‹åºã€‚</p>\n<h1 id=\"ä¼ ç»Ÿçš„bioé€šä¿¡ç®€ä»‹\"><a class=\"anchor\" href=\"#ä¼ ç»Ÿçš„bioé€šä¿¡ç®€ä»‹\">#</a> ä¼ ç»Ÿçš„ BIO é€šä¿¡ç®€ä»‹</h1>\n<p>æˆ‘ä»¬è¿™é‡Œè®²çš„ <code>IO</code>  æ˜¯ä»¥å¥—æ¥å­—ä¸ºæ•°æ®è½½ä½“çš„ <code>BS</code>  æ¶æ„å±‚é¢ï¼Œä»¥å‰å¤§å¤šæ•°ç½‘ç»œé€šä¿¡æ˜¯é˜»å¡æ¨¡å¼ï¼š</p>\n<ul>\n<li>\n<p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘å‡ºè¯·æ±‚åï¼Œå®¢æˆ·ç«¯ä¼šä¸€ç›´ç­‰å¾… (ä¸ä¼šå†åšå…¶ä»–äº‹æƒ…)ï¼Œç›´åˆ°æœåŠ¡å™¨ç«¯è¿”å›ç»“æœæˆ–è€…ç½‘ç»œå‡ºç°é—®é¢˜ã€‚</p>\n</li>\n<li>\n<p>æœåŠ¡å™¨ç«¯åŒæ ·çš„ï¼Œå½“åœ¨å¤„ç†æŸä¸ªå®¢æˆ·ç«¯ A å‘æ¥çš„è¯·æ±‚æ—¶ï¼Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯ B å‘æ¥çš„è¯·æ±‚ä¼šç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å™¨ç«¯çš„è¿™ä¸ªå¤„ç†çº¿ç¨‹å®Œæˆä¸Šä¸€ä¸ªå¤„ç†ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/31/079d2509a6ab9a23.jpg\" alt=\"BSç¤ºæ„å›¾\" /></p>\n<p>å°½ç®¡å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ¥æ”¶è¯·æ±‚ï¼Œå…¶ä»–çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚ä½†æ˜¯ä»ç„¶å­˜åœ¨å±€é™ï¼Œæ•°æ®æŠ¥æ–‡çš„æ¥æ”¶ä»ç„¶éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ¥ï¼Œå¹¶ä¸”åœ¨ <code>Linux</code>  ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åˆ›å»ºçš„çº¿ç¨‹æ˜¯æœ‰é™çš„ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯è¾ƒå¤§çš„èµ„æºæ¶ˆè€—ï¼Œ <code>JVM</code>  åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå›å‘³èµ·åˆ†é…å †æ ˆç©ºé—´ï¼Œé»˜è®¤ä¸º <code>128K</code> ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¤§é‡ä½¿ç”¨é•¿è¿æ¥ï¼Œçº¿ç¨‹ä¸ä¼šå…³é—­ï¼Œç³»ç»Ÿèµ„æºæ¶ˆè€—å®¹æ˜“å¤±æ§ï¼ˆæ­¤å¤„å¯ä»¥è”æƒ³ QQï¼Œå¦‚æœä¸å‘æ¶ˆæ¯ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«å ç”¨ï¼‰ã€‚</p>\n<h1 id=\"ä»£ç å®è·µ\"><a class=\"anchor\" href=\"#ä»£ç å®è·µ\">#</a> ä»£ç å®è·µ</h1>\n<p>æˆ‘ä»¬é€šè¿‡ <code>socket</code>  æ¨¡æ‹Ÿ <code>BIO</code>  çš„å®ç°é€»è¾‘</p>\n<p>å»ºç«‹ <code>Server</code> ï¼Œå»ºç«‹ <code>ServerSocket</code>  å¯¹è±¡ï¼Œç»‘å®šç«¯å£ï¼Œç­‰å¾…è¿æ¥ï¼Œå¦‚æœè¿æ¥æˆåŠŸå°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†è¿æ¥</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token comment\">// ç»‘å®šç«¯å£</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// æ­»å¾ªç¯ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// ç­‰å¾…è¿æ¥  é˜»å¡</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç­‰å¾…è¿æ¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿æ¥æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">// è¿æ¥æˆåŠŸåæ–°å¼€ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†è¿™ä¸ªè¿æ¥</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç­‰å¾…è¯»å–æ•°æ®\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                            <span class=\"token comment\">// ç­‰å¾…è¯»å–æ•°æ®    é˜»å¡</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                            <span class=\"token keyword\">int</span> length <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®è¯»å–æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å»ºç«‹ <code>Client</code> -- å®¢æˆ·ç«¯ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Socket</span> socket<span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸€æ¡æ•°æ®\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå½“æœåŠ¡ç«¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¼šæ–°å¼€ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œåœ¨ <code>IO</code>  æ—¶ä¼šè¢«é˜»å¡ã€‚ä»å‰é¢æˆ‘ä»¬å¯¹å„ç§ <code>IO</code>  è®²è§£æ—¶çŸ¥é“ï¼Œ <code>read</code>  æ–¹æ³•ï¼Œå¦‚æœ <code>IO</code>  æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå°±ä¼šé˜»å¡ã€‚ä¸è®ºæ˜¯é˜»å¡ IOï¼Œéé˜»å¡ IOï¼Œå¤šè·¯å¤ç”¨ï¼Œä¿¡å·é©±åŠ¨ï¼Œéƒ½ä¼šåœ¨ <code>read</code>  æ–¹æ³•å­˜åœ¨é˜»å¡çš„æƒ…å†µã€‚</p>\n<p>å¦‚æœæ“ä½œç³»ç»Ÿæ²¡æœ‰å‘ç°æœ‰å¥—æ¥å­—ä»æŒ‡å®šçš„ç«¯å£ X æ¥ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿå°±ä¼šç­‰å¾…ã€‚è¿™æ · <code>serverSocket.accept()</code>  æ–¹æ³•å°±ä¼šä¸€ç›´ç­‰å¾…ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>accept()</code>  æ–¹æ³•ä¸ºä»€ä¹ˆä¼šé˜»å¡ï¼šå®ƒå†…éƒ¨çš„å®ç°æ˜¯ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŒæ­¥ IOã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>æ˜é‡‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTc0MTkxNjI0MzMxMTAwMTc0\">https://juejin.cn/post/6974191624331100174</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLWJpby5odG1s\">https://pdai.tech/md/java/io/java-io-bio.html</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/30/Java/%E5%B9%B6%E5%8F%91/Java%E7%BA%BF%E7%A8%8B%E6%B1%A01-%E7%9B%B8%E5%85%B3%E7%B1%BB%E7%BB%93%E6%9E%84/",
            "url": "https://cecilia.cool/2022/08/30/Java/%E5%B9%B6%E5%8F%91/Java%E7%BA%BF%E7%A8%8B%E6%B1%A01-%E7%9B%B8%E5%85%B3%E7%B1%BB%E7%BB%93%E6%9E%84/",
            "title": "Javaçº¿ç¨‹æ± (1)--ç›¸å…³ç±»ç»“æ„",
            "date_published": "2022-08-30T01:46:50.000Z",
            "content_html": "<h1 id=\"ç±»ç»“æ„å…³ç³»å›¾\"><a class=\"anchor\" href=\"#ç±»ç»“æ„å…³ç³»å›¾\">#</a> ç±»ç»“æ„å…³ç³»å›¾</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/30/d1bcfa7989f8d9ea.jpg\" alt=\"UMLç±»å›¾\" /></p>\n<h1 id=\"æ¥å£\"><a class=\"anchor\" href=\"#æ¥å£\">#</a> æ¥å£</h1>\n<h2 id=\"excutor\"><a class=\"anchor\" href=\"#excutor\">#</a> Excutor</h2>\n<blockquote>\n<p><code>Executor</code>  æ¥å£æä¾›ä¸€ç§å°†ä»»åŠ¡æäº¤ä»ä»»åŠ¡è¿è¡Œåˆ†ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚é€šå¸¸ä½¿ç”¨  <code>Executor</code>  è€Œä¸æ˜¯æ˜¾å¼åœ°åˆ›å»ºçº¿ç¨‹ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Executor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œä»»åŠ¡æäº¤ç»™ <code>Excutor</code> ï¼Œä»»åŠ¡ä¸ä¼šåœ¨æäº¤çº¿ç¨‹ä¸­è¿è¡Œï¼Œè€Œæ˜¯äº¤ç»™å…¶ä»–çº¿ç¨‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadPerTaskExecutor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Executor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> r<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯ <code>Excutor</code>  ä¹Ÿä¸æ˜¯ä¸¥æ ¼å¼‚æ­¥ï¼Œæœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œ <code>Excutor</code>  å¯ä»¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­ç«‹å³è¿è¡Œæäº¤çš„ä»»åŠ¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DirectExecutor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Executor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> r<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        r<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯çœ‹å®ç°ç±»å¦‚ä½•ç¼–å†™ä»£ç ã€‚<strong>Executor</strong> çš„ä¸»è¦ä½œç”¨ï¼šæä¾›äº†ä¸€ç§æ˜¾ç¤ºåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ã€‚</p>\n<ul>\n<li><code>JDK1.5</code>  ä¹‹å‰çš„æ–¹å¼ï¼š <code>Thread</code>  +  <code>Runnable</code></li>\n<li><code>Executor</code>  æä¾›çš„çš„æ–¹å¼ï¼š <code>Executor</code>  +  <code>Runnable</code></li>\n</ul>\n<h2 id=\"executorservice\"><a class=\"anchor\" href=\"#executorservice\">#</a> ExecutorService</h2>\n<blockquote>\n<p><code>ExecutorService</code>  ç»§æ‰¿è‡ª <code>Executor</code>  æ¥å£ï¼Œ <code>ExecutorService</code>  æä¾›äº†<strong>ç®¡ç†ç»ˆæ­¢</strong>çš„æ–¹æ³•ï¼Œä»¥åŠå¯ä¸ºè·Ÿè¸ªä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒçŠ¶å†µè€Œç”Ÿæˆ  <code>Future</code>  çš„æ–¹æ³•ã€‚ å¯ä»¥å…³é—­  <code>ExecutorService</code> ï¼Œè¿™å°†å¯¼è‡´å…¶åœæ­¢æ¥å—æ–°ä»»åŠ¡ã€‚å…³é—­åï¼Œæ‰§è¡Œç¨‹åºå°†æœ€åç»ˆæ­¢ï¼Œè¿™æ—¶æ²¡æœ‰ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œä¹Ÿæ²¡æœ‰ä»»åŠ¡åœ¨ç­‰å¾…æ‰§è¡Œï¼Œå¹¶ä¸”æ— æ³•æäº¤æ–°ä»»åŠ¡ã€‚</p>\n</blockquote>\n<p>è¯¦ç»†è®²è§£å°±æ˜¯ï¼š</p>\n<ul>\n<li><strong>ExecutorService æ¥å£</strong>æ˜¯ä¸€ä¸ª<strong>æ‰§è¡Œå™¨</strong>ï¼Œå®ƒå¯ä»¥ç»ˆæ­¢ä»»åŠ¡ã€‚</li>\n<li><strong>ExecutorService æ¥å£</strong>è¿˜æä¾›äº†è¿”å›<strong> Future æ¥å£</strong>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨äºè¿½è¸ªä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µã€‚</li>\n<li><strong>ExecutorService</strong> å¯ä»¥æ‰‹åŠ¨å…³é—­ï¼Œè¿™ç§æ“ä½œä¼šå¯¼è‡´å®ƒæ‹’ç»æ–°çš„ä»»åŠ¡ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œå…è®¸ä¹‹å‰å·²ç»æäº¤çš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åå†å…³é—­æ‰§è¡Œå™¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// é˜»æ­¢æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡å¼€å¯ï¼Œå¹¶ä¸”ä¼šè¯•å›¾åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åå…³é—­æ‰§è¡Œå™¨ã€‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">shutdownNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>ExecutorService</code>  è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼š <code>submit()</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> task<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> task<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> task<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™è¡¨ç¤º <code>ExecutorService</code>  å¯ä»¥æ¥æ”¶ <code>Runnable</code> ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶ <code>Callable&lt;T&gt;</code> ã€‚</p>\n<p>ä¸‹é¢ç»™ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">//newCachedThreadPool å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newCachedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//ExecutorService é€šè¿‡ submit æäº¤ä»»åŠ¡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    executorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--- ExecutorService begin.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--- ExecutorService end.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--- ExecutorService is interrupted.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    executorService<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶ä»–ä¸€äº›é‡è¦æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åœ¨çº¿ç¨‹æ± æœåŠ¡æ‰§è¡Œ shutdown () æˆ–è€… shutdownNow () æ–¹æ³•ä¹‹åï¼Œæ‰€æœ‰çš„ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// å¦‚æœæ²¡æœ‰æ‰§è¡Œ shutdown () æˆ–è€… shutdownNow () æ–¹æ³•ï¼Œåˆ™æ°¸è¿œè¿”å› false</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>executorService<span class=\"token punctuation\">.</span><span class=\"token function\">isTerminated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// é˜»å¡ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡ç»ˆæ­¢</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// å¦‚æœç­‰å¾…æ—¶é—´è¶…æ—¶ï¼Œåˆ™è¿”å› false</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// å¦‚æœå½“å‰çº¿ç¨‹è¢« interruptï¼Œåˆ™æŠ›å‡º InterruptedException å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// å¦‚æœçº¿ç¨‹æ± äº†æ‰§è¡Œ shutdown () æˆ–è€… shutdownNow () æ–¹æ³•ï¼Œå¹¶ä¸”æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»å®Œæˆï¼Œåˆ™è¿”å› true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// å¦‚æœçº¿ç¨‹æ± æœªæ‰§è¡Œ shutdown () æˆ–è€… shutdownNow () æ–¹æ³•ï¼Œåˆ™æ°¸è¿œè¿”å› false</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>executorService<span class=\"token punctuation\">.</span><span class=\"token function\">awaitTermination</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MILLISECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"scheduledexecutorservice\"><a class=\"anchor\" href=\"#scheduledexecutorservice\">#</a> ScheduledExecutorService</h2>\n<p>ä» <code>Scheduled</code>  å¯ä»¥çœ‹å‡ºä¸å®šæ—¶æœ‰å…³ã€‚å¯ä»¥åœ¨<strong>ç»™å®šå»¶æ—¶</strong>ä¹‹åè°ƒåº¦ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æŒ‡å®šçš„å‘¨æœŸè°ƒåº¦ä»»åŠ¡ã€‚</p>\n<ul>\n<li><strong>schedule () æ–¹æ³•</strong>å¯ä»¥åˆ›å»ºå«æœ‰<strong>å»¶æ—¶ (delays)<strong> å˜é‡çš„ä»»åŠ¡ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¯ä»¥ç”¨äº</strong>å–æ¶ˆ</strong>æˆ–<strong>æ£€æŸ¥è¿è¡ŒçŠ¶æ€</strong>çš„<strong> Future å¯¹è±¡</strong>ã€‚å¦‚æœ <code>delays&lt;=0</code> ï¼Œåˆ™ä¼šç«‹å³æ‰§è¡Œã€‚</li>\n<li><strong>scheduleAtFixedRate () æ–¹æ³•</strong>å’Œ<strong> scheduleWithFixedDelay () æ–¹æ³•</strong>å¯ä»¥åˆ›å»ºå¹¶è¿è¡Œ<strong>å®šæœŸè¿è¡Œ</strong>çš„ä»»åŠ¡ã€‚</li>\n</ul>\n<p>è¯¦ç»†æ–¹æ³•è¯´æ˜ï¼š</p>\n<p>1. <code>schedule(Runnable command,long delay, TimeUnit unit)</code> ï¼š</p>\n<ul>\n<li>åœ¨ä¸€å®šå»¶æ—¶ (delay) ä¹‹åï¼Œè¿è¡Œ Runnable ä»»åŠ¡ã€‚</li>\n<li>æ­¤ä»»åŠ¡åªè¿è¡Œä¸€æ¬¡ã€‚</li>\n</ul>\n<p>2. <code>schedule(Callable callable,long delay, TimeUnit unit)</code> ï¼š</p>\n<ul>\n<li>åœ¨ä¸€å®šå»¶æ—¶ (delay) ä¹‹åï¼Œè¿è¡Œ Callable ä»»åŠ¡ã€‚</li>\n<li>æ­¤ä»»åŠ¡åªè¿è¡Œä¸€æ¬¡ã€‚</li>\n</ul>\n<p>3. <code>scheduleWithFixedDelay(Runnable command,long initialDelay,long delay,TimeUnit unit)</code> ï¼š</p>\n<ul>\n<li>åœ¨ä¸€å®šå»¶æ—¶ (initialDelay) ä¹‹åï¼Œå¼€å§‹å‘¨æœŸæ€§çš„è¿è¡Œ Runnable ä»»åŠ¡ã€‚</li>\n<li>å‘¨æœŸæ€§ï¼šä¸Šä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ (delay)ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚</li>\n</ul>\n<p>4. <code>scheduleAtFixedRate(Runnable command,long initialDelay,long period,TimeUnit unit)</code> ï¼š</p>\n<ul>\n<li>åœ¨ä¸€å®šå»¶æ—¶ (initialDelay) ä¹‹åï¼Œå¼€å§‹å‘¨æœŸæ€§çš„è¿è¡Œ Runnable ä»»åŠ¡ã€‚</li>\n<li>å‘¨æœŸæ€§ï¼šæ¯è¿‡ä¸€æ®µæ—¶é—´ (period)ï¼Œå°±å¼€å§‹è¿è¡Œä¸€æ¬¡ Runnable ä»»åŠ¡ã€‚</li>\n<li>å¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¤§äºç­‰å¾…å‘¨æœŸ (period)ï¼šä¸Šä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ¯è¿‡ä¸€æ®µæ—¶é—´ (ä»»åŠ¡æ‰§è¡Œæ—¶é—´)ï¼Œå°±å¼€å§‹è¿è¡Œä¸€æ¬¡ Runnable ä»»åŠ¡ã€‚</li>\n</ul>\n<h2 id=\"abstractexecutorservice\"><a class=\"anchor\" href=\"#abstractexecutorservice\">#</a> AbstractExecutorService</h2>\n<blockquote>\n<p><code>AbstractExecutorService</code>  ç»§æ‰¿è‡ª <code>ExecutorService</code>  æ¥å£ï¼Œå…¶æä¾›  <code>ExecutorService</code>  æ‰§è¡Œæ–¹æ³•çš„é»˜è®¤å®ç°ã€‚æ­¤ç±»ä½¿ç”¨  <code>newTaskFor()</code>  è¿”å›çš„ RunnableFuture å®ç°  <code>submit</code> ã€ <code>invokeAny</code>  å’Œ  <code>invokeAll</code>  æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>RunnableFuture</code>  æ˜¯æ­¤åŒ…ä¸­æä¾›çš„  <code>FutureTask</code>  ç±»ã€‚</p>\n</blockquote>\n<p><code>invokeAny()</code>  æ˜¯è°ƒç”¨<strong> newTaskFor () æ–¹æ³•å¯¹ä»»åŠ¡è¿›è¡Œäº†åŒ…è£…ä¸º RunnableFuture å¯¹è±¡</strong>ï¼Œç„¶åè°ƒç”¨äº†<strong>æœ¬å¯¹è±¡çš„ execute () æ–¹æ³•æäº¤ä»»åŠ¡</strong>ï¼Œå¹¶è¿”å›å¼‚æ­¥è®¡ç®—ç»“æœå¯¹è±¡ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1qdWMtb3ZlcnZpZXcuaHRtbA==\">https://pdai.tech/md/java/thread/java-thread-x-juc-overview.html</span></p>\n<p>Executor æ¥å£å­¦ä¹ ç¬”è®°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhbmNoYW81MjcyL2FydGljbGUvZGV0YWlscy83OTgyOTQwNw==\">https://blog.csdn.net/hanchao5272/article/details/79829407</span></p>\n<p>ExecutorService æ¥å£å­¦ä¹ ç¬”è®°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhbmNoYW81MjcyL2FydGljbGUvZGV0YWlscy83OTgzMDI0NQ==\">https://blog.csdn.net/hanchao5272/article/details/79830245</span></p>\n<p>ScheduleExecutorService æ¥å£å­¦ä¹ ç¬”è®°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhbmNoYW81MjcyL2FydGljbGUvZGV0YWlscy83OTgzNDc0NA==\">https://blog.csdn.net/hanchao5272/article/details/79834744</span></p>\n<p>ç®€ä¹¦ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC83NDE4YmVkZDUyMGY=\">https://www.jianshu.com/p/7418bedd520f</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(1)-Unix%20IO%E6%A8%A1%E5%9E%8B/",
            "url": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B(1)-Unix%20IO%E6%A8%A1%E5%9E%8B/",
            "title": "ç½‘ç»œç¼–ç¨‹(1)--Unix IOæ¨¡å‹",
            "date_published": "2022-08-29T09:11:42.000Z",
            "content_html": "<h1 id=\"ioæ¨¡å‹\"><a class=\"anchor\" href=\"#ioæ¨¡å‹\">#</a> I/O æ¨¡å‹</h1>\n<p>Unix åŒ…å«ç‰©ç§ <code>IO</code>  æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šé˜»å¡ <code>IO</code> ã€éé˜»å¡ <code>IO</code> ã€ <code>IO</code>  å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ <code>IO</code> ã€å¼‚æ­¥ <code>IO</code> ã€‚å’Œ Java çš„ <code>IO</code>  æ¨¡å‹æœ‰ä¸‹åˆ—å¯¹åº”ï¼ˆä¸ä¸¥æ ¼ï¼‰</p>\n<table>\n<thead>\n<tr>\n<th>Java-IO æ¨¡å‹</th>\n<th>Unix-IO æ¨¡å‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>BIO</td>\n<td>é˜»å¡å¼ IO</td>\n</tr>\n<tr>\n<td>NIO</td>\n<td>IO å¤šè·¯å¤ç”¨</td>\n</tr>\n<tr>\n<td>AIO</td>\n<td>å¼‚æ­¥ IO</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å†…æ ¸æ€ä¸ç”¨æˆ·æ€\"><a class=\"anchor\" href=\"#å†…æ ¸æ€ä¸ç”¨æˆ·æ€\">#</a> å†…æ ¸æ€ä¸ç”¨æˆ·æ€</h2>\n<p>æˆ‘ä»¬å°†æ–‡ä»¶ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ“ä½œç³»ç»Ÿæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</p>\n<ul>\n<li>è¿›ç¨‹é™·å…¥å†…æ ¸æ€ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œæ–‡ä»¶é˜…è¯»ã€‚</li>\n<li>ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼Œè¿”å›ç”¨æˆ·æ€ã€‚<br />\næ‰€ä»¥ Unix çš„äº”ç§ IO æ¨¡å‹çš„ä¸åŒæŒ‡å‡ºï¼Œå°±æ˜¯è¿™ä¸¤ä¸ªæ­¥éª¤çš„å¤„ç†æµç¨‹ä¸åŒã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/263fe8ccf6ac446f.jpg\" alt=\"å†…æ ¸æ€ä¸ç”¨æˆ·æ€\" /></p>\n<p>è¯¦ç»†å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAzOTc3NDc4NA==\">ä»æ ¹ä¸Šç†è§£ç”¨æˆ·æ€ä¸å†…æ ¸æ€</span>ã€‚</p>\n<h2 id=\"é˜»å¡å¼io\"><a class=\"anchor\" href=\"#é˜»å¡å¼io\">#</a> é˜»å¡å¼ I/O</h2>\n<p>åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼ŒçŸ¥é“æ•°æ®å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºæ‰è¿”å›ã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶ä»–ç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤ä¸æ¶ˆè€—  <code>CPU</code>  æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/2a980fa2571b2c21.jpg\" alt=\"é˜»å¡å¼I/O\" /></p>\n<h2 id=\"éé˜»å¡å¼-io\"><a class=\"anchor\" href=\"#éé˜»å¡å¼-io\">#</a> éé˜»å¡å¼ I/O</h2>\n<p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ ( <code>polling</code> )ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/84ce0bff467e53e2.jpg\" alt=\"éé˜»å¡å¼IOæ¨¡å‹\" /></p>\n<h2 id=\"io-å¤šè·¯å¤ç”¨\"><a class=\"anchor\" href=\"#io-å¤šè·¯å¤ç”¨\">#</a> I/O å¤šè·¯å¤ç”¨</h2>\n<blockquote>\n<p>I/O å¤šè·¯å¤ç”¨æ˜¯æŒ‡ç”¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„çŠ¶æ€ã€‚</p>\n</blockquote>\n<p>ç±»ä¼¼ä¸éé˜»å¡ï¼Œåªä¸è¿‡è½®è¯¢ä¸æ˜¯ç”±ç”¨æˆ·çº¿ç¨‹å»æ‰§è¡Œï¼Œè€Œæ˜¯ç”±å†…æ ¸å»è½®è¯¢ï¼Œå†…æ ¸ç›‘å¬ç¨‹åºç›‘å¬åˆ°æ•°æ®å‡†å¤‡å¥½åï¼Œè°ƒç”¨å†…æ ¸å‡½æ•°å¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·æ€ã€‚ <code>select</code>  ç³»ç»Ÿè°ƒç”¨ï¼ˆpollï¼Œå……å½“ä»£ç†ç±»çš„è§’è‰²ï¼Œä¸æ–­è½®è¯¢æ³¨å†Œåˆ°å®ƒè¿™é‡Œçš„æ‰€æœ‰éœ€è¦ <code>IO</code>  çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæœ‰ç»“æœæ—¶ï¼ŒæŠŠç»“æœå‘Šè¯‰è¢«ä»£ç†çš„ <code>recvfrom</code>  å‡½æ•°ï¼Œå†å»æ‹¿æ•°æ®ã€‚</p>\n<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹å¤šä¸ª <code>IO</code>  ç«¯å£è¿›è¡Œç›‘å¬ï¼Œå½“ <code>socket</code>  æœ‰è¯»å†™äº‹ä»¶æ—¶åˆ†å‘åˆ°<strong>å…·ä½“çš„çº¿ç¨‹</strong>è¿›è¡Œå¤„ç†ã€‚æ¨¡å‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/934a13f46855bf91.jpg\" alt=\"å¤šè·¯å¤ç”¨\" /></p>\n<p>æˆ‘ä»¬ç€é‡è®²è§£ä¸€ä¸‹å¤šè·¯å¤ç”¨ï¼Œè¿™åœ¨ä¹‹åè®²è§£ <code>Reactor</code>  æ¨¡å‹ä¼šç”¨åˆ°ã€‚ä¼ ç»Ÿçš„ <code>I/O</code>  æœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼Œä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½å‡†å¤‡ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå®¢æˆ·ç«¯æ˜¯é•¿è¿æ¥ï¼ˆå¦‚æœå®¢æˆ·ç«¯è¿˜ä¸å‘é€æ•°æ®ï¼ŒæœåŠ¡ç«¯çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨ <code>read</code>  é‚£é‡Œï¼‰ï¼Œçº¿ç¨‹ä¹Ÿå°±è¦ä¸€ç›´ç»´æŠ¤ã€‚éšç€è¿™æ ·çš„å®¢æˆ·ç«¯è¿æ¥è¶Šæ¥è¶Šå¤šï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šæœ‰å¾ˆå¤šç§<strong>çŠ¶æ€</strong>ï¼šè¯»å†™ï¼Œè§£ç ï¼Œç¼–ç ï¼Œè¿æ¥ç­‰ï¼Œæˆ‘ä»¬é€šè¿‡ <code>Selector</code>  é€‰æ‹©å™¨è½®è¯¢è¿™äº›å®¢æˆ·ç«¯ï¼Œåªæœ‰å®¢æˆ·ç«¯åœ¨å¯¹åº”çš„çŠ¶æ€æ‰ä¼šåˆ›å»ºçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼ˆæ¯”å¦‚çœŸæ­£å¼€å§‹è¯»å†™æ‰ä¼šåˆ›å»ºçº¿ç¨‹æ‰§è¡Œï¼Œå½“ç„¶ï¼Œè¿™äº›ç”±çº¿ç¨‹æ± ç»´æŠ¤ï¼‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/07/4d3abcf790e05c9b.jpg\" alt=\"\" /></p>\n<p>å…³äºå¤ç”¨çš„å‡ ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆçœ‹ä¸æ‡‚å°±ç®—äº†ï¼‰ï¼š</p>\n<h3 id=\"select\"><a class=\"anchor\" href=\"#select\">#</a> select</h3>\n<blockquote>\n<p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ† 3 ç±»ï¼Œåˆ†åˆ«æ˜¯ writefdsã€readfdsã€å’Œ exceptfdsã€‚è°ƒç”¨å select å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰ exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeout æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸º null å³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“ select å‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå† fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p>\n</blockquote>\n<h3 id=\"poll\"><a class=\"anchor\" href=\"#poll\">#</a> poll</h3>\n<blockquote>\n<p>poll æœ¬è´¨ä¸Šå’Œ select æ²¡æœ‰åŒºåˆ«ï¼Œå®ƒå°†ç”¨æˆ·ä¼ å…¥çš„æ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åæŸ¥è¯¢æ¯ä¸ª fd å¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œå¦‚æœè®¾å¤‡å°±ç»ªåˆ™åœ¨è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ï¼Œå¦‚æœéå†å®Œæ‰€æœ‰ fd åæ²¡æœ‰å‘ç°å°±ç»ªè®¾å¤‡ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªæˆ–è€…ä¸»åŠ¨è¶…æ—¶ï¼Œè¢«å”¤é†’åå®ƒåˆè¦å†æ¬¡éå† fdã€‚è¿™ä¸ªè¿‡ç¨‹ç»å†äº†å¤šæ¬¡æ— è°“çš„éå†ã€‚</p>\n</blockquote>\n<h3 id=\"epoll\"><a class=\"anchor\" href=\"#epoll\">#</a> epoll</h3>\n<blockquote>\n<p>epoll æ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºè¾¹ç¼˜è§¦å‘ï¼Œå®ƒåªå‘Šè¯‰è¿›ç¨‹å“ªäº› fd åˆšåˆšå˜ä¸ºå°±ç»ªæ€ï¼Œå¹¶ä¸”åªä¼šé€šçŸ¥ä¸€æ¬¡ã€‚è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œepoll ä½¿ç”¨ â€œäº‹ä»¶â€ çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡ epoll_ctl æ³¨å†Œ fdï¼Œä¸€æ—¦è¯¥ fd å°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼ callback çš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥ fdï¼Œepoll_wait ä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚</p>\n</blockquote>\n<h2 id=\"ä¿¡å·é©±åŠ¨-io\"><a class=\"anchor\" href=\"#ä¿¡å·é©±åŠ¨-io\">#</a> ä¿¡å·é©±åŠ¨ I/O</h2>\n<p>åº”ç”¨è¿›ç¨‹ä½¿ç”¨  <code>sigaction</code>  ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€  <code>SIGIO</code>  ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨  <code>recvfrom</code>  å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚</p>\n<p>ç›¸æ¯”äºéé˜»å¡å¼  <code>I/O</code>  çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨  <code>I/O</code>  çš„  <code>CPU</code>  åˆ©ç”¨ç‡æ›´é«˜ã€‚</p>\n<p>ç¼ºç‚¹ï¼šä¿¡å·  <code>I/O</code>  åœ¨å¤§é‡  <code>IO</code>  æ“ä½œæ—¶å¯èƒ½ä¼šå› ä¸ºä¿¡å·é˜Ÿåˆ—æº¢å‡ºå¯¼è‡´æ²¡æ³•é€šçŸ¥ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/d11f190edcb68560.jpg\" alt=\"\" /></p>\n<h2 id=\"å¼‚æ­¥io\"><a class=\"anchor\" href=\"#å¼‚æ­¥io\">#</a> å¼‚æ­¥ I/O</h2>\n<p>åœ¨ä¸Šé¢å››ç§ <code>I/O</code>  æ¨¡å‹ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿›ç¨‹åœ¨è°ƒç”¨ <code>recvfrom</code>  åˆ°å¤„ç†æ•°æ®æŠ¥æ—¶éƒ½ä¼šè¢«é˜»å¡ï¼Œè€Œå¼‚æ­¥ <code>I/O</code>  åšåˆ°äº†çœŸæ­£çš„éé˜»å¡ã€‚å¼‚æ­¥ <code>I/O</code>  ä¹Ÿæ˜¯ä¾é ä¿¡å·é€šçŸ¥ï¼Œä½†æ˜¯é€šçŸ¥çš„æ—¶å€™å¹¶ä¸æ˜¯æ•°æ®æŠ¥å‡†å¤‡å¥½äº†ï¼Œè€Œæ˜¯ <code>I/O</code>  æ“ä½œå·²ç»å®Œæˆã€‚</p>\n<p>ä¸»è¿›ç¨‹åªè´Ÿè´£åšè‡ªå·±çš„äº‹æƒ…ï¼Œç­‰ <code>IO</code>  æ“ä½œå®Œæˆ (æ•°æ®æˆåŠŸä»å†…æ ¸ç¼“å­˜åŒºå¤åˆ¶åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒº) æ—¶é€šè¿‡å›è°ƒå‡½æ•°å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/a4dae8581b870ade.jpg\" alt=\"\" /></p>\n<p>ç›¸å¯¹äºåŒæ­¥ <code>IO</code> ï¼Œå¼‚æ­¥ <code>IO</code>  ä¸æ˜¯é¡ºåºæ‰§è¡Œã€‚ç”¨æˆ·è¿›ç¨‹è¿›è¡Œ <code>aio_read</code>  ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œæ— è®ºå†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œéƒ½ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œç„¶åç”¨æˆ·æ€è¿›ç¨‹å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚ç­‰åˆ° <code>socket</code>  æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå†…æ ¸ç›´æ¥å¤åˆ¶æ•°æ®ç»™è¿›ç¨‹ï¼Œç„¶åä»å†…æ ¸å‘è¿›ç¨‹å‘é€é€šçŸ¥ã€‚ <code>IO</code>  ä¸¤ä¸ªé˜¶æ®µï¼Œè¿›ç¨‹éƒ½æ˜¯éé˜»å¡çš„ã€‚</p>\n<p>è¦å®ç°çœŸæ­£çš„å¼‚æ­¥  <code>I/O</code> ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åšå¤§é‡çš„å·¥ä½œã€‚ç›®å‰  <code>Windows</code>  ä¸‹é€šè¿‡  <code>IOCP</code>  å®ç°äº†çœŸæ­£çš„å¼‚æ­¥  <code>I/O</code> ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLW1vZGVsLmh0bWw=\">https://pdai.tech/md/java/io/java-io-model.html</span></p>\n<p>Stevens W R, Fenner B, Rudoff A M. UNIX network programming[M]. Addison-Wesley Professional, 2004.</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9saW51eC9saWJyYXJ5L2wtYXN5bmMv\">Boost application performance using asynchronous I/O  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS93aW5kb3dzL2Rlc2t0b3AvYWEzNjU2ODModj12cy44NSkuYXNweA==\">Synchronous and Asynchronous I/O  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAwMzA2Mzg1OQ==\">Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kYW5pZWwuaGF4eC5zZS9kb2NzL3BvbGwtdnMtc2VsZWN0Lmh0bWw=\">poll vs select vs event-based  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy51bGR1enNvZnQuY29tLzIwMTQvMDEvc2VsZWN0LXBvbGwtZXBvbGwtcHJhY3RpY2FsLWRpZmZlcmVuY2UtZm9yLXN5c3RlbS1hcmNoaXRlY3RzLw==\">select / poll / epoll: practical difference for system architects  (opens new window)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MDQxNDEyMjE0Nzk4Iw==\">unix ç½‘ç»œç¼–ç¨‹ ç¬¬ä¸€å·</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNzI4NzE4NDYyOTkw\">äº”ç§ IO æ¨¡å‹ä»‹ç»å’Œå¯¹æ¯”</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGemh1YW5sYW4uemhpaHUuY29tJTJGcCUyRjQzOTMzNzE3\">ä¸€æ–‡è¯»æ‡‚é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹ä¸­çš„ I/O æ¨¡å‹</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGd3d3LmppYW5zaHUuY29tJTJGcCUyRmRmZDk0MGU3ZmNhMg==\">èŠèŠ IO å¤šè·¯å¤ç”¨ä¹‹ selectã€pollã€epoll è¯¦è§£</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(4)-%E5%B8%B8%E8%A7%81%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "url": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(4)-%E5%B8%B8%E8%A7%81%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "title": "IO(4)--å¸¸è§ç±»çš„ä½¿ç”¨",
            "date_published": "2022-08-29T02:56:25.000Z",
            "content_html": "<h1 id=\"ioå¸¸è§ç±»\"><a class=\"anchor\" href=\"#ioå¸¸è§ç±»\">#</a> IO å¸¸è§ç±»</h1>\n<p>Java çš„  <code>I/O</code>  å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»:</p>\n<ul>\n<li>ç£ç›˜æ“ä½œ: File</li>\n<li>å­—èŠ‚æ“ä½œ: InputStream å’Œ OutputStream</li>\n<li>å­—ç¬¦æ“ä½œ: Reader å’Œ Writer</li>\n<li>å¯¹è±¡æ“ä½œ: Serializable</li>\n<li>ç½‘ç»œæ“ä½œ: Socket</li>\n</ul>\n<p>åƒ <code>FileInputStream</code>  è¿™æ ·çš„ç±»éƒ½æ˜¯å­—èŠ‚æ“ä½œçš„å­ç±»ï¼Œä¸ç®—å…¥å¸¸è§ç±»è®²è§£ï¼Œä¹‹åä¼šå¯¹è¿™äº›å­ç±»å•ç‹¬å¼€å‘ã€‚</p>\n<h1 id=\"æ–‡ä»¶æµ\"><a class=\"anchor\" href=\"#æ–‡ä»¶æµ\">#</a> æ–‡ä»¶æµ</h1>\n<h2 id=\"fileç±»\"><a class=\"anchor\" href=\"#fileç±»\">#</a> File ç±»</h2>\n<p><code>File</code>  ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚ä¸èƒ½è®¿é—®æ–‡ä»¶å†…å®¹æœ¬èº«ï¼Œéœ€è¦é€šè¿‡è¾“å…¥è¾“å‡ºæµè¿›è¡Œè®¿é—®ã€‚è®¿é—®è·¯å¾„å¯ä»¥æ˜¯ç»å¯¹ / ç›¸å¯¹è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„æ˜¯ç”±ç³»ç»Ÿå±æ€§ <code>user.dir</code>  æŒ‡å®šï¼Œå³ä¸º Java VM æ‰€åœ¨è·¯å¾„ã€‚</p>\n<p>å¯ä»¥é€’å½’åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listAllFiles</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">File</span> dir<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dir <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>dir<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">.</span><span class=\"token function\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">File</span> file <span class=\"token operator\">:</span> dir<span class=\"token punctuation\">.</span><span class=\"token function\">listFiles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token function\">listAllFiles</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>File</code>  ç±»ä¸­å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯åˆ¤æ–­ç±»çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª <code>boolean</code>  å€¼ï¼Œæ–¹æ³•ä½“ç®€å•ï¼Œæ­¤å¤„ä¸ä¼šè¿‡å¤šè®²è§£ï¼Œè¯¦ç»†å…¨é¢çš„æ–¹æ³•å¯ä»¥å‚è€ƒ<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy9hcGkv\"> Java8 API æ–‡æ¡£</span>ã€‚</p>\n<ul>\n<li><code>public void deleteOnExit()</code> ï¼šåœ¨ VM å…³é—­çš„æ—¶å€™ï¼Œåˆ é™¤è¯¥æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œä¸åƒ <code>delete()</code>  æ–¹æ³•ä¸€è°ƒç”¨å°±åˆ é™¤ã€‚ä¸€èˆ¬ç”¨äºä¸´æ—¶æ–‡ä»¶æ¯”è¾ƒåˆé€‚ã€‚</li>\n<li><code>public boolean renameTo(File dest)</code> ï¼šé‡å‘½åæ­¤ File å¯¹è±¡æ‰€å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœé‡å‘½åæˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™ï¼Œè¿”å› falseã€‚</li>\n<li><code>public boolean setReadOnly()</code> ï¼šè®¾ç½®æ­¤ File å¯¹è±¡ä¸ºåªè¯»æƒé™ã€‚</li>\n<li><code>public boolean setWritable(boolean writable, boolean ownerOnly)</code> ï¼šå†™æƒé™è®¾ç½®ï¼Œ <code>writable</code>  å¦‚æœä¸º <code>true</code> ï¼Œå…è®¸å†™è®¿é—®æƒé™ï¼›å¦‚æœä¸º <code>false</code> ï¼Œå†™è®¿é—®æƒé™æ˜¯ä¸å…è®¸çš„ã€‚ <code>ownerOnly</code>  å¦‚æœä¸º <code>true</code> ï¼Œåˆ™å†™è®¿é—®æƒé™ä»…é€‚ç”¨äºæ‰€æœ‰è€…ï¼›å¦åˆ™å®ƒé€‚ç”¨äºæ‰€æœ‰äººã€‚</li>\n<li><code>public boolean setWritable(boolean writable)</code> ï¼š åº•å±‚å®ç°æ˜¯ï¼šé€šè¿‡ <code>setWritable(writable, true)</code>  å®ç°ï¼Œé»˜è®¤æ˜¯ä»…é€‚ç”¨äºæ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰è€…ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">setWritable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> writable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">setWritable</span><span class=\"token punctuation\">(</span>writable<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// åŒæ ·çš„ï¼Œè¿˜æœ‰ setReadableï¼ŒsetExecutable æ–¹æ³•</span></pre></td></tr></table></figure><ul>\n<li><code>public static File createTempFile(String prefix, String suffix, File directory)</code> ï¼šåœ¨æŒ‡å®šçš„ä¸´æ—¶æ–‡ä»¶ç›®å½• <code>directort</code>  ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç©ºæ–‡ä»¶ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ File ç±»æ¥è°ƒç”¨ï¼Œä½¿ç”¨ç»™å®šå‰ç¼€ã€ç³»ç»Ÿç”Ÿæˆçš„éšæœºæ•°ä»¥åŠç»™å®šåç¼€ä½œä¸ºæ–‡ä»¶åã€‚ <code>prefix</code>  è‡³å°‘ 3 å­—èŠ‚é•¿ã€‚å¦‚æœ <code>suffix</code>  è®¾ç½®ä¸º <code>null</code> ï¼Œåˆ™é»˜è®¤åç¼€ä¸º <code>.tmp</code> ã€‚</li>\n<li><code>public String[] list()</code> ï¼šåˆ—å‡º <code>File</code>  å¯¹è±¡çš„æ‰€æœ‰å­æ–‡ä»¶åå’Œè·¯å¾„åï¼Œè¿”å›çš„æ˜¯ <code>String</code>  æ•°ç»„ã€‚</li>\n</ul>\n<h3 id=\"æ–‡ä»¶è¿‡æ»¤å™¨\"><a class=\"anchor\" href=\"#æ–‡ä»¶è¿‡æ»¤å™¨\">#</a> æ–‡ä»¶è¿‡æ»¤å™¨</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">File</span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D:testDir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> nameArr <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> name<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".doc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name <span class=\"token operator\">:</span> nameArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>   </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>list</code>  å‡½æ•°æ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œå…¶æ–¹æ³•å¦‚ä¸‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilenameFilter</span> filter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">String</span> names<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>names <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>filter <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> names<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> v <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// å°†ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åŠ å…¥åˆ°è¿”å›å€¼ä¸­</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> names<span class=\"token punctuation\">.</span>length <span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            v<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> v<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span>v<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@FunctionalInterface</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FilenameFilter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">File</span> dir<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å­—èŠ‚æµç›¸å…³\"><a class=\"anchor\" href=\"#å­—èŠ‚æµç›¸å…³\">#</a> å­—èŠ‚æµç›¸å…³</h2>\n<p>è¿™é‡Œä»‹ç»å…³äº <code>InputStream</code>  å’Œ <code>OutputStream</code>  æœ€ç®€å•çš„ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">copyFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">File</span> in<span class=\"token punctuation\">,</span><span class=\"token class-name\">File</span> out<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">InputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">OutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> r <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        output<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"å­—ç¬¦æµç›¸å…³\"><a class=\"anchor\" href=\"#å­—ç¬¦æµç›¸å…³\">#</a> å­—ç¬¦æµç›¸å…³</h2>\n<p>æœ€ç®€å•çš„ä½¿ç”¨ï¼Œé€è¡Œè¾“å‡ºæ–‡æœ¬</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">copyFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">File</span> in<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">FileReader</span> filReader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">BufferReader</span> bufferReader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReaderBuffer</span><span class=\"token punctuation\">(</span>fileReader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> line<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>line <span class=\"token operator\">=</span> bufferReader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// åœ¨è°ƒç”¨ BufferedReader çš„ close () æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ Reader çš„ close () æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// å› æ­¤åªè¦ä¸€ä¸ª close () è°ƒç”¨å³å¯</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    bufferedReader<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"åºåˆ—åŒ–\"><a class=\"anchor\" href=\"#åºåˆ—åŒ–\">#</a> åºåˆ—åŒ–</h2>\n<p>ä¸€èˆ¬ä¸ºäº†å°†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Json</code> ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åºåˆ—åŒ–ï¼Œ<strong>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“</strong>ã€‚ä½ å¯ä»¥å°†éœ€è¦å­˜å‚¨çš„å¯¹è±¡ï¼ˆå¤šä¸ªï¼‰æ”¾åœ¨ä¸€ä¸ª <code>list</code>  æˆ–è€… <code>map</code>  é›†åˆä¸­ï¼Œç„¶åå†é€šè¿‡åºåˆ—åŒ–å°†é›†åˆæ”¾å…¥æ–‡ä»¶ä¸­ï¼ˆä½†æ˜¯ä½ æ‰“å¼€æ–‡ä»¶é‡Œé¢æ˜¯ä¹±ç ï¼Œä¸åƒ <code>Json</code>  å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ä¿å­˜çš„å®é™…å†…å®¹ï¼‰ã€‚</p>\n<p>ç›¸å…³æ–¹æ³•ï¼š</p>\n<ul>\n<li>åºåˆ—åŒ–: ObjectOutputStream.writeObject ()</li>\n<li>ååºåˆ—åŒ–: ObjectInputStream.readObject ()</li>\n</ul>\n<p>çœ‹çœ‹æœ€åŸºæœ¬çš„ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">A</span> a1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token number\">123</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">String</span> objectFile <span class=\"token operator\">=</span> <span class=\"token string\">\"file/a1\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">ObjectOutputStream</span> objectOutputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>objectFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    objectOutputStream<span class=\"token punctuation\">.</span><span class=\"token function\">writeObject</span><span class=\"token punctuation\">(</span>a1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    objectOutputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">ObjectInputStream</span> objectInputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectInputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>objectFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">A</span> a2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">A</span><span class=\"token punctuation\">)</span> objectInputStream<span class=\"token punctuation\">.</span><span class=\"token function\">readObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    objectInputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>a2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">A</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> y<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"x = \"</span> <span class=\"token operator\">+</span> x <span class=\"token operator\">+</span> <span class=\"token string\">\"  \"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"y = \"</span> <span class=\"token operator\">+</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯<strong>ä¿å­˜å¯¹è±¡çš„çŠ¶æ€</strong>ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚å¯¹äºéé™æ€å±æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>transient</code>  å…³é”®å­—ï¼Œè¯¥å…³é”®å­—å¯ä»¥é¿å…è¢«ä¿®é¥°å±æ€§åºåˆ—åŒ–ã€‚</p>\n<p>ä¾‹å¦‚ <code>ArrayList</code>  ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„  <code>elementData</code>  æ˜¯ç”¨  <code>transient</code>  ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> elementData<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>ArrayList</code>  ä¸­å®ç°äº† <code>writeObject</code>  å’Œ <code>readObject</code></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">writeObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>ObjectOutputStream</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>IOException</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">// é˜²æ­¢åºåˆ—åŒ–æœŸé—´æœ‰ä¿®æ”¹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">int</span> expectedModCount <span class=\"token operator\">=</span> modCount<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// å†™å‡ºé transient é static å±æ€§ï¼ˆä¼šå†™å‡º size å±æ€§ï¼‰</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t<span class=\"token comment\">// ArrayList ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªæ•°ç»„éœ€è¦åºåˆ—åŒ–å§</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        s<span class=\"token punctuation\">.</span><span class=\"token function\">defaultWriteObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å†™å‡ºå¤§å°ä½œä¸ºä¸ cloneï¼ˆï¼‰è¡Œä¸ºå…¼å®¹çš„å®¹é‡</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        s<span class=\"token punctuation\">.</span><span class=\"token function\">writeInt</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// ä¾æ¬¡å†™å‡ºå…ƒç´ </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>size<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            s<span class=\"token punctuation\">.</span><span class=\"token function\">writeObject</span><span class=\"token punctuation\">(</span>elementData<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœæœ‰ä¿®æ”¹ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>modCount <span class=\"token operator\">!=</span> expectedModCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentModificationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸€èˆ¬åœ°ï¼Œåªè¦å®ç°äº† Serializable æ¥å£å³å¯è‡ªåŠ¨åºåˆ—åŒ–ï¼Œ <code>writeObject()</code>  å’Œ <code>readObject()</code>  æ˜¯ä¸ºäº†è‡ªå·±æ§åˆ¶åºåˆ—åŒ–çš„æ–¹å¼ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»å£°æ˜ä¸º <code>private</code> ï¼Œåœ¨ <code>java.io.ObjectStreamClass#getPrivateMethod()</code>  æ–¹æ³•ä¸­é€šè¿‡åå°„è·å–åˆ° <code>writeObject()</code>  è¿™ä¸ªæ–¹æ³•ã€‚</p>\n<p><code>readObject</code>  åŒç†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>ObjectInputStream</span> s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">throws</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// å£°æ˜ä¸ºç©ºæ•°ç»„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    elementData <span class=\"token operator\">=</span> <span class=\"token constant\">EMPTY_ELEMENTDATA</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// è¯»å…¥é transient é static å±æ€§ï¼ˆä¼šè¯»å– size å±æ€§ï¼‰</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    s<span class=\"token punctuation\">.</span><span class=\"token function\">defaultReadObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// è¯»å…¥å…ƒç´ ä¸ªæ•°ï¼Œæ²¡ä»€ä¹ˆç”¨ï¼Œåªæ˜¯å› ä¸ºå†™å‡ºçš„æ—¶å€™å†™äº† size å±æ€§ï¼Œè¯»çš„æ—¶å€™ä¹Ÿè¦æŒ‰é¡ºåºæ¥è¯»</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    s<span class=\"token punctuation\">.</span><span class=\"token function\">readInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ignored</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>size <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// è®¡ç®—å®¹é‡</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">int</span> capacity <span class=\"token operator\">=</span> <span class=\"token function\">calculateCapacity</span><span class=\"token punctuation\">(</span>elementData<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">SharedSecrets</span><span class=\"token punctuation\">.</span><span class=\"token function\">getJavaOISAccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkArray</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> capacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token function\">ensureCapacityInternal</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> a <span class=\"token operator\">=</span> elementData<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// ä¾æ¬¡è¯»å–å…ƒç´ åˆ°æ•°ç»„ä¸­</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>size<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            a<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">readObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ç¼“å†²æµ\"><a class=\"anchor\" href=\"#ç¼“å†²æµ\">#</a> ç¼“å†²æµ</h1>\n<p>ç¼“å†²æµä¹Ÿåˆ†è¾“å…¥æµå’Œè¾“å‡ºæµï¼Œå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚ä½¿ç”¨æ–¹æ³•å¤§åŒå°å¼‚ï¼Œè¿™é‡Œä»¥ç¼“å†²æµçš„å­—èŠ‚è¾“å…¥æµ <code>BufferedInputStream</code>  ä¸ºä¾‹è®²è§£ã€‚</p>\n<p>æ„é€ æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">BufferedInputStream</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InputStream</span> in<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>size <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Buffer size &lt;= 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    buf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">BufferedInputStream</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InputStream</span> in<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">,</span> <span class=\"token constant\">DEFAULT_BUFFER_SIZE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥æ”¶çš„å‚æ•°å¯ä»¥æ˜¯ <code>FileInputStream</code> ï¼Œå¦‚æœä½ äº†è§£<strong>è£…é¥°è€…æ¨¡å¼</strong>ï¼Œå°±ä¼šå¯¹è¿™ç§è®¾è®¡éå¸¸ç†Ÿæ‚‰ã€‚</p>\n<p>ç¼“å†²æµçš„å‡ºç°ä¸»è¦æ˜¯ <code>FileInputStream</code>  è¿™æ ·çš„æ–‡ä»¶ç±»éƒ½æ˜¯ç›´æ¥å’Œç¡¬ç›˜è¿›è¡Œäº¤äº’ï¼Œä½†æ˜¯ç£ç›˜çš„éšæœºè¯»å–æ˜¯ååˆ†æ¶ˆè€—æ—¶é—´çš„ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ <code>FileInputstream</code>  æ—¶ï¼Œéƒ½ä¼šåœ¨å¤–ç•Œå®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå¾ªç¯è°ƒç”¨ <code>read</code>  å‡½æ•°å°†ç£ç›˜ä¸­çš„æ•°æ®è¯»åˆ°æ•°ç»„ä¸­ã€‚ä½†æ˜¯è¿™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾å®šä¹‰çš„æ•°ç»„å¾ˆå°ï¼Œé‚£ä¹ˆè¦å°†ç£ç›˜ä¸­çš„æ•°æ®å…¨éƒ¨éƒ½å‡ºæ¥å°±éœ€è¦è°ƒç”¨å¤šæ¬¡ <code>read</code>  æ–¹æ³•ã€‚å‡è®¾å¾ªç¯ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>read</code>  æ–¹æ³•ï¼Œç£ç›˜å°†ç£å¤´å®šä½åˆ°ç›¸åº”ä½ç½®ï¼ˆè¿™ä¸ªè¿‡ç¨‹å¯¹äº CPU æ¥è¯´éå¸¸æ…¢ï¼‰ï¼Œç„¶åè½¬åŠ¨ç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ã€‚æ­¤æ—¶ç”µè„‘ä¸­å…¶ä»–ç¨‹åºä¹Ÿéœ€è¦è®¿é—®ç£ç›˜ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆç£ç›˜åˆéœ€è¦é‡æ–°è½¬åŠ¨ç£å¤´å®šä½åˆ°ç£ç›˜ä¸­ç›¸åº”çš„ä½ç½®è¿›è¡Œæ•°æ®è¯»å–ã€‚åˆ°äº†åé¢çš„å¾ªç¯è°ƒç”¨ <code>read</code> ï¼Œç”±äºç£å¤´å¹¶ä¸åœ¨ç¬¬ä¸€æ¬¡ <code>read</code>  è¯»å–åˆ°çš„ç£ç›˜åŒºåŸŸï¼Œæ‰€ä»¥ç£å¤´åˆè¦é‡æ–°å®šä½......</p>\n<p>æ‰€ä»¥ç¼“å†²æµå°±æ˜¯å°†æˆ‘ä»¬å®šä¹‰çš„é‚£ä¸ªæ•°ç»„æ”¾åˆ°ç±»é‡Œé¢è¿›è¡Œå°è£…ï¼ŒåŒæ—¶æä¾›ä¸€äº›å…¶ä»–ä¾¿äºä½¿ç”¨çš„æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//read æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>read</code>  å¯¹å¤–æä¾›çš„æ–¹æ³•æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯è¯´è¿”å›çš„ç»“æœä¸ä¸€å®šæ˜¯ä»ç¡¬ç›˜ä¸­ç›´æ¥è¯»å–çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»ç¼“å†²æ•°ç»„è¿”å›çš„ã€‚</p>\n<p>è¿™é‡Œç€é‡è®²ä¸€ä¸‹ <code>mark</code>  æ–¹æ³•å’Œ <code>reset</code>  æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//mark æ–¹æ³•èƒ½å¤Ÿåœ¨å½“å‰ä½ç½®æ‰“ä¸€ä¸ªæ ‡è®°ï¼Œä¹‹åå†æ¬¡è°ƒç”¨ reset æ–¹æ³•ï¼Œ\"æŒ‡é’ˆå°±ä¼šå›åˆ°æ ‡è®°å¤„\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">mark</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> readlimit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    marklimit <span class=\"token operator\">=</span> readlimit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    markpos <span class=\"token operator\">=</span> pos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">getBufIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Cause exception if closed</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markpos <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Resetting to invalid mark\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    pos <span class=\"token operator\">=</span> markpos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ–¹æ³•çš„å®ç°å¾ˆç®€å•ï¼Œåªæ˜¯è®¾ç½®äº†å‡ ä¸ªå˜é‡çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ <code>BufferedInputStream</code>  ç›¸å…³çš„å˜é‡è®¾è®¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç¼“å†²æ•°ç»„</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">byte</span> buf<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//mark æ–¹æ³•æœ€å¤šä¿å­˜çš„å­—èŠ‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> marklimit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// æ ‡è®°ä½ç½®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> markpos <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// æ•°ç»„ä¸­å­˜å‚¨çš„æ•°æ®ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// æºç æ³¨é‡Šä¸ºç¼“å†²æ•°ç»„ä¸­æœ€åä¸€ä¸ªæœ‰æ•ˆçš„å…ƒç´ çš„ä¸‹æ ‡ + 1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> count<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// å½“å‰è¯»å–åˆ°æ•°ç»„ä¸­çš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> pos<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ <code>mark</code>  å’Œ <code>reset</code>  æ–¹æ³•ï¼ˆä»¥åŠç›¸å…³çš„å±æ€§éƒ½æ²¡æœ‰ï¼‰ï¼Œé‚£ä¹ˆå…³äºç¼“å†²çš„è®¾è®¡ï¼Œæ— éå°±æ˜¯å½“ <code>(pos==buff.length)</code>  æ—¶å°† <code>pos</code>  è®¾ä¸º 0ï¼Œç„¶åé‡æ–°è¯»ä¸€ç»„æ•°ç»„è¦†ç›– <code>buff</code>  æ•°ç»„ã€‚</p>\n<p>å†å¤æ‚ä¸€ç‚¹å°±æ˜¯ï¼Œæœ‰æ¬¡è¯»å–ä¹Ÿè®¸å¹¶ä¸ä¼šå°†æ•°ç»„å¡«æ»¡ï¼ˆè¿™å¾ˆæ­£å¸¸ï¼Œæ¯”å¦‚ç£ç›˜ä¸­æ•°ç»„ä¸è¶³ä»¥å¡«æ»¡ç¼“å†²æ•°ç»„ï¼‰ï¼Œå‡è®¾é•¿åº¦ä¸º 10ï¼Œæœ‰å¯èƒ½è¯»äº† 9 ä¸ªæ•°æ®è¿›å»ï¼Œæ­¤æ—¶ <code>count=9</code> ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨é‡æ–°è¦†ç›–æ•°ç»„å‰ï¼Œåº”è¯¥å…ˆåˆ¤æ–­ä¸€ä¸‹ <code>pos&gt;=count</code>  è¿™ä¸ªæ¡ä»¶ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>read</code>  æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pos <span class=\"token operator\">>=</span> count<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// æ•°ç»„ä¸­æ‰€æœ‰æ•°æ®éƒ½è¢«è¯»å–äº†</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é‡æ–°å¡«å…¥æ•°æ®</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pos <span class=\"token operator\">>=</span> count<span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¦‚æœé‡æ–°å¡«å…¥æ•°æ®éƒ½ pos ä»ç„¶å¤§äº countï¼Œè¯´æ˜æ²¡æœ‰æ•°æ®äº†</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// åæ­£å°±æ˜¯è¿”å›è¯»åˆ°çš„å…ƒç´ </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">getBufIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>pos<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘ <code>mark</code>  æ–¹æ³•çš„å®ç°ï¼Œé‚£ä¹ˆ <code>fill()</code>  åº”è¯¥è¿™ä¹ˆå®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buffer <span class=\"token operator\">=</span> <span class=\"token function\">getBufIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å–ç¼“å†²æ•°ç»„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> \tpos <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    count <span class=\"token operator\">=</span> pos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// è¯»å–æ•°æ®åˆ°ç¼“å†²æ•°ç»„ä¸­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> <span class=\"token function\">getInIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// è¯»å–åˆ°æ•°æ®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        count <span class=\"token operator\">+=</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼Œfill ç»“æŸæ—¶ pos å’Œ count éƒ½æ˜¯ 0ï¼Œåœ¨ read ä¸­å°±è¿”å› - 1</span></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœè¦è€ƒè™‘ mark æ ‡è®°ï¼Œæˆ‘ä»¬å°±ä¸èƒ½éšæ„è¦†ç›–æ ‡è®°ï¼Œæˆ‘ä»¬å…ˆä¸¾ä¸€ç§æç«¯çš„æƒ…å†µ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">FileInputStream</span> in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">BufferedInputStream</span> bI <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedInputStream</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        bI<span class=\"token punctuation\">.</span><span class=\"token function\">mark</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æˆ‘ä»¬å…è®¸æ‰“ä¸Šæ ‡è®°åï¼Œå¦‚æœè¿›è¡Œäº† > 40 æ¬¡ readï¼Œreset å¯èƒ½ä¼šå¤±æ•ˆ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            bI<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        bI<span class=\"token punctuation\">.</span><span class=\"token function\">reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬åªè®¾ç½®äº†ç¼“å†²åŒºæ•°ç»„å¤§å°ä¸º 4ï¼Œä½†æ˜¯ mark çš„å‚æ•°æ˜¯ 40ï¼Œæˆ‘ä»¬åœ¨ reset å¤„æ‰“æ–­ç‚¹æŸ¥çœ‹ä¸€ä¸‹å˜é‡</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/09/05/0b2154c97cf6a393.jpg\" alt=\"markå‚æ•°\" /></p>\n<p>æ˜¾ç„¶ mark å‚æ•°ä¼šå½±å“æ•°ç»„å¤§å°ï¼ˆå…¶å®æ˜¯èµ‹å€¼ç»™ <code>marklimit</code> ï¼Œç„¶ååœ¨ <code>fill</code>  ä¸­æ‰©å®¹çš„ï¼‰ï¼Œä½†æ˜¯ä»£ç æ³¨é‡Šä¸­æˆ‘ä¹Ÿå†™äº†æ˜¯å¯èƒ½ä¼šå¤±æ•ˆï¼Œ <code>BufferedInputStream</code>  ä½ å¯ä»¥ç†è§£ä¸ºæ˜¯å°½åŠ›åœ¨ç»´æŠ¤ä¿å­˜è¿™ä¸ªæ ‡è®°ï¼Œå¦‚æœ mark çš„å‚æ•° <code>k</code>  å¾ˆå°ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨è€…èƒ½å¤Ÿå®¹å¿åœ¨é¢å¤–è°ƒç”¨äº† <code>k</code>  æ¬¡ <code>read</code>  å <code>reset</code>  ä¼šå¤±æ•ˆçš„ï¼Œä½†æ˜¯å¦‚æœç¼“å†²æ•°ç»„èƒ½å¤Ÿåœ¨è¯»å–äº† <code>k</code>  æ¬¡åè¿˜èƒ½ä¿å­˜æ ‡è®°ä½ï¼Œå®ƒæ˜¯ä¼šå»ä¿å­˜çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦çœ‹ä¸€ä¸‹ <code>fill</code>  åŸæœ¬å®Œæ•´çš„ä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buffer <span class=\"token operator\">=</span> <span class=\"token function\">getBufIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//markpos &lt; 0 è¯´æ˜æ²¡æœ‰è°ƒç”¨è¿‡ markï¼Œä¹Ÿå°±æ˜¯ä¸è€ƒè™‘ mark çš„æƒ…å†µ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markpos <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        pos <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>           </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pos <span class=\"token operator\">>=</span> buffer<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>  <span class=\"token comment\">//no room left in buffer -- éœ€è¦æ‰©å®¹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>markpos <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// å°† markpos åˆ°æœ«å°¾çš„æ•°æ®éƒ½é‡æ–°å¤åˆ¶åˆ°æ•°ç»„å‰é¢çš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// æ­¤æ—¶ä¸ç”¨ç®¡ marklimit, å› ä¸ºç°åœ¨æ˜¯è°ƒç”¨ reset ä¸€å®šèƒ½å›åˆ°æ ‡å¿—å¤„</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// è¿™å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„å°½é‡ä¿å­˜æ ‡è®°ä½</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// ä½ å¯ä»¥æƒ³æƒ³ï¼Œå¦‚æœ marklimit å¾ˆå°ï¼Œä½†æ˜¯æ•°ç»„ä»ä¼šä¿å­˜è¿™ä¸ªæ ‡è®°ä½</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">int</span> sz <span class=\"token operator\">=</span> pos <span class=\"token operator\">-</span> markpos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">arraycopy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> markpos<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> sz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            pos <span class=\"token operator\">=</span> sz<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            markpos <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> marklimit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// æ­¤æ—¶ markpos ä¸€å®šä¸º 0</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// å“ªæ€•å°½é‡ä¿å­˜ï¼Œå½“ markpos ä¸æ–­å‰ç§»ï¼Œç›´åˆ°ä¸º 0 æ—¶ï¼Œå°±ä¸èƒ½å†ä¿å­˜äº†</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// æ‰€ä»¥æ­¤æ—¶å°±ä¼šå¤±æ•ˆ</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// æ‰€ä»¥ä½ ä¼šçœ‹åˆ°ï¼Œå½“ marklimit å¾ˆå°æ—¶ï¼Œä¼šå‡ºç°ä¸¤ç§æƒ…å†µ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 1. å¦‚æœæ•°ç»„å¾ˆå¤§å¾ˆå¤§ï¼Œå¤±æ•ˆå°±ä¼šå‡ºç°å¾—æ›´æ™šï¼ˆå…¶å®æ¬¡æ•°å°±æ˜¯ lengthï¼‰</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token comment\">// 2. å¦‚æœæ•°ç»„å¾ˆå°ï¼ˆä½†æ˜¯ä¾ç„¶ >=marklimit), å¤±æ•ˆä¹Ÿä¼šå¾ˆæ—©ï¼ˆæ¬¡æ•°å…¶å®ä¹Ÿæ˜¯ lengthï¼‰</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            markpos <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            pos <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>       </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token constant\">MAX_BUFFER_SIZE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutOfMemoryError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Required array size too large\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæˆ‘ä»¬è®¾ç½®çš„ marklimit å¾ˆå¤§å¾ˆå¤§ï¼Œè¶…è¿‡äº† length</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token comment\">// é‚£ä¹ˆæ•°ç»„å°±åº”è¯¥è¿åˆä½¿ç”¨è€…ï¼Œå“ªæ€•å¯¹æ•°ç»„æ‰©å®¹ä¹Ÿè¦åœ¨ marklimit å¤±æ•ˆå‰ä¿å­˜æ ‡è®°ä½</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// è¿™é‡Œé‡‡ç”¨çš„æ˜¯äºŒå€æ‰©å®¹</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">int</span> nsz <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pos <span class=\"token operator\">&lt;=</span> <span class=\"token constant\">MAX_BUFFER_SIZE</span> <span class=\"token operator\">-</span> pos<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                pos <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">:</span> <span class=\"token constant\">MAX_BUFFER_SIZE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nsz <span class=\"token operator\">></span> marklimit<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                nsz <span class=\"token operator\">=</span> marklimit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">byte</span> nbuf<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>nsz<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">arraycopy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> nbuf<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>bufUpdater<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">,</span> nbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Stream closed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            buffer <span class=\"token operator\">=</span> nbuf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    count <span class=\"token operator\">=</span> pos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> <span class=\"token function\">getInIfOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> pos<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        count <span class=\"token operator\">=</span> n <span class=\"token operator\">+</span> pos<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å·®ä¸å¤šç¼“å†²æµå°±æ˜¯è¿™æ ·äº†ï¼Œåœ¨è£…é¥°è€…æ¨¡å¼ä¸‹ï¼Œå®ç°ç®€å•æ˜“æ‡‚ã€‚</p>\n<h1 id=\"è½¬æ¢æµ\"><a class=\"anchor\" href=\"#è½¬æ¢æµ\">#</a> è½¬æ¢æµ</h1>\n<p>å‡è®¾æˆ‘ä»¬åªæ‹¿åˆ°äº† <code>FileInputStream</code> ï¼Œå´å¸Œæœ›ä½¿ç”¨å­—ç¬¦æµï¼Œè¿™é‡Œè¿˜æ˜¯éœ€è¦å€ŸåŠ©è£…é¥°è€…æ¨¡å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InputStreamReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">reader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        e<span class=\"token punctuation\">.</span>printStackTrace</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// æ™®é€šçš„å­—ç¬¦æµæ˜¯ï¼šReader reader = new FileReader ();</span></pre></td></tr></table></figure><p><code>writer</code>  æ˜¯å·®ä¸å¤šçš„ï¼Œä¸å†èµ˜è¿°ã€‚</p>\n<h1 id=\"æ‰“å°æµ\"><a class=\"anchor\" href=\"#æ‰“å°æµ\">#</a> æ‰“å°æµ</h1>\n<p>å¹³æ—¶ä½¿ç”¨çš„ <code>System.out</code>  å°±æ˜¯æ‰“å°æµ <code>PrnitStream</code> ï¼Œè¯¥ç±»ä¹Ÿç»§æ‰¿äº† <code>FilterOutputStream</code>  ç±»ã€‚å­˜åœ¨è‡ªåŠ¨å¸…é‚£äº›æœºåˆ¶ï¼Œå½“å‘æ‰“å°æµä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚æ•°ç»„åè‡ªåŠ¨è°ƒç”¨ <code>flush</code>  æ–¹æ³•ã€‚å†…éƒ¨ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>checkError()</code>  æ–¹æ³•è¿›è¡Œé”™è¯¯æ£€æŸ¥ã€‚ä»–èƒ½æ ¼å¼åŒ–ä»»æ„ç±»å‹å¹¶ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å†™å…¥åˆ°è¾“å‡ºæµä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Strin</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">try</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PrintStream</span> stream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrintStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        stream<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>æ˜é‡‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MTI2ODU4NDI4NDI0I2hlYWRpbmctNg==\">https://juejin.cn/post/6844904126858428424#heading-6</span></p>\n<p>ArrayList æ˜¯å¦‚ä½•å®ç°åºåˆ—åŒ–çš„ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTYxNTA3L2FydGljbGUvZGV0YWlscy8xMDk0Mzk2OTM=\">https://blog.csdn.net/qq_43561507/article/details/109439693</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLWJhc2ljLXVzYWdlLmh0bWw=\">https://pdai.tech/md/java/io/java-io-basic-usage.html</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(3)-OutputStream%E6%BA%90%E7%A0%81/",
            "url": "https://cecilia.cool/2022/08/29/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(3)-OutputStream%E6%BA%90%E7%A0%81/",
            "title": "IO(3)--OutputStreamæºç ",
            "date_published": "2022-08-28T23:53:40.000Z",
            "content_html": "<h1 id=\"ç±»ç»“æ„\"><a class=\"anchor\" href=\"#ç±»ç»“æ„\">#</a> ç±»ç»“æ„</h1>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/29/e599d6a89199aff1.jpg\" alt=\"UML\" /></p>\n<h1 id=\"æºç è§£æ\"><a class=\"anchor\" href=\"#æºç è§£æ\">#</a> æºç è§£æ</h1>\n<p>æˆ‘ä»¬å·²ç»åˆ†æäº† <code>InputStream</code> ï¼Œè¿™ä¸¤ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¸€ä¸ª <code>read</code>  å¯¹åº”ä¸€ä¸ª <code>write</code> ï¼Œä¹Ÿæ˜¯ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SOutputStream</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Closeable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Flushable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// å°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å°†æŒ‡å®šçš„ byte æ•°ç»„çš„å­—èŠ‚å…¨éƒ¨å†™å…¥è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// å°†æŒ‡å®šçš„ byte æ•°ç»„ä¸­ä»åç§»é‡ off å¼€å§‹çš„ len ä¸ªå­—èŠ‚å†™å…¥è¾“å‡ºæµ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>off <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>off <span class=\"token operator\">></span> b<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                   <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>off <span class=\"token operator\">+</span> len<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> b<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>off <span class=\"token operator\">+</span> len<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IndexOutOfBoundsException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len <span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">[</span>off <span class=\"token operator\">+</span> i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// åˆ·æ–°è¾“å‡ºæµï¼Œå¹¶å¼ºåˆ¶å†™å‡ºæ‰€æœ‰ç¼“å†²çš„è¾“å‡ºå­—èŠ‚</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// å…³é—­è¾“å‡ºæµï¼Œå¹¶é‡Šæ”¾ä¸è¯¥æµæœ‰å…³çš„æ‰€æœ‰èµ„æº</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/27/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(2)-InputStream%E6%BA%90%E7%A0%81/",
            "url": "https://cecilia.cool/2022/08/27/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(2)-InputStream%E6%BA%90%E7%A0%81/",
            "title": "IO(2)--InputStreamæºç ",
            "date_published": "2022-08-27T01:58:11.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œè¯·å…ˆçœ‹å®Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­ <code>IO</code>  çš„ç±»è®¾è®¡ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼ã€‚ <code>InputStream</code>  è¡¨ç¤ºè¾“å…¥ï¼Œæ˜¯æŒ‡å¤–ç•Œå¯¹ç¨‹åºè¿›è¡Œæ•°æ®çš„è¾“å…¥ã€‚å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå³è¡¨ç¤ºæ‰€æœ‰å­—èŠ‚è¾“å…¥æµå®ç°ç±»çš„åŸºç±»ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æŠ½è±¡åœ°è¡¨ç¤ºæ‰€æœ‰ä»ä¸åŒæ•°æ®æºäº§ç”Ÿè¾“å…¥çš„ç±»ã€‚</p>\n<h1 id=\"æ ¸å¿ƒæ–¹æ³•\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•\">#</a> æ ¸å¿ƒæ–¹æ³•</h1>\n<p><code>InputStream</code>  çš„ä¸‰ä¸ª <code>read</code>  æ˜¯æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼ˆ<strong>JDK8</strong>ï¼‰ï¼Œåˆ†åˆ«æ˜¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è¯»å–ä¸‹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› - 1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// å…·ä½“å®ç°ä¹‹ååˆ†æ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>åœ¨<strong> JDK9</strong> å’Œ<strong> JDK11</strong> åˆæ–°å¢äº†å…¶ä»–å‡ ä¸ªæ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// JDK9 æ–°å¢ï¼šè¯»å– InputStream ä¸­çš„æ‰€æœ‰å‰©ä½™å­—èŠ‚ï¼Œè°ƒç”¨ readNBytes (Integer.MAX_VALUE) æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">readAllBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// JDK11 æ›´æ–°ï¼šè¯»å– InputStream ä¸­çš„å‰©ä½™å­—èŠ‚çš„æŒ‡å®šä¸Šé™å¤§å°çš„å­—èŠ‚å†…å®¹ï¼›æ­¤æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¯»å–äº†è¯·æ±‚çš„å­—èŠ‚æ•°ã€æ£€æµ‹åˆ°æµç»“æŸæˆ–å¼•å‘å¼‚å¸¸ä¸ºæ­¢ã€‚æ­¤æ–¹æ³•ä¸ä¼šå…³é—­è¾“å…¥æµã€‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">readNBytes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// JDK9 æ–°å¢ï¼šä»è¾“å…¥æµè¯»å–è¯·æ±‚çš„å­—èŠ‚æ•°å¹¶ä¿å­˜åœ¨ byte æ•°ç»„ä¸­ï¼› æ­¤æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¯»å–äº†è¯·æ±‚çš„å­—èŠ‚æ•°ã€æ£€æµ‹åˆ°æµç»“æŸæˆ–å¼•å‘å¼‚å¸¸ä¸ºæ­¢ã€‚æ­¤æ–¹æ³•ä¸ä¼šå…³é—­è¾“å…¥æµã€‚</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">readNBytes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> b<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> off<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// JDK9 æ–°å¢ï¼šè¯»å– InputStream ä¸­çš„å…¨éƒ¨å­—èŠ‚å¹¶å†™å…¥åˆ°æŒ‡å®šçš„ OutputStream ä¸­</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OutputStream</span> out<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å…¶ä»–çš„é‡è¦æ–¹æ³•ä¹‹åä¼šåœ¨æºç è®²è§£æåˆ°ã€‚</p>\n<h1 id=\"æºç è§£æ\"><a class=\"anchor\" href=\"#æºç è§£æ\">#</a> æºç è§£æ</h1>\n<p><code>InputStream</code>  æœ‰å‡ ä¸ªé‡è¦çš„å±æ€§</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å½“ä½¿ç”¨ skip æ–¹æ³•æ—¶ï¼Œæœ€å¤§çš„ buffer size å¤§å°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">MAX_SKIP_BUFFER_SIZE</span> <span class=\"token operator\">=</span> <span class=\"token number\">2048</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// é»˜è®¤çš„ buffer sizeï¼ˆJDK8 æ²¡æœ‰è¯¥å±æ€§ï¼‰</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">DEFAULT_BUFFER_SIZE</span> <span class=\"token operator\">=</span> <span class=\"token number\">8192</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// ç”±äºä¸€äº› VM åœ¨æ•°ç»„ä¸­ä¿ç•™ä¸€äº›å¤´å­—ï¼Œæ‰€ä»¥å°è¯•åˆ†é…è¾ƒå¤§çš„é˜µåˆ—å¯èƒ½ä¼šå¯¼è‡´</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// OutOfMemoryErrorï¼ˆè¯·æ±‚çš„é˜µåˆ—å¤§å°è¶…è¿‡ VM é™åˆ¶ï¼‰</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">MAX_BUFFER_SIZE</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_VALUE</span> <span class=\"token operator\">-</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>read(byte b[], int off, int len)</code>  æ–¹æ³•ï¼šå› ä¸ºä»£ç æ¯”è¾ƒç®€å•ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œåœ¨ <code>IDE</code>  ä¸­æŸ¥çœ‹ï¼Œè¿™é‡Œç»™å‡ºæµç¨‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/27/03f2dc59b76e0b13.jpg\" alt=\"readæ–¹æ³•\" /></p>\n<p><code>readNBytes(int len)</code>  æ–¹æ³•ï¼šä»£ç è¾ƒé•¿ï¼Œä½†æ˜¯éƒ½æ¯”è¾ƒç®€å•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è¯»å– InputStream ä¸­çš„å‰©ä½™å­—èŠ‚çš„æŒ‡å®šä¸Šé™å¤§å°çš„å­—èŠ‚å†…å®¹ï¼›æ­¤æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// ç›´åˆ°è¯»å–äº†è¯·æ±‚çš„å­—èŠ‚æ•°ã€æ£€æµ‹åˆ°æµç»“æŸæˆ–å¼•å‘å¼‚å¸¸ä¸ºæ­¢ã€‚æ­¤æ–¹æ³•ä¸ä¼šå…³é—­è¾“å…¥æµã€‚</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">readNBytes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// è¾¹ç•Œæ£€æŸ¥</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"len &lt; 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> bufs <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç¼“å­˜æ¯æ¬¡è¯»å–åˆ°çš„å†…å®¹æ”¾åˆ° bufsï¼Œæœ€åç»„è£…æˆ result</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æœ€åè¯»å–åˆ°çš„å†…å®¹</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">int</span> total <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">int</span> remaining <span class=\"token operator\">=</span> len<span class=\"token punctuation\">;</span> <span class=\"token comment\">// å‰©ä½™å­—èŠ‚é•¿åº¦</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–ç¼“å­˜æ•°ç»„</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>remaining<span class=\"token punctuation\">,</span> <span class=\"token constant\">DEFAULT_BUFFER_SIZE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">int</span> nread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// è¯»å–åˆ°ç»“æŸä¸ºæ­¢ï¼Œç»“æŸæ¡ä»¶ï¼šè¦ä¹ˆ buf è¢«è¯»æ»¡ï¼Œè¦ä¹ˆ remaining==0</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">=</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> nread<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                         <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> nread<span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            nread <span class=\"token operator\">+=</span> n<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            remaining <span class=\"token operator\">-=</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nread <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_BUFFER_SIZE</span> <span class=\"token operator\">-</span> total <span class=\"token operator\">&lt;</span> nread<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OutOfMemoryError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Required array size too large\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            total <span class=\"token operator\">+=</span> nread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                result <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bufs <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    bufs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    bufs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                bufs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœè¯»ä¸åˆ°å†…å®¹ï¼ˆè¿”å› - 1ï¼‰æˆ–è€…æ²¡æœ‰å‰©ä½™çš„å­—èŠ‚ï¼Œåˆ™è·³å‡ºå¾ªç¯</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> remaining <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bufs <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> total <span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            result <span class=\"token operator\">:</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyOf</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">// ç»„è£…æœ€åçš„ result</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>total<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">int</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    remaining <span class=\"token operator\">=</span> total<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> b <span class=\"token operator\">:</span> bufs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">arraycopy</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        offset <span class=\"token operator\">+=</span> count<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        remaining <span class=\"token operator\">-=</span> count<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œ <code>InputStream</code>  æœ€æ ¸å¿ƒçš„å°±æ˜¯ <code>read()</code>  æ–¹æ³•ï¼Œå­ç±»å¦‚ä½•å®ç°è¯¥æ–¹æ³•å†³å®šäº†å­ç±»çš„ä½œç”¨ã€‚æ‰€ä»¥ç±»ä¼¼å…¶ä»–çš„ <code>int readNBytes(byte[],int,int)</code>  ä¹‹ç±»çš„ï¼Œå…¶å®ç°éƒ½å¾ˆç®€å•ã€‚</p>\n<p>å…³äº <code>read(byte[],int,int)</code>  å’Œ <code>readNBytes(byte[],int,int)</code>  çš„åŒºåˆ«ï¼š</p>\n<ul>\n<li><code>read(byte[], int, int)</code>  æ˜¯å°è¯•è¯»åˆ°æœ€å¤š <code>len</code>  ä¸ª <code>bytes</code> ï¼Œä½†æ˜¯<strong>è¯»å–åˆ°çš„å†…å®¹é•¿åº¦å¯èƒ½æ˜¯å°äº len</strong> çš„ã€‚</li>\n<li><code>readNBytes(byte[], int, int)</code>  ä¼šä¸€ç›´ï¼ˆ <code>while</code>  å¾ªç¯ï¼‰æŸ¥æ‰¾ç›´åˆ° <code>stream</code>  å°¾ä¸ºæ­¢ã€‚</li>\n</ul>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>skip</code>  æ–¹æ³•çš„å®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—èŠ‚ä¸è¯»å–</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">skip</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">long</span> remaining <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> nr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">int</span> size <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_SKIP_BUFFER_SIZE</span><span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> skipBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>remaining <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        nr <span class=\"token operator\">=</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>skipBuffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nr <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        remaining <span class=\"token operator\">-=</span> nr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">return</span> n <span class=\"token operator\">-</span> remaining<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>skip</code>  æ–¹æ³•ä¸æ˜¯è¯´åœ¨æ•°æ®æºä¸­è·³è¿‡ <code>n</code>  ä¸ªå­—èŠ‚ç„¶åå†ä½¿ç”¨ <code>read</code>  è¯»å–ï¼Œè€Œæ˜¯å°†è¿™ <code>n</code>  ä¸ªå­—èŠ‚è¯»åˆ°ä¸€ä¸ªç¼“å­˜æ•°ç»„ä¸­ï¼Œæ–¹æ³•ç»“æŸåè¯¥æ•°ç»„åˆä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯æ–‡ä»¶æŒ‡é’ˆåœ¨æ•°æ®æºä¸­çš„ä½ç½®ç¡®å®ç§»åŠ¨äº† <code>n</code>  ä¸ªå­—èŠ‚ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> size <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_SKIP_BUFFER_SIZE</span><span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç å†³å®šäº†è·³è¿‡å­—èŠ‚æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœ€å¤šæ˜¯ <code>2048</code>  ä¸ªå­—èŠ‚ã€‚</p>\n<p><code>transferTo</code>  æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// JDK9 æ–°å¢ï¼šè¯»å– InputStream ä¸­çš„å…¨éƒ¨å­—èŠ‚å¹¶å†™å…¥åˆ°æŒ‡å®šçš„ OutputStream ä¸­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">transferTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OutputStream</span> out<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">,</span> <span class=\"token string\">\"out\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">long</span> transferred <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token constant\">DEFAULT_BUFFER_SIZE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> read<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>read <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">DEFAULT_BUFFER_SIZE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> read<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        transferred <span class=\"token operator\">+=</span> read<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> transferred<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLWJhc2ljLWNvZGUtaW5wdXRzdHJlYW0uaHRtbA==\">https://pdai.tech/md/java/io/java-io-basic-code-inputstream.html</span></p>\n<p>å¹¶å‘ç¼–ç¨‹ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2lmZXZlLmNvbS9qYXZhLWlvLSVFNCVCOSU4Qi1pbnB1dHN0cmVhbSVFNiVCQSU5MCVFNyVBMCU4MS8=\">http://ifeve.com/java-io-%E4%B9%8B-inputstream%E6%BA%90%E7%A0%81/</span></p>\n<p>stackoverflowï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTM3NTQzODcvamF2YS1yZWFkLXZzLXJlYWRuYnl0ZXMtb2YtdGhlLWlucHV0c3RyZWFtLWluc3RhbmNl\">https://stackoverflow.com/questions/53754387/java-read-vs-readnbytes-of-the-inputstream-instance</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/26/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(1)-%E5%88%86%E7%B1%BB/",
            "url": "https://cecilia.cool/2022/08/26/Java/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/IO(1)-%E5%88%86%E7%B1%BB/",
            "title": "Java IO(1)--åˆ†ç±»",
            "date_published": "2022-08-26T05:42:44.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>ä¸ºäº†åˆ†ç±»æ–¹ä¾¿å’ŒçŸ¥è¯†çš„è¿è´¯æ€§ï¼Œè¿™é‡Œå°±å°† IO çš„éƒ¨åˆ†ï¼ˆå…³äºæ–‡ä»¶æµçš„æ“ä½œï¼‰ä¹Ÿæ”¾åˆ°ç½‘ç»œç¼–ç¨‹çš„ <code>Tags</code>  é‡Œé¢ã€‚çœŸæ­£çš„ç½‘ç»œç¼–ç¨‹å¤§æ¦‚å°±æ˜¯ä» <code>Socket</code>  é‚£ä¸€å—å¼€å§‹è®²è§£ï¼Œæ¥ç€å°±æ˜¯ç¼“å†²åŒºï¼Œé€šé“ä»¥åŠ NIO çš„å„ç§è¯¦è§£ã€‚</p>\n<h1 id=\"ä¼ è¾“æ–¹å¼\"><a class=\"anchor\" href=\"#ä¼ è¾“æ–¹å¼\">#</a> ä¼ è¾“æ–¹å¼</h1>\n<p>åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼š <code>å­—èŠ‚</code> æ˜¯ä¸ªè®¡ç®—æœºçœ‹çš„ï¼Œ <code>å­—ç¬¦</code> æ‰æ˜¯ç»™äººçœ‹çš„ã€‚</p>\n<p>å­—èŠ‚æµä¸»è¦æ˜¯ <code>InputStream</code>  å’Œ <code>OutputStream</code>  æ´¾ç”Ÿå‡ºæ¥çš„ä¸€äº›åˆ—ç±»ã€‚å­—ç¬¦æµä¸»è¦ <code>Reader</code>  å’Œ <code>Writer</code>  æ´¾ç”Ÿå‡ºæ¥çš„ç±»ã€‚</p>\n<h2 id=\"å­—èŠ‚æµå’Œå­—ç¬¦æµåŒºåˆ«\"><a class=\"anchor\" href=\"#å­—èŠ‚æµå’Œå­—ç¬¦æµåŒºåˆ«\">#</a> å­—èŠ‚æµå’Œå­—ç¬¦æµåŒºåˆ«</h2>\n<ul>\n<li>\n<p>å­—èŠ‚æµè¯»å–å•ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æµè¯»å–å•ä¸ªå­—ç¬¦ (ä¸€ä¸ªå­—ç¬¦æ ¹æ®ç¼–ç çš„ä¸åŒï¼Œå¯¹åº”çš„å­—èŠ‚ä¹Ÿä¸åŒï¼Œå¦‚ UTF-8 ç¼–ç ä¸­æ–‡æ±‰å­—æ˜¯ 3 ä¸ªå­—èŠ‚ï¼ŒGBK ç¼–ç ä¸­æ–‡æ±‰å­—æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚)</p>\n</li>\n<li>\n<p>å­—èŠ‚æµç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ (å›¾ç‰‡ã€MP3ã€è§†é¢‘æ–‡ä»¶)ï¼Œå­—ç¬¦æµç”¨æ¥å¤„ç†æ–‡æœ¬æ–‡ä»¶ (å¯ä»¥çœ‹åšæ˜¯ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨äº†æŸç§ç¼–ç ï¼Œäººå¯ä»¥é˜…è¯»)ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¼–ç ä¸è§£ç \"><a class=\"anchor\" href=\"#ç¼–ç ä¸è§£ç \">#</a> ç¼–ç ä¸è§£ç </h2>\n<p>ç¼–ç æ˜¯å°†å­—ç¬¦è½¬ä¸ºå­—èŠ‚ï¼Œè§£ç æ˜¯å°†å­—èŠ‚ç»„åˆæˆå­—ç¬¦ã€‚ç¼–ç å’Œè§£ç è¿‡ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼é‚£ä¹ˆå°±å‡ºç°äº†ä¹±ç ã€‚</p>\n<p>Java ä½¿ç”¨åŒå­—èŠ‚ç¼–ç  UTF-16beï¼Œè¿™ä¸æ˜¯æŒ‡ Java åªæ”¯æŒè¿™ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè€Œæ˜¯è¯´ char è¿™ç§ç±»å‹ä½¿ç”¨ UTF-16be è¿›è¡Œç¼–ç ã€‚char ç±»å‹å  16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼ŒJava ä½¿ç”¨è¿™ç§åŒå­—èŠ‚ç¼–ç æ˜¯ä¸ºäº†è®©ä¸€ä¸ªä¸­æ–‡æˆ–è€…ä¸€ä¸ªè‹±æ–‡éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ª char æ¥å­˜å‚¨ã€‚</p>\n<h1 id=\"æ•°æ®æ“ä½œ\"><a class=\"anchor\" href=\"#æ•°æ®æ“ä½œ\">#</a> æ•°æ®æ“ä½œ</h1>\n<p>åˆ†ç±»å¤§è‡´çœ‹ä¸‹è¡¨</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">ç±»åˆ«</th>\n<th style=\"text-align:center\">å¯¹åº”ç±»</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">æ–‡ä»¶</td>\n<td style=\"text-align:center\">FileInputStream,FileOutputStream,FileReader,FileWriter</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ•°ç»„</td>\n<td style=\"text-align:center\">ByteArrayInputStream,ByteArrayOutputStream,CharArrayReaderã€CharArrayWriter</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ç®¡é“</td>\n<td style=\"text-align:center\">PipedInputStreamã€PipedOutputStreamã€PipedReaderã€PipedWriter</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">åŸºæœ¬æ•°æ®ç±»å‹</td>\n<td style=\"text-align:center\">DataInputStreamã€DataOutputStream</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ç¼“å†²</td>\n<td style=\"text-align:center\">BufferedInputStreamã€BufferedOutputStreamã€BufferedReaderã€BufferedWriter</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ‰“å°</td>\n<td style=\"text-align:center\">PrintStreamã€PrintWriter</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">å¯¹è±¡åºåˆ—åŒ–ååºåˆ—åŒ–</td>\n<td style=\"text-align:center\">ObjectInputStreamã€ObjectOutputStream</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">è½¬æ¢</td>\n<td style=\"text-align:center\">InputStreamReaderã€OutputStreamWriter</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"è®¾è®¡æ¨¡å¼\"><a class=\"anchor\" href=\"#è®¾è®¡æ¨¡å¼\">#</a> è®¾è®¡æ¨¡å¼</h1>\n<p><code>IO</code>  ä½¿ç”¨äº†<a href=\"https://cecilia.cool/2022/08/24/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B-%E8%A3%85%E9%A5%B0/\">è£…é¥°è€…æ¨¡å¼</a>ï¼Œä»¥ <code>InputStream</code>  ä¸ºä¾‹ï¼š</p>\n<ul>\n<li>\n<p><code>InputStream</code>  æ˜¯æŠ½è±¡ç»„ä»¶ã€‚</p>\n</li>\n<li>\n<p><code>FileInputStream</code>  æ˜¯ <code>InputStream</code>  å­ç±»ï¼Œä¸ºå…·ä½“ç»„ä»¶ï¼Œæä¾›å­—èŠ‚æµçš„è¾“å…¥æ“ä½œã€‚</p>\n</li>\n<li>\n<p><code>FilterInputStream</code>  å±äºæŠ½è±¡è£…é¥°è€…ï¼Œæä¾›é¢å¤–åŠŸèƒ½</p>\n</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/26/f54be56eb22c08b8.jpg\" alt=\"IOä½¿ç”¨è£…é¥°è€…æ¨¡å¼\" /></p>\n<p>å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨  <code>FileInputStream</code>  å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚  <code>BufferedInputStream</code>  å¯¹è±¡å³å¯ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">FileInputStream</span> fileInputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileInputStream</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">BufferedInputStream</span> bufferedInputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedInputStream</span><span class=\"token punctuation\">(</span>fileInputStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9pby9qYXZhLWlvLWJhc2ljLWNhdGVnb3J5Lmh0bWw=\">https://pdai.tech/md/java/io/java-io-basic-category.html</span></p>\n</blockquote>\n",
            "tags": [
                "ç½‘ç»œç¼–ç¨‹"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/24/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B-%E8%A3%85%E9%A5%B0/",
            "url": "https://cecilia.cool/2022/08/24/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B-%E8%A3%85%E9%A5%B0/",
            "title": "ç»“æ„å‹--è£…é¥°è€…æ¨¡å¼",
            "date_published": "2022-08-24T13:37:10.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡<strong>æ·»åŠ æ–°çš„åŠŸèƒ½</strong>ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒæ˜¯ä½œä¸ºç°æœ‰çš„ç±»çš„ä¸€ä¸ª<strong>åŒ…è£…</strong>ã€‚</p>\n<p>** è¿™ç§æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªè£…é¥°ç±»ï¼Œç”¨æ¥åŒ…è£…åŸæœ‰çš„ç±»ï¼Œå¹¶åœ¨ä¿æŒç±»æ–¹æ³•ç­¾åå®Œæ•´æ€§çš„å‰æä¸‹ï¼Œæä¾›äº†é¢å¤–çš„åŠŸèƒ½ã€‚** ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¸ºäº†æ‰©å±•ä¸€ä¸ªç±»ç»å¸¸ä½¿ç”¨ç»§æ‰¿æ–¹å¼å®ç°ï¼Œç”±äºç»§æ‰¿ä¸ºç±»å¼•å…¥é™æ€ç‰¹å¾ï¼Œå¹¶ä¸”éšç€æ‰©å±•åŠŸèƒ½çš„å¢å¤šï¼Œå­ç±»ä¼šå¾ˆè†¨èƒ€ã€‚</p>\n<p>è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚</p>\n<h1 id=\"ç›¸å…³ç»“æ„\"><a class=\"anchor\" href=\"#ç›¸å…³ç»“æ„\">#</a> ç›¸å…³ç»“æ„</h1>\n<p>åœ¨è£…é¥°è€…æ¨¡å¼ä¸­ï¼Œä¸ºäº†è®©ç³»ç»Ÿå…·æœ‰æ›´å¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡è£…é¥°ç±»ï¼Œè€Œå°†å…·ä½“çš„è£…é¥°ç±»ä½œä¸ºå®ƒçš„å­ç±»ã€‚</p>\n<h2 id=\"component\"><a class=\"anchor\" href=\"#component\">#</a> Component</h2>\n<p>æŠ½è±¡æ„ä»¶ï¼šå®ƒæ˜¯å…·ä½“æ„ä»¶å’ŒæŠ½è±¡è£…é¥°ç±»çš„å…±åŒçˆ¶ç±»ï¼Œå£°æ˜äº†åœ¨å…·ä½“æ„ä»¶ä¸­å®ç°çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå®ƒçš„å¼•å…¥å¯ä»¥ä½¿å®¢æˆ·ç«¯ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†<strong>æœªè¢«è£…é¥°çš„å¯¹è±¡</strong>ä»¥åŠ<strong>è£…é¥°ä¹‹åçš„å¯¹è±¡</strong>ï¼Œå®ç°å®¢æˆ·ç«¯çš„é€æ˜æ“ä½œã€‚</p>\n<h2 id=\"concretecomponent\"><a class=\"anchor\" href=\"#concretecomponent\">#</a> ConcreteComponent</h2>\n<p>å…·ä½“æ„ä»¶ï¼ˆå°±æ˜¯è¦è¢«è£…é¥°çš„ç±»ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡æ„ä»¶ç±»çš„å­ç±»ï¼Œç”¨äºå®šä¹‰å…·ä½“çš„æ„ä»¶å¯¹è±¡ï¼Œå®ç°äº†åœ¨æŠ½è±¡æ„ä»¶ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œ<strong>è£…é¥°å™¨å¯ä»¥ç»™å®ƒå¢åŠ é¢å¤–çš„èŒè´£ï¼ˆæ–¹æ³•ï¼‰</strong>ã€‚</p>\n<h2 id=\"decorator\"><a class=\"anchor\" href=\"#decorator\">#</a> Decorator</h2>\n<p>æŠ½è±¡è£…é¥°ç±»ï¼šå®ƒä¹Ÿæ˜¯æŠ½è±¡æ„ä»¶ç±»çš„å­ç±»ï¼Œç”¨äºç»™å…·ä½“æ„ä»¶å¢åŠ èŒè´£ï¼Œä½†æ˜¯å…·ä½“èŒè´£åœ¨å…¶å­ç±»ä¸­å®ç°ã€‚å®ƒ<strong>ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘æŠ½è±¡æ„ä»¶å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡è¯¥å¼•ç”¨å¯ä»¥è°ƒç”¨è£…é¥°ä¹‹å‰æ„ä»¶å¯¹è±¡çš„æ–¹æ³•</strong>ï¼Œå¹¶é€šè¿‡å…¶å­ç±»æ‰©å±•è¯¥æ–¹æ³•ï¼Œä»¥è¾¾åˆ°è£…é¥°çš„ç›®çš„ã€‚</p>\n<h2 id=\"concretedecorator\"><a class=\"anchor\" href=\"#concretedecorator\">#</a> ConcreteDecorator</h2>\n<p>å…·ä½“è£…é¥°ç±»ï¼šå®ƒæ˜¯æŠ½è±¡è£…é¥°ç±»çš„å­ç±»ï¼Œè´Ÿè´£å‘æ„ä»¶æ·»åŠ æ–°çš„èŒè´£ã€‚æ¯ä¸€ä¸ªå…·ä½“è£…é¥°ç±»éƒ½å®šä¹‰äº†ä¸€äº›æ–°çš„è¡Œä¸ºï¼Œå®ƒå¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡è£…é¥°ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶å¯ä»¥å¢åŠ æ–°çš„æ–¹æ³•ç”¨ä»¥æ‰©å……å¯¹è±¡çš„è¡Œä¸ºã€‚</p>\n<h1 id=\"ä¾‹å­\"><a class=\"anchor\" href=\"#ä¾‹å­\">#</a> ä¾‹å­</h1>\n<p>ä¸ºäº†èƒ½å¤Ÿæ›´æ–¹ä¾¿ç†è§£ä¾‹å­ï¼Œè¿™é‡Œå…ˆç»™ä¸€ä¸‹ <code>UML</code>  ç±»å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/26/12afa26882288dae.jpg\" alt=\"UMLç±»å›¾\" /></p>\n<p>è®¾è®¡ä¸åŒç§ç±»çš„é¥®æ–™ï¼Œé¥®æ–™å¯ä»¥æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ç‰›å¥¶ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ æ–°é…æ–™ã€‚æ¯å¢åŠ ä¸€ç§é…æ–™ï¼Œè¯¥é¥®æ–™çš„ä»·æ ¼å°±ä¼šå¢åŠ ï¼Œè¦æ±‚è®¡ç®—ä¸€ç§é¥®æ–™çš„ä»·æ ¼ã€‚</p>\n<p>åœ¨ DarkRoast é¥®æ–™ä¸Šæ–°å¢æ–°æ·»åŠ  Mocha é…æ–™ï¼Œä¹‹ååˆæ·»åŠ äº† Whip é…æ–™ã€‚DarkRoast è¢« Mocha åŒ…è£¹ï¼ŒMocha åˆè¢« Whip åŒ…è£¹ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ªç›¸åŒçˆ¶ç±»ï¼Œéƒ½æœ‰ cost () æ–¹æ³•ï¼Œå¤–å±‚ç±»çš„ cost () æ–¹æ³•è°ƒç”¨äº†å†…å±‚ç±»çš„ cost () æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Component è®¾è®¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> interfacce <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// ConcreteComponent</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DarkRoast</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// Decorator</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CondimentDecorator</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Beverage</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Beverage</span> beverage<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢å·²ç»æåˆ°ï¼Œ <code>Decorator</code>  æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“çš„è£…é¥°ç”±å­ç±»å®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ConcreteDecorator-A</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Milk</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CondimentDecorator</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Milk</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Beverage</span> beverage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>beverage <span class=\"token operator\">=</span> beverage<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> beverage<span class=\"token punctuation\">.</span><span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// ConcreteDecorator-B</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Mocha</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CondimentDecorator</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Mocha</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Beverage</span> beverage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>beverage <span class=\"token operator\">=</span> beverage<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> beverage<span class=\"token punctuation\">.</span><span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿è¡Œ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Beverage</span> beverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HouseBlend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        beverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mocha</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        beverage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Milk</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>beverage<span class=\"token punctuation\">.</span><span class=\"token function\">cost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kZXNpZ24tcGF0dGVybi9kZWNvcmF0b3ItcGF0dGVybi5odG1s\">https://www.runoob.com/design-pattern/decorator-pattern.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2LXNwZWMvcGF0dGVybi8xMl9kZWNvcmF0b3IuaHRtbA==\">https://pdai.tech/md/dev-spec/pattern/12_decorator.html</span></p>\n<p>ç¨€åœŸæ˜é‡‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNjgxMzIyNjQ3NTY2\">https://juejin.cn/post/6844903681322647566</span></p>\n</blockquote>\n",
            "tags": [
                "è®¾è®¡æ¨¡å¼"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/24/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B-%E9%80%82%E9%85%8D%E5%99%A8/",
            "url": "https://cecilia.cool/2022/08/24/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B-%E9%80%82%E9%85%8D%E5%99%A8/",
            "title": "ç»“æ„å‹--é€‚é…å™¨æ¨¡å¼",
            "date_published": "2022-08-24T13:37:10.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¸¾ä¸ªçœŸå®çš„ä¾‹å­ï¼Œè¯»å¡å™¨æ˜¯ä½œä¸ºå†…å­˜å¡å’Œç¬”è®°æœ¬ä¹‹é—´çš„é€‚é…å™¨ã€‚æ‚¨å°†å†…å­˜å¡æ’å…¥è¯»å¡å™¨ï¼Œå†å°†è¯»å¡å™¨æ’å…¥ç¬”è®°æœ¬ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ç¬”è®°æœ¬æ¥è¯»å–å†…å­˜å¡ã€‚</p>\n<p>é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆç”¨æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œå®ƒä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/30/363342117a084bd9.jpg\" alt=\"ç¤ºä¾‹\" /></p>\n<h1 id=\"å®ç°\"><a class=\"anchor\" href=\"#å®ç°\">#</a> å®ç°</h1>\n<p>é¸­å­ (Duck) å’Œç«é¸¡ (Turkey) æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack () æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble () æ–¹æ³•ã€‚</p>\n<p>è¦æ±‚å°† Turkey çš„  <code>gobble()</code>  æ–¹æ³•é€‚é…æˆ Duck çš„  <code>quack() </code> æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­ï¼</p>\n<p>æ¥å£ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Duck</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">quack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Turkey</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">gobble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®ç°ç±»ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WildTurkey</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Turkey</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">gobble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gobble!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// ç«é¸¡ -> é¸­å­</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TurkeyAdapter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Duck</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">Turkey</span> turkey<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TurkeyAdapter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Turkey</span> turkey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>turkey <span class=\"token operator\">=</span> turkey<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">quack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        turkey<span class=\"token punctuation\">.</span><span class=\"token function\">gobble</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿è¡Œï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Turkey</span> turkey <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WildTurkey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Duck</span> duck <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TurkeyAdapter</span><span class=\"token punctuation\">(</span>turkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        duck<span class=\"token punctuation\">.</span><span class=\"token function\">quack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å…¶ä»–ç¤ºä¾‹ï¼š</p>\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ª <em> <code>MediaPlayer</code> </em> æ¥å£å’Œä¸€ä¸ªå®ç°äº† <em> <code>MediaPlayer</code> </em> æ¥å£çš„å®ä½“ç±» <em> <code>AudioPlayer</code> </em>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<em> <code>AudioPlayer</code> </em> å¯ä»¥æ’­æ”¾ mp3 æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ã€‚</p>\n<p>æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªæ¥å£ <em> <code>AdvancedMediaPlayer</code> </em> å’Œå®ç°äº† <em> <code>AdvancedMediaPlayer</code> </em> æ¥å£çš„å®ä½“ç±»ã€‚è¯¥ç±»å¯ä»¥æ’­æ”¾ vlc å’Œ mp4 æ ¼å¼çš„æ–‡ä»¶ã€‚</p>\n<p>æˆ‘ä»¬æƒ³è¦è®© <em> <code>AudioPlayer</code> </em> æ’­æ”¾å…¶ä»–æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ï¼ˆåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå…¶å®å°±æ˜¯ç«é¸¡å†’å……é¸­å­ï¼‰ã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œ<strong>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°äº† <em> <code>MediaPlayer</code> </em> æ¥å£çš„é€‚é…å™¨ç±» <em> <code>MediaAdapter</code> </em>ï¼Œå¹¶ä½¿ç”¨ <em> <code>AdvancedMediaPlayer</code> </em> å¯¹è±¡æ¥æ’­æ”¾æ‰€éœ€çš„æ ¼å¼ã€‚</strong></p>\n<p>ä½“ç°åœ¨ <code>UML</code>  ä¸­å³ä¸º</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/30/3f8436392da4a3ad.jpg\" alt=\"UML\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kZXNpZ24tcGF0dGVybi9hZGFwdGVyLXBhdHRlcm4uaHRtbA==\">https://www.runoob.com/design-pattern/adapter-pattern.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2LXNwZWMvcGF0dGVybi85X2FkYXB0ZXIuaHRtbA==\">https://pdai.tech/md/dev-spec/pattern/9_adapter.html</span></p>\n</blockquote>\n",
            "tags": [
                "è®¾è®¡æ¨¡å¼"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/24/Java/%E5%B9%B6%E5%8F%91/Java%E7%BA%BF%E7%A8%8B%E6%B1%A02-FutureTask/",
            "url": "https://cecilia.cool/2022/08/24/Java/%E5%B9%B6%E5%8F%91/Java%E7%BA%BF%E7%A8%8B%E6%B1%A02-FutureTask/",
            "title": "Javaçº¿ç¨‹æ± (2)--FutureTask",
            "date_published": "2022-08-24T06:02:39.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>FutureTask</code>  ä¸º  <code>Future</code>  æä¾›äº†<strong>åŸºç¡€</strong>å®ç°ï¼ˆè¨€å¤–ä¹‹æ„å°±æ˜¯ä¹Ÿæä¾›äº†ä¸€äº›åŠŸèƒ½æ€§å‡½æ•°ä¾›æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰  <code>task</code>  ç±»ä½¿ç”¨ï¼‰ï¼Œå¦‚è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ ( <code>get</code> ) å’Œå–æ¶ˆä»»åŠ¡ ( <code>cancel</code> ) ç­‰ã€‚å¦‚æœä»»åŠ¡å°šæœªå®Œæˆï¼Œè·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶å°†ä¼šé˜»å¡ã€‚ä¸€æ—¦æ‰§è¡Œç»“æŸï¼Œä»»åŠ¡å°±ä¸èƒ½è¢«é‡å¯æˆ–å–æ¶ˆ (é™¤éä½¿ç”¨ <code>runAndReset</code>  æ‰§è¡Œè®¡ç®—)ã€‚ <code>FutureTask</code>  å¸¸ç”¨æ¥å°è£…  <code>Callable</code>  å’Œ  <code>Runnable</code> ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚ <code>FutureTask</code>  çš„çº¿ç¨‹å®‰å…¨ç”± <code>CAS</code>  æ¥ä¿è¯ã€‚</p>\n<h1 id=\"ä¸¤ç§å¼‚æ­¥æ¨¡å‹\"><a class=\"anchor\" href=\"#ä¸¤ç§å¼‚æ­¥æ¨¡å‹\">#</a> ä¸¤ç§å¼‚æ­¥æ¨¡å‹</h1>\n<p>åœ¨ <code>Java</code>  çš„å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¤§ä½“ä¸Šä¼šåˆ†ä¸ºä¸¤ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œä¸€ç±»æ˜¯ä»¥å¼‚æ­¥çš„å½¢å¼æ¥å¹¶è¡Œè¿è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œ<strong>ä¸éœ€è¦</strong>è¿”å›ä»»åŠ¡çš„ç»“æœæ•°æ®ã€‚ä¸€ç±»æ˜¯ä»¥å¼‚æ­¥çš„å½¢å¼è¿è¡Œå…¶ä»–ä»»åŠ¡ï¼Œ<strong>éœ€è¦</strong>è¿”å›ç»“æœã€‚</p>\n<h2 id=\"æ— è¿”å›ç»“æœå¼‚æ­¥æ¨¡å‹\"><a class=\"anchor\" href=\"#æ— è¿”å›ç»“æœå¼‚æ­¥æ¨¡å‹\">#</a> æ— è¿”å›ç»“æœå¼‚æ­¥æ¨¡å‹</h2>\n<p>æ— è¿”å›ç»“æœçš„å¼‚æ­¥ä»»åŠ¡å¯ä»¥ç›´æ¥ä¸¢è¿›çº¿ç¨‹æˆ–çº¿ç¨‹æ± ä¸­è¿è¡Œã€‚æƒ³è¦è·å–è¿è¡Œç»“æœçš„è¯ï¼Œå¯ä»¥è°ƒç”¨å›è°ƒæ–¹æ³•ã€‚å…·ä½“å®ç°æ˜¯å®šä¹‰ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œå¹¶åœ¨æ¥å£ä¸­å®šä¹‰æ¥æ”¶ä»»åŠ¡ç»“æœæ•°æ®çš„æ–¹æ³•ã€‚ä»»åŠ¡è¿è¡Œåè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œæ‰§è¡Œå›è°ƒæ¥å£å®ç°ç±»ä¸­çš„é€»è¾‘å¤„ç†ç»“æœæ•°æ®</p>\n<ul>\n<li>å®šä¹‰å›è°ƒæ¥å£</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å®šä¹‰ä»»åŠ¡ç»“æœæ•°æ®çš„å°è£…ç±»</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TaskCallable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">T</span> <span class=\"token function\">callable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>å®šä¹‰ä»»åŠ¡ç»“æœæ•°æ®çš„å°è£…ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskResult</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// ä»»åŠ¡çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> taskStatus<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// ä»»åŠ¡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> taskMessage<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// ä»»åŠ¡ç»“æœæ•°æ®</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> taskResult<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"TaskResult&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token string\">\"taskStatus=\"</span> <span class=\"token operator\">+</span> taskStatus <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token string\">\", taskMessage='\"</span> <span class=\"token operator\">+</span> taskMessage <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token string\">\", taskResult='\"</span> <span class=\"token operator\">+</span> taskResult <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>åˆ›å»ºå›è°ƒæ¥å£çš„å®ç°ç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TaskCallable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TaskResult</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TaskResult</span> <span class=\"token function\">callable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TaskResult</span> taskResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    \t<span class=\"token comment\">//TODO æ‹¿åˆ°ç»“æœæ•°æ®åè¿›ä¸€æ­¥å¤„ç†</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>taskResult<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t<span class=\"token keyword\">return</span> taskResult<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>åˆ›å»ºä»»åŠ¡çš„æ‰§è¡Œç±»</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskExecutor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TaskCallable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TaskResult</span><span class=\"token punctuation\">></span></span> taskCallable<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> taskParameter<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TaskExecutor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TaskCallable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TaskResult</span><span class=\"token punctuation\">></span></span> taskCallable<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> taskParameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>taskCallable <span class=\"token operator\">=</span> taskCallable<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    \t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>taskParameter <span class=\"token operator\">=</span> taskParameter<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//TODO ä¸€ç³»åˆ—ä¸šåŠ¡é€»è¾‘ï¼Œå°†ç»“æœæ•°æ®å°è£…æˆ TaskResult å¯¹è±¡å¹¶è¿”å›</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">TaskResult</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TaskResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        result<span class=\"token punctuation\">.</span><span class=\"token function\">setTaskStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        result<span class=\"token punctuation\">.</span><span class=\"token function\">setTaskMessage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>taskParameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        result<span class=\"token punctuation\">.</span><span class=\"token function\">setTaskResult</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¼‚æ­¥å›è°ƒæˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        taskCallable<span class=\"token punctuation\">.</span><span class=\"token function\">callable</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>è¿è¡Œä¸€ä¸‹</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskCallableTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">TaskCallable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TaskResult</span><span class=\"token punctuation\">></span></span> taskCallable <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TaskHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">TaskExecutor</span> taskExecutor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TaskExecutor</span><span class=\"token punctuation\">(</span>taskCallable<span class=\"token punctuation\">,</span> <span class=\"token string\">\"æµ‹è¯•å›è°ƒä»»åŠ¡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>taskExecutor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// ç»“æœï¼šTaskResult &#123;taskStatus=1, taskMessage=' æµ‹è¯•å›è°ƒä»»åŠ¡ ', taskResult=' å¼‚æ­¥å›è°ƒæˆåŠŸ '&#125;</span></pre></td></tr></table></figure><h2 id=\"æœ‰è¿”å›ç»“æœæ¨¡å‹\"><a class=\"anchor\" href=\"#æœ‰è¿”å›ç»“æœæ¨¡å‹\">#</a> æœ‰è¿”å›ç»“æœæ¨¡å‹</h2>\n<p>æˆ‘ä»¬è‡ªå·±å®šä¹‰æ¥å£å¹¶å®ç°å›è°ƒæ–¹æ³•æ¯”è¾ƒéº»çƒ¦ï¼ŒJDK æä¾›äº†å¯ä»¥ç›´æ¥è¿”å›å¼‚æ­¥ç»“æœçš„å¤„ç†æ–¹æ¡ˆã€‚</p>\n<ul>\n<li>ä½¿ç”¨ <code>Future</code>  æ¥å£è·å–å¼‚æ­¥ç»“æœï¼Œå¸¸ä¸çº¿ç¨‹æ± ä¸€èµ·ä½¿ç”¨ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newSingleThreadExecutor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//submit æäº¤ä»»åŠ¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> future <span class=\"token operator\">=</span> executorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        \t<span class=\"token keyword\">return</span> <span class=\"token string\">\"æµ‹è¯•Futureè·å–å¼‚æ­¥ç»“æœ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>future<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    executorService<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// çº¿ç¨‹æ± å…³é—­</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>ä½¿ç”¨ <code>FutureTask</code>  è·å–å¼‚æ­¥ç»“æœï¼Œ <code>FutureTask</code>  ç±»æ—¢å¯ä»¥ç»“åˆ <code>Thread</code>  ç±»ä½¿ç”¨ä¹Ÿå¯ä»¥ç»“åˆçº¿ç¨‹æ± ä½¿ç”¨ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é…åˆ Thread ä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">FutureTask</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> futureTask <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FutureTask</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token string\">\"æµ‹è¯•FutureTaskè·å–å¼‚æ­¥ç»“æœ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>futureTask<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>futureTask<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// é…åˆçº¿ç¨‹æ± ä½¿ç”¨ï¼Œå’Œ Future æ²¡ä»€ä¹ˆåŒºåˆ«</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">p</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newSingleThreadExecutor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token class-name\">FutureTask</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> futureTask <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FutureTask</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>       \t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"æµ‹è¯•FutureTaskè·å–å¼‚æ­¥ç»“æœ\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    executorService<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>futureTask<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>futureTask<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    executorService<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ç›¸å…³ç±»è§£æ\"><a class=\"anchor\" href=\"#ç›¸å…³ç±»è§£æ\">#</a> ç›¸å…³ç±»è§£æ</h1>\n<h2 id=\"callableæ¥å£\"><a class=\"anchor\" href=\"#callableæ¥å£\">#</a> Callable æ¥å£</h2>\n<p>æ³›å‹æ¥å£ï¼Œå¯¹æ¯” <code>Runnable</code>  ä¸ä¼šè¿”å›æ•°æ®ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@FunctionalInterface</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">V</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// å‡½æ•°å¼æ¥å£</span></pre></td></tr></table></figure><p>å¤ä¹ ä¸€ä¸‹ï¼Œåœ¨ <code>JDK 1.8</code>  ä¸­åªå£°æ˜æœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£ä¸ºå‡½æ•°å¼æ¥å£ï¼Œå‡½æ•°å¼æ¥å£å¯ä»¥ä½¿ç”¨ <code>@FunctionalInterface</code>  æ³¨è§£ä¿®é¥°ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ <code> @FunctionalInterface</code>  æ³¨è§£ä¿®é¥°ã€‚åªè¦ä¸€ä¸ªæ¥å£ä¸­åªåŒ…å«æœ‰ä¸€ä¸ªæ–¹æ³•ï¼ˆå¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ¥å£å°±æ˜¯å‡½æ•°å¼æ¥å£ã€‚</p>\n<h2 id=\"futureæ¥å£\"><a class=\"anchor\" href=\"#futureæ¥å£\">#</a> Future æ¥å£</h2>\n<p>æ³›å‹æ¥å£ï¼Œä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œåœ¨ä¸¤ç§å¼‚æ­¥æ¨¡å‹ä¸­å¯ä»¥çœ‹å‡º <code>Future</code>  çš„ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// å–æ¶ˆå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> mayInterruptIfRunning<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCancelled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¦‚æœä»»åŠ¡è¢«å–æ¶ˆæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿæ˜¯ true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isDone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">V</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ExecutionException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// å¸¦è¶…æ—¶æ—¶é—´çš„ get () ç‰ˆæœ¬ï¼Œå¦‚æœé˜»å¡ç­‰å¾…è¿‡ç¨‹ä¸­è¶…æ—¶åˆ™ä¼šæŠ›å‡º TimeoutException å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token class-name\">V</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span> unit<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ExecutionException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeoutException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>cancel</code>  å‡½æ•°ï¼šå¦‚æœå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆæˆ–è€…å·²ç»è¢«å–æ¶ˆï¼Œæˆ–è€…ç”±äºæŸäº›åŸå› ä¸èƒ½å–æ¶ˆï¼Œåˆ™ä¼šè¿”å› <code>false</code> ã€‚å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œåˆ™ä¼šè¿”å› trãƒ»ue å¹¶ä¸”å¼‚æ­¥ä»»åŠ¡ä¸ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œäº†ä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œè‹¥ <code>mayInterruptIfRunning</code> ï¼ˆå½“å‰ä¼ é€’çš„ <code>boolean</code>  ç±»å‹å‚æ•°ï¼‰ä¸º <code>true</code> ï¼Œåˆ™ä¼šç«‹å³ä¸­æ–­æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹å¹¶è¿”å› <code>true</code> ï¼Œè‹¥ <code>mayInterruptIfRunning</code>  ä¸º <code>false</code> ï¼Œåˆ™ä¼šè¿”å› <code>true</code>  ä¸”ä¸ä¼šä¸­æ–­ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ã€‚</li>\n</ul>\n<h2 id=\"runnablefutureæ¥å£\"><a class=\"anchor\" href=\"#runnablefutureæ¥å£\">#</a> RunnableFuture æ¥å£</h2>\n<p><code>RunnableFuture</code>  ç»§æ‰¿äº† <code>Runnable</code>  æ¥å£å’Œ <code>Future</code>  æ¥å£ï¼Œè€Œ <code>FutureTask</code>  å®ç°äº† <code>RunnableFuture</code>  æ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸º <code>Runnable</code>  è¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸º <code>Future</code>  å¾—åˆ° <code>Callable</code>  çš„è¿”å›å€¼ã€‚ <code>RunnableFuture</code>  æ¥å£æƒ³è¦å…¶å®ç°ç±»å®ç°çš„åŠŸèƒ½å°±æ˜¯ç›¸å½“äºä¸€ä¸ªæ‹¥æœ‰ <code>run</code>  æ–¹æ³•çš„ <code>future</code>  æ¥å£ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">RunnableFuture</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Future</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"futuretaskè§£æ\"><a class=\"anchor\" href=\"#futuretaskè§£æ\">#</a> FutureTask è§£æ</h1>\n<h2 id=\"å…³é”®å±æ€§\"><a class=\"anchor\" href=\"#å…³é”®å±æ€§\">#</a> å…³é”®å±æ€§</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å†…éƒ¨æŒæœ‰çš„ callable ä»»åŠ¡ï¼Œè¿è¡Œå®Œæ¯•åç½®ç©º</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> callable<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// ä» get () ä¸­è¿”å›çš„ç»“æœæˆ–æŠ›å‡ºçš„å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Object</span> outcome<span class=\"token punctuation\">;</span> <span class=\"token comment\">// non-volatile, protected by state reads/writes</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¿è¡Œ callable çš„çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Thread</span> runner<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ Treiber æ ˆä¿å­˜ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">WaitNode</span> waiters<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>FutureTask</code>  è¿˜æœ‰å‡ ä¸ªå±æ€§è¡¨ç¤ºçŠ¶æ€</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä»»åŠ¡çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">NEW</span>          <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">COMPLETING</span>   <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">NORMAL</span>       <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">EXCEPTIONAL</span>  <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CANCELLED</span>    <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">INTERRUPTING</span> <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">INTERRUPTED</span>  <span class=\"token operator\">=</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>FutureTask</code>  çš„çŠ¶æ€æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™é‡Œè¯¦ç»†è®²ä¸€ä¸‹ï¼š</p>\n<ul>\n<li>\n<p><code>state</code>  æ˜¯ <code>volatile</code>  ä¿®é¥°ï¼Œç¡®ä¿äº†å…¶ä»–çº¿ç¨‹å¯¹å…¶ä¿®æ”¹çš„å¯è§æ€§ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœä»»åŠ¡çŠ¶æ€ä¸æ˜¯ <code>NEW</code> ï¼Œå°±è¯´æ˜ä»»åŠ¡å·²ç»å®Œæˆäº†ã€‚ä»»åŠ¡å¦‚æœå¤„äºå–æ¶ˆæˆ–è€…ä¸­æ–­ï¼Œä¹Ÿè¢«è®¤å®šä¸ºå®Œæˆäº†ã€‚</p>\n</li>\n<li>\n<p><code>COMPLETING</code>  å’Œ <code>INTERRUPTING</code>  æ˜¯ä¸­é—´æ€ï¼Œåªä¼š<strong>å­˜åœ¨çŸ­æš‚æ—¶é—´</strong>ã€‚</p>\n</li>\n</ul>\n<p>ä»»åŠ¡çš„<strong>åˆå§‹çŠ¶æ€</strong>éƒ½æ˜¯ <code>NEW</code> ï¼Œç”±æ„é€ å‡½æ•°ä¿è¯ã€‚</p>\n<p>ä»»åŠ¡çš„<strong>ç»ˆæ­¢çŠ¶æ€</strong>æœ‰ 4 ç§ï¼š</p>\n<ul>\n<li><code>NORMAL</code> ï¼šä»»åŠ¡æ­£å¸¸æ‰§è¡Œå®Œæ¯•</li>\n<li><code>EXCEPTIONAL</code> ï¼šä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ç§å‘ç”Ÿå¼‚å¸¸</li>\n<li><code>CANCELLED</code> ï¼šä»»åŠ¡è¢«å–æ¶ˆ</li>\n<li><code>INTERRUPTED</code> ï¼šä»»åŠ¡è¢«ä¸­æ–­</li>\n</ul>\n<p>ä»»åŠ¡çš„<strong>ä¸­é—´çŠ¶æ€</strong>æœ‰ 2 ç§ï¼š</p>\n<ul>\n<li><code>COMPLETING</code> ï¼šæ­£åœ¨è®¾ç½®ä»»åŠ¡ç»“æœ</li>\n<li><code>INTERRUPTING</code> ï¼šæ­£åœ¨ä¸­æ–­è¿è¡Œä»»åŠ¡çš„çº¿ç¨‹</li>\n</ul>\n<p>å°½ç®¡çŠ¶æ€æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è½¬æ¢è·¯å¾„æ˜¯å›ºå®šçš„ã€‚ä»»åŠ¡çš„ä¸­é—´çŠ¶æ€æ˜¯ä¸€ä¸ªç¬æ€ï¼Œå®ƒéå¸¸çš„çŸ­æš‚ã€‚è€Œä¸”<strong>ä»»åŠ¡çš„ä¸­é—´æ€å¹¶ä¸ä»£è¡¨ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œè€Œæ˜¯ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œäº†ï¼Œæ­£åœ¨è®¾ç½®æœ€ç»ˆçš„è¿”å›ç»“æœ</strong>ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/25/7faf75cf765b58ca.jpg\" alt=\"çŠ¶æ€è½¬æ¢\" /></p>\n<h2 id=\"å†…éƒ¨é˜Ÿåˆ—\"><a class=\"anchor\" href=\"#å†…éƒ¨é˜Ÿåˆ—\">#</a> å†…éƒ¨é˜Ÿåˆ—</h2>\n<p><code>FutureTask</code>  ä¸­æœ‰ä¸€ä¸ªå±æ€§æ˜¯ <code>private volatile WaitNode waiters</code> ã€‚è¿™ä¸ªç±»æ˜¯ <code>FutureTask</code>  çš„é™æ€å†…éƒ¨ç±»ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WaitNode</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Thread</span> thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">WaitNode</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">WaitNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> thread <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é˜Ÿåˆ—çš„å®ç°æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œå®ƒè¡¨ç¤º<strong>æ‰€æœ‰ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•çš„çº¿ç¨‹çš„é›†åˆ</strong>ã€‚è¿™ä¸ªé˜Ÿåˆ—å­˜æ”¾çš„ä¸æ˜¯æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œè€Œæ˜¯è·å–ç»“æœçš„çº¿ç¨‹ã€‚æˆ‘ä»¬å‡è®¾æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ˜¯çº¿ç¨‹ <code>t</code> ï¼Œè·å–ä»»åŠ¡ç»“æœçš„çº¿ç¨‹ <code>s</code> ã€‚å¦‚æœ <code>s</code>  åœ¨ä»»åŠ¡å®Œæˆå‰å°±è°ƒç”¨ <code>get</code>  æ–¹æ³•è·å–ç»“æœï¼Œå°±ä¼šåœ¨ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‚èµ·ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è¢«å”¤é†’ã€‚å¦‚æœä½ æƒ³çŸ¥é“æœ¬è´¨ï¼Œå¯ä»¥å‘ä¸‹ç¿»ï¼Œçœ‹çœ‹ <code>get</code>  æ–¹æ³•çš„æºç ï¼Œè¯¥æ–¹æ³•ä¼šæ£€æµ‹ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">&lt;=</span> <span class=\"token constant\">COMPLETING</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    s <span class=\"token operator\">=</span> <span class=\"token function\">awaitDone</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>awaitDone</code>  å‡½æ•°ä¼šåœ¨ä¹‹åè¯¦ç»†è®²åˆ°ã€‚</p>\n<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ <code>FutureTask</code>  ä¸­çš„è¿™ä¸ªå•å‘é“¾è¡¨æ˜¯å½“åš<strong>æ ˆ</strong>æ¥ä½¿ç”¨çš„ï¼Œç¡®åˆ‡æ¥è¯´æ˜¯å½“åš <code>Treiber</code>  æ ˆæ¥ä½¿ç”¨çš„ï¼Œä¸äº†è§£ <code>Treiber</code>  æ ˆæ˜¯ä¸ªå•¥çš„å¯ä»¥ç®€å•çš„æŠŠå®ƒå½“åšæ˜¯ä¸€ä¸ª<strong>çº¿ç¨‹å®‰å…¨</strong>çš„æ ˆï¼Œå®ƒä½¿ç”¨ <code>CAS</code>  æ¥å®Œæˆå…¥æ ˆå‡ºæ ˆæ“ä½œ (æƒ³è¿›ä¸€æ­¥äº†è§£çš„è¯å¯ä»¥çœ‹<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxMjQ2MzMzMA==\">è¿™ç¯‡æ–‡ç« </span>)ã€‚ä¸ºå•¥è¦ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ ˆå‘¢ï¼Œ<strong>å› ä¸ºåŒä¸€æ—¶åˆ»å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹éƒ½åœ¨è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœ</strong>ï¼Œå¦‚æœä»»åŠ¡è¿˜åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåˆ™è¿™äº›çº¿ç¨‹å°±è¦è¢«åŒ…è£…æˆ <code>WaitNode</code>  æ‰”åˆ° <code>Treiber</code>  æ ˆçš„æ ˆé¡¶ï¼Œå³å®Œæˆå…¥æ ˆæ“ä½œï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶å…¥æ ˆçš„æƒ…å†µï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ CAS æ“ä½œä¿è¯å…¥æ ˆçš„çº¿ç¨‹å®‰å…¨ï¼Œå¯¹äºå‡ºæ ˆçš„æƒ…å†µä¹Ÿæ˜¯åŒç†ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/25/e03943daf8f237ea.jpg\" alt=\"é˜Ÿåˆ—\" /></p>\n<h2 id=\"æ„é€ å‡½æ•°\"><a class=\"anchor\" href=\"#æ„é€ å‡½æ•°\">#</a> æ„é€ å‡½æ•°</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">FutureTask</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> callable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callable <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>callable <span class=\"token operator\">=</span> callable<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">NEW</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// ensure visibility of callable</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">FutureTask</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> runnable<span class=\"token punctuation\">,</span> <span class=\"token class-name\">V</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>callable <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">callable</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">NEW</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// ensure visibility of callable</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€ç»ˆæ‰€åšçš„äº‹æƒ…å…¶å®å°±æ˜¯ä¸¤ä¸ªï¼šåˆå§‹åŒ– <code>callable</code>  å’ŒçŠ¶æ€ <code>state</code> ï¼Œå¦‚æœä¸éœ€è¦è¿”å›å€¼ <code>result</code>  å¯ä»¥ä¼  <code>null</code> ã€‚æˆ‘ä»¬é¡ºä¾¿çœ‹ä¸€ä¸‹ <code>Executors.callable()</code>  æ–¹æ³•ï¼Œ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æŠŠ Runnable è½¬æ¢æˆ Callable</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">callable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> task<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>task <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>       <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RunnableAdapter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨çš„æ˜¯é€‚é…å™¨æ¨¡å¼ï¼Œè°ƒç”¨ <code>RunnableAdapter&lt;T&gt;(task, result)</code>  æ–¹æ³•æ¥é€‚é…ï¼Œå…³äºé€‚é…å™¨æ¨¡å¼ï¼Œæˆ‘è¿‡å‡ å¤©æ¥å¡«å‘ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RunnableAdapter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Runnable</span> task<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">T</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">RunnableAdapter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Runnable</span> task<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>task <span class=\"token operator\">=</span> task<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>result <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        task<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ ¸å¿ƒæ–¹æ³•-run\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•-run\">#</a> æ ¸å¿ƒæ–¹æ³• - run ()</h2>\n<p>åœ¨ <code>new</code>  äº†ä¸€ä¸ª <code>FutureTask</code>  å¯¹è±¡ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œè¿™ä¸ª <code>Task</code> , æ— è®ºæ˜¯é€šè¿‡ç›´æ¥ <code>new</code>  ä¸€ä¸ª <code>Thread</code>  è¿˜æ˜¯é€šè¿‡çº¿ç¨‹æ± ï¼Œæ‰§è¡Œçš„éƒ½æ˜¯ <code>run()</code>  æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±çœ‹çœ‹ <code>run()</code>  æ–¹æ³•çš„å®ç°ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// å¦‚æœä¸æ˜¯æ–°å»ºä»»åŠ¡æˆ–è€… CAS æ›¿æ¢å¤±è´¥ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// æ­¤å¤„ CAS æ˜¯å°† runnner è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œåœ¨æ­¤ä¹‹å‰ runner éƒ½æ˜¯ null</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">!=</span> <span class=\"token constant\">NEW</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token operator\">!</span><span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> runnerOffset<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                     <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">Callable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> c <span class=\"token operator\">=</span> callable<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> state <span class=\"token operator\">==</span> <span class=\"token constant\">NEW</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">V</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">boolean</span> ran<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                result <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ‰§è¡Œä»»åŠ¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                ran <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                result <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                ran <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token function\">setException</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ran<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®¾ç½®æ‰§è¡Œç»“æœ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        runner <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">int</span> s <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«ä¸­æ–­äº†ï¼Œéœ€è¦å¤„ç†ä¸­æ–­é€»è¾‘</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">>=</span> <span class=\"token constant\">INTERRUPTING</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token function\">handlePossibleCancellationInterrupt</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å¤„ç†ä¸­æ–­é€»è¾‘</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>run</code>  æ–¹æ³•å‡ºç°çš„å…¶ä»–æ–¹æ³•ä¹Ÿéœ€è¦è¯´ä¸€ä¸‹ï¼Œå½“ <code>call()</code>  å‡½æ•°æ‰§è¡ŒæˆåŠŸï¼Œä¼šé€šè¿‡ <code>set</code>  å‡½æ•°è®¾ç½®ç»“æœ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">V</span> v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// CAS æ›´æ”¹çŠ¶æ€ NEW --> COMPLETING</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> stateOffset<span class=\"token punctuation\">,</span> <span class=\"token constant\">NEW</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">COMPLETING</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® FutureTask å±æ€§ outcome ä¸º vï¼Œå…¶å®å°±æ˜¯è®¾ç½®è¿”å›ç»“æœ</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        outcome <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">putOrderedInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> stateOffset<span class=\"token punctuation\">,</span> <span class=\"token constant\">NORMAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// final state</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">finishCompletion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ‰§è¡Œå®Œæ¯•ï¼Œå”¤é†’ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å”¤é†’ç­‰å¾…çº¿ç¨‹çš„ <code>finishCompletion</code>  æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">finishCompletion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// assert state > COMPLETING;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">WaitNode</span> q<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">=</span> waiters<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> waitersOffset<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// ç§»é™¤ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// è‡ªæ—‹éå†ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> q<span class=\"token punctuation\">.</span>thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    q<span class=\"token punctuation\">.</span>thread <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">unpark</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å”¤é†’ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">WaitNode</span> next <span class=\"token operator\">=</span> q<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                q<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// unlink to help gc</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                q <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// ä»»åŠ¡å®Œæˆåè°ƒç”¨å‡½æ•°ï¼Œè‡ªå®šä¹‰æ‰©å±•</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    callable <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// to reduce footprint</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœåœ¨ <code>run</code>  æœŸé—´å‘ç”Ÿä¸­æ–­ï¼Œå°±ä¼šè¿›å…¥ä¸­æ–­çš„å¤„ç†é€»è¾‘</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handlePossibleCancellationInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åœ¨ä¸­æ–­è€…ä¸­æ–­çº¿ç¨‹ä¹‹å‰å¯èƒ½ä¼šå»¶è¿Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©å‡º CPU æ—¶é—´ç‰‡è‡ªæ—‹ç­‰å¾…</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token constant\">INTERRUPTING</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">==</span> <span class=\"token constant\">INTERRUPTING</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// wait out pending interrupt</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ ¸å¿ƒæ–¹æ³•-get\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•-get\">#</a> æ ¸å¿ƒæ–¹æ³• - get ()</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è·å–æ‰§è¡Œç»“æœ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">V</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ExecutionException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> s <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">&lt;=</span> <span class=\"token constant\">COMPLETING</span><span class=\"token punctuation\">)</span>\t<span class=\"token comment\">// å¤„äºæœªå®ŒæˆçŠ¶æ€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        s <span class=\"token operator\">=</span> <span class=\"token function\">awaitDone</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">// è¯¥æ–¹æ³•ä¹‹åä¼šè®²åˆ°ï¼Œ0L è¡¨ç¤ºæ— é™ç­‰å¾…</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">report</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å–æ‰§è¡Œç»“æœæˆ–æŠ›å‡ºæ‰§è¡ŒæœŸé—´çš„å¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// è¿”å›æ‰§è¡Œç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">V</span> <span class=\"token function\">report</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ExecutionException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">Object</span> x <span class=\"token operator\">=</span> outcome<span class=\"token punctuation\">;</span>\t<span class=\"token comment\">// \tè·å¾—ç»“æœ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token constant\">NORMAL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">)</span>x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">>=</span> <span class=\"token constant\">CANCELLED</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CancellationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExecutionException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">)</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ ¸å¿ƒæ–¹æ³•-cancel\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•-cancel\">#</a> æ ¸å¿ƒæ–¹æ³• - cancel ()</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> mayInterruptIfRunning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// å¦‚æœå½“å‰ Future çŠ¶æ€ä¸º NEWï¼Œæ ¹æ®å‚æ•°ä¿®æ”¹ Future çŠ¶æ€ä¸º INTERRUPTING æˆ– CANCELLED</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">==</span> <span class=\"token constant\">NEW</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> stateOffset<span class=\"token punctuation\">,</span> <span class=\"token constant\">NEW</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>              mayInterruptIfRunning <span class=\"token operator\">?</span> <span class=\"token constant\">INTERRUPTING</span> <span class=\"token operator\">:</span> <span class=\"token constant\">CANCELLED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mayInterruptIfRunning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å¯ä»¥åœ¨è¿è¡Œæ—¶ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> runner<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    t<span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// final state</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">putOrderedInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> stateOffset<span class=\"token punctuation\">,</span> <span class=\"token constant\">INTERRUPTED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token function\">finishCompletion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ç§»é™¤å¹¶å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ ¸å¿ƒæ–¹æ³•-awaitdone\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ–¹æ³•-awaitdone\">#</a> æ ¸å¿ƒæ–¹æ³• - awaitDone ()</h2>\n<p>åœ¨å…·ä½“åˆ†æå®ƒçš„æºç ä¹‹å‰ï¼Œæœ‰ä¸€ç‚¹æˆ‘ä»¬å…ˆç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œ <code>FutureTask</code>  ä¸­ä¼šæ¶‰åŠåˆ°ä¸¤ç±»çº¿ç¨‹ï¼Œä¸€ç±»æ˜¯æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªï¼Œ <code>FutureTask</code>  çš„ <code>run</code>  æ–¹æ³•å°±ç”±è¯¥çº¿ç¨‹æ¥æ‰§è¡Œï¼›ä¸€ç±»æ˜¯è·å–ä»»åŠ¡æ‰§è¡Œç»“æœçš„çº¿ç¨‹ï¼Œå®ƒå¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œéƒ½å¯ä»¥è°ƒç”¨ <code>get</code>  æ–¹æ³•æ¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™è¿™äº›çº¿ç¨‹å°±éœ€è¦è¿›å…¥ <code>Treiber</code>  æ ˆä¸­æŒ‚èµ·ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œæˆ–è€…ç­‰å¾…çš„çº¿ç¨‹è‡ªèº«è¢«ä¸­æ–­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> <span class=\"token function\">awaitDone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> timed<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> nanos<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> deadline <span class=\"token operator\">=</span> timed <span class=\"token operator\">?</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">nanoTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> nanos <span class=\"token operator\">:</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">WaitNode</span> q <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">boolean</span> queued <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// è‡ªæ—‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// è·å–å¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token function\">removeWaiter</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ç§»é™¤ç­‰å¾… WaitNode</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">int</span> s <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">></span> <span class=\"token constant\">COMPLETING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                q<span class=\"token punctuation\">.</span>thread <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ç½®ç©ºç­‰å¾…èŠ‚ç‚¹çš„çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token constant\">COMPLETING</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// cannot time out yet</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            q <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WaitNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>queued<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token comment\">//CAS ä¿®æ”¹ waiter</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            queued <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> waitersOffset<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                                 q<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> waiters<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            nanos <span class=\"token operator\">=</span> deadline <span class=\"token operator\">-</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">nanoTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nanos <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token function\">removeWaiter</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è¶…æ—¶ï¼Œç§»é™¤ç­‰å¾…èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">parkNanos</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> nanos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é˜»å¡å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é˜»å¡å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•çš„å¤§æ¡†æ¶å°±æ˜¯è‡ªæ—‹ï¼Œæˆ‘ä»¬å…ˆæ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿™æ˜¯å› ä¸º <code>get</code>  æ–¹æ³•æ˜¯é˜»å¡å¼çš„ï¼Œå¦‚æœç­‰å¾…çš„ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™è°ƒç”¨ <code>get</code>  æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æ‰”åˆ° <code>Treiber</code>  æ ˆä¸­æŒ‚èµ·ç­‰å¾…ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»»åŠ¡è¿Ÿè¿Ÿæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™æˆ‘ä»¬ä¹Ÿæœ‰å¯èƒ½ç›´æ¥ä¸­æ–­åœ¨ <code>Treiber</code>  æ ˆä¸­çš„çº¿ç¨‹ï¼Œä»¥åœæ­¢ç­‰å¾…ã€‚</p>\n<p><code>removeWaiter</code>  çš„ä½œç”¨æ˜¯å°†å‚æ•°ä¸­çš„ <code>node</code>  ä»ç­‰å¾…é˜Ÿåˆ—ï¼ˆå³ <code>Treiber</code>  æ ˆï¼‰ä¸­ç§»é™¤ã€‚å¦‚æœæ­¤æ—¶çº¿ç¨‹è¿˜æ²¡æœ‰è¿›å…¥ <code>Treiber</code>  æ ˆï¼Œåˆ™  <code>q=null</code> ï¼Œé‚£ä¹ˆ <code>removeWaiter(q)</code>  å•¥ä¹Ÿä¸å¹²ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬å°±ç›´æ¥æŠ›å‡ºäº† <code>InterruptedException</code>  å¼‚å¸¸ã€‚</p>\n<p>ä¹‹å</p>\n<ul>\n<li>å¦‚æœä»»åŠ¡å·²ç»è¿›å…¥ç»ˆæ­¢æ€ï¼ˆ <code>s &gt; COMPLETING</code> ï¼‰ï¼Œæˆ‘ä»¬å°±ç›´æ¥è¿”å›ä»»åŠ¡çš„çŠ¶æ€ï¼›</li>\n<li>å¦åˆ™ï¼Œå¦‚æœä»»åŠ¡æ­£åœ¨è®¾ç½®æ‰§è¡Œç»“æœï¼ˆ <code>s == COMPLETING</code> ï¼‰ï¼Œæˆ‘ä»¬å°±è®©å‡ºå½“å‰çº¿ç¨‹çš„ CPU èµ„æºç»§ç»­ç­‰å¾…</li>\n<li>å¦åˆ™ï¼Œå°±è¯´æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæˆ–è€…ä»»åŠ¡æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‚£ä¹ˆè¿™æ—¶ï¼Œå¦‚æœ q ç°åœ¨è¿˜ä¸º null, è¯´æ˜å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œäºæ˜¯æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª <code>WaitNode</code> ,  <code>WaitNode</code>  çš„æ„é€ å‡½æ•°æˆ‘ä»¬ä¹‹å‰å·²ç»çœ‹è¿‡äº†ï¼Œå°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªè®°å½•äº†å½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹ï¼›</li>\n<li>å¦‚æœ <code>q</code>  ä¸ä¸º <code>null</code> ï¼Œè¯´æ˜ä»£è¡¨å½“å‰çº¿ç¨‹çš„ <code>WaitNode</code>  å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œåˆ™æ¥ä¸‹æ¥å¦‚æœ <code>queued=false</code> ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰å…¥é˜Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œäº†:</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>queued <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapObject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> waitersOffset<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> waiters<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å®ƒçš„ç­‰ä»·ä»£ç å°±æ˜¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>q<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> waiters<span class=\"token punctuation\">;</span> <span class=\"token comment\">// å½“å‰èŠ‚ç‚¹çš„ next æŒ‡å‘ç›®å‰çš„æ ˆé¡¶å…ƒç´ </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// å¦‚æœæ ˆé¡¶èŠ‚ç‚¹åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰å˜ï¼Œå³æ²¡æœ‰å‘ç”Ÿå¹¶å‘å…¥æ ˆçš„æƒ…å†µ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>waitersçš„å€¼è¿˜æ˜¯ä¸Šé¢q<span class=\"token punctuation\">.</span>nextæ‰€ä½¿ç”¨çš„waiterså€¼<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    waiters <span class=\"token operator\">=</span> q<span class=\"token punctuation\">;</span> <span class=\"token comment\">// ä¿®æ”¹æ ˆé¡¶çš„æŒ‡é’ˆï¼ŒæŒ‡å‘åˆšåˆšå…¥æ ˆçš„èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯ä¸€äº›è¶…æ—¶ç»“æŸç­‰å¾…å’Œè‡ªè¡Œé˜»å¡çš„å‡½æ•°ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1qdWMtZXhlY3V0b3ItRnV0dXJlVGFzay5odG1s\">https://pdai.tech/md/java/thread/java-thread-x-juc-executor-FutureTask.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGluZ2h1LWphdmEvcC84OTkxODI0Lmh0bWwlRTQlQkIlQTUlRTUlOEYlOEFodHRwczovL3d3dy5qaWFuc2h1LmNvbS9wL2Q2MWQ3ZmZhNmFiYw==\">https://www.cnblogs.com/linghu-java/p/8991824.html ä»¥åŠ https://www.jianshu.com/p/d61d7ffa6abc</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbmd6aG9uZzEyOC9hcnRpY2xlL2RldGFpbHMvODA1NTM3ODk=\">https://blog.csdn.net/xingzhong128/article/details/80553789</span></p>\n<p>å†°æ²³ã€Šæ·±å…¥ç†è§£é«˜å¹¶å‘ç¼–ç¨‹ã€‹ï¼ˆç¬¬ 1 ç‰ˆï¼‰</p>\n<p>è®²å¾—å¾ˆè¯¦ç»†ï¼Œå¼ºçƒˆæ¨èï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxNjU3MjU5MSNpdGVtLTQ=\">https://segmentfault.com/a/1190000016572591#item-4</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/23/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A76-StampedLock/",
            "url": "https://cecilia.cool/2022/08/23/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A76-StampedLock/",
            "title": "Java8æ–°ç‰¹æ€§--StampedLock",
            "date_published": "2022-08-23T05:54:59.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¸€èˆ¬åº”ç”¨ï¼Œéƒ½æ˜¯è¯»å¤šå†™å°‘ï¼Œ <code>ReentrantReadWriteLock</code>  å› è¯»å†™äº’æ–¥ï¼Œæ•…è¯»æ—¶é˜»å¡å†™ï¼Œå› è€Œæ€§èƒ½ä¸Šä¸Šä¸å»ã€‚å¯èƒ½ä¼šä½¿å†™çº¿ç¨‹é¥¥é¥¿ï¼Œ <code>StampedLock</code>  è¥è¿è€Œç”Ÿã€‚</p>\n<p>``StampedLock <code>å¹¶æ²¡æœ‰ä½¿ç”¨</code>  AQS <code>ï¼Œ</code> API <code>ç›¸å¯¹å¤æ‚ï¼Œå†…å£å®ç°æ¯”</code>  ReentrantReadWriteLock <code>å¤æ‚å¾—å¤šï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸å¯¹æºç è¿›è¡Œè¿‡å¤šè§£é‡Šã€‚æœ‰ç‚¹å°±æ˜¯ååé‡ç›¸å¯¹</code>  ReentrantReadWriteLock` æœ‰æ˜¾è‘—æå‡ã€‚</p>\n<h1 id=\"åŸç†\"><a class=\"anchor\" href=\"#åŸç†\">#</a> åŸç†</h1>\n<p>è·å–é”çš„æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªé‚®æˆ³ <code>Stamp</code> ï¼Œ <code>Stamp=0</code>  è¡¨ç¤ºè·å–å¤±è´¥ï¼Œå…¶ä½™éƒ½è¡¨ç¤ºæˆåŠŸã€‚é‡Šæ”¾é”æ—¶ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªé‚®æˆ³ <code>Stamp</code> ï¼Œè¿™ä¸ª <code>Stamp</code>  å¿…é¡»å’Œè·å¾—é”æ—¶çš„ <code>Stamp</code>  ä¸€è‡´ã€‚</p>\n<p>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Point</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">double</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StampedLock</span> sl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StampedLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">void</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> deltaX<span class=\"token punctuation\">,</span> <span class=\"token keyword\">double</span> deltaY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>       <span class=\"token keyword\">long</span> stamp <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">writeLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>       <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           x <span class=\"token operator\">+=</span> deltaX<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>           y <span class=\"token operator\">+=</span> deltaY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>           sl<span class=\"token punctuation\">.</span><span class=\"token function\">unlockWrite</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ç”¨åˆ°äº† Stamp é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"ç‰¹ç‚¹\"><a class=\"anchor\" href=\"#ç‰¹ç‚¹\">#</a> ç‰¹ç‚¹</h1>\n<ul>\n<li><code>StampedLock</code>  ä¸æ”¯æŒé”é‡å…¥ï¼Œå†™é”çš„é‡å…¥ä¼šé€ æˆæ­»é”ã€‚ä½†æ˜¯æ”¯æŒä¸‰ç§æ¨¡å¼ï¼šå†™é”ï¼Œæ‚²è§‚é”ï¼Œä¹è§‚é”ã€‚</li>\n<li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”ï¼Œå†™é”å’Œæ‚²è§‚è¯»é”æ˜¯äº’æ–¥çš„ã€‚</li>\n<li>å…è®¸å¤š ä¸ªçº¿ç¨‹åŒæ—¶è·å–ä¹è§‚é”å’Œæ‚²è§‚è¯»é”ã€‚</li>\n</ul>\n<h1 id=\"ä½¿ç”¨\"><a class=\"anchor\" href=\"#ä½¿ç”¨\">#</a> ä½¿ç”¨</h1>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ <code>JDK1.8</code>  æºç è‡ªå¸¦çš„æ¡ˆä¾‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StampedLockDemo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">double</span> x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StampedLock</span> sl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StampedLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//ã€å†™é” (æ’å®ƒé”)ã€‘</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> deltaX<span class=\"token punctuation\">,</span><span class=\"token keyword\">double</span> deltaY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">/**stampedLock è°ƒç”¨ writeLock å’Œ unlockWrite æ—¶å€™éƒ½ä¼šå¯¼è‡´ stampedLock çš„ stamp å€¼çš„å˜åŒ–</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         * å³æ¯æ¬¡ + 1ï¼ˆä¸æ˜¯ç‹­ä¹‰çš„åŠ ä¸€ï¼‰ï¼Œç›´åˆ°åŠ åˆ°æœ€å¤§å€¼ï¼Œç„¶åä» 0 é‡æ–°å¼€å§‹ </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         **/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">long</span> stamp <span class=\"token operator\">=</span>sl<span class=\"token punctuation\">.</span><span class=\"token function\">writeLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å†™é”</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            x <span class=\"token operator\">+=</span>deltaX<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            y <span class=\"token operator\">+=</span>deltaY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            sl<span class=\"token punctuation\">.</span><span class=\"token function\">unlockWrite</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é‡Šæ”¾å†™é”</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//ã€ä¹è§‚è¯»é”ã€‘</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">double</span> <span class=\"token function\">distanceFromOrigin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// A read-only method</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         * tryOptimisticRead æ˜¯ä¸€ä¸ªä¹è§‚çš„è¯»ï¼Œä½¿ç”¨è¿™ç§é”çš„è¯»ä¸é˜»å¡å†™</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         * æ¯æ¬¡è¯»çš„æ—¶å€™å¾—åˆ°ä¸€ä¸ªå½“å‰çš„ stamp å€¼ï¼ˆç±»ä¼¼æ—¶é—´æˆ³çš„ä½œç”¨ï¼‰</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">long</span> stamp <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">tryOptimisticRead</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// è¿™é‡Œå°±æ˜¯è¯»æ“ä½œï¼Œè¯»å– x å’Œ yï¼Œå› ä¸ºè¯»å– x æ—¶ï¼Œy å¯èƒ½è¢«å†™äº†æ–°çš„å€¼ï¼Œæ‰€ä»¥ä¸‹é¢éœ€è¦åˆ¤æ–­</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">double</span> currentX <span class=\"token operator\">=</span> x<span class=\"token punctuation\">,</span> currentY <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">/** å¦‚æœè¯»å–çš„æ—¶å€™å‘ç”Ÿäº†å†™ï¼Œåˆ™ stampedLock çš„ stamp å±æ€§å€¼ä¼šå˜åŒ–ï¼Œæ­¤æ—¶éœ€è¦é‡è¯»ï¼Œ</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         * å†é‡è¯»çš„æ—¶å€™éœ€è¦åŠ è¯»é”ï¼ˆå¹¶ä¸”é‡è¯»æ—¶ä½¿ç”¨çš„åº”å½“æ˜¯æ‚²è§‚çš„è¯»é”ï¼Œå³é˜»å¡å†™çš„è¯»é”ï¼‰</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         * å½“ç„¶é‡è¯»çš„æ—¶å€™è¿˜å¯ä»¥ä½¿ç”¨ tryOptimisticReadï¼Œæ­¤æ—¶éœ€è¦ç»“åˆå¾ªç¯äº†ï¼Œå³ç±»ä¼¼ CAS æ–¹å¼</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>         * è¯»é”åˆé‡æ–°è¿”å›ä¸€ä¸ª stampe å€¼ */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sl<span class=\"token punctuation\">.</span><span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å¦‚æœéªŒè¯å¤±è´¥ï¼ˆè¯»ä¹‹å‰å·²å‘ç”Ÿå†™ï¼‰</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            stamp <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">readLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ‚²è§‚è¯»é”</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                currentX <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                currentY <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">finally</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                sl<span class=\"token punctuation\">.</span><span class=\"token function\">unlockRead</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é‡Šæ”¾è¯»é”</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// è¯»é”éªŒè¯æˆåŠŸåæ‰§è¡Œè®¡ç®—ï¼Œå³è¯»çš„æ—¶å€™æ²¡æœ‰å‘ç”Ÿå†™</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>currentX <span class=\"token operator\">*</span>currentX <span class=\"token operator\">+</span> currentY <span class=\"token operator\">*</span>currentY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">//ã€æ‚²è§‚è¯»é”ã€‘</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">moveIfAtOrigin</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span> newX<span class=\"token punctuation\">,</span> <span class=\"token keyword\">double</span> newY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// upgrade</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">// è¯»é”ï¼ˆè¿™é‡Œå¯ç”¨ä¹è§‚é”æ›¿ä»£ï¼‰</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">long</span> stamp <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">readLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token comment\">// å¾ªç¯ï¼Œæ£€æŸ¥å½“å‰çŠ¶æ€æ˜¯å¦ç¬¦åˆ</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">==</span> <span class=\"token number\">0.0</span> <span class=\"token operator\">&amp;&amp;</span> y <span class=\"token operator\">==</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>             * è½¬æ¢å½“å‰è¯»æˆ³ä¸ºå†™æˆ³ï¼Œå³ä¸Šå†™é”</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>             * 1. å†™é”æˆ³ï¼Œç›´æ¥è¿”å›å†™é”æˆ³</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>             * 2. è¯»é”æˆ³ä¸”å†™é”å¯è·å¾—ï¼Œåˆ™é‡Šæ”¾è¯»é”ï¼Œè¿”å›å†™é”æˆ³</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>             * 3. ä¹è§‚è¯»æˆ³ï¼Œå½“ç«‹å³å¯ç”¨æ—¶è¿”å›å†™é”æˆ³</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>             * 4. å…¶ä»–æƒ…å†µè¿”å› 0</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>             */</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">long</span> ws <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">tryConvertToWriteLock</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœå†™é”æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">!=</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>              stamp <span class=\"token operator\">=</span> ws<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ›¿æ¢ç¥¨æ®ä¸ºå†™é”</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>              x <span class=\"token operator\">=</span> newX<span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¿®æ”¹æ•°æ®</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>              y <span class=\"token operator\">=</span> newY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>              <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token comment\">// è½¬æ¢ä¸ºå†™é”å¤±è´¥</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token comment\">// é‡Šæ”¾è¯»é”</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                sl<span class=\"token punctuation\">.</span><span class=\"token function\">unlockRead</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token comment\">// è·å–å†™é”ï¼ˆå¿…è¦æƒ…å†µä¸‹é˜»å¡ä¸€ç›´åˆ°è·å–å†™é”æˆåŠŸï¼‰</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                stamp <span class=\"token operator\">=</span> sl<span class=\"token punctuation\">.</span><span class=\"token function\">writeLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token comment\">// é‡Šæ”¾é”ï¼ˆå¯èƒ½æ˜¯è¯» / å†™é”ï¼‰</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            sl<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span>stamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>ç°ä¿¡ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZXNpb24uY29tL2FydGljbGUvMTcwNjIxMjU1NS8=\">https://www.freesion.com/article/1706212555/</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC1zdGFtcGVkbG9jay5odG1s\">https://pdai.tech/md/java/java8/java8-stampedlock.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aXphcmRmb3JjZWwuZ2l0Ym9va3MuaW8vamF2YTgtbmV3LWZlYXR1cmVzL2NvbnRlbnQvMTAuaHRtbA==\">https://wizardforcel.gitbooks.io/java8-new-features/content/10.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aXphcmRmb3JjZWwuZ2l0Ym9va3MuaW8vamF2YTgtdHV0b3JpYWxzL2NvbnRlbnQvSmF2YSUyMDglMjAlRTUlQjklQjYlRTUlOEYlOTElRTYlOTUlOTklRTclQTglOEIlMjBUaHJlYWRzJTIwJUU1JTkyJThDJTIwRXhlY3V0b3JzLmh0bWw=\">https://wizardforcel.gitbooks.io/java8-tutorials/content/Java 8 å¹¶å‘æ•™ç¨‹ Threads å’Œ Executors.html</span></p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/22/Java/%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91-ThreadLocal/",
            "url": "https://cecilia.cool/2022/08/22/Java/%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91-ThreadLocal/",
            "title": "Javaå¹¶å‘-ThreadLocal",
            "date_published": "2022-08-22T05:03:54.000Z",
            "content_html": "<h1 id=\"é™æ€ç±»\"><a class=\"anchor\" href=\"#é™æ€ç±»\">#</a> é™æ€ç±»</h1>\n<p>æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹<strong>é™æ€ç±»</strong>ï¼Œè¿™åœ¨ä¹‹åçš„è®²è§£ä¼šç”¨åˆ°ã€‚é™æ€ç±»åªèƒ½æ˜¯å†…éƒ¨ç±»ï¼Œå¦‚æœå¤–éƒ¨ç±»ä½¿ç”¨ <code>static</code>  ä¼šæŠ¥é”™ã€‚</p>\n<p>é¦–å…ˆï¼Œé™æ€ç±»è¢« <code>static</code>  ä¿®é¥°ï¼Œé™æ€ä»£ç ï¼ˆæ–¹æ³•ï¼Œå±æ€§ç­‰ï¼‰çš„ä½¿ç”¨æ–¹å¼ä¸ä¾èµ–äºå®ä¾‹å¯¹è±¡ã€‚é™æ€ç±»ä¸­å¯ä»¥æœ‰éé™æ€å±æ€§ï¼Œè¦ä½¿ç”¨éé™æ€å±æ€§å°±éœ€è¦ä¾èµ–å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªéé™æ€å±æ€§å¹¶ä¸æ˜¯æ‰€æœ‰ç±»å…±äº«ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">A</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">public</span>  <span class=\"token keyword\">void</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">public</span>  <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">A</span> a1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token class-name\">A</span> a2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        a1<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>a2<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">Test</span> t1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        t1<span class=\"token punctuation\">.</span><span class=\"token function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// ç»“æœæ˜¯ 0ï¼Œè¯´æ˜ a1 å’Œ a2 ä¸å…±äº« count</span></pre></td></tr></table></figure><p><strong>é™æ€ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€æˆå‘˜</strong>ã€‚</p>\n<h1 id=\"threadlocalç®€ä»‹\"><a class=\"anchor\" href=\"#threadlocalç®€ä»‹\">#</a> ThreadLocal ç®€ä»‹</h1>\n<p>çº¿ç¨‹å®‰å…¨çš„è§£å†³æ€è·¯å¯ä»¥æœ‰ï¼š</p>\n<ul>\n<li>\n<p>äº’æ–¥åŒæ­¥ï¼š <code>synchronized</code>  å’Œ <code>ReentrantLock</code>  ç­‰åŠ é”ã€‚</p>\n</li>\n<li>\n<p>éé˜»å¡åŒæ­¥ï¼š <code>CASï¼ŒAtomicXXX</code>  ç­‰ç¡¬ä»¶å®ç°åŸå­æ“ä½œã€‚</p>\n</li>\n<li>\n<p>æ— åŒæ­¥æ–¹æ¡ˆï¼šæ ˆå°é—­ï¼Œæœ¬åœ°å­˜å‚¨ï¼ˆThreadLocalï¼‰ï¼Œå¯é‡å…¥ä»£ç ã€‚</p>\n</li>\n</ul>\n<p>æœ¬æ–‡å°†ä¼šè®²è§£æœ¬åœ°å­˜å‚¨ --  <code>ThreadLocal</code> ã€‚</p>\n<p><code>ThreadLocal</code>  æ˜¯ä¸€ä¸ªå°†åœ¨å¤šçº¿ç¨‹ä¸­ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„å˜é‡å‰¯æœ¬çš„ç±»ï¼›å½“ä½¿ç”¨ <code>ThreadLocal</code>  æ¥ç»´æŠ¤å˜é‡æ—¶ï¼Œ <code>ThreadLocal</code>  ä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„å˜é‡å‰¯æœ¬ï¼Œé¿å…å› å¤šçº¿ç¨‹æ“ä½œå…±äº«å˜é‡è€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>\n<p>å…ˆçœ‹ä¸€ä¸‹åŸºæœ¬çš„ä½¿ç”¨ï¼Œ<strong>ä¸€å®šè¦å…ˆçœ‹çœ‹</strong>ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadLocalTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> threadLocal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»ºç¬¬ä¸€ä¸ªçº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Thread</span> threadA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ThreadAï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹Aæœ¬åœ°å˜é‡ä¸­çš„å€¼ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»ºç¬¬äºŒä¸ªçº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">Thread</span> threadB <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ThreadBï¼š\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹Bæœ¬åœ°å˜é‡ä¸­çš„å€¼ä¸ºï¼š\"</span> <span class=\"token operator\">+</span> threadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// å¯åŠ¨çº¿ç¨‹ A å’Œçº¿ç¨‹ B</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        threadA<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        threadB<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// æ¯æ¬¡çš„æ‰“å°ç»“æœå¯èƒ½ä¸ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// çº¿ç¨‹ B æœ¬åœ°å˜é‡ä¸­çš„å€¼ä¸ºï¼šThreadBï¼šThread-1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// çº¿ç¨‹ A æœ¬åœ°å˜é‡ä¸­çš„å€¼ä¸ºï¼šThreadAï¼šThread-0</span></pre></td></tr></table></figure><h1 id=\"ç›¸å…³çš„ç±»\"><a class=\"anchor\" href=\"#ç›¸å…³çš„ç±»\">#</a> ç›¸å…³çš„ç±»</h1>\n<h2 id=\"entry\"><a class=\"anchor\" href=\"#entry\">#</a> Entry</h2>\n<p>è¯¥ç±»æ˜¯ <code>ThreadLocalMap</code>  çš„å†…éƒ¨é™æ€ç±»ï¼Œå®ƒæ˜¯å®é™…å­˜å‚¨å•å…ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹ <code>Thread</code>  å°†èµ„æºå­˜å‚¨åœ¨ <code>ThreadLocalMap</code>  å±æ€§ <code>threadLocals</code>  ä¸­ï¼Œè€Œå…¶å®çœŸæ­£å­˜å‚¨çš„æ˜¯ <code>Entry</code> ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Entry</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WeakReference</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> k<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        value <span class=\"token operator\">=</span> v<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ <code>Entry</code>  é‡Œé¢æœ‰ä¸€ä¸ª<strong>éé™æ€</strong>å±æ€§ <code>Object value</code> ï¼Œå…¶å®å­˜å‚¨çš„å°±æ˜¯èµ„æºå‰¯æœ¬ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ <code>value</code>  å…¶å®å°±æ˜¯ <code>String</code>  ç±»å‹ï¼Œåœ¨çº¿ç¨‹ <code>A</code>  ä¸­çš„å€¼å°±æ˜¯ï¼š <code>ThreadAï¼šThread-0</code> ï¼›åœ¨çº¿ç¨‹ <code>B</code>  ä¸­çš„å€¼ i å°±æ˜¯ï¼š <code>ThreadBï¼šThread-1</code> ã€‚</p>\n<p><code>Entry</code>  å­˜å‚¨çš„å¦ä¸€ä¸ªå±æ€§å°±æ˜¯ <code>ThreadLocal</code> ï¼Œåˆ°è¿™æˆ‘ä»¬å¯ä»¥çŸ¥é“ <code>Entry</code>  æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨èµ„æºçš„ <code>&lt;ThreadLocal,Object&gt;</code> ã€‚æ‰€ä»¥ä¾‹å­ä¸­ï¼Œä»å›¾åƒæ¥çœ‹æ˜¯è¿™æ ·çš„ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/22/90d3d2b93ed0f243.jpg\" alt=\"Entryå…³ç³»å›¾\" /></p>\n<p>æŸ¥çœ‹ <code>ThreadLocalMap</code>  æºç å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å…¶å†…éƒ¨æœ‰ä¸€ä¸ª <code>Entry</code>  æ•°ç»„ï¼ŒæŸ¥æ‰¾æ—¶æ˜¯æ ¹æ®å“ˆå¸Œç æŸ¥æ‰¾çš„ã€‚</p>\n<h2 id=\"threadlocalmap\"><a class=\"anchor\" href=\"#threadlocalmap\">#</a> ThreadLocalMap</h2>\n<p>è¿™æ˜¯ <code>ThreadLocal</code>  çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæ ¹æ®å…¶ç»™å®šçš„æ–¹æ³•å¯ä»¥å¿«é€ŸæŸ¥æ‰¾å½“å‰çº¿ç¨‹å¯¹åº”çš„ <code>Entry</code> ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹å…¶ç›¸å…³å±æ€§</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">INITIAL_CAPACITY</span> <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> table<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> size <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> threshold<span class=\"token punctuation\">;</span> <span class=\"token comment\">// The next size value at which to resizeï¼ŒDefault to 0</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ <code>ThreadLocalMap</code>  æ˜¯å¦‚ä½•æŸ¥æ‰¾ <code>Entry</code>  çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Entry</span> <span class=\"token function\">getEntry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// é€šè¿‡ ThreadLocal çš„å“ˆå¸Œç æ‹¿åˆ°æ•°ç»„ä¸‹æ ‡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>threadLocalHashCode <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è·å–å¯¹äº Entry</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">Entry</span> e <span class=\"token operator\">=</span> table<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å¤„ç†å“ˆå¸Œå†²çª</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// è¿™é‡Œå°±æ˜¯å½“å‘ç”Ÿå“ˆå¸Œå†²çªï¼Œåœ¨ table æ•°ç»„ä¸­å¾ªç¯å‘åç§»ä½æŸ¥æ‰¾</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">getEntryAfterMiss</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€åéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨ä½¿ç”¨çš„æ˜¯ <code>ThreadLocal</code>  çš„ <code>get</code>  å’Œ <code>set</code> ï¼ˆä»¥åŠ <code>remove</code> ï¼‰ï¼Œè¿™äº›å‡½æ•°çš„å®ç°å…¶å®å°±æ˜¯è°ƒç”¨å…¶å†…éƒ¨ç±» <code>ThreadLocalMap</code> ï¼Œæ‰€ä»¥ <code>getEntry</code>  æ¥æ”¶çš„å‚æ•°å…¶å®å°±æ˜¯å…¶å¤–éƒ¨ç±»çš„å®ä¾‹ã€‚</p>\n<p>çŸ¥é“å…¶å¤§è‡´ç»“æ„å’Œä½¿ç”¨ï¼Œå‰©ä¸‹çš„åˆ†ææ–¹æ³•ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p>\n<h1 id=\"threadlocalè¯¦è§£\"><a class=\"anchor\" href=\"#threadlocalè¯¦è§£\">#</a> ThreadLocal è¯¦è§£</h1>\n<p>å·²ç»å­¦ä¹ äº†å‰é¢ä¸¤ä¸ªå†…éƒ¨ç±»çš„åŸç†ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥çœ‹æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">T</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">ThreadLocalMap</span> threadLocals <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å¾—çº¿ç¨‹ t çš„ threadLocals å±æ€§</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>threadLocals <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">ThreadLocalMap<span class=\"token punctuation\">.</span>Entry</span> e <span class=\"token operator\">=</span> threadLocals<span class=\"token punctuation\">.</span><span class=\"token function\">getEntry</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é€šè¿‡ ThreadLocal å®ä¾‹æ‰¾åˆ°å€¼</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">T</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span>e<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// å¦‚æœçº¿ç¨‹çš„ threadLocals è¿˜æ²¡æœ‰åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">setInitialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// åˆå§‹åŒ–å€¼ï¼Œå…¶å®ä¸»è¦æ˜¯å› ä¸º threadLocals==nullï¼Œè¯¥å‡½æ•°è¦è°ƒç”¨ createMap</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">T</span> <span class=\"token function\">setInitialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token class-name\">T</span> value <span class=\"token operator\">=</span> <span class=\"token function\">initialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è¿”å› null</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å¯¹çº¿ç¨‹ t åˆ›å»º ThreadLocalMap</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œé‡ç‚¹æä¸€ä¸‹ <code>createMap</code>  å‡½æ•°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> t<span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span> firstValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    t<span class=\"token punctuation\">.</span>threadLocals <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocalMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> firstValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é™æ€å†…éƒ¨ç±»çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå®ƒå¯ä»¥å…ˆå®ä¾‹åŒ–è€Œä¸ç”¨ç®¡å¤–éƒ¨ç±»æ˜¯å¦å®ä¾‹åŒ–ã€‚é™æ€ç±»çš„å¦ä¸€ä¸ªæ„ä¹‰å°±æ˜¯å¤–éƒ¨ç±»éœ€è¦è®¿é—®å†…éƒ¨ç±»è€Œå†…éƒ¨ç±»ä¸éœ€è¦è®¿é—®å¤–éƒ¨ç±»ã€‚ä»ä¸Šé¢çš„è®²è§£å¯ä»¥çœ‹åˆ°ï¼Œ <code>ThreadLocalMap</code>  å”¯ä¸€éœ€è¦ä¾èµ–çš„å°±æ˜¯å¤–éƒ¨ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p>\n<p>å†çœ‹ä¸€ä¸‹ <code>set</code>  å‡½æ•°ï¼Œå¾ˆç®€å•ï¼Œæ­¤å¤„ä¸å†è§£é‡Šã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">ThreadLocalMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>map <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">createMap</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"è¡¥å……\"><a class=\"anchor\" href=\"#è¡¥å……\">#</a> è¡¥å……</h1>\n<p>ä¹‹å‰æˆ‘å¯¹è¿™äº›çŸ¥è¯†çš„è®²è§£ï¼Œä¸ºäº†æ›´å®¹æ˜“è®©è¯»è€…ç†è§£ï¼Œè¯´å¾—æ¯”è¾ƒé€šä¿—ï¼Œä¸ºäº†æ„å»ºä¸€ä¸ªç³»ç»Ÿçš„çŸ¥è¯†ä½“ç³»ï¼Œè¿™é‡Œä¼šå¼•ç”¨å…¶ä»–åšå®¢å¯¹æ•´ä¸ª <code>ThreadLocal</code>  çš„è®²è§£ã€‚</p>\n<h2 id=\"threadlocalmapå¯¹è±¡æ˜¯ä»€ä¹ˆ\"><a class=\"anchor\" href=\"#threadlocalmapå¯¹è±¡æ˜¯ä»€ä¹ˆ\">#</a> ThreadLocalMap å¯¹è±¡æ˜¯ä»€ä¹ˆ</h2>\n<p>æœ¬è´¨ä¸Šæ¥è®²ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª <code>Map</code> , ä½†æ˜¯è¿™ä¸ª <code>ThreadLocalMap</code>  ä¸æˆ‘ä»¬å¹³æ—¶è§åˆ°çš„ <code>Map</code>  æœ‰ç‚¹ä¸ä¸€æ ·</p>\n<ul>\n<li>å®ƒæ²¡æœ‰å®ç° <code>Map</code>  æ¥å£ï¼›</li>\n<li>å®ƒæ²¡æœ‰ <code>public</code>  çš„æ–¹æ³•ï¼Œæœ€å¤šæœ‰ä¸€ä¸ª <code>default</code>  çš„æ„é€ æ–¹æ³•ï¼Œ<strong>å› ä¸ºè¿™ä¸ª <code>ThreadLocalMap</code>  çš„æ–¹æ³•ä»…ä»…åœ¨ <code>ThreadLocal</code>  ç±»ä¸­è°ƒç”¨</strong>ï¼Œå±äºé™æ€å†…éƒ¨ç±»</li>\n<li>è¯¥ç±»ä»…ä»…ç”¨äº†ä¸€ä¸ª <code>Entry</code>  æ•°ç»„æ¥å­˜å‚¨ <code>Key</code> ,  <code>Value</code> ;  <code>Entry</code>  å¹¶ä¸æ˜¯é“¾è¡¨å½¢å¼ï¼Œè€Œæ˜¯æ¯ä¸ª <code>bucket</code>  é‡Œé¢ä»…ä»…æ”¾ä¸€ä¸ª <code>Entry</code> ;</li>\n</ul>\n<p>ä¸Šæ–‡è®²åˆ°æŸ¥æ‰¾æ˜¯ä¸å“ˆå¸Œç æœ‰å…³ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ä¸€ä¸‹ <code>ThreadLocalMap</code>  æ˜¯æ€ä¹ˆå¤„ç†å“ˆå¸Œå†²çªçš„</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">//set å‡½æ•° -- å°† & lt;k,v > æ’å…¥åˆ°æ•°ç»„ä¸­</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> tab <span class=\"token operator\">=</span> table<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>threadLocalHashCode <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>len<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å–ä¸‹æ ‡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// æ ¹æ® threshold å¯çŸ¥ï¼Œtable ä¸­ä¸€å®šæœ‰ 1/3 ä»¥ä¸Šä¸º null</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Entry</span> e <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>         e <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         e <span class=\"token operator\">=</span> tab<span class=\"token punctuation\">[</span>i <span class=\"token operator\">=</span> <span class=\"token function\">nextIndex</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> k <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>k <span class=\"token operator\">==</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å¦‚æœè¯¥ä½ç½®çš„ key ç›¸åŒï¼Œè¯´æ˜ä¹‹å‰å·²ç»ä¸º key æ‰¾åˆ°å¯¹åº”çš„ä¸‹æ ‡</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            e<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>k <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//k ä¸º nullï¼Œè¯´æ˜ä¹‹å‰æœ‰ key å æœ‰è¿‡ï¼Œä½†æ˜¯è¢«æ¸…ç©ºäº†ï¼Œæ‰€ä»¥å½“å‰ key å¯ä»¥ç›´æ¥å†™è¿›å»</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token function\">replaceStaleEntry</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// æ­¤æ—¶è¿˜æ²¡å°† & lt;key,value > æ”¾å…¥ table ä¸­ï¼Œå½“å‰ i çš„ Entry ä¸º nullï¼Œå¯ä»¥æ”¾è¿›å»</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    tab<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Entry</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">int</span> sz <span class=\"token operator\">=</span> <span class=\"token operator\">++</span>size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// ä¸€äº›ç§»å‡ºå’Œæ‰©å®¹æ“ä½œ</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">cleanSomeSlots</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> sz<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> sz <span class=\"token operator\">>=</span> threshold<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token function\">rehash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//nextIndex å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†å“ˆå¸Œå†²çªï¼Œå¦‚ä½•æ‰¾ä¸‹ä¸€ä¸ªä¸‹æ ‡ -- ç›´æ¥åŠ  1</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">nextIndex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†çœ‹ä¸€ä¸‹ <code>get</code>  æ–¹æ³•ä¸Šé¢å·²ç»è®²äº†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC10aHJlYWRsb2NhbC5odG1s\">https://pdai.tech/md/java/thread/java-thread-x-threadlocal.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3ZraW5nX3dhbmcvYXJ0aWNsZS9kZXRhaWxzLzE0MjI1Mzc5\">https://blog.csdn.net/vking_wang/article/details/14225379</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvbW8zLXktNDVfYW81NGI1VDdlejdpQQ==\">https://mp.weixin.qq.com/s/mo3-y-45_ao54b5T7ez7iA</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHR0YmxvZy5jb20vP3A9MzA4Nw==\">https://www.xttblog.com/?p=3087</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dodXQyMDEwaGovYXJ0aWNsZS9kZXRhaWxzLzgxNDEzODg3\">https://blog.csdn.net/whut2010hj/article/details/81413887</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAxODM5OTc5NQ==\">https://segmentfault.com/a/1190000018399795</span></p>\n<p>å†°æ²³ã€Šæ·±å…¥ç†è§£é«˜å¹¶å‘ç¼–ç¨‹ã€‹ç¬¬ 1 ç‰ˆ</p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/20/Java/%E5%B9%B6%E5%8F%91/JUC_locks5-ReentrantReadWriteLock/",
            "url": "https://cecilia.cool/2022/08/20/Java/%E5%B9%B6%E5%8F%91/JUC_locks5-ReentrantReadWriteLock/",
            "title": "J.U.C.locks(5)--ReentrantReadWriteLock",
            "date_published": "2022-08-20T09:54:35.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>åœ¨çœ‹æœ¬æ–‡æ—¶ï¼Œæ‚¨éœ€è¦æœ‰ <code>AQS</code>  å’Œ <code>ReentrantLock</code>  åŸºç¡€ã€‚åœ¨é˜…è¯»æºç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„æœ€ç®€å•çš„åº”ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">ReentrantReadWriteLock</span> rw <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReentrantReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">ReentrantReadWriteLock<span class=\"token punctuation\">.</span>ReadLock</span> r <span class=\"token operator\">=</span> rw<span class=\"token punctuation\">.</span><span class=\"token function\">readLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">ReentrantReadWriteLock<span class=\"token punctuation\">.</span>WriteLock</span> w <span class=\"token operator\">=</span> rw<span class=\"token punctuation\">.</span><span class=\"token function\">writeLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            r<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1è·å–è¯»é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1é‡Šæ”¾è¯»é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            r<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            w<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2è·å–å†™é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2é‡Šæ”¾å†™é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            w<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            r<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t3è·å–è¯»é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t3é‡Šæ”¾è¯»é”\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            r<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        t1<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>t2<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>t3<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…·ä½“è¾“å‡ºæ¯æ¬¡å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚</p>\n<h1 id=\"å†…éƒ¨ç»“æ„\"><a class=\"anchor\" href=\"#å†…éƒ¨ç»“æ„\">#</a> å†…éƒ¨ç»“æ„</h1>\n<p>è¯¥ç±»æœ‰äº”ä¸ªå†…éƒ¨ç±»</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/Cyan-N/Images/1cf1e3de42128443.jpg\" alt=\"ReentrantReadWriteLockå†…éƒ¨ç±»\" /></p>\n<h2 id=\"å†…éƒ¨ç±»sync\"><a class=\"anchor\" href=\"#å†…éƒ¨ç±»sync\">#</a> å†…éƒ¨ç±» Sync</h2>\n<p><code>Sync</code>  æŠ½è±¡ç±»ç»§æ‰¿ AQS æŠ½è±¡ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">abstract</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Sync</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractQueuedSynchronizer</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>Sync</code>  ç±»å†…éƒ¨ä¹Ÿå­˜åœ¨ä¸¤ä¸ªå†…éƒ¨ç±»ï¼š <code>HoldCounter</code>  å’Œ <code>ThreadLocalHoldCounter</code> ã€‚</p>\n<h3 id=\"holdcounter\"><a class=\"anchor\" href=\"#holdcounter\">#</a> HoldCounter</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// HoldCounter-- è®¡æ•°å™¨ï¼Œä¸»è¦ä¸è¯»é”é…å¥—ä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HoldCounter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// è®¡æ•°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹çš„ TID å±æ€§çš„å€¼</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> tid <span class=\"token operator\">=</span> <span class=\"token function\">getThreadId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>count</code>  è¡¨ç¤ºæŸä¸ª<strong>è¯»</strong>çº¿ç¨‹<strong>é‡å…¥çš„æ¬¡æ•°</strong>ï¼Œ <code>tid</code>  è¡¨ç¤ºè¯¥çº¿ç¨‹çš„ <code>tid</code>  å­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªçº¿ç¨‹ã€‚</p>\n<h2 id=\"threadlocalholdcounter\"><a class=\"anchor\" href=\"#threadlocalholdcounter\">#</a> ThreadLocalHoldCounter</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æœ¬åœ°çº¿ç¨‹è®¡æ•°å™¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadLocalHoldCounter</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HoldCounter</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// é‡å†™åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰è¿›è¡Œ set çš„æƒ…å†µä¸‹ï¼Œè·å–çš„éƒ½æ˜¯è¯¥ HoldCounter å€¼</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HoldCounter</span> <span class=\"token function\">initialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HoldCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>ThreadLocalHoldCounter</code>  é‡å†™äº† <code>ThreadLocal</code>  çš„ <code>initialValue</code>  æ–¹æ³•ï¼Œ** <code>ThreadLocal</code>  ç±»å¯ä»¥å°†çº¿ç¨‹ä¸å¯¹è±¡ç›¸å…³è”ã€‚** åœ¨æ²¡æœ‰è¿›è¡Œ <code>set</code>  çš„æƒ…å†µä¸‹ï¼Œ <code>get</code>  åˆ°çš„å‡æ˜¯ <code>initialValue</code>  æ–¹æ³•é‡Œé¢ç”Ÿæˆçš„é‚£ä¸ª <code>HolderCounter</code>  å¯¹è±¡ã€‚</p>\n<h2 id=\"ç†è§£è®¡æ•°å™¨\"><a class=\"anchor\" href=\"#ç†è§£è®¡æ•°å™¨\">#</a> ç†è§£è®¡æ•°å™¨</h2>\n<p>è¿™ä¸¤ä¸ªç±»å¾ˆé‡è¦ï¼Œéƒ½æ˜¯ä¸è¯»é”ç›¸å…³çš„ï¼Œå¼ºè°ƒï¼š<strong>å¤šä¸ªä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶è·å¾—ä¸€ä¸ªè¯»é”</strong>ã€‚å…¶ä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†è¯»é”ï¼Œå®ƒå°±ä¼šåˆ†é…ä¸€ä¸ª <code>HoldCounter</code>  ç”¨æ¥è®°å½•å®ƒçš„è·å–é”çš„æ¬¡æ•°ã€‚å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–è¯»é”ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ª <code>HoldCounter</code> ï¼Œå®ƒä»¬å­˜æ”¾åœ¨ <code>ThreadLocalHoldCounter</code>  ä¸­ï¼Œè¯¥ç±»ç»§æ‰¿äº† <code>ThreadLocal</code> ï¼Œ <code>Thread</code>  æœ‰ä¸€ä¸ªå±æ€§å°±æ˜¯ <code>ThreadLocal.ThreadLocalMap threadLocals = null;</code> ã€‚å…³äº <code>threadLocals</code> ï¼Œä¹‹åä¼šå†å¼€ä¸€ä¸ªå‘ã€‚ç°åœ¨ä½ å°±åªéœ€è¦çŸ¥é“ <code>ThreadLocalHoldCounter</code>  ç”¨äºå­˜æ”¾ HoldCouter å³å¯ã€‚</p>\n<p>åœ¨ <code>ReentrantReadWriteLock</code>  ä¸­ç›¸å…³çš„<strong>å±æ€§</strong>è¡¨ç¤ºä¸º</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å­˜æ”¾ HoldCounter</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token class-name\">ThreadLocalHoldCounter</span> readHolds<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// ä¸Šä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹çš„ HoldCounterï¼Œå‡å°‘æŸ¥æ‰¾ readHolds</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token class-name\">HoldCounter</span> cachedHoldCounter<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// ç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹çš„ HoldCounterï¼Œä¹Ÿæ˜¯ä¸ºäº†å‡å°‘ readHolds æ¬¡æ•°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token class-name\">Thread</span> firstReader <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token keyword\">int</span> firstReaderHoldCount<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è®¡æ•°å™¨çš„åˆå§‹åŒ–å’Œæ”¹å˜å‘ç”Ÿåœ¨è·å–é”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è·å–è¯»é”çš„æºç ï¼ˆ <code>Sync</code>  æºç ï¼‰ï¼Œå› ä¸ºè¯»é”æ˜¯å…±äº«é”ï¼Œæ‰€ä»¥æ˜¯ <code>shared</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">tryAcquireShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> unused<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Thread</span> current <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// è·å–è¯»é”çš„ä¸¤ä¸ªå‰æï¼Œæš‚æ—¶ä¸ç”¨ç®¡</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">exclusiveCount</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> current<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span> r <span class=\"token operator\">=</span> <span class=\"token function\">sharedCount</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å–è¯»é”çŠ¶æ€ï¼Œåæ–‡ä¼šè®²åˆ°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦åº”è¯¥é˜»å¡ï¼Œä¸é”çš„å…¬å¹³æ€§æœ‰å…³ï¼Œæš‚æ—¶ä¸ç®¡</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">readerShouldBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        r <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MAX_COUNT</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> c <span class=\"token operator\">+</span> <span class=\"token constant\">SHARED_UNIT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// é‡ç‚¹ï¼Œ1. å¦‚æœæ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—è¯»é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±è®¾ç½®ä¸º firstReader</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            firstReader <span class=\"token operator\">=</span> current<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            firstReaderHoldCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>firstReader <span class=\"token operator\">==</span> current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 2. å¦‚æœå½“å‰çº¿ç¨‹å°±æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼ˆé”é‡å…¥ï¼‰</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            firstReaderHoldCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token class-name\">HoldCounter</span> rh <span class=\"token operator\">=</span> cachedHoldCounter<span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸Šä¸€æ¬¡æ‹¿åˆ°è¯»é”çš„çº¿ç¨‹çš„ HoldCounter</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rh <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> rh<span class=\"token punctuation\">.</span>tid <span class=\"token operator\">!=</span> <span class=\"token function\">getThreadId</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 3.rh ä¸ºç©ºæˆ–è€…å½“å‰çº¿ç¨‹å’Œä¸Šæ¬¡è·å–è¯»é”çš„çº¿ç¨‹ä¸ä¸€è‡´</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                cachedHoldCounter <span class=\"token operator\">=</span> rh <span class=\"token operator\">=</span> readHolds<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//get () å‡½æ•°ä¼šé€šè¿‡ currentThread () å‡½æ•°æ‹¿åˆ°å¯¹åº”çš„ HoldCounter</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rh<span class=\"token punctuation\">.</span>count <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                readHolds<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>rh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®¾ç½®</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            rh<span class=\"token punctuation\">.</span>count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">fullTryAcquireShared</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è‡ªæ—‹è·å–é”</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"syncçš„åŸºæœ¬å‡½æ•°\"><a class=\"anchor\" href=\"#syncçš„åŸºæœ¬å‡½æ•°\">#</a> Sync çš„åŸºæœ¬å‡½æ•°</h2>\n<ul>\n<li>æ„é€ å‡½æ•°ï¼šåœ¨ <code>Sync</code>  çš„æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†æœ¬åœ°çº¿ç¨‹è®¡æ•°å™¨å’Œ <code>AQS</code>  çš„çŠ¶æ€ <code>state</code> ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ„é€ å‡½æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// æœ¬åœ°çº¿ç¨‹è®¡æ•°å™¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    readHolds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadLocalHoldCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½® AQS çš„çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ensures visibility of readHolds</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹ <code>ReentrantReadWriteLock</code>  å¯¹è±¡çš„æ“ä½œç»å¤§å¤šæ•°éƒ½è½¬å‘è‡³ <code>Sync</code>  å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥è¦å¯¹ <code>Sync</code>  ç±»ä¸­çš„é‡ç‚¹å‡½æ•°è¿›è¡Œåˆ†æã€‚</p>\n<ul>\n<li><code>sharedCount</code>  å‡½æ•°ï¼šæ ‡è¯†å æœ‰<strong>è¯»é”</strong>çš„çº¿ç¨‹æ•°é‡</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">sharedCount</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> c<span class=\"token punctuation\">)</span>    <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> c <span class=\"token operator\">>>></span> <span class=\"token constant\">SHARED_SHIFT</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>SHARED_SHIFT</code>  æ˜¯ <code>Sync</code>  é‡è¦çš„å˜é‡ï¼Œå€¼ä¸º 16ã€‚ç›´æ¥å°† <code>state</code>  å³ç§» 16 ä½ï¼Œå°±å¯ä»¥å¾—åˆ°è¯»é”çš„çº¿ç¨‹æ•°é‡ï¼Œå› ä¸º <code>state</code>  çš„é«˜ 16 ä½è¡¨ç¤ºè¯»é”ï¼Œå¯¹åº”çš„ä½åå…­ä½è¡¨ç¤ºå†™é”æ•°é‡ã€‚</p>\n<ul>\n<li><code>exclusiveCount</code>  å‡½æ•°ï¼šè¡¨ç¤ºå æœ‰<strong>å†™é”</strong>çš„çº¿ç¨‹æ•°é‡</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">exclusiveCount</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> c<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> c <span class=\"token operator\">&amp;</span> <span class=\"token constant\">EXCLUSIVE_MASK</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å†™é”å æœ‰çš„æœ€å¤§çº¿ç¨‹æ•°é‡æ˜¯ <code>(1 &lt;&lt; 16) - 1</code> ï¼Œ ç›´æ¥å°†çŠ¶æ€ <code>state</code>  å’Œ <code>(2^16 - 1)</code>  åšä¸è¿ç®—ï¼Œå…¶ç­‰æ•ˆäºå°† <code>state</code>  æ¨¡ä¸Š <code>2^16</code> ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/20/54200b15d89a0deb.jpg\" alt=\"ReentrantReadWriteLockè¯»å†™é”çŠ¶æ€\" /></p>\n<p>å†™çº¿ç¨‹è·å–é”ä¿®æ”¹ <code>state</code> ï¼Œå°±æ˜¯æ­£å¸¸çš„ <code>+1</code> ï¼Œå¯ä»¥ç†è§£ä¸ºä½ 16 ä½ + 1ï¼›è€Œè¯»çº¿ç¨‹è·å–é”ä¿®æ”¹ <code>state</code> ï¼Œæ˜¯é«˜ 16 ä½ + 1ï¼Œå³ä¸ºæ¯æ¬¡ s <code>tate+=SHARED_UNIT</code> ï¼ŒSHARED_UNIT æ˜¯ä¸€ä¸ªå¾ˆå¤§æ•°ï¼ˆ <code>1&lt;&lt;16+1</code> ï¼‰ï¼Œæ¯æ¬¡è¯»é” <code>state</code>  åŠ è¿™ä¹ˆå¤§ä¸ªæ•°ï¼Œæ€ä¹ˆæ˜¯ + 1 å‘¢ï¼Œè¿™é‡Œå°±è¦ç†è§£é«˜ 16 ä½ + 1 æ˜¯åœ¨äºŒè¿›åˆ¶ä¸‹ + 1ã€‚</p>\n<h2 id=\"é‡å†™aqså‡½æ•°\"><a class=\"anchor\" href=\"#é‡å†™aqså‡½æ•°\">#</a> é‡å†™ AQS å‡½æ•°</h2>\n<p>ä¸ºäº†å‡è½»è¯»è€…é˜…è¯»å‹åŠ›ï¼Œä¹‹åçš„æ–¹æ³•ä¸ä¼šç»™å‡ºæ‰€æœ‰æºç ï¼Œè€Œæ˜¯ä»¥æµç¨‹å›¾çš„å½¢å¼ï¼Œå»ºè®®è‡ªå·±ç»“åˆæºç é˜…è¯»ã€‚ä¹‹å‰æˆ‘ä»¬è®²äº† <code>exclusiveCount</code>  å‡½æ•°ï¼Œé…åˆ <code>getState</code>  è·å¾—å†™çº¿ç¨‹çš„æ•°é‡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//c çš„å‰ 16 ä½æ˜¯è¯»é”æ•°é‡ï¼Œå 16 ä½æ˜¯å†™é”æ•°é‡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">int</span> w <span class=\"token operator\">=</span> <span class=\"token function\">exclusiveCount</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è·å¾—å†™é”çš„æ•°é‡</span></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å­¦ä¹ é‡å†™ <code>AQS</code>  é‡Œçš„é‡è¦å‡½æ•°ï¼š</p>\n<ul>\n<li><code>tryRelease</code>  å‡½æ•°ï¼šå…ˆæ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯ç‹¬å çº¿ç¨‹ï¼Œå†æ˜¯å¦èµ„æºï¼Œä¹‹åä¼šåˆ¤æ–­æ˜¯å¦é‡Šæ”¾æˆåŠŸï¼ˆå®Œå…¨é‡Šæ”¾ï¼Œå¦‚æœè¿˜æœ‰é‡å…¥åˆ™ä¸ç®—æˆåŠŸï¼‰ï¼Œè®¾ç½®é‡Šæ”¾åçš„çŠ¶æ€ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/21/c738f5e6e9f48b26.jpg\" alt=\"tryReleaseå‡½æ•°\" /></p>\n<ul>\n<li><code>tryAcquire</code>  å‡½æ•°ï¼šä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œå•ç‹¬çœ‹ <code>c</code>  æ˜¯æ²¡æœ‰å¤šå¤§æ„ä¹‰çš„ã€‚æ‰€ä»¥è¦åˆ¤æ–­ <code>w</code>  çš„å€¼ã€‚å¹¶å‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªèµ„æºï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯è¯»æ“ä½œï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦åŠ é”ï¼Œå¦‚æœå­˜åœ¨å†™æ“ä½œï¼Œé‚£ä¹ˆ<strong>è¯»æ“ä½œå’Œå†™æ“ä½œéƒ½è¦åŠ é”ã€‚<strong>è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ <code>c != 0 &amp;&amp; w == 0</code> ï¼Œè¯´æ˜</strong>åªæœ‰è¯»é”ï¼Œè€Œæ²¡æœ‰å†™é”ï¼Œä½†æ˜¯æ­¤æ—¶çº¿ç¨‹æƒ³è¦è·å–å†™é”ä¹Ÿæ˜¯ä¸å…è®¸çš„</strong>ã€‚ <code>tryAcquire</code>  çš„å¤§è‡´æµç¨‹å°±æ˜¯è¿™æ ·çš„ï¼Œå…ˆåˆ¤æ–­æœ‰æ²¡æœ‰è¯»é”ï¼Œåœ¨åˆ¤æ–­å½“å‰å†™é”çš„ç‹¬å çº¿ç¨‹æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œæœ€ååˆ¤æ–­è·å–çš„é”çº¿ç¨‹æ•°é‡ä¼šä¸ä¼šè¶…è¿‡ <code>MAX_COUNT</code> ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/21/a1d528bbb62fe895.jpg\" alt=\"tryAcquireå‡½æ•°\" /></p>\n<p><code>tryAcquire</code>  å’Œ <code>tryRelease</code>  éƒ½æ˜¯ä¸å†™æ“ä½œç›¸å…³çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ <code>AQS</code>  é™¤äº†ç‹¬å æ¨¡å¼ï¼Œè¿˜æœ‰å…±äº«æ¨¡å¼ï¼Œéœ€è¦é‡å†™ <code>tryReleaseShared</code>  å’Œ <code>tryAcquireShared</code>  å‡½æ•°ã€‚è€Œè‹¥å¹²ä¸ªçº¿ç¨‹çš„è¯»æ“ä½œå¯ä»¥å†å…±äº«æ¨¡å¼ä¸­æ‰§è¡Œã€‚</p>\n<ul>\n<li><code>tryAcquireShared</code>  å‡½æ•°ï¼šå¦‚æœè¯¥èµ„æºè¢«åˆ«çš„çº¿ç¨‹çš„å†™é”è·å–ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¸èƒ½å†è·å–è¯»é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸€ä¸ªçº¿ç¨‹æƒ³è¦è·å–è¯»é”ï¼Œå¿…é¡»æ˜¯ä¸¤ç§å‰æä¹‹ä¸€ï¼š1 æ˜¯æ•´ä¸ªåŒæ­¥å™¨éƒ½æ²¡æœ‰å†™çº¿ç¨‹ï¼›2 å°±æ˜¯å“ªæ€•æœ‰å†™çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä¹Ÿå¿…é¡»æ˜¯è‡ªå·±è¿™ä¸ªçº¿ç¨‹</strong>ã€‚è¯¥å‡½æ•°æˆ‘ä»¬åœ¨è®²è®¡æ•°å™¨æ—¶ä¹Ÿçœ‹äº†æºç å’Œæ³¨é‡Šï¼Œæ‰€ä»¥æ­¤å¤„ç›´æ¥ç»™å‡ºæµç¨‹å›¾ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/21/b2433f1d5bc0c19e.jpg\" alt=\"tryAcquireSharedå‡½æ•°\" /></p>\n<p>æ­¤å¤„ä¸å¿…è¿‡å¤šè¿½ç©¶ <code>threadLocals</code> ï¼Œä¹‹åä¼šè®²åˆ°çš„ã€‚</p>\n<ul>\n<li><code>tryReleaseShared</code>  å‡½æ•°ï¼šä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾è¯»é”æ—¶ï¼Œéœ€è¦çš„æ”¹åŠ¨å…¶å®å°±æ˜¯ <code>HoldCounter</code> ï¼Œæ‰€ä»¥å¤§è‡´æµç¨‹å°±æ˜¯åˆ¤æ–­ <code>firstReader</code> ã€‚æ¥ç€ä¿®æ”¹è‡ªèº«çš„ <code>HoldCounter</code>  ç­‰ï¼Œæœ€åæ­»å¾ªç¯ç›´åˆ°æˆåŠŸ <code>CAS</code>  ä¿®æ”¹è¯»é”çŠ¶æ€ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/21/dfecf123841434e4.jpg\" alt=\"tryReleaseSharedå‡½æ•°\" /></p>\n<h1 id=\"é”çš„å…¬å¹³æ€§\"><a class=\"anchor\" href=\"#é”çš„å…¬å¹³æ€§\">#</a> é”çš„å…¬å¹³æ€§</h1>\n<p>ä¸ <code>ReentrantLock</code>  ä¸€æ ·ï¼Œè¯¥ç±»çš„è¯»å†™é”éƒ½æ˜¯é»˜è®¤éå…¬å¹³çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ReentrantReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ReentrantReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> fair<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    sync <span class=\"token operator\">=</span> fair <span class=\"token operator\">?</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FairSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NonfairSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    readerLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReadLock</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    writerLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WriteLock</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>NonfairSync</code>  å’Œ <code>FairSync</code>  ç»§æ‰¿ <code>Sync</code> ï¼Œå®ç°çš„æ˜¯ä¸¤ç§é˜»å¡ç­–ç•¥ â€”â€” <code>writerShouldBlock</code>  å’Œ <code>readerShouldBlock</code> ã€‚</p>\n<h2 id=\"nonfairsync\"><a class=\"anchor\" href=\"#nonfairsync\">#</a> NonfairSync</h2>\n<ul>\n<li><code>writerShouldBlock</code> ï¼šå†™é”åœ¨æŠ¢é”å‰æ°¸è¿œä¸ä¼šé˜»å¡ï¼Œéå…¬å¹³æ€§</li>\n<li><code>readerShouldBlock</code> ï¼šè¯»çº¿ç¨‹æŠ¢é”ä¹‹å‰ï¼Œå¦‚æœé˜Ÿåˆ— <code>head</code>  åç»§ï¼ˆ <code>head.next</code> ï¼‰æ˜¯ç‹¬å èŠ‚ç‚¹æ—¶é˜»å¡ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NonfairSync</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Sync</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">8159625535654395037L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">writerShouldBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// writers can always barge</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">readerShouldBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// åˆ¤æ–­ AQS é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ˜¯ç‹¬å çº¿ç¨‹ï¼ˆå†™çº¿ç¨‹ï¼‰</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">apparentlyFirstQueuedIsExclusive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"fairsync\"><a class=\"anchor\" href=\"#fairsync\">#</a> FairSync</h2>\n<p>æ— è®ºæ˜¯å†™çº¿ç¨‹è¿˜æ˜¯è¯»çº¿ç¨‹ï¼Œåªè¦åŒæ­¥é˜Ÿåˆ—ä¸­æœ‰å…¶ä»–èŠ‚ç‚¹åœ¨ç­‰å¾…é”ï¼Œå°±é˜»å¡ï¼Œè¿™å°±æ˜¯å…¬å¹³æ€§ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FairSync</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Sync</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">2274990926593161451L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">writerShouldBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">hasQueuedPredecessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">readerShouldBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">hasQueuedPredecessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//  hasQueuedPredecessors () åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰ç­‰å¾…æ›´ä¹…çš„èŠ‚ç‚¹</span></pre></td></tr></table></figure><p>æ­¤æ—¶ä½ å†å»é˜…è¯» <code>Sync</code>  é‡å†™çš„ <code>AQS</code>  æ–¹æ³•ï¼Œä½ å°±ä¼šå¯¹çº¿ç¨‹æ˜¯å¦åº”è¯¥é˜»å¡æœ‰æ›´æ¸…æ™°è®¤è¯†ã€‚éå…¬å¹³é”åœ¨ <code>tryAcquire</code>  ä¸­å§‹ç»ˆä¸ä¼šç®¡åŒæ­¥é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨ç­‰å¾…æ›´ä¹…çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥å» <code>CAS</code>  æ›¿æ¢æŠ¢é”ã€‚</p>\n<h1 id=\"è¯»å†™é”çš„è°ƒç”¨\"><a class=\"anchor\" href=\"#è¯»å†™é”çš„è°ƒç”¨\">#</a> è¯»å†™é”çš„è°ƒç”¨</h1>\n<p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå¯¹ <code>ReentrantReadWriteLock</code>  å¯¹è±¡çš„æ“ä½œç»å¤§å¤šæ•°éƒ½è½¬å‘è‡³ <code>Sync</code>  å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œå…¶å®å°±æ˜¯ <code>ReadLock</code>  å’Œ <code>WriteLock</code>  çš„æ–¹æ³•å®é™…æ˜¯åœ¨è°ƒç”¨ <code>Sync</code>  çš„æ–¹æ³•ã€‚</p>\n<h2 id=\"readlock\"><a class=\"anchor\" href=\"#readlock\">#</a> ReadLock</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ReadLock æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    sync<span class=\"token punctuation\">.</span><span class=\"token function\">acquireShared</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Sync æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acquireShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//tryAcquireShared è¿”å› - 1  è·å–é”å¤±è´¥ï¼Œ1 è·å–é”æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">tryAcquireShared</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// è·å–é”å¤±è´¥å…¥åŒæ­¥é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token function\">doAcquireShared</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶ä»–çš„éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>\n<h2 id=\"writelock\"><a class=\"anchor\" href=\"#writelock\">#</a> WriteLock</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// WriteLock æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    sync<span class=\"token punctuation\">.</span><span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Sync æ–¹æ³•ï¼Œå…¶å®æ˜¯ AQS æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// è‹¥æ²¡æœ‰æŠ¢åˆ°é”ï¼Œåˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token function\">acquireQueued</span><span class=\"token punctuation\">(</span><span class=\"token function\">addWaiter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXCLUSIVE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// è‡ªå·±ä¸­æ–­è‡ªå·±</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token function\">selfInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…¶ä»–çš„éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>\n<h1 id=\"ä½¿ç”¨æ³¨æ„\"><a class=\"anchor\" href=\"#ä½¿ç”¨æ³¨æ„\">#</a> ä½¿ç”¨æ³¨æ„</h1>\n<p>åˆ—å‡º <code>ReentrantReadWriteLock</code>  ä½¿ç”¨çš„æ³¨æ„ï¼š</p>\n<ul>\n<li>æœ‰è¯»é”å’Œå†™é”ï¼Œå¦‚æœè·å–äº†è¯»é”ï¼Œä¸èƒ½é‡å…¥å†™é”ï¼›åä¹‹åˆ™å¯ä»¥ã€‚</li>\n</ul>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1sb2NrLVJlZW50cmFudFJlYWRXcml0ZUxvY2suaHRtbA==\">https://pdai.tech/md/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html</span></p>\n<p>ReentrantReadWriteLock åŸç†è¯¦è§£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS9zdGVmYW54ZnkvNTA4MzM5NiNSZWVudHJhbnRSZWFkV3JpdGVMb2NrXzk=\">https://blog.51cto.com/stefanxfy/5083396#ReentrantReadWriteLock_9</span></p>\n<p>æ­»ç£• Java å¹¶å‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY21zYmxvZ3MuY29tL2FydGljbGUvMTM5MTI5Nzg1MzEwNzg2NzY0OCVFRiVCQyU4OCVFNSU4NSVCNiVFNSVBRSU5RSVFNSU5MCU4RCVFNSVBRCU5N2R1Y2slRTQlQjglOEQlRTUlQkYlODUlRTglQkYlOTklRTQlQjklODglRTglOEElQjElRTUlOTMlQTglRUYlQkMlODk=\">https://www.cmsblogs.com/article/1391297853107867648ï¼ˆå…¶å®åå­— duck ä¸å¿…è¿™ä¹ˆèŠ±å“¨ï¼‰</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/20/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A75-%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD%E4%BC%98%E5%8C%96/",
            "url": "https://cecilia.cool/2022/08/20/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A75-%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD%E4%BC%98%E5%8C%96/",
            "title": "Java8æ–°ç‰¹æ€§(5)--ç±»å‹æ¨æ–­ä¼˜åŒ–",
            "date_published": "2022-08-20T07:17:13.000Z",
            "content_html": "<h1 id=\"æ³›å‹ç®€ä»‹\"><a class=\"anchor\" href=\"#æ³›å‹ç®€ä»‹\">#</a> æ³›å‹ç®€ä»‹</h1>\n<p>æ³›å‹æ˜¯ <code>Java SE 1.5</code>  çš„æ–°ç‰¹æ€§ï¼Œæ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ã€‚ç†è§£ <code>Java</code>  æ³›å‹æœ€ç®€å•çš„æ–¹æ³•æ˜¯æŠŠå®ƒçœ‹æˆä¸€ç§ä¾¿æ·è¯­æ³•ï¼Œèƒ½èŠ‚çœä½ æŸäº› <code>Java</code>  ç±»å‹è½¬æ¢ (casting) ä¸Šçš„æ“ä½œã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æœ‰æ³›å‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Apple</span><span class=\"token punctuation\">></span></span> box <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Apple</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>box<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Apple</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Apple</span> apple <span class=\"token operator\">=</span> box<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// æ²¡æœ‰æ³›å‹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">Apple</span> apple <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Apple</span><span class=\"token punctuation\">)</span>box<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨æ³›å‹ç±»å‹ï¼Œéœ€è¦åœ¨å£°æ˜å¹¶èµ‹å€¼çš„æ—¶å€™ï¼Œä¸¤ä¾§éƒ½åŠ ä¸Šæ³›å‹ç±»å‹ã€‚ä¾‹å¦‚:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> myMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œåœ¨å£°æ˜å˜é‡æ—¶å·²ç»æŒ‡å®šäº†å‚æ•°ç±»å‹ï¼Œåœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶è¿˜éœ€è¦å†æŒ‡å®šã€‚åœ¨ <code>Java 7 </code> å¾—åˆ°æ”¹è¿›</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> myMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ³¨æ„åé¢çš„ \"&lt;>\"</span></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡å£°æ˜æ—¶çš„æ³›å‹ç±»å‹è‡ªåŠ¨æ¨æ–­å‡ºå®ä¾‹åŒ– <code>HashMap</code>  æ—¶çš„æ³›å‹ç±»å‹ã€‚å†æ¬¡æé†’ä¸€å®šè¦æ³¨æ„ new  <code>HashMap</code>  åé¢çš„ â€œ&lt;&gt;â€ï¼Œåªæœ‰åŠ ä¸Šè¿™ä¸ª â€œ&lt;&gt;â€ æ‰è¡¨ç¤ºæ˜¯è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œå¦åˆ™å°±æ˜¯éæ³›å‹ç±»å‹çš„ <code>HashMap</code> ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ç¼–è¯‘å™¨ç¼–è¯‘æºä»£ç æ—¶ä¼šç»™å‡ºä¸€ä¸ªè­¦å‘Šæç¤ºã€‚</p>\n<p>ä½†æ˜¯ <code>Java SE 7</code>  åœ¨åˆ›å»ºæ³›å‹å®ä¾‹æ—¶çš„ç±»å‹æ¨æ–­æ˜¯æœ‰é™åˆ¶çš„ï¼šåªæœ‰æ„é€ å™¨çš„å‚æ•°åŒ–ç±»å‹åœ¨<strong>ä¸Šä¸‹æ–‡ä¸­è¢«æ˜¾è‘—çš„å£°æ˜</strong>äº†ï¼Œæ‰å¯ä»¥ä½¿ç”¨ç±»å‹æ¨æ–­ï¼Œå¦åˆ™ä¸è¡Œã€‚ä¾‹å¦‚ï¼šä¸‹é¢çš„ä¾‹å­åœ¨ <code>java 7</code>  æ— æ³•æ­£ç¡®ç¼–è¯‘ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// ç”±äº addAll æœŸæœ›è·å¾— Collection&lt;? extends String > ç±»å‹çš„å‚æ•°ï¼Œå› æ­¤ä¸‹é¢çš„è¯­å¥æ— æ³•é€šè¿‡</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>list<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>addAll</code>  çš„å‡½æ•°åŸå‹æ˜¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">boolean</span> <span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">E</span><span class=\"token punctuation\">></span></span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// List å°±æ˜¯ç»§æ‰¿äº† Collection</span></pre></td></tr></table></figure><h1 id=\"java8æ”¹è¿›\"><a class=\"anchor\" href=\"#java8æ”¹è¿›\">#</a> Java8 æ”¹è¿›</h1>\n<p><code>java8</code>  é‡Œé¢æ³›å‹çš„ç›®æ ‡ç±»å‹æ¨æ–­ä¸»è¦ 2 ä¸ª:</p>\n<ul>\n<li>\n<p>æ”¯æŒé€šè¿‡<strong>æ–¹æ³•</strong>ä¸Šä¸‹æ–‡æ¨æ–­æ³›å‹ç›®æ ‡ç±»å‹ã€‚</p>\n</li>\n<li>\n<p>æ”¯æŒåœ¨<strong>æ–¹æ³•</strong>è°ƒç”¨é“¾è·¯å½“ä¸­ï¼Œæ³›å‹ç±»å‹æ¨æ–­ä¼ é€’åˆ°æœ€åä¸€ä¸ªæ–¹æ³•ã€‚</p>\n</li>\n</ul>\n<p>ä¹‹å‰çš„ <code>Java7</code>  æ˜¯<strong>æ„é€ å™¨</strong>ä¸Šä¸‹æ–‡ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Z</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Z</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">nil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Z</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Z</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">cons</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Z</span> head<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Z</span><span class=\"token punctuation\">></span></span> tail<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token class-name\">E</span> <span class=\"token function\">head</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é€šè¿‡æ–¹æ³•èµ‹å€¼çš„ç›®æ ‡å‚æ•°æ¥è‡ªåŠ¨æ¨æ–­æ³›å‹çš„ç±»å‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> l <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">nil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// è€Œä¸æ˜¯æ˜¾ç¤ºçš„æŒ‡å®šç±»å‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//List&lt;String> l = List.&lt;String>nil();</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// é€šè¿‡å‰é¢æ–¹æ³•å‚æ•°ç±»å‹æ¨æ–­æ³›å‹çš„ç±»å‹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">cons</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">nil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// è€Œä¸æ˜¯æ˜¾ç¤ºçš„æŒ‡å®šç±»å‹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//List.cons(42, List.&lt;Integer>nil());</span></pre></td></tr></table></figure><p>ä½ è®°ä½ <code>Java8</code>  å¯ä»¥ä»æ–¹æ³•ä¸Šä¸‹æ–‡è·å–ç›®æ ‡ç±»å‹å³å¯ã€‚ä¹‹å‰çš„ <code>list.addAll(new ArrayList&lt;&gt;());</code> ï¼Œ <code>list</code>  è¿™ä¸ªå¼•ç”¨å°±æŒ‡æ˜äº†ç±»å‹ï¼Œæ‰€ä»¥ <code>Java8</code>  ç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC10eXBlLmh0bWw=\">https://pdai.tech/md/java/java8/java8-type.html</span></p>\n<p>æ³¨ï¼šç½‘ä¸Šå…³äº Java8 ç±»å‹æ¨æ–­ä¼˜åŒ–å¥½å¤šéƒ½ä¸€æ¨¡ä¸€æ ·ï¼Œè¿åæ§½éƒ½ä¸€æ ·ï¼Œä¸€ç‚¹éƒ½æ²¡æœ‰æ”¹è¿‡ï¼Œç”±äºå®ƒä»¬éƒ½å¤§å¤šæ²¡å†™å‘å¸ƒæ—¶é—´ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è°æŠ„è°çš„ã€‚</p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/19/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A74-%E7%B1%BB%E5%9E%8B%E6%B3%A8%E8%A7%A3%E4%B8%8E%E9%87%8D%E5%A4%8D%E6%B3%A8%E8%A7%A3/",
            "url": "https://cecilia.cool/2022/08/19/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A74-%E7%B1%BB%E5%9E%8B%E6%B3%A8%E8%A7%A3%E4%B8%8E%E9%87%8D%E5%A4%8D%E6%B3%A8%E8%A7%A3/",
            "title": "Java8æ–°ç‰¹æ€§(4)--ç±»å‹æ³¨è§£ä¸é‡å¤æ³¨è§£",
            "date_published": "2022-08-19T14:26:44.000Z",
            "content_html": "<h1 id=\"java5çš„æ³¨è§£\"><a class=\"anchor\" href=\"#java5çš„æ³¨è§£\">#</a> Java5 çš„æ³¨è§£</h1>\n<p>æ³¨è§£å°±ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ äº†æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºåŠ äº†æŸç§æ ‡è®°ã€‚å‘Šè¯‰ <code>javac</code>  ç¼–è¯‘å™¨æˆ–è€… java å¼€å‘å·¥å…·â€¦â€¦ å‘å…¶ä¼ é€’æŸç§ä¿¡æ¯ï¼Œä½œä¸ºä¸€ä¸ªæ ‡è®°ã€‚</p>\n<p>åŒæ—¶æ³¨è§£åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼ˆæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼š <code>java</code>  æºæ–‡ä»¶ --&gt;  <code>class</code>  æ–‡ä»¶ --&gt; å†…å­˜ä¸­çš„å­—èŠ‚ç ã€‚ç”±å…ƒæ³¨è§£ <code>Retention</code>  å†³å®šï¼Œæ³¨è§£çš„é»˜è®¤é˜¶æ®µæ˜¯ <code>Class</code> ã€‚</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">æ³¨è§£</th>\n<th style=\"text-align:center\">é˜¶æ®µ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">@Retention(RetentionPolicy.SOURCE)</td>\n<td style=\"text-align:center\">æºæ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">@Retention(RetentionPolicy.CLASS)</td>\n<td style=\"text-align:center\">class æ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">RetentionPolicy.RUNTIME</td>\n<td style=\"text-align:center\">å†…å­˜ä¸­çš„å­—èŠ‚ç </td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"java8çš„æ³¨è§£\"><a class=\"anchor\" href=\"#java8çš„æ³¨è§£\">#</a> Java8 çš„æ³¨è§£</h1>\n<p><code>Java8</code>  ä¸»è¦æ˜¯ä¸¤ç‚¹æ”¹è¿›ï¼šç±»å‹æ³¨è§£å’Œé‡å¤æ³¨è§£ã€‚</p>\n<h2 id=\"ç±»å‹æ³¨è§£\"><a class=\"anchor\" href=\"#ç±»å‹æ³¨è§£\">#</a> ç±»å‹æ³¨è§£</h2>\n<p>åœ¨ <code>java 8</code>  ä¹‹å‰ï¼Œæ³¨è§£åªèƒ½æ˜¯åœ¨å£°æ˜çš„åœ°æ–¹æ‰€ä½¿ç”¨ï¼Œæ¯”å¦‚ç±»ï¼Œæ–¹æ³•ï¼Œå±æ€§ï¼› <code>java 8</code>  é‡Œé¢ï¼Œæ³¨è§£å¯ä»¥åº”ç”¨åœ¨ä»»ä½•åœ°æ–¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åˆ›å»ºç±»å®ä¾‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">new</span> <span class=\"token annotation punctuation\">@Interned</span> <span class=\"token class-name\">MyObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// ç±»å‹æ˜ å°„</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>myString <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> str<span class=\"token punctuation\">;</span>\t</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//implements è¯­å¥</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">UnmodifiableList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token annotation punctuation\">@Readonly</span> <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token annotation punctuation\">@Readonly</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span> â€¦ <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//throw exception å£°æ˜</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">monitorTemperature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token annotation punctuation\">@Critical</span> <span class=\"token class-name\">TemperatureException</span> <span class=\"token punctuation\">&#123;</span> â€¦ <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç±»å‹æ³¨è§£åªæ˜¯è¯­æ³•è€Œä¸æ˜¯è¯­ä¹‰ï¼Œå¹¶ä¸ä¼šå½±å“ java çš„ç¼–è¯‘æ—¶é—´ï¼ŒåŠ è½½æ—¶é—´ï¼Œä»¥åŠè¿è¡Œæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘æˆ <code>class</code>  æ–‡ä»¶çš„æ—¶å€™å¹¶ä¸åŒ…å«ç±»å‹æ³¨è§£ã€‚</p>\n<p>åœ¨æšä¸¾ç±»å‹ <code>ElementType</code>  ä¸­æ–°å¢äº†ä¸¤ä¸ª</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Type parameter declaration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// @since 1.8 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// è¡¨ç¤ºè¯¥æ³¨è§£èƒ½å†™åœ¨ç±»å‹å˜é‡çš„å£°æ˜è¯­å¥ä¸­</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token constant\">TYPE_PARAMETER</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Use of a type</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// @since 1.8</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// è¡¨ç¤ºè¯¥æ³¨è§£èƒ½å†™åœ¨ä½¿ç”¨ç±»å‹çš„ä»»ä½•è¯­å¥ä¸­</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token constant\">TYPE_USE</span></pre></td></tr></table></figure><p><code>Java8</code>  å¹¶æ²¡æœ‰é›†æˆå…³äºç±»å‹æ³¨è§£çš„ä½¿ç”¨æ¡†æ¶ï¼Œå®ƒéœ€è¦å¼€å‘è€…è‡ªå·±å»æ­å»ºæ¡†æ¶æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚<strong>åç››é¡¿å¤§å­¦</strong>å¼€å‘å‡ºæ¥çš„ç¬¬ä¸‰æ–¹æ’ä»¶å·¥å…·<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGVja2VyZnJhbWV3b3JrLm9yZy8=\"> Cheker Framework</span>ã€‚ç±»å‹æ³¨è§£è¢«ç”¨æ¥æ”¯æŒåœ¨ <code>Java</code>  ç¨‹åºä¸­åšå¼ºç±»å‹æ£€æŸ¥ï¼Œé…åˆä¸Šè¿°å·¥å…·å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æµ‹å‡º <code>runtime error</code> ã€‚</p>\n<p>æ³¨æ„ï¼šä½¿ç”¨ <code>Checker Framework</code>  å¯ä»¥æ‰¾åˆ°ç±»å‹æ³¨è§£å‡ºç°çš„åœ°æ–¹å¹¶æ£€æŸ¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">checkers<span class=\"token punctuation\">.</span>nullness<span class=\"token punctuation\">.</span>quals<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Object</span> my <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// ä½¿ç”¨ javac ç¼–è¯‘ï¼Œä¸Šè¿°æ˜¯é€šè¿‡çš„</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>javac <span class=\"token operator\">-</span>processor <span class=\"token class-name\"><span class=\"token namespace\">checkers<span class=\"token punctuation\">.</span>nullness<span class=\"token punctuation\">.</span></span>NullnessChecker</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">.</span>java</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// ä½†æ˜¯æ”¹ä¸ºä¸‹é¢ä»£ç å°±ä¸ä¼šé€šè¿‡</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">Object</span> my <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æ³¨æ„ <code>java 5,6,7</code>  ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒæ³¨è§£ <code>@NonNul</code> lï¼Œä½† <code>checker framework </code> æœ‰ä¸ªå‘ä¸‹å…¼å®¹çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯å°†ç±»å‹æ³¨è§£ <code>@NonNull</code>  ç”¨ /**/ æ³¨é‡Šèµ·æ¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">checkers<span class=\"token punctuation\">.</span>nullness<span class=\"token punctuation\">.</span>quals<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestDemo</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">sample</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">/*@NonNull*/</span> <span class=\"token class-name\">Object</span> my <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ‰æ—¶é—´æˆ‘å†å‡ºä¸€ç¯‡å…³äº <code>Checker Framework</code>  çš„ä½¿ç”¨æ–‡ç« å§ï¼Œç¡®å®å¾ˆç®€å•ï¼Œå°±æ˜¯å®˜ç½‘æ˜¯è‹±æ–‡çš„è®©æˆ‘è¿™ä¸ªè‹±è¯­å¤©å‘çœ‹ç€éš¾å—ã€‚</p>\n<h2 id=\"å…³äºjsr-308\"><a class=\"anchor\" href=\"#å…³äºjsr-308\">#</a> å…³äº JSR 308</h2>\n<p>ä½ å¯ä»¥å°±æŠŠ <code>JSR 308</code>  ä¸ç±»å‹æ³¨è§£æŒ‚é’©ã€‚</p>\n<p><code>JSR 308</code>  æƒ³è¦è§£å†³åœ¨ Java 1.5 æ³¨è§£ä¸­å‡ºç°çš„ä¸¤ä¸ªé—®é¢˜:</p>\n<ul>\n<li>åœ¨å¥æ³•ä¸Šå¯¹æ³¨è§£çš„é™åˆ¶ï¼šåªèƒ½æŠŠæ³¨è§£å†™åœ¨å£°æ˜çš„åœ°æ–¹</li>\n<li>ç±»å‹ç³»ç»Ÿåœ¨è¯­ä¹‰ä¸Šçš„é™åˆ¶ï¼šç±»å‹ç³»ç»Ÿè¿˜åšä¸åˆ°é¢„é˜²æ‰€æœ‰çš„ bug</li>\n</ul>\n<p><code>JSR 308</code>  é€šè¿‡å¦‚ä¸‹æ–¹æ³•è§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜:</p>\n<ul>\n<li>å¯¹ Java è¯­è¨€çš„å¥æ³•è¿›è¡Œæ‰©å……ï¼Œå…è®¸æ³¨è§£å‡ºç°åœ¨æ›´å¤šçš„ä½ç½®ä¸Šã€‚åŒ…æ‹¬ï¼šæ–¹æ³•æ¥æ”¶å™¨ (method receiversï¼Œè¯‘æ³¨ï¼šä¾‹ <code>public int size() @Readonly &#123; â€¦ &#125;)</code> ï¼Œæ³›å‹å‚æ•°ï¼Œæ•°ç»„ï¼Œç±»å‹è½¬æ¢ï¼Œç±»å‹æµ‹è¯•ï¼Œå¯¹è±¡åˆ›å»ºï¼Œç±»å‹å‚æ•°ç»‘å®šï¼Œç±»ç»§æ‰¿å’Œ throws å­å¥ã€‚å…¶å®å°±æ˜¯ç±»å‹æ³¨è§£ï¼Œç°åœ¨æ˜¯ java 8 çš„ä¸€ä¸ªç‰¹æ€§</li>\n<li>é€šè¿‡å¼•å…¥å¯æ’æ‹”çš„ç±»å‹ç³»ç»Ÿ (pluggable type systems) èƒ½å¤Ÿåˆ›å»ºåŠŸèƒ½æ›´å¼ºå¤§çš„æ³¨è§£å¤„ç†å™¨ã€‚ç±»å‹æ£€æŸ¥å™¨å¯¹å¸¦æœ‰ç±»å‹é™å®šæ³¨è§£çš„æºç è¿›è¡Œåˆ†æï¼Œä¸€æ—¦å‘ç°ä¸åŒ¹é…ç­‰é”™è¯¯ä¹‹å¤„å°±ä¼šäº§ç”Ÿè­¦å‘Šä¿¡æ¯ã€‚å…¶å®å°±æ˜¯ check framework</li>\n</ul>\n<p>å¯¹ JSR308ï¼Œæœ‰äººåå¯¹ï¼Œè§‰å¾—æ›´å¤æ‚æ›´é™æ€äº†ï¼Œæ¯”å¦‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@NotEmpty</span> <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">String</span><span class=\"token operator\">></span> strings <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token operator\">&lt;</span><span class=\"token annotation punctuation\">@NonNull</span> <span class=\"token class-name\">String</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span></pre></td></tr></table></figure><p>æ¢æˆåŠ¨æ€è¯­è¨€ä¸º</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> strings <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"one\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"two\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æœ‰äººèµæˆï¼Œè¯´åˆ°åº•ï¼Œä»£ç æ‰æ˜¯ â€œæœ€æ ¹æœ¬â€ çš„æ–‡æ¡£ã€‚ä»£ç ä¸­åŒ…å«çš„æ³¨è§£æ¸…æ¥šè¡¨æ˜äº†ä»£ç ç¼–å†™è€…çš„æ„å›¾ã€‚å½“æ²¡æœ‰åŠæ—¶æ›´æ–°æˆ–è€…æœ‰é—æ¼çš„æ—¶å€™ï¼Œæ°æ°æ˜¯æ³¨è§£ä¸­åŒ…å«çš„æ„å›¾ä¿¡æ¯ï¼Œæœ€å®¹æ˜“åœ¨å…¶ä»–æ–‡æ¡£ä¸­è¢«ä¸¢å¤±ã€‚è€Œä¸”å°†è¿è¡Œæ—¶çš„é”™è¯¯è½¬åˆ°ç¼–è¯‘é˜¶æ®µï¼Œä¸ä½†å¯ä»¥åŠ é€Ÿå¼€å‘è¿›ç¨‹ï¼Œè¿˜å¯ä»¥èŠ‚çœæµ‹è¯•æ—¶æ£€æŸ¥ bug çš„æ—¶é—´ã€‚</p>\n<p>å…³äº <code>JSR 308</code>  çš„äº‰è®®ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW5mb3EuY24vYXJ0aWNsZS8yMDA4LzA1L2pzci0zMDg=\">JSR 308ï¼šJava è¯­è¨€å¤æ‚åº¦åœ¨æ£æ„å¢é•¿ï¼Ÿ</span>ã€‚</p>\n<h2 id=\"é‡å¤æ³¨è§£\"><a class=\"anchor\" href=\"#é‡å¤æ³¨è§£\">#</a> é‡å¤æ³¨è§£</h2>\n<p>å…è®¸åœ¨åŒä¸€ç”³æ˜ç±»å‹ (ç±»ï¼Œå±æ€§ï¼Œæˆ–æ–¹æ³•) çš„å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚</p>\n<p>åœ¨ <code>JDK1.8</code>  ä¹‹å‰ä½¿ç”¨é‡å¤æ³¨è§£çš„è§£å†³æ–¹æ¡ˆ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æ³¨è§£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Authority</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token class-name\">String</span> <span class=\"token function\">role</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Authorities</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">Authority</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RepeatAnnotationUseOldVersion</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Authorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token annotation punctuation\">@Authority</span><span class=\"token punctuation\">(</span>role<span class=\"token operator\">=</span><span class=\"token string\">\"Admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token annotation punctuation\">@Authority</span><span class=\"token punctuation\">(</span>role<span class=\"token operator\">=</span><span class=\"token string\">\"Manager\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doSomeThing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç”±å¦ä¸€ä¸ªæ³¨è§£æ¥å­˜å‚¨é‡å¤æ³¨è§£ï¼Œåœ¨ä½¿ç”¨æ—¶å€™ï¼Œç”¨å­˜å‚¨æ³¨è§£ <code>Authorities</code>  æ¥æ‰©å±•é‡å¤æ³¨è§£ã€‚</p>\n<p><code>Java8</code>  çš„åšæ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Repeatable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authorities</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Authority</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token class-name\">String</span> <span class=\"token function\">role</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Authorities</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">Authority</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RepeatAnnotationUseNewVersion</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token annotation punctuation\">@Authority</span><span class=\"token punctuation\">(</span>role<span class=\"token operator\">=</span><span class=\"token string\">\"Admin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Authority</span><span class=\"token punctuation\">(</span>role<span class=\"token operator\">=</span><span class=\"token string\">\"Manager\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doSomeThing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»ºé‡å¤æ³¨è§£ <code>Authority</code>  æ—¶ï¼ŒåŠ ä¸Š <code>@Repeatable</code> , æŒ‡å‘å­˜å‚¨æ³¨è§£ <code>Authorities</code> ï¼Œåœ¨ä½¿ç”¨æ—¶å€™ï¼Œç›´æ¥å¯ä»¥é‡å¤ä½¿ç”¨ <code>Authority</code>  æ³¨è§£ã€‚ä»ä¸Šé¢ä¾‹å­çœ‹å‡ºï¼Œ <code>java 8</code>  é‡Œé¢åšæ³•æ›´é€‚åˆå¸¸è§„çš„æ€ç»´ï¼Œå¯è¯»æ€§å¼ºä¸€ç‚¹ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC10eXBlLWFubm8uaHRtbA==\">https://pdai.tech/md/java/java8/java8-type-anno.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC1hbm5vLXJlcGVhdC5odG1s\">https://pdai.tech/md/java/java8/java8-anno-repeat.html</span></p>\n<p>å†°æ²³çš„åšå®¢ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmluZ2hlMDAxL3AvMTMwMzM0NDcuaHRtbA==\">https://www.cnblogs.com/binghe001/p/13033447.html</span></p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/19/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A73-%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95/",
            "url": "https://cecilia.cool/2022/08/19/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A73-%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95/",
            "title": "Java8æ–°ç‰¹æ€§(3)--é»˜è®¤æ–¹æ³•",
            "date_published": "2022-08-19T08:00:30.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æ¥å£å¯ä»¥æœ‰å®ç°æ–¹æ³•ï¼Œè€Œä¸”ä¸éœ€è¦å®ç°ç±»å®ç°å…¶æ–¹æ³•ï¼Œåªéœ€è¦åœ¨æ–¹æ³•åå‰åŠ ä¸Š <code>default</code>  å…³é”®å­—ã€‚</p>\n<p>ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªç‰¹æ€§ï¼Ÿé¦–å…ˆï¼Œä¹‹å‰çš„æ¥å£æ˜¯ä¸ªåŒåˆƒå‰‘ï¼Œ<strong>å¥½å¤„æ˜¯é¢å‘æŠ½è±¡è€Œä¸æ˜¯é¢å‘å…·ä½“ç¼–ç¨‹</strong>ï¼Œç¼ºé™·æ˜¯ï¼Œå½“éœ€è¦ä¿®æ”¹æ¥å£æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹å…¨éƒ¨å®ç°è¯¥æ¥å£çš„ç±»ï¼Œç›®å‰çš„ java 8 ä¹‹å‰çš„é›†åˆæ¡†æ¶æ²¡æœ‰ foreach æ–¹æ³•ï¼Œé€šå¸¸èƒ½æƒ³åˆ°çš„è§£å†³åŠæ³•æ˜¯åœ¨ JDK é‡Œç»™ç›¸å…³çš„æ¥å£æ·»åŠ æ–°çš„æ–¹æ³•åŠå®ç°ã€‚ç„¶è€Œï¼Œå¯¹äºå·²ç»å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ˜¯æ²¡æ³•åœ¨ç»™æ¥å£æ·»åŠ æ–°æ–¹æ³•çš„åŒæ—¶ä¸å½±å“å·²æœ‰çš„å®ç°ã€‚æ‰€ä»¥å¼•è¿›çš„é»˜è®¤æ–¹æ³•ã€‚<strong>ä»–ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ¥å£çš„ä¿®æ”¹ä¸ç°æœ‰çš„å®ç°ä¸å…¼å®¹çš„é—®é¢˜</strong>ã€‚</p>\n<p>åœ¨ç®€å•ç‚¹è¯´å°±æ˜¯ï¼Œå‡è®¾æˆ‘æŸä¸€ä¸ªæ¥å£éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„è¡Œä¸ºï¼Œè¿™ä¸ªè¡Œä¸ºæå–å‡ºæ¥çš„å…¬å…±è¡Œä¸ºï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤æ–¹æ³•ï¼Œå°±éœ€è¦åœ¨æ‰€æœ‰å®ç°ç±»ä¸Šä¿®æ”¹ï¼Œä¿è¯å…¶å®Œæ•´å®ç°å…¶æ¥å£ã€‚</p>\n<h1 id=\"java8æŠ½è±¡ç±»ä¸æ¥å£\"><a class=\"anchor\" href=\"#java8æŠ½è±¡ç±»ä¸æ¥å£\">#</a> Java8 æŠ½è±¡ç±»ä¸æ¥å£</h1>\n<p>java 8 çš„æ¥å£éƒ½æœ‰å®ç°æ–¹æ³•äº†ï¼Œè·ŸæŠ½è±¡ç±»è¿˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…¶å®è¿˜æ˜¯æœ‰çš„ï¼Œè¯·çœ‹ä¸‹è¡¨å¯¹æ¯”ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>ç›¸åŒç‚¹</th>\n<th>ä¸åŒç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>éƒ½æ˜¯æŠ½è±¡ç±»å‹</td>\n<td><strong>æŠ½è±¡ç±»ä¸å¯ä»¥å¤šé‡ç»§æ‰¿ï¼Œæ¥å£å¯ä»¥</strong> (æ— è®ºæ˜¯å¤šé‡ç±»å‹ç»§æ‰¿è¿˜æ˜¯å¤šé‡è¡Œä¸ºç»§æ‰¿)</td>\n</tr>\n<tr>\n<td>éƒ½å¯ä»¥æœ‰å®ç°æ–¹æ³• (ä»¥å‰æ¥å£ä¸è¡Œ)</td>\n<td>æŠ½è±¡ç±»å’Œæ¥å£æ‰€åæ˜ å‡ºçš„è®¾è®¡ç†å¿µä¸åŒã€‚å…¶å®æŠ½è±¡ç±»è¡¨ç¤ºçš„æ˜¯â€is-aâ€ å…³ç³»ï¼Œæ¥å£è¡¨ç¤ºçš„æ˜¯â€like-aâ€ å…³ç³»</td>\n</tr>\n<tr>\n<td>éƒ½å¯ä»¥ä¸éœ€è¦å®ç°ç±»æˆ–è€…ç»§æ‰¿è€…å»å®ç°æ‰€æœ‰æ–¹æ³•ï¼Œ(ä»¥å‰ä¸è¡Œï¼Œç°åœ¨æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸éœ€è¦å®ç°è€…å®ç°)</td>\n<td>æ¥å£ä¸­å®šä¹‰çš„å˜é‡é»˜è®¤æ˜¯<strong> public static final</strong> å‹ï¼Œä¸”å¿…é¡»ç»™å…¶åˆå€¼ï¼Œæ‰€ä»¥å®ç°ç±»ä¸­ä¸èƒ½æ”¹å˜å…¶å€¼ï¼›æŠ½è±¡ç±»ä¸­çš„å˜é‡é»˜è®¤æ˜¯ friendly å‹ï¼Œå…¶å€¼å¯ä»¥åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é‡æ–°èµ‹å€¼ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"å¤šé‡ç»§æ‰¿å†²çª\"><a class=\"anchor\" href=\"#å¤šé‡ç»§æ‰¿å†²çª\">#</a> å¤šé‡ç»§æ‰¿å†²çª</h1>\n<p>æ¥å£å¯ä»¥ä¹¦å†™é»˜è®¤æ–¹æ³•äº†ï¼Œç„¶ååˆå› ä¸ºæ¥å£ä¹‹é—´æ˜¯å¯ä»¥å¤šç»§æ‰¿çš„ï¼Œå› è€Œå®è´¨ä¸Š Java 8 çš„æ¥å£å¤šç»§æ‰¿å…¶å®ä¹Ÿä¼šæ¶‰åŠåˆ°å®ç°å¤šç»§æ‰¿çš„é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥çœ‹çœ‹ <code>Java</code>  å®ƒåœ¨è¯­æ³•å±‚é¢çš„è§£å†³æ–¹æ¡ˆ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Father</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çˆ¸çˆ¸åƒé¥­æ–¹å¼...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// ä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Mother</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¦ˆå¦ˆåƒé¥­æ–¹å¼...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Son</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Father</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Mother</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// ä¸æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Son</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Father</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Mother</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å„¿å­è‡ªå·±çš„åƒé¥­æ–¹å¼~~~\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// æ³¨æ„è¿™ç§è¯­æ³•æ˜¯è°ƒç”¨ ã€æŒ‡å®šæ¥å£ã€‘çš„ defualt æ–¹æ³•ï¼š</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// è‹¥æ¥å£åå­—æ²¡æœ‰å†²çªï¼Œç›´æ¥ super è°ƒç”¨å³å¯ï½ï½ï½</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">Father</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Mother</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å½“æ¥å£çš„æ–¹æ³•å‰é¢ç›¸åŒæ—¶ï¼Œæ‰ä¼šå‡ºç°å†²çªã€‚ç±»ä¸­çš„æ–¹æ³•ä¼˜å…ˆçº§æœ€é«˜ã€‚ç±»æˆ–è€…çˆ¶ç±»ä¸­çš„æ–¹æ³•å®ç°ä¼˜å…ˆçº§å¤§äºä»»ä½•æ¥å£çš„é»˜è®¤æ–¹æ³•ã€‚å¦‚æœæœ€åè¿˜æ˜¯æ— æ³•åˆ¤æ–­ï¼Œé‚£ä¹ˆå®ç°ç±»å¿…é¡»é€šè¿‡æ˜¾ç¤ºå¤å†™æ–¹å¼å¤å†™é»˜è®¤æ–¹æ³•ï¼Œå†é€šè¿‡ <code>super</code>  è°ƒç”¨æŒ‡å®šæ¥å£çš„å®ç°ã€‚ <code>Java8</code>  åœ¨è¯­è¨€å±‚é¢ä¸Šï¼Œå¯¹è‹¥å‡ºç°æ¥å£ <code>default</code>  æ–¹æ³•å†²çªçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä¸ä½œä¸ºã€‚å…¶å®ä¸ä½œä¸ºä¹Ÿæ˜¯ä¸€ç§ä½œä¸ºï¼Œå®ƒè®©ç¼–è¯‘å™¨å»æç¤ºè°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºçš„ <code>override</code>  è¿™ä¸ªå†²çªçš„æ–¹æ³•ï¼Œè®© coder è‡ªå·±å»å†³å®šè°ƒç”¨é€»è¾‘ã€‚</p>\n<p>å…¶å®ï¼Œæ›´ä¸ºç›´ç™½çš„è§£é‡Šï¼Œå°±æ˜¯å¯»æ‰¾å”¯ä¸€é»˜è®¤æ–¹æ³•çš„æœ€çŸ­è·¯å¾„ï¼Œä¸Šè¿°ä¾‹å­ï¼Œä» <code>Son</code>  å®ç°ç±»æ‰¾ <code>eat</code>  çš„å®ç°ï¼Œä» <code>Son</code>  åˆ° <code>Father</code>  å’Œ <code>Son</code>  åˆ° <code>Mother</code>  è·ç¦»æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">aa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A's aa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">C</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">aa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C's aa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">D</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">C</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä» <code>D</code>  æ‰¾ <code>aa</code>  æ–¹æ³•ï¼Œä» <code>D</code>  åˆ° <code>C</code>  æ˜¯æœ€çŸ­çš„ã€‚</p>\n<h1 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h1>\n<p>é»˜è®¤æ–¹æ³•ç»™äºˆæˆ‘ä»¬ä¿®æ”¹æ¥å£è€Œä¸ç ´ååŸæ¥çš„å®ç°ç±»çš„ç»“æ„æä¾›äº†ä¾¿åˆ©ï¼Œç›®å‰ java 8 çš„é›†åˆæ¡†æ¶å·²ç»å¤§é‡ä½¿ç”¨äº†é»˜è®¤æ–¹æ³•æ¥æ”¹è¿›äº†ï¼Œå½“æˆ‘ä»¬æœ€ç»ˆå¼€å§‹ä½¿ç”¨ Java 8 çš„ lambdas è¡¨è¾¾å¼æ—¶ï¼Œæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªå¹³æ»‘çš„è¿‡æ¸¡ä½“éªŒã€‚ä¹Ÿè®¸å°†æ¥æˆ‘ä»¬ä¼šåœ¨ API è®¾è®¡ä¸­çœ‹åˆ°æ›´å¤šçš„é»˜è®¤æ–¹æ³•çš„åº”ç”¨ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC1kZWZhdWx0Lmh0bWwj\">https://pdai.tech/md/java/java8/java8-default.html#</span></p>\n<p>èŠèŠ java ä¸­çš„å¤šç»§æ‰¿ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9hcnRpY2xlLzkxMTUxMA==\">https://developer.aliyun.com/article/911510</span></p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/18/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A72-Optional%E7%B1%BB/",
            "url": "https://cecilia.cool/2022/08/18/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A72-Optional%E7%B1%BB/",
            "title": "Java8æ–°ç‰¹æ€§(2)--Optionalç±»",
            "date_published": "2022-08-18T15:40:58.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>Optional</code>  ç±»çš„å¼•å…¥å¾ˆå¥½çš„è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ä¸º <code>null</code>  çš„å®¹å™¨å¯¹è±¡ï¼Œ <code>Optional</code>  æœ¬èº«æ²¡æœ‰å¼•å…¥æ–°æŠ€æœ¯ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œå¯¹è±¡çš„åŒ…è£…ç±»ï¼Œé€šè¿‡å°†å¯¹è±¡å°è£…åœ¨ <code>Optional</code>  ä¸­ï¼Œå¯ä»¥çœå»å¤§é‡ç©ºæŒ‡é’ˆæ£€æŸ¥ã€‚</p>\n<p>ç›¸å…³çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿé˜…è¯»<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9qYXZhL2phdmE4LW9wdGlvbmFsLWNsYXNzLmh0bWw=\">èœé¸Ÿæ•™ç¨‹</span>ã€‚è¿™é‡Œå¤§è‡´æä¸€äº›ç›¸å…³çš„è¡Œä¸ºï¼š</p>\n<ul>\n<li>è·å– <code>Optional</code>  é‡Œçš„å€¼ï¼Œå¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œè¿”å›é»˜è®¤å€¼ï¼ˆå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼Œæœ‰ç‚¹åƒ <code>HashMap</code>  ä¸­çš„ <code>getOrDefault</code> ï¼‰</li>\n<li>æ£€æµ‹ <code>Optional</code>  é‡Œçš„å€¼ï¼Œï¼ˆ <code>ifPresent</code>  æ–¹æ³•æ¥æ”¶ <code>Consumer</code>  æ¥å£ï¼Œæ¥å¯¹å€¼è¿›è¡Œæ“ä½œï¼‰</li>\n<li>æ„é€ å™¨ç§æœ‰ï¼Œé€šè¿‡å…¶ä»–æ–¹æ³•ï¼ˆé™æ€ï¼‰æ£€æµ‹è¦æ„é€ å¯¹è±¡æ‰€ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦ä¸º <code>null</code> ï¼Œæ¥é€‰æ‹©è°ƒç”¨æ„é€ å™¨ã€‚</li>\n</ul>\n<h1 id=\"å…¥é—¨\"><a class=\"anchor\" href=\"#å…¥é—¨\">#</a> å…¥é—¨</h1>\n<p>ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªäººå¯èƒ½æœ‰è½¦ä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆ  <code>Person</code>  ç±»å†…éƒ¨  <code>car</code>  å˜é‡å°±ä¸åº”è¯¥å£°æ˜ä¸º  <code>Car</code> ï¼Œå½“å˜é‡å­˜åœ¨æ—¶ï¼Œ <code>Optional</code>  ç±»åªæ˜¯å¯¹  <code>Car</code>  çš„ç®€å•å°è£…ã€‚å˜é‡ä¸å­˜åœ¨æ—¶ï¼Œä¼šä½¿ç”¨  <code>Optional.empty()</code>  æ–¹æ³•è¿”å›ç©ºçš„  <code>Optional</code>  å¯¹è±¡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/19/496146745a92782a.png\" alt=\"image-20220819112640846\" /></p>\n<p>ä½†æ˜¯  <code>null</code>  å¼•ç”¨å’Œ  <code>Optional.empty()</code>  æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ï¼Ÿä»è¯­ä¹‰ä¸Šï¼Œå®ƒä»¬å¯ä»¥å½“æˆä¸€å›äº‹å„¿ï¼Œä½†å®é™…ä¸Šå·®åˆ«éå¸¸å¤§ï¼šå¦‚æœå°è¯•è§£å¼•ç”¨ä¸€ä¸ª  <code>null</code> ï¼Œä¸€å®šä¼šè§¦å‘  <code>NullPointerException</code> ï¼Œä¸è¿‡ä½¿ç”¨  <code>Optional.empty()</code>  æ˜¯ä¸€ä¸ªæœ‰æ•ˆå¯¹è±¡ã€‚</p>\n<h1 id=\"åˆ›å»ºå¯¹è±¡\"><a class=\"anchor\" href=\"#åˆ›å»ºå¯¹è±¡\">#</a> åˆ›å»ºå¯¹è±¡</h1>\n<p>è¿™é‡Œæœ‰ <code>empty(),of(),ofNullable()</code>  ä¸‰ä¸ªé™æ€æ–¹æ³•ï¼Œéƒ½å¯ä»¥ç”¨æ¥åˆ›å»º <code>Optional</code>  å¯¹è±¡ï¼Œå†æ¬¡å¼ºè°ƒï¼Œ <code>Optional</code>  çš„æ„é€ å™¨æ˜¯ç§æœ‰çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token constant\">EMPTY</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">ofNullable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> value <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œè¦è¯´æ˜çš„æ˜¯ï¼Œ <code>Optional</code>  æœ‰ä¸€ä¸ª <code>EMPTY</code>  çš„é™æ€å±æ€§ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token constant\">EMPTY</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>Optional</code>  æ˜¯ä¸å¯¹å¤–æä¾›å¯¹ <code>value==null</code>  æ—¶ä¿®æ”¹ <code>value</code>  çš„æ–¹æ³•çš„ï¼Œå› ä¸º <code>ifPresent</code>  ä¼šè¿›è¡Œ <code>null</code>  å€¼æ£€æµ‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ifPresent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Consumer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> consumer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            consumer<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸€ä¸ªç©ºçš„ <code>Optional</code>  å°±æ°¸è¿œä¸ä¼šè¢«åŠ å…¥æ–°çš„å€¼ï¼ˆå› ä¸ºæ— æ³•ä¿®æ”¹ï¼‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæ‰€æœ‰çš„ç©ºçš„ <code>Optional</code>  éƒ½å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç©ºçš„ <code>Optional</code> ï¼Œè¿™å°±æ˜¯ <code>EMPTY</code> ã€‚</p>\n<h1 id=\"å…¶ä»–æ–¹æ³•\"><a class=\"anchor\" href=\"#å…¶ä»–æ–¹æ³•\">#</a> å…¶ä»–æ–¹æ³•</h1>\n<h2 id=\"map\"><a class=\"anchor\" href=\"#map\">#</a> map</h2>\n<p>æºç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">U</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">U</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">U</span><span class=\"token punctuation\">></span></span> mapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofNullable</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®ƒå’Œ <code>ifPresent</code>  çš„åŒºåˆ«åœ¨äºï¼Œ <code>map</code>  æ¥æ”¶çš„æ—¶ <code>Function</code>  æ¥å£ï¼Œå­˜åœ¨è¿”å›å€¼ï¼Œ <code>map</code>  ä¼šå°† <code>apply</code>  çš„è¿”å›å€¼å°è£…åœ¨ä¸€ä¸ªæ–°çš„ <code>Optional</code>  ä¸­ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//map æ–¹æ³•æ‰§è¡Œä¼ å…¥çš„ lambda è¡¨è¾¾å¼å‚æ•°å¯¹ Optional å®ä¾‹çš„å€¼è¿›è¡Œä¿®æ”¹ã€‚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// ä¸º lambda è¡¨è¾¾å¼çš„è¿”å›å€¼åˆ›å»ºæ–°çš„ Optional å®ä¾‹ä½œä¸º map æ–¹æ³•çš„è¿”å›å€¼ã€‚</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> name <span class=\"token operator\">=</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> upperName <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> value<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>upperName<span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No value found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// è¾“å‡ºï¼šABC</span></pre></td></tr></table></figure><h2 id=\"flatmap\"><a class=\"anchor\" href=\"#flatmap\">#</a> flatMap</h2>\n<p>æºç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">U</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">U</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">U</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> mapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>mapper<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå’Œ <code>map</code>  çš„å·®åˆ«å°±æ˜¯è¿”å›è¯­å¥ï¼Œ <code>flatmap</code>  åªæ˜¯å¯¹ <code>apply</code>  å‡½æ•°è¿”å›å€¼è¿›è¡Œç©ºå€¼åˆ¤æ–­ï¼Œè€Œä¸å°†å®ƒå°è£…åœ¨ <code>Optional</code>  ä¸­ã€‚ä½†æ˜¯ï¼Œä»å‡½æ•°å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼Œ <code>flatMap</code>  å…¶å®è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª <code>Optional</code> ï¼Œæ‰€ä»¥ <code>mapper.apply</code>  å¿…é¡»è¿”å› <code>Optional</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>upperName <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>upperName<span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No value found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è¾“å‡º SANAULLA</span></pre></td></tr></table></figure><h2 id=\"fliter\"><a class=\"anchor\" href=\"#fliter\">#</a> fliter</h2>\n<p><code>filter</code>  æ–¹æ³•é€šè¿‡ä¼ å…¥é™å®šæ¡ä»¶å¯¹ <code>Optional</code>  å®ä¾‹çš„å€¼è¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœæœ‰å€¼å¹¶ä¸”æ»¡è¶³æ–­è¨€æ¡ä»¶è¿”å›åŒ…å«è¯¥å€¼çš„ <code>Optional</code> ï¼Œå¦åˆ™è¿”å›ç©º <code>Optional</code> ã€‚è¦åŠ å…¥åˆ¤å®šæ¡ä»¶ï¼Œä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œ <code>fliter</code>  åº”è¯¥å®ç° <code>Predicate</code>  æ¥å£ï¼ˆæ–­å®šå‹æ¥å£ï¼‰ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> predicate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>predicate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¦‚æœä¸ºç©º</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> predicate<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span> <span class=\"token operator\">:</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9qYXZhL2phdmE4LW9wdGlvbmFsLWNsYXNzLmh0bWw=\">https://www.runoob.com/java/java8-optional-class.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC1vcHRpb25hbC5odG1s\">https://pdai.tech/md/java/java8/java8-optional.html</span></p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/17/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A71-%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B/",
            "url": "https://cecilia.cool/2022/08/17/Java/Java8/Java8%E6%96%B0%E7%89%B9%E6%80%A71-%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B/",
            "title": "Java8æ–°ç‰¹æ€§(1)--å‡½æ•°ç¼–ç¨‹",
            "date_published": "2022-08-17T14:12:34.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>Lambda</code>  å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼ˆå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ï¼‰ã€‚ä½¿ç”¨  <code>Lambda</code>  è¡¨è¾¾å¼å¯ä»¥ä½¿ä»£ç å˜çš„æ›´åŠ ç®€æ´ç´§å‡‘ã€‚</p>\n<p>ä»¥ä¸‹æ˜¯ lambda è¡¨è¾¾å¼çš„é‡è¦ç‰¹å¾:</p>\n<ul>\n<li>** å¯é€‰ç±»å‹å£°æ˜ï¼š** ä¸éœ€è¦å£°æ˜å‚æ•°ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ç»Ÿä¸€è¯†åˆ«å‚æ•°å€¼ã€‚</li>\n<li>** å¯é€‰çš„å‚æ•°åœ†æ‹¬å·ï¼š** ä¸€ä¸ªå‚æ•°æ— éœ€å®šä¹‰åœ†æ‹¬å·ï¼Œä½†å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰åœ†æ‹¬å·ã€‚</li>\n<li>** å¯é€‰çš„å¤§æ‹¬å·ï¼š** å¦‚æœä¸»ä½“åŒ…å«äº†ä¸€ä¸ªè¯­å¥ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å·ã€‚</li>\n<li>** å¯é€‰çš„è¿”å›å…³é”®å­—ï¼š** å¦‚æœä¸»ä½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼è¿”å›å€¼åˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿”å›å€¼ï¼Œå¤§æ‹¬å·éœ€è¦æŒ‡å®šè¡¨è¾¾å¼è¿”å›äº†ä¸€ä¸ªæ•°å€¼ã€‚</li>\n</ul>\n<p>å…·ä½“ä»£ç ä¸º</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1. ä¸éœ€è¦å‚æ•°ï¼Œè¿”å›å€¼ä¸º 5  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token number\">5</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 2. æ¥æ”¶ä¸€ä¸ªå‚æ•° (æ•°å­—ç±»å‹), è¿”å›å…¶ 2 å€çš„å€¼  </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>x <span class=\"token operator\">-></span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> x  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 3. æ¥å— 2 ä¸ªå‚æ•° (æ•°å­—), å¹¶è¿”å›ä»–ä»¬çš„å·®å€¼  </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> x â€“ y  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 4. æ¥æ”¶ 2 ä¸ª int å‹æ•´æ•°ï¼Œè¿”å›ä»–ä»¬çš„å’Œ  </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> y<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> x <span class=\"token operator\">+</span> y  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 5. æ¥å—ä¸€ä¸ª string å¯¹è±¡ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°ï¼Œä¸è¿”å›ä»»ä½•å€¼ (çœ‹èµ·æ¥åƒæ˜¯è¿”å› void)  </span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><blockquote>\n<p>é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å¯¹æ•°æ®è¿›è¡ŒæŠ½è±¡ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯å¯¹è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ã€‚ç°å®ä¸–ç•Œä¸­ï¼Œæ•°æ®å’Œè¡Œä¸ºå¹¶å­˜ï¼Œç¨‹åºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› æ­¤è¿™ä¸¤ç§ç¼–ç¨‹æ–¹å¼æˆ‘ä»¬éƒ½å¾—å­¦ã€‚</p>\n</blockquote>\n<h1 id=\"ä¸»è¦å†…å®¹\"><a class=\"anchor\" href=\"#ä¸»è¦å†…å®¹\">#</a> ä¸»è¦å†…å®¹</h1>\n<h2 id=\"å˜é‡ä½œç”¨åŸŸ\"><a class=\"anchor\" href=\"#å˜é‡ä½œç”¨åŸŸ\">#</a> å˜é‡ä½œç”¨åŸŸ</h2>\n<p><code>Lambda</code>  ä½¿ç”¨çš„å˜é‡ï¼Œå¿…é¡»è¢« <code>final</code>  ä¿®é¥°æˆ–è€…å«æœ‰éšæ€§ <code>final</code> ã€‚åŒæ ·çš„ï¼Œå˜é‡åœ¨ <code>Lambda</code>  è¡¨è¾¾å¼ä¸­ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// n = 9;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Runnable</span> r <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// n = 9;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//n æ—¢ä¸èƒ½åœ¨è¡¨è¾¾å¼ä¸­è¢«ä¿®æ”¹ï¼Œä¹Ÿä¸èƒ½åœ¨ Lambda è¡¨è¾¾å¼ä¹‹å¤–è¢«ä¿®æ”¹ã€‚</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// æ€»ä¹‹ï¼Œn æ˜¯ä¸å¯ä¿®æ”¹çš„</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ–¹æ³•å¼•ç”¨\"><a class=\"anchor\" href=\"#æ–¹æ³•å¼•ç”¨\">#</a> æ–¹æ³•å¼•ç”¨</h2>\n<p>æ–¹æ³•å¼•ç”¨çš„å¯ä»¥ç®€åŒ– <code>Lambda</code>  è¡¨è¾¾å¼ï¼Œä½†æ˜¯åœ¨æ–¹æ³•å¼•ç”¨ä¸­ä¸èƒ½æœ‰ä»»ä½•å‚æ•°ä¿®æ”¹</p>\n<p>æ„é€ å¼•ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Student</span> s <span class=\"token operator\">=</span> <span class=\"token class-name\">Student</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span></pre></td></tr></table></figure><p>å¯¹è±¡ **:ğŸ˜—* å®ä¾‹æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// public void forEach(Consumer&lt;? super E> action) </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//forEach éœ€è¦é‡å†™ Consumer çš„ accept æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>list<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>list<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token operator\">::</span><span class=\"token function\">println</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>list<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span> <span class=\"token operator\">+</span> s <span class=\"token operator\">+</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç±»å **:ğŸ˜—* é™æ€æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Stream</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Double</span><span class=\"token punctuation\">></span></span> stream <span class=\"token operator\">=</span> <span class=\"token class-name\">Stream</span><span class=\"token punctuation\">.</span><span class=\"token function\">generate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token operator\">::</span><span class=\"token function\">random</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç±»å **:ğŸ˜—* å®ä¾‹æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*  è¿™é‡Œå¦‚æœä½¿ç”¨ç¬¬ä¸€å¥è¯ï¼Œç¼–è¯‘å™¨ä¼šæœ‰æç¤º: Can be replaced with Comparator.naturalOrderï¼Œè¿™å¥è¯å‘Šè¯‰æˆ‘ä»¬</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  String å·²ç»é‡å†™äº† compareTo () æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå†™æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Œæ˜¯å› ä¸ºä¸ºäº†ä½“ç°ä¸‹é¢</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  è¿™å¥ç¼–è¯‘å™¨çš„æç¤º: Lambda can be replaced with method referenceã€‚å¥½äº†ï¼Œä¸‹é¢çš„è¿™å¥å°±æ˜¯æ”¹å†™æˆæ–¹æ³•å¼•ç”¨ä¹‹å: </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//  TreeSet&lt;String> set = new TreeSet&lt;>((s1,s2) -> s1.compareTo(s2));</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">TreeSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> set <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TreeSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token operator\">::</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"æ³¨è§£-functioninterface\"><a class=\"anchor\" href=\"#æ³¨è§£-functioninterface\">#</a> æ³¨è§£ @FunctionInterface</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Documented</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">FunctionalInterface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥æ³¨è§£åªèƒ½ä¿®é¥°æ¥å£ã€‚è¢« <code>FunctionalInterface</code>  æ³¨è§£ä¿®é¥°çš„æ¥å£ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¢«å®ç°çš„æ–¹æ³•å¿…é¡»è¢«<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNDg4MTEz\"> defalut</span> ä¿®é¥°ã€‚</p>\n<p>å¦‚æœå£°æ˜çš„æ–¹æ³•å’Œ <code>java.lang.Object</code>  ä¸­çš„æŸä¸ªæ–¹æ³•ä¸€æ ·ï¼Œå®ƒå¯ä»¥ä¸å½“åšæœªå®ç°çš„æ–¹æ³•ï¼Œä¸è¿èƒŒè¿™ä¸ªåŸåˆ™:ï¼šä¸€ä¸ªè¢«å®ƒæ³¨è§£çš„æ¥å£åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚</p>\n<p>æ¯”å¦‚ <code>java public interface Comparator&lt;T&gt; &#123; int compare(T o1, T o2); boolean equals(Object obj); &#125;</code> ã€‚</p>\n<p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æŠŠæ»¡è¶³ <code>function interface</code>  è¦æ±‚çš„æ¥å£è‡ªåŠ¨è¯†åˆ«ä¸º <code>function interface</code> ï¼Œæ‰€ä»¥ä½ æ‰ä¸éœ€è¦å¯¹ä¸Šé¢ç¤ºä¾‹ä¸­çš„ ITest æ¥å£å¢åŠ  <code>@FunctionInterface</code>  æ³¨è§£ã€‚</p>\n<h2 id=\"å†…ç½®å››å¤§å‡½æ•°æ¥å£\"><a class=\"anchor\" href=\"#å†…ç½®å››å¤§å‡½æ•°æ¥å£\">#</a> å†…ç½®å››å¤§å‡½æ•°æ¥å£</h2>\n<ul>\n<li>æ¶ˆè´¹å‹æ¥å£ï¼š <code>Consumer&lt; T&gt; void accept(T t)</code> ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Consumer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Person</span><span class=\"token punctuation\">></span></span> greeter <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, \"</span> <span class=\"token operator\">+</span> p<span class=\"token punctuation\">.</span>firstName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>greeter<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Luke\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Skywalker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>ä¾›ç»™å‹æ¥å£ï¼š <code>Supplier &lt; T&gt; T get()</code> ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Supplier</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Person</span><span class=\"token punctuation\">></span></span> personSupplier <span class=\"token operator\">=</span> <span class=\"token class-name\">Person</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>personSupplier<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// new Person</span></pre></td></tr></table></figure><ul>\n<li>æ–­å®šå‹æ¥å£ï¼š <code> Predicate&lt;T&gt; boolean test(T t)</code> ã€‚è¿”å›å€¼ç±»å‹æ˜¯å›ºå®šçš„ <code>boolean</code> ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redicate<span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> predicate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> s<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>predicate<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">// true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> isEmpty <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token operator\">::</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>å‡½æ•°å‹æ¥å£ï¼š <code>Function&lt;T,R&gt; R apply(T t)</code> ï¼Œæœ‰å‚æœ‰è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> toInteger <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token operator\">::</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9qYXZhL2phdmE4LWxhbWJkYS1leHByZXNzaW9ucy5odG1s\">https://www.runoob.com/java/java8-lambda-expressions.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS9qYXZhOC9qYXZhOC1zdHJlYW0uaHRtbA==\">https://pdai.tech/md/java/java8/java8-stream.html</span></p>\n</blockquote>\n",
            "tags": [
                "Java8"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/17/Java/%E5%B9%B6%E5%8F%91/JUC_locks4-Reentrantlock/",
            "url": "https://cecilia.cool/2022/08/17/Java/%E5%B9%B6%E5%8F%91/JUC_locks4-Reentrantlock/",
            "title": "J.U.C.locks(4)--Reentrantlock",
            "date_published": "2022-08-17T05:33:43.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¹‹åä»‹ç»çš„å·¥å…·ç±»å¾ˆå¤šéƒ½æ˜¯åŸºäº <code>AQS</code>  å®ç°çš„ï¼Œæ‰€ä»¥å…³äº <code>AQS</code>  çš„ä¸¤ç¯‡æ–‡ç« è¯·åŠ¡å¿…å…ˆçœ‹å®Œï¼šAQS ä¸Šï¼ŒAQS ä¸‹ã€‚</p>\n<p><code>Reentrantlock</code>  æ˜¯å¯é‡å…¥é”ï¼Œå†…éƒ¨å®ç°äº†å…¬å¹³é”ï¼Œä¹Ÿå®ç°äº†éå…¬å¹³é”ã€‚åœ¨çœ‹ä¸‹é¢çš„å†…å®¹æ—¶ï¼Œå¯ä»¥å¸¦ç€ä¸‹é¢çš„é—®é¢˜æ€è€ƒï¼š</p>\n<ul>\n<li>\n<p>ä»€ä¹ˆæ˜¯å¯é‡å…¥ï¼Œä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿå®ƒç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>\n</li>\n<li>\n<p><code>ReentrantLock</code>  çš„æ ¸å¿ƒæ˜¯ <code>AQS</code> ï¼Œé‚£ä¹ˆå®ƒæ€ä¹ˆæ¥å®ç°çš„ï¼Œç»§æ‰¿å—ï¼Ÿè¯´è¯´å…¶ç±»å†…éƒ¨ç»“æ„å…³ç³»ã€‚</p>\n</li>\n<li>\n<p><code>ReentrantLock</code>  æ˜¯å¦‚ä½•å®ç°å…¬å¹³é”çš„ï¼Ÿ</p>\n</li>\n<li>\n<p><code>ReentrantLock</code>  æ˜¯å¦‚ä½•å®ç°éå…¬å¹³é”çš„ï¼Ÿ</p>\n</li>\n<li>\n<p><code>ReentrantLock</code>  é»˜è®¤å®ç°çš„æ˜¯å…¬å¹³è¿˜æ˜¯éå…¬å¹³é”ï¼Ÿ</p>\n</li>\n<li>\n<p>ä½¿ç”¨ <code>ReentrantLock</code>  å®ç°å…¬å¹³å’Œéå…¬å¹³é”çš„ç¤ºä¾‹ï¼Ÿ</p>\n</li>\n<li>\n<p><code>ReentrantLock</code>  å’Œ <code>Synchronized</code>  çš„å¯¹æ¯”ï¼Ÿ</p>\n</li>\n</ul>\n<h1 id=\"å†…éƒ¨ç±»\"><a class=\"anchor\" href=\"#å†…éƒ¨ç±»\">#</a> å†…éƒ¨ç±»</h1>\n<p><code>ReentrantLock</code>  æœ‰ä¸‰ä¸ªå†…éƒ¨ç±»ï¼Œå…·ä½“çœ‹ä¸‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/17/1c541052a7533ea7.png\" alt=\"image-20220817141354041\" /></p>\n<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ <code>ReentrantLock</code>  å®ç°äº†å…¬å¹³ä¸éå…¬å¹³çš„åŒæ­¥å™¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†åˆ†æä¸€ä¸‹æºç </p>\n<h2 id=\"sync\"><a class=\"anchor\" href=\"#sync\">#</a> Sync</h2>\n<p><code>Sync</code>  å®ç°çš„æ˜¯éå…¬å¹³çš„è·å–é” --  <code>nonfairTryAcquire</code> ï¼Œä½†æ˜¯æ— è®ºæ˜¯å…¬å¹³è¿˜æ˜¯éå…¬å¹³ï¼ŒæŸäº›æ–¹æ³•æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ <code>Sync</code>  ç›´æ¥é‡å†™äº† <code>tryRelease</code>  æ–¹æ³•ï¼Œ <code>isHeldExclusively</code>  æ–¹æ³•ï¼Œè€Œå°† <code>tryAcquire</code>  çš„å®ç°ç•™ç»™äº†ä¸¤ä¸ªå­ç±»ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// éå…¬å¹³æ–¹å¼è·å–</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">nonfairTryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> acquires<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Thread</span> current <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è·å–çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// è¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹æ­£åœ¨ç«äº‰è¯¥é”</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> acquires<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// æ¯”è¾ƒå¹¶è®¾ç½®çŠ¶æ€æˆåŠŸï¼ŒçŠ¶æ€ 0 è¡¨ç¤ºé”æ²¡æœ‰è¢«å ç”¨</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®å½“å‰çº¿ç¨‹ç‹¬å </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current <span class=\"token operator\">==</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// å½“å‰çº¿ç¨‹æ‹¥æœ‰è¯¥é”</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">int</span> nextc <span class=\"token operator\">=</span> c <span class=\"token operator\">+</span> acquires<span class=\"token punctuation\">;</span> <span class=\"token comment\">// å¢åŠ é‡å…¥æ¬¡æ•°</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// overflow</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Maximum lock count exceeded\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½®çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>nextc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// å¤±è´¥</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœä½ å¾ˆç»†å¿ƒï¼Œåº”è¯¥å‘ç°äº†ä¸Šé¢çš„ä»£ç å’Œæˆ‘ä»¬åœ¨ AQS ä¸Šå®ç°çš„è‡ªå®šä¹‰åŒæ­¥å™¨çš„ <code>tryAcquire</code>  å¾ˆç›¸ä¼¼ã€‚å°±æ˜¯åŸºæœ¬çš„è·å–é”æˆ–è€…é‡å…¥é”ç„¶åæ”¹å˜ <code>state</code>  çš„çŠ¶æ€ã€‚</p>\n<p>å¯¹äº <code>tryRelease</code>  å’Œ <code>isHeldExclusively</code>  ç­‰æ–¹æ³•ï¼Œå°±ä¸å†èµ˜è¿°ã€‚</p>\n<p><code>Sync</code>  ç±»å­˜åœ¨å¦‚ä¸‹æ–¹æ³•å’Œä½œç”¨å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/17/3fc03d7a89136ab2.png\" alt=\"image-20220817140901105\" /></p>\n<h1 id=\"nonfairsync\"><a class=\"anchor\" href=\"#nonfairsync\">#</a> NonfairSync</h1>\n<p><code>NonfairSync</code>  ç±»ç»§æ‰¿äº† <code>Sync</code>  ç±»ï¼Œè¡¨ç¤ºé‡‡ç”¨éå…¬å¹³ç­–ç•¥è·å–é”ï¼Œå…¶å®ç°äº† <code>Sync</code>  ç±»ä¸­æŠ½è±¡çš„ <code>lock</code>  æ–¹æ³•ï¼Œæºç å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// éå…¬å¹³é”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NonfairSync</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Sync</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// ç‰ˆæœ¬å·</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token number\">7316153563782823691L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// è·å¾—é”</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ¯”è¾ƒå¹¶è®¾ç½®çŠ¶æ€æˆåŠŸï¼ŒçŠ¶æ€ 0 è¡¨ç¤ºé”æ²¡æœ‰è¢«å ç”¨</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// æŠŠå½“å‰çº¿ç¨‹è®¾ç½®ç‹¬å äº†é”</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token comment\">// é”å·²ç»è¢«å ç”¨ï¼Œæˆ–è€… set å¤±è´¥</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">// ä»¥ç‹¬å æ¨¡å¼è·å–å¯¹è±¡ï¼Œå¿½ç•¥ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> acquires<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">nonfairTryAcquire</span><span class=\"token punctuation\">(</span>acquires<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œæä¸€ä¸‹ï¼Œ <code>unlock</code>  æ˜¯ç”± <code>ReentrantLock</code>  å®ç°çš„ã€‚ä» <code>lock</code>  æ–¹æ³•çš„æºç å¯çŸ¥ï¼Œ<strong>æ¯ä¸€æ¬¡éƒ½å°è¯•è·å–é”</strong>ï¼Œè€Œå¹¶ä¸ä¼šæŒ‰ç…§å…¬å¹³ç­‰å¾…çš„åŸåˆ™è¿›è¡Œç­‰å¾…ï¼Œè®©ç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹è·å¾—é”ã€‚</p>\n<h1 id=\"fairsync\"><a class=\"anchor\" href=\"#fairsync\">#</a> FairSync</h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å…¬å¹³é”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FairSync</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Sync</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// ç‰ˆæœ¬åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">3000897897090466540L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// ä»¥ç‹¬å æ¨¡å¼è·å–å¯¹è±¡ï¼Œå¿½ç•¥ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// å°è¯•å…¬å¹³è·å–é”</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> acquires<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">Thread</span> current <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// è·å–çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// çŠ¶æ€ä¸º 0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">hasQueuedPredecessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> acquires<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// ä¸å­˜åœ¨å·²ç»ç­‰å¾…æ›´ä¹…çš„çº¿ç¨‹å¹¶ä¸”æ¯”è¾ƒå¹¶ä¸”è®¾ç½®çŠ¶æ€æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®å½“å‰çº¿ç¨‹ç‹¬å </span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current <span class=\"token operator\">==</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// çŠ¶æ€ä¸ä¸º 0ï¼Œå³èµ„æºå·²ç»è¢«çº¿ç¨‹å æ®</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// ä¸‹ä¸€ä¸ªçŠ¶æ€</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">int</span> nextc <span class=\"token operator\">=</span> c <span class=\"token operator\">+</span> acquires<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è¶…è¿‡äº† int çš„è¡¨ç¤ºèŒƒå›´</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Maximum lock count exceeded\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>nextc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¬å¹³è·å–é”ä¸­ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å¯ä»¥æ‹¿åˆ°é”ï¼Œå®ƒä¼šæ£€æµ‹åœ¨é˜»å¡é˜Ÿåˆ—ä¸­æ˜¯æœ‰èŠ‚ç‚¹ç­‰å¾…å¾—æ›´ä¹…ï¼Œè€Œä¸ä¼šè¶Šè¿‡è¿™äº›ç­‰å¾…å¾—æ›´ä¹…çš„èŠ‚ç‚¹è‡ªå·±å»è·å–èŠ‚ç‚¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">hasQueuedPredecessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> acquires<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>è€Œéå…¬å¹³èŠ‚ç‚¹å°±æ˜¯ç›´æ¥å°è¯•è·å–é”èµ„æº</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> acquires<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>åœ¨å…¬å¹³ä¸éå…¬å¹³ï¼Œä¹Ÿä½“ç°åœ¨ <code>lock</code>  ä¸Šï¼Œå¦‚æœæ˜¯å…¬å¹³é”ï¼Œæ˜¯ä¸èƒ½ç›´æ¥å°±å»å°è¯• <code>CAS</code>  æ›¿æ¢ï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸­å¯èƒ½æœ‰ç­‰å¾…æ›´ä¹…çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>tryAcquire</code>  ä¸­åˆ¤æ–­ä¸€ä¸‹ï¼Œè€Œéå…¬å¹³é”æ˜¯ç›´æ¥å¯ä»¥åœ¨ <code>lock</code>  ä¸­å…ˆ <code>CAS</code>  æ›¿æ¢ä¸€ä¸‹ï¼Œä¸ç”¨è€ƒè™‘æ˜¯å¦é˜»å¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…æ›´ä¹…çš„èŠ‚ç‚¹ã€‚</p>\n<h1 id=\"å…¬å¹³æ€§çš„è¯¦è§£\"><a class=\"anchor\" href=\"#å…¬å¹³æ€§çš„è¯¦è§£\">#</a> å…¬å¹³æ€§çš„è¯¦è§£</h1>\n<p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œ <code>AQS</code>  çš„åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸¥æ ¼å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼ˆé™¤éä¸€ä¸ªèŠ‚ç‚¹è¢«è®¾ä¸º <code>CANCLLED</code> ï¼Œç„¶åè¢«åˆ é™¤ï¼‰ï¼Œå¦åˆ™ä¸€å®šæ˜¯é˜Ÿé¦–çš„èŠ‚ç‚¹å…ˆå‡ºå»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ** å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è¿›å…¥äº†é˜Ÿåˆ—ï¼Œåœ¨ <code>AQS</code>  çš„æœºåˆ¶ä¸‹ï¼Œå®ƒä¸å¯èƒ½æ¯”é˜Ÿé¦–èŠ‚ç‚¹å…ˆè·å–é”èµ„æºã€‚** æ‰€ä»¥ <code>ReentrantLock</code>  å®ç°çš„éå…¬å¹³é”ï¼Œä¸æ˜¯è¯´é˜»å¡é˜Ÿåˆ—ä¸­çš„åé¢çš„èŠ‚ç‚¹å¯ä»¥æ¯”é˜Ÿé¦–èŠ‚ç‚¹å…ˆè·å–èµ„æºï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</p>\n<p>è¯·ä¸€å®šè¦è®°ä½ï¼Œ <code>AQS</code>  é‡Œé¢çš„å…ˆè¿›å…ˆå‡ºçš„åŒæ­¥é˜Ÿåˆ—æ˜¯è°ƒåº¦ç­–ç•¥ï¼Œé€šè¿‡ç»´æŠ¤å…ˆè¿›å…ˆå‡ºçš„åŒæ­¥é˜Ÿåˆ—å®ç°å…¬å¹³çš„è°ƒåº¦ï¼Œï¼Œè¿™æ˜¯ä¸èƒ½è¢«å­ç±»æ”¹å˜çš„ã€‚è€Œæ‰€è°“çš„å…¬å¹³çš„è·å–é”ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªçº¿ç¨‹ <code>t</code>  åˆšè¢«åˆ›å»ºå¹¶æƒ³è¦è·å–èµ„æºï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—ä¸­å­˜åœ¨èŠ‚ç‚¹ï¼ˆä¸æ˜¯æŒ‡ <code>head</code>  é‚£ä¸ªå“‘èŠ‚ç‚¹ï¼‰ï¼Œé‚£ä¹ˆçº¿ç¨‹ <code>t</code>  å°±ä¸èƒ½å»è·å–èµ„æºï¼ˆæ— è®ºè¿™ä¸ªèµ„æºæ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ç‹¬å ï¼‰ï¼Œè€Œæ˜¯éœ€è¦å»åŒæ­¥é˜Ÿåˆ—è¿›è¡Œæ’é˜Ÿã€‚</p>\n<p>ä½†æ˜¯éå…¬å¹³é”ï¼Œå°±æ˜¯çº¿ç¨‹ <code>t</code>  å¯ä»¥ä¸ç”¨æ£€æµ‹åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥å°è¯•å»è·å–ï¼Œå¦‚æœæ²¡æœ‰è·å–æˆåŠŸï¼Œå†å»é˜»å¡é˜Ÿåˆ—æ’é˜Ÿã€‚</p>\n<p>ä¸Šè¿°å®ç°åŸºäºä¸€ä¸ªé‡è¦çš„ <code>AQS</code>  æ–¹æ³•ï¼š <code>hasQueuedPredecessors</code> ã€‚å®ƒä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦å…¥é˜Ÿï¼Œå…¶å®å°±æ˜¯æ£€æµ‹é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰èŠ‚ç‚¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasQueuedPredecessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// è¯»å–å¤´èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Node</span> t <span class=\"token operator\">=</span> tail<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token comment\">// è¯»å–å°¾èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Node</span> h <span class=\"token operator\">=</span> head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//s æ˜¯é¦–èŠ‚ç‚¹ h çš„åç»§èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">Node</span> s<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> h <span class=\"token operator\">!=</span> t <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=</span> h<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> s<span class=\"token punctuation\">.</span>thread <span class=\"token operator\">!=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨è®²è§£æ–¹æ³•ä¹‹å‰ï¼Œå…ˆå›å¿†ä¸€ä¸‹ <code>enq</code>  æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨å…ˆå‡è®¾åŒæ­¥é˜Ÿåˆ—<strong>æ²¡æœ‰è¢«åˆå§‹åŒ–</strong>ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Node</span> <span class=\"token function\">enq</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å‡è®¾çº¿ç¨‹ t æ‰§è¡Œè¯¥æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Node</span> t <span class=\"token operator\">=</span> tail<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// æ­¤æ—¶ tail == head == null</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetHead</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token comment\">// æ­¤æ—¶ tail = null,head = new Node (),head.next = null</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœåœ¨è¯¥ä½ç½®æ–­å¼€ï¼Œç”±çº¿ç¨‹ s æ‰§è¡Œ hasQueuedPredecessors æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token comment\">// è¿”å›çš„æ˜¯ trueï¼Œå› ä¸ºæ­¤æ—¶è™½ç„¶æ²¡æœ‰åˆå§‹åŒ–å®Œï¼Œä½†æ˜¯å·²ç»æœ‰çº¿ç¨‹å‡†å¤‡åŠ å…¥é˜Ÿåˆ—ä¸­äº†</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                tail <span class=\"token operator\">=</span> head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            \t<span class=\"token comment\">// å¦‚æœåœ¨è¯¥ä½ç½®æ–­å¼€ï¼Œç”±çº¿ç¨‹ s æ‰§è¡Œ hasQueuedPredecessors æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            \t<span class=\"token comment\">//h == t è¿”å› falseï¼Œè¡¨ç¤º s çº¿ç¨‹ä¸éœ€è¦åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œç¦»è°±å§ï¼Œæˆ‘çœŸçš„æ— è¯­</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            node<span class=\"token punctuation\">.</span>prev <span class=\"token operator\">=</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetTail</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                t<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">return</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ <code>he == t</code>  çš„æ„æ€å…¶å®æ˜¯ï¼Œ <code>head</code>  æ˜¯å“‘èŠ‚ç‚¹ï¼Œä¸å‚ä¸æ’é˜Ÿï¼Œæ‰€ä»¥æ­¤æ—¶é˜Ÿåˆ—ä¸­å°±æ²¡æœ‰èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦æ’é˜Ÿã€‚å‡ºç°è¿™æ ·çš„æƒ…å†µå¾ˆç®€å•ï¼Œå°±æ˜¯å½“æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å‡ºé˜Ÿä¹‹åï¼ŒåŒæ­¥é˜Ÿåˆ—å°±æ˜¯ <code>head == tail</code> ï¼Œä½†æ˜¯è¿™å¯¼è‡´åœ¨ <code>enq</code>  å‡½æ•°ä¸­å‡ºç°äº†æ¼æ´ï¼Œæˆ‘ä¹Ÿæ²¡æŸ¥åˆ°ç›¸å…³çš„æ–‡çŒ®ï¼Œå¯èƒ½æ˜¯æˆ‘å“ªé‡Œæ²¡å­¦æ‡‚ï¼Œä½†æ˜¯æˆ‘æ˜¯çœŸçš„ä¸ç†è§£ã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1sb2NrLVJlZW50cmFudExvY2suaHRtbCMlRTUlQjglQTYlRTclOUQlODBiYXQlRTUlQTQlQTclRTUlOEUlODIlRTclOUElODQlRTklOUQlQTIlRTglQUYlOTUlRTklOTclQUUlRTklQTIlOTglRTUlOEUlQkIlRTclOTAlODYlRTglQTclQTM=\">Java å…¨æ ˆçŸ¥è¯†ä½“ç³»</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGVlc2Y0NTYvcC81MzgzNjA5Lmh0bWw=\">JDK1.8 æºç åˆ†æä¹‹ ReentrantLock (ä¸‰)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODEwNjMyMi9hcnRpY2xlL2RldGFpbHMvMTA3MTU0OTYx\">AQS-hasQueuedPredecessors () è§£æ</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHVkbi5jb20vbmV3cy82MmQzYzI4Mjg2NGQ1YzczYWNiZTFlODQuaHRtbA==\">AQS ä¹‹ hasQueuedPredecessors æ–¹æ³•æºç åˆ†æ</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/16/Java/%E5%B9%B6%E5%8F%91/JUC_locks3-AQS%E4%B8%8B/",
            "url": "https://cecilia.cool/2022/08/16/Java/%E5%B9%B6%E5%8F%91/JUC_locks3-AQS%E4%B8%8B/",
            "title": "J.U.C.locks(3)--AQSä¸‹",
            "date_published": "2022-08-16T01:46:21.000Z",
            "content_html": "<h1 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼\"><a class=\"anchor\" href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼\">#</a> æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h1>\n<p>åŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰åŒæ­¥å™¨ä¸€èˆ¬çš„æ–¹å¼æ˜¯è¿™æ · (æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨)ã€‚ <code>AQS</code>  åº•å±‚ä½¿ç”¨æ¨¡æ¿æ–¹æ³•ï¼Œä½¿ç”¨è€…ç»§æ‰¿ <code>AbstractQueuedSynchronizer</code>  å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ã€‚(è¿™äº›é‡å†™æ–¹æ³•å¾ˆç®€å•ï¼Œæ— éæ˜¯å¯¹äºå…±äº«èµ„æº <code>state</code>  çš„è·å–å’Œé‡Šæ”¾) å°† AQS ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨å…¶æ¨¡æ¿æ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•ã€‚</p>\n<p>AQS ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨æ—¶éœ€è¦é‡å†™ä¸‹é¢å‡ ä¸ª AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">isHeldExclusively</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ° condition æ‰éœ€è¦å»å®ç°å®ƒã€‚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">tryRelease</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">tryAcquireShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0 è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">tryReleaseShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</span></pre></td></tr></table></figure><p>è¿™äº›æ–¹æ³•çš„å®ç°å¿…é¡»æ˜¯å†…éƒ¨çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”é€šå¸¸åº”è¯¥ç®€çŸ­è€Œä¸æ˜¯é˜»å¡ã€‚AQS ç±»ä¸­çš„å…¶ä»–æ–¹æ³•éƒ½æ˜¯ final ï¼Œæ‰€ä»¥æ— æ³•è¢«å…¶ä»–ç±»ä½¿ç”¨ï¼Œåªæœ‰è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥è¢«å…¶ä»–ç±»ä½¿ç”¨ã€‚å…³äºæ¨¡æ¿æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href=\"https://cecilia.cool/2022/08/07/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/\">è¡Œä¸ºå‹ - æ¨¡æ¿æ–¹æ³•</a>ã€‚</p>\n<h1 id=\"conditionobjectå†…éƒ¨ç±»\"><a class=\"anchor\" href=\"#conditionobjectå†…éƒ¨ç±»\">#</a> ConditionObject å†…éƒ¨ç±»</h1>\n<p><code>ConditionObject</code>  å®ç°äº† <code>Condition</code>  æ¥å£ï¼Œè¯¥æ¥å£åœ¨ <code>j.u.c.lock</code>  åŒ…ä¸‹ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Condition</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸å“åº”ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">awaitUninterruptibly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶é—´ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">long</span> <span class=\"token function\">awaitNanos</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> nanosTimeout<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶é—´ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚æ­¤æ–¹æ³•åœ¨è¡Œä¸ºä¸Šç­‰æ•ˆäº: awaitNanos (unit.toNanos (time)) > 0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> time<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span> unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šæœ€åæœŸé™ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">boolean</span> <span class=\"token function\">awaitUntil</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Date</span> deadline<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚å¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…æ­¤æ¡ä»¶ï¼Œåˆ™é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªå”¤é†’ã€‚åœ¨ä» await è¿”å›ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¿…é¡»é‡æ–°è·å–é”ã€‚</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">signal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚å¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…æ­¤æ¡ä»¶ï¼Œåˆ™å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚åœ¨ä» await è¿”å›ä¹‹å‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¿…é¡»é‡æ–°è·å–é”ã€‚</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">signalAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œ <code>Condition</code>  å®šä¹‰äº†æ¡ä»¶æ“ä½œçš„è§„èŒƒã€‚ç”±äº <code>ConditionObject</code>  æºç æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œå»ºè®®è‡ªå·±å»çœ‹ä¸€ä¸‹æºç ï¼Œä¹‹åä¼šç»“åˆæµç¨‹å›¾è®²è§£å‡ ä¸ªé‡è¦çš„æ–¹æ³•ã€‚</p>\n<h2 id=\"å”¤é†’å‡½æ•°\"><a class=\"anchor\" href=\"#å”¤é†’å‡½æ•°\">#</a> å”¤é†’å‡½æ•°</h2>\n<p>ä¸»è¦æ˜¯ <code>signal</code>  å’Œ <code>signalAll</code> ï¼Œå…ˆçœ‹æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">signal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isHeldExclusively</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// åªæœ‰è·å–é”ï¼Œæ‰èƒ½è°ƒç”¨ signal çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalMonitorStateException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Node</span> first <span class=\"token operator\">=</span> firstWaiter<span class=\"token punctuation\">;</span><span class=\"token comment\">// æ‹¿åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>first <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">doSignal</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å”¤é†’å¤´èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doSignal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> first<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>firstWaiter <span class=\"token operator\">=</span> first<span class=\"token punctuation\">.</span>nextWaiter<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// ç­‰å¾…é˜Ÿåˆ—å¤´èŠ‚ç‚¹å‘ä¸‹ç§»åŠ¨</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            lastWaiter <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        first<span class=\"token punctuation\">.</span>nextWaiter <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// éœ€è¦å”¤é†’çš„èŠ‚ç‚¹ç§»å‡ºç­‰å¾…é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">transferForSignal</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>             <span class=\"token punctuation\">(</span>first <span class=\"token operator\">=</span> firstWaiter<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// æ­¤æ—¶ node å·²ç»ç§»å‡ºç­‰å¾…é˜Ÿåˆ—äº†</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">transferForSignal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// è¿™é‡Œå¦‚æœ node çš„çŠ¶æ€æ˜¯ CANCELLEDï¼Œå°±ä¼šå¤±è´¥ï¼Œnode ä¹Ÿå°±è‡ªç„¶è€Œç„¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œç­‰å¾… GC</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">compareAndSetWaitStatus</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CONDITION</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token comment\">// ä¿®æ”¹æˆåŠŸï¼ŒåŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œè¿”å› node çš„å‰é©±èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token class-name\">Node</span> p <span class=\"token operator\">=</span> <span class=\"token function\">enq</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">int</span> ws <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>waitStatus<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">//ws > 0 æ˜¯ CANCELLED</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">compareAndSetWaitStatus</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SIGNAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">unpark</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/16/57b0196e8d0c797b.png\" alt=\"image-20220816124802107\" /></p>\n<p><code>signalAll</code>  æ˜¯å·®ä¸å¤šçš„ï¼Œåœ¨ <code>doSignalAll</code>  åªä¸è¿‡æ˜¯ä¸æ–­å¾ªç¯ä»è€Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‡½æ•°</p>\n<h2 id=\"ç­‰å¾…å‡½æ•°\"><a class=\"anchor\" href=\"#ç­‰å¾…å‡½æ•°\">#</a> ç­‰å¾…å‡½æ•°</h2>\n<p><code>AQS</code>  ç»´æŠ¤ä¸€ä¸ªå•é“¾è¡¨é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸ºç­‰å¾…é˜Ÿåˆ—ï¼ˆä¹Ÿå«æ¡ä»¶é˜Ÿåˆ—ï¼‰ï¼Œå½“çº¿ç¨‹è°ƒç”¨ <code>await</code>  æ—¶ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ä» <code>Condition</code>  æ¥å£ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§éƒ¨åˆ†å‡½æ•°éƒ½æ˜¯å’Œ <code>await</code>  æœ‰å…³ï¼Œå…ˆçœ‹ä¸€ä¸‹æœ€ç®€å•çš„ <code>await</code> ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InterruptedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Node</span> node <span class=\"token operator\">=</span> <span class=\"token function\">addConditionWaiter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å°†å½“å‰çº¿ç¨‹å°è£…ä¸º nodeï¼ŒåŠ å…¥ Condition é˜Ÿåˆ—ï¼Œæ­¤æ—¶ node çŠ¶æ€ä¸º CODITION</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// å½»åº•é‡Šæ”¾å·²ç»è¢«å½“å‰çº¿ç¨‹å ç”¨çš„åŒæ­¥èµ„æºï¼Œä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼Œè¿”å›åŸæœ¬å æœ‰çš„åŒæ­¥èµ„æºæ•°é‡  </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å¦‚æœçº¿ç¨‹æ²¡æœ‰é”èµ„æºï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶ä¸” node èŠ‚ç‚¹çŠ¶æ€ä¸º CANCELLED</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> savedState <span class=\"token operator\">=</span> <span class=\"token function\">fullyRelease</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">int</span> interruptMode <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     <span class=\"token comment\">// å¦‚æœè¯¥èŠ‚ç‚¹è¿˜ä¸å­˜åœ¨ä¸åŒæ­¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå°±é˜»å¡æ‰è‡ªå·±  </span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  \t <span class=\"token comment\">// è¿™é‡Œè¿™æ ·åˆ¤æ–­çš„åŸå› æ˜¯å› ä¸º signal æ–¹æ³•ä¼šå°†æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç›¸åº”èŠ‚ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isOnSyncQueue</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å®Œæˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—å—ï¼Œé”èµ„æºé‡Šæ”¾ã€‚</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœè¢«å¤–ç•Œ interruptï¼Œå°±ä¼šè¿”å› - 1 æˆ– 1ï¼Œä¼šä¸­æ–­æ ‡è®°æ¸…ç©º</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>interruptMode <span class=\"token operator\">=</span> <span class=\"token function\">checkInterruptWhileWaiting</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">//acquireQueued æ–¹æ³•åªä¼šåœ¨æˆåŠŸè·å–åˆ°åŒæ­¥èµ„æºä¹‹åæ‰ä¼šè¿”å›ï¼Œè¿”å›å°±è¡¨æ˜æˆåŠŸè·å–åˆ°åŒæ­¥èµ„æºï¼Œ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// å¹¶ä¸”è¿”å›å€¼ä¸º true è¡¨æ˜åœ¨å°è¯•è·å–åŒæ­¥èµ„æºçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸­æ–­ï¼Œéœ€è¦æ¢å¤ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">acquireQueued</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> savedState<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> interruptMode <span class=\"token operator\">!=</span> <span class=\"token constant\">THROW_IE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        interruptMode <span class=\"token operator\">=</span> <span class=\"token constant\">REINTERRUPT</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>nextWaiter <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// clean up if cancelled</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token function\">unlinkCancelledWaiters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// æ ¹æ® interruptMode æ˜¯å¦é‡æ–°ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>interruptMode <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token function\">reportInterruptAfterWait</span><span class=\"token punctuation\">(</span>interruptMode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>çœ‹æµç¨‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/16/dea46e6cb133ee9d.png\" alt=\"image-20220816141909290\" /></p>\n<p>å…³äºæ¢å¤ä¸­æ–­çš„æœºåˆ¶ï¼Œ <code>park</code>  æ–¹æ³•è¢«å”¤é†’ä¹‹åï¼Œå‘ç°è¢«ä¸­æ–­è¿‡ ( <code>interruptMode</code>  å°†ä¸ä¸º 0) åˆ™è·³å‡ºå¾ªç¯ ã€‚å¦‚æœè¢«ä¸­æ–­è¿‡ï¼Œè¿™é‡Œä¹Ÿä¼šæ ¹æ®æƒ…å†µè¿”å›å¤„ç†ä¸­æ–­å¼‚å¸¸çš„æ–¹å¼ï¼š</p>\n<ul>\n<li>å¦‚æœä»…ä»…å‘ç”Ÿäº†ä¸­æ–­æ²¡æœ‰å‘é€ signalï¼Œæˆ–è€…ä¸­æ–­å‘ç”Ÿåœ¨ signal ä¹‹å‰ï¼Œåˆ™è¿”å› THROW_IE,</li>\n<li>å¦‚æœä¸­æ–­ä¸ signal åŒæ—¶å‘ç”Ÿæˆ–è€…å‘ç”Ÿåœ¨ signal ä¹‹åï¼Œåˆ™è¿”å› REINTERRUPT</li>\n<li>å¦‚æœæ²¡æœ‰ä¸­æ–­å‘ç”Ÿï¼Œè¯´æ˜ä¸æ˜¯è¢«ä¸­æ–­å”¤é†’ï¼Œé‚£ä¹ˆç»§ç»­åˆ¤æ–­ while æ¡ä»¶ï¼Œæ˜¯å¦å·²ç»å­˜åœ¨äºåŒæ­¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœä¸åœ¨åŒæ­¥ç­‰å¾…é˜Ÿåˆ—åˆ™ç»§ç»­é˜»å¡</li>\n</ul>\n<h1 id=\"å‚è€ƒæ–‡ç« \"><a class=\"anchor\" href=\"#å‚è€ƒæ–‡ç« \">#</a> å‚è€ƒæ–‡ç« </h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdHhtZnovcC8xNDc1NTkyMC5odG1s\">https://www.cnblogs.com/txmfz/p/14755920.html</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/07/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/",
            "url": "https://cecilia.cool/2022/08/07/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95/",
            "title": "è¡Œä¸ºå‹-æ¨¡æ¿æ–¹æ³•",
            "date_published": "2022-08-07T13:48:23.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ–¹å¼ / æ¨¡æ¿ã€‚å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚</p>\n<p>å…³é”®ä»£ç æ¡†æ¶åœ¨æŠ½è±¡ç±»ä¸­å®ç°ï¼Œå…¶ä»–æ­¥éª¤åœ¨å­ç±»å®ç°ã€‚æ¨¡æ¿æ–¹æ³•éœ€è¦åŠ ä¸Š <code>final</code>  é˜²æ­¢è¢«é‡å†™ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå­ç±»è¦é‡å†™çš„ä¸æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œè€Œæ˜¯å­ç±»éœ€è¦é‡å†™çš„æ–¹æ³•ã€‚æŠ½è±¡ç±»å¯ä»¥é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¥è§„å®šä¸€æ•´å¥—è¡Œä¸ºæµç¨‹ï¼Œä½†æ˜¯æµç¨‹ä¸­å„ä¸ªè¡Œä¸ºå¯ä»¥ç”±å­ç±»è‡ªå·±å®ç°ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Game</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">startPlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">endPlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token comment\">// æ¨¡æ¿</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// åˆå§‹åŒ–æ¸¸æˆ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// å¼€å§‹æ¸¸æˆ</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token function\">startPlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token comment\">// ç»“æŸæ¸¸æˆ</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token function\">endPlay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//initialize,startPlay,endPlay æ–¹æ³•å¯ä»¥ç”±å­ç±»é‡å†™</span></pre></td></tr></table></figure><h1 id=\"æ„å›¾\"><a class=\"anchor\" href=\"#æ„å›¾\">#</a> æ„å›¾</h1>\n<p>æ¨¡æ¿æ–¹æ³•å¯ä»¥å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ï¼Œé€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚</p>\n<h1 id=\"ä¸¾ä¾‹\"><a class=\"anchor\" href=\"#ä¸¾ä¾‹\">#</a> ä¸¾ä¾‹</h1>\n<p>æ³¡èŒ¶å’Œæ³¡å’–å•¡éƒ½æœ‰ç±»ä¼¼çš„æµç¨‹ï¼ˆçƒ§æ°´ï¼Œå€’å…¥æ¯ä¸­ï¼‰ï¼Œä½†æ˜¯æŸäº›æ­¥éª¤ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼ˆåŠ è°ƒæ–™ï¼Œbrew-- é…é…¿ï¼Ÿï¼‰ï¼Œè¦æ±‚å¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/07/20a244dbdd6e5c6a.png\" alt=\"image-20220807222733874\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>èœé¸Ÿæ•™ç¨‹ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9kZXNpZ24tcGF0dGVybi90ZW1wbGF0ZS1wYXR0ZXJuLmh0bWw=\">https://www.runoob.com/design-pattern/template-pattern.html</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvZGV2LXNwZWMvcGF0dGVybi8xN190ZW1wbGF0ZS5odG1s\">https://pdai.tech/md/dev-spec/pattern/17_template.html</span></p>\n</blockquote>\n",
            "tags": [
                "è®¾è®¡æ¨¡å¼"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/07/Java/%E5%B9%B6%E5%8F%91/JUC_locks2-AQS%E4%B8%8A/",
            "url": "https://cecilia.cool/2022/08/07/Java/%E5%B9%B6%E5%8F%91/JUC_locks2-AQS%E4%B8%8A/",
            "title": "J.U.C.locks(2)--AQSä¸Š",
            "date_published": "2022-08-07T09:40:57.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>åœ¨ <code>locks</code>  åŒ…ä¸‹æœ‰ä¸€ä¸ªç±»æ˜¯ <code>AbstractQueuedSynchronizer</code> ï¼Œå…¶ç®€å†™å°±æ˜¯ <code>AQS</code> ï¼Œ <code>AQS</code>  æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä½¿ç”¨ <code>AQS</code>  èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ã€‚</p>\n<p><code>AQS</code>  æ˜¯ä¸€ä¸ªæä¾›ç»™ç”¨æˆ·è‡ªå®šä¹‰åŒæ­¥å™¨çš„ç®€å•æ¡†æ¶ã€‚å…¶å†…éƒ¨ä¸¥æ ¼ä½¿ç”¨å…ˆè¿›å…ˆå‡ºçš„é˜»å¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”æ„é€ å‡ºæ¥çš„åŒæ­¥å™¨ä¾èµ–äºä¸€ä¸ª <code>int</code>  ç±»å‹çš„ <code>state</code>  æ¥åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å ç”¨é”ã€‚ <code>AQS</code>  æä¾›ç‹¬å æ¨¡å¼ï¼ˆ <code>exclusive</code> ï¼‰å’Œå…±äº«æ¨¡å¼ï¼ˆ <code>shared</code> ï¼‰ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„åŒæ­¥å™¨ä¸€èˆ¬æ”¯æŒä¸€ç§æ¨¡å¼ï¼Œå½“ç„¶æœ‰äº›åŒæ­¥å™¨ä¸¤ç§ä¹Ÿæ”¯æŒã€‚</p>\n<p><code>AQS</code>  æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æº<strong>ç©ºé—²</strong>ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„<strong>æœºåˆ¶</strong>ï¼Œè¿™ä¸ªæœºåˆ¶ <code>AQS</code>  æ˜¯ç”¨<strong> CLH é˜Ÿåˆ—é”</strong>å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>\n<p>æƒ³è¦å€ŸåŠ© <code>AQS</code>  å®ç°è‡ªå®šä¹‰çš„åŒæ­¥å™¨ï¼Œéœ€è¦ç»§æ‰¿ <code>AQS</code>  ç±»ï¼Œåœ¨æ³¨é‡Šä¸­ï¼Œ <code>AQS</code>  è¯´æ˜å­ç±»åº”è¯¥æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ã€‚</p>\n<blockquote>\n<p>Subclasses should be defined as non-public internal helperclasses that are used to implement the synchr onization properties of their enclosing class.</p>\n</blockquote>\n<p>ç»§æ‰¿ <code>AQS</code>  åï¼Œéœ€è¦é‡å†™å‡ ä¸ªå¿…è¦çš„æ–¹æ³•ï¼Œå®é™…ä¸Šï¼Œå­ç±»ä¹Ÿåªèƒ½é‡å†™è¿™å‡ ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå…¶ä»–æ–¹æ³•éƒ½è¢« <code>final</code>  ä¿®é¥°ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å‰ä¸¤ä¸ªæ˜¯ç‹¬å æ¨¡å¼éœ€è¦é‡å†™çš„æ–¹æ³•    </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryRelease</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">// åä¸¤ä¸ªæ˜¯å…±äº«æ¨¡å¼éœ€è¦é‡å†™çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> <span class=\"token function\">tryAcquireShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryReleaseShared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦åŒæ­¥åªä¸å½“å‰çº¿ç¨‹ä¿æŒä¸€è‡´</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isHeldExclusively</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsupportedOperationException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å®ç°è‡ªå®šä¹‰åŒæ­¥å™¨\"><a class=\"anchor\" href=\"#å®ç°è‡ªå®šä¹‰åŒæ­¥å™¨\">#</a> å®ç°è‡ªå®šä¹‰åŒæ­¥å™¨</h1>\n<p>ç»§æ‰¿ <code>AQS</code>  çš„å­ç±»åº”è¯¥æ˜¯éå…¬æœ‰çš„å†…éƒ¨ç±»ï¼Œå®ç°çš„åŒæ­¥å™¨ä¾èµ– <code>int state</code>  å€¼åˆ¤æ–­å½“å‰é”æ˜¯å¦è¢«å ç”¨ï¼Œè¿™ä¸ª <code>state</code>  å€¼ä»£è¡¨çš„å«ä¹‰ç”±ç”¨æˆ·è‡ªå·±æ¥å†³å®šï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ 0 è¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹å ç”¨é”ï¼Œ1 è¡¨ç¤ºæœ‰ 1 ä¸ªçº¿ç¨‹å ç”¨é”ï¼Œx+1 è¡¨ç¤ºæŸä¸ªçº¿ç¨‹ç¬¬ x æ¬¡é‡å…¥è¿™æŠŠé”ã€‚æ­¤æ¬¡è‡ªå®šä¹‰åŒæ­¥å™¨ä»…æ”¯æŒç‹¬å æ¨¡å¼ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyLock</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Syn</span> syn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>syn <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Syn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Syn</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractQueuedSynchronizer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> acquire<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è·å–å½“å‰ state çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">// å®šä¹‰ state çŠ¶æ€ï¼Œo-- æ²¡æœ‰èµ„æºï¼Œ1-- æœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—èµ„æº</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å¿…é¡»æ­»ç”¨ CASï¼Œå¦‚æœåœ¨ CAS ä¹‹å‰æœ‰å…¶ä»–çº¿ç¨‹æ‹¿åˆ°äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å› false</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// çº¿ç¨‹è·å–é”èµ„æºï¼Œå°†è¯¥çº¿ç¨‹è®¾ä¸ºç‹¬å çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">==</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// é‡å…¥</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">int</span> nextC <span class=\"token operator\">=</span> acquire <span class=\"token operator\">+</span> c<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>nextC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¯¥çº¿ç¨‹ä¸æ˜¯å½“å‰é”çš„ç‹¬å çº¿ç¨‹ï¼Œæ— æ³•è·å¾—é”</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">protected</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryRelease</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">final</span> <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">!=</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalMonitorStateException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> arg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">boolean</span> free <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// å¦‚æœå­˜åœ¨é”é‡å…¥ï¼Œä¹Ÿå°±æ˜¯ state>1ï¼Œé‚£ä¹ˆé”å…¶å®å¹¶æ²¡æœ‰ release</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                free <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">return</span> free<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">showLockThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å½“å‰ç‹¬å é”èµ„æºçš„Thread: \"</span> <span class=\"token operator\">+</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>syn<span class=\"token punctuation\">.</span><span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>syn<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">showLockThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>syn<span class=\"token punctuation\">.</span><span class=\"token function\">showLockThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰åŒæ­¥å™¨å°±å®ç°äº†ï¼Œç°åœ¨ä½¿ç”¨ä¸€ä¸‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">MyLock</span> lock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1 start---\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    lock<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1 get lock---\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    lock<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t1 unlock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2 start---\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                    lock<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2 get lock---\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    lock<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"t2 unlock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        t1<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        t2<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        lock<span class=\"token punctuation\">.</span><span class=\"token function\">showLockThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>ç»“æœï¼š</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>t1 start---</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>t2 start---</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>t1 get lock---</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>å½“å‰ç‹¬å é”èµ„æºçš„ Thread: t1</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>t1 unlock</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>t2 get lock---</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>t2 unlock</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>*/</span></pre></td></tr></table></figure><h1 id=\"aqså±æ€§\"><a class=\"anchor\" href=\"#aqså±æ€§\">#</a> AQS å±æ€§</h1>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AbstractQueuedSynchronizer</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractOwnableSynchronizer</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">implements</span> <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span>Serializable</span> <span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// part1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// ç‰ˆæœ¬å·</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> <span class=\"token number\">7373984972572414691L</span><span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// å¤´èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Node</span> head<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// å°¾ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">transient</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Node</span> tail<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> state<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// è‡ªæ—‹æ—¶é—´</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> spinForTimeoutThreshold <span class=\"token operator\">=</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// part2</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// Unsafe ç±»å®ä¾‹</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Unsafe</span> unsafe <span class=\"token operator\">=</span> <span class=\"token class-name\">Unsafe</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUnsafe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">//state å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> stateOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">//head å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> headOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">//state å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> tailOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">//tail å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> waitStatusOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">//next å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> nextOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// é™æ€åˆå§‹åŒ–å—</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            stateOffset <span class=\"token operator\">=</span> unsafe<span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractQueuedSynchronizer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            headOffset <span class=\"token operator\">=</span> unsafe<span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractQueuedSynchronizer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"head\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            tailOffset <span class=\"token operator\">=</span> unsafe<span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractQueuedSynchronizer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tail\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            waitStatusOffset <span class=\"token operator\">=</span> unsafe<span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"waitStatus\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            nextOffset <span class=\"token operator\">=</span> unsafe<span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"next\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>part1</code>  éƒ¨åˆ†ï¼Œå†…éƒ¨è¦ç»´æŠ¤ä¸€ä¸ª <code>FIFO</code>  çš„é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å…¶å®æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥ <code>AQS</code>  å†…éƒ¨å­˜åœ¨ <code>head,tail</code>  ä¸¤ä¸ª <code>Node</code>  èŠ‚ç‚¹ã€‚ <code>Node</code>  æ˜¯ <code>AQS</code>  çš„å†…éƒ¨ç±»ï¼Œ <code>AQS</code>  å°†ä¸€ä¸ªçº¿ç¨‹å°è£…ä¸º <code>Node</code>  æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚</p>\n<p>ç„¶åå°±æ˜¯ <code>state</code> ï¼Œ <code>AQS</code>  æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œ <code>getState(),setState(int),compareAndSetState(int)</code> ã€‚</p>\n<p><code>part2</code>  éƒ¨åˆ†ï¼Œå› ä¸º <code>AQS</code>  ä¸­æœ‰å¾ˆå¤š <code>CAS</code>  æ“ä½œï¼Œæ‰€ä»¥å¿…é¡»è¦æå‰æ‹¿åˆ°å„ä¸ªå­—æ®µåœ¨å…¶ç±»ä¸­çš„åœ°å€åç§»é‡ã€‚</p>\n<h1 id=\"nodeå†…éƒ¨ç±»\"><a class=\"anchor\" href=\"#nodeå†…éƒ¨ç±»\">#</a> Node å†…éƒ¨ç±»</h1>\n<p>å…ˆç»™æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// æ¨¡å¼ï¼Œåˆ†ä¸ºå…±äº«ä¸ç‹¬å </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// å…±äº«æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> <span class=\"token constant\">SHARED</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// é™æ€å˜é‡ï¼Œåœ¨ç‹¬å æ¨¡å¼ä¸­ï¼Œt çº¿ç¨‹æ‹¿åˆ°é”èµ„æºï¼ŒEXCLUSIVE = t</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> <span class=\"token constant\">EXCLUSIVE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// ç»“ç‚¹çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// CANCELLEDï¼Œå€¼ä¸º 1ï¼Œè¡¨ç¤ºå½“å‰çš„çº¿ç¨‹è¢«å–æ¶ˆ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// SIGNALï¼Œå€¼ä¸º - 1ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹åŒ…å«çš„çº¿ç¨‹éœ€è¦è¿è¡Œï¼Œä¹Ÿå°±æ˜¯ unpark</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// CONDITIONï¼Œå€¼ä¸º - 2ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹åœ¨ç­‰å¾… conditionï¼Œä¹Ÿå°±æ˜¯åœ¨ condition é˜Ÿåˆ—ä¸­</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// PROPAGATEï¼Œå€¼ä¸º - 3ï¼Œè¡¨ç¤ºå½“å‰åœºæ™¯ä¸‹åç»­çš„ acquireShared èƒ½å¤Ÿå¾—ä»¥æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// å€¼ä¸º 0ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹åœ¨ sync é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ç€è·å–é”</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CANCELLED</span> <span class=\"token operator\">=</span>  <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">SIGNAL</span>    <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">CONDITION</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PROPAGATE</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// ç»“ç‚¹çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> waitStatus<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// å‰é©±ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Node</span> prev<span class=\"token punctuation\">;</span>    </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// åç»§ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Node</span> next<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// ç»“ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Thread</span> thread<span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// ä¸‹ä¸€ä¸ªç­‰å¾…è€…</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token class-name\">Node</span> nextWaiter<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// ç»“ç‚¹æ˜¯å¦åœ¨å…±äº«æ¨¡å¼ä¸‹ç­‰å¾…</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isShared</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> nextWaiter <span class=\"token operator\">==</span> <span class=\"token constant\">SHARED</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// è·å–å‰é©±ç»“ç‚¹ï¼Œè‹¥å‰é©±ç»“ç‚¹ä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> <span class=\"token function\">predecessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">NullPointerException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// ä¿å­˜å‰é©±ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token class-name\">Node</span> p <span class=\"token operator\">=</span> prev<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å‰é©±ç»“ç‚¹ä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token comment\">// å‰é©±ç»“ç‚¹ä¸ä¸ºç©ºï¼Œè¿”å›</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">return</span> p<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// æ— å‚æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">// æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> thread<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span> mode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>nextWaiter <span class=\"token operator\">=</span> mode<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>thread <span class=\"token operator\">=</span> thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\">// æ„é€ æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> thread<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> waitStatus<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">=</span> waitStatus<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>thread <span class=\"token operator\">=</span> thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡ç‚¹çœ‹ <code>Node</code>  çš„å±æ€§ï¼Œå…³äº <code>Node</code>  ä¸­å¸¸é‡çš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RyYXl2b25ubi9hcnRpY2xlL2RldGFpbHMvMTA5Mjg1ODYy\">AQS ä¸­ Node çŠ¶æ€</span>ã€‚</p>\n<p>å…ˆè®²ä¸€ä¸‹åŒå‘é“¾è¡¨çš„å‡ºå…¥é˜Ÿæœºåˆ¶ï¼Œä¸€å¼€å§‹ï¼Œ <code>AQS</code>  çš„ <code>head,tail</code>  éƒ½æ˜¯ <code>null</code> ï¼Œå½“åŠ å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ˆ <code>addWaiter</code>  æ–¹æ³•ï¼‰ï¼Œä¼šæ£€æŸ¥ <code>tail==null</code> ï¼Œå¦‚æœæ˜¯ <code>null</code> ï¼Œå°±è¯´æ˜é˜Ÿåˆ—ä¸ºç©ºï¼Œå°±ä¼šåˆå§‹åŒ–é˜Ÿåˆ—ï¼Œè®© <code>head,tail</code>  æŒ‡å‘ <code>new Node</code> ï¼Œæ­¤æ—¶å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹æŒ‡å‘åŒä¸€ä¸ªï¼Œæ²¡æœ‰å®é™…æ„ä¹‰çš„èŠ‚ç‚¹ã€‚ç„¶åå†æŠŠè¦åŠ å…¥çš„èŠ‚ç‚¹åŠ å…¥åˆ° <code>head</code>  åé¢ï¼Œæ¥ç€ <code>tail</code>  æŒ‡å‘æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼ˆ <code>enq</code>  æ–¹æ³•å®ç°ï¼‰ã€‚</p>\n<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸¤ä¸ªæ–¹æ³•çš„æºä»£ç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æš‚æ—¶ä¸ç”¨ç®¡ modeï¼ŒaddWaiter æ˜¯å°†å½“å‰çº¿ç¨‹åŠ å…¥åŒæ­¥é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Node</span> <span class=\"token function\">addWaiter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> mode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Node</span> node <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Node</span> pred <span class=\"token operator\">=</span> tail<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pred <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        node<span class=\"token punctuation\">.</span>prev <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetTail</span><span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            pred<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">enq</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é˜Ÿåˆ—æ²¡æœ‰åˆå§‹åŒ–æˆ–è€… CAS å¤±è´¥ï¼Œè¿›å…¥ enq æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">Node</span> <span class=\"token function\">enq</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// æ— é™å¾ªç¯ï¼Œç›´åˆ°èŠ‚ç‚¹é€šè¿‡ CAS åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">Node</span> t <span class=\"token operator\">=</span> tail<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// åˆå§‹åŒ–é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetHead</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                tail <span class=\"token operator\">=</span> head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            node<span class=\"token punctuation\">.</span>prev <span class=\"token operator\">=</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetTail</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                t<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token keyword\">return</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…³äº <code>Node</code>  çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ <code>waitStatus</code> ï¼Œä¹‹åä¼šè¯¦ç»†è®²åˆ°ã€‚</p>\n<h1 id=\"åŒæ­¥é˜Ÿåˆ—è¯¦è§£\"><a class=\"anchor\" href=\"#åŒæ­¥é˜Ÿåˆ—è¯¦è§£\">#</a> åŒæ­¥é˜Ÿåˆ—è¯¦è§£</h1>\n<p>åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¦‚æœå°è¯•è·å¾—é”èµ„æºå¤±è´¥åï¼Œä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼ŒåŒæ—¶è¿›å…¥é˜»å¡é˜Ÿåˆ—ã€‚å°½ç®¡ä¸åŒçš„åŒæ­¥å™¨å¯¹é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è°ƒåº¦ä¸åŒï¼Œå¯èƒ½æ˜¯ä¸ºäº†é¿å…é¥¥é¥¿ä½¿ç”¨ <code>FIFO</code> ï¼Œä¹Ÿå¯èƒ½ä¸ºäº†æé«˜ååé‡ä½¿ç”¨å…¶ä»–è°ƒåº¦ï¼Œæ¯”å¦‚ä¼˜å…ˆçº§ä¹‹ç±»çš„ã€‚ä½†æ˜¯å…¶ä»–çš„å¹¶å‘æµç¨‹å¤§è‡´æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚é˜»å¡åè¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œè°ƒç”¨äº† <code>wait,await</code>  ä¹‹ç±»çš„å‡½æ•°ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¯¥éƒ¨åˆ†ä¼šè®²è§£ <code>AQS</code>  å¦‚ä½•ç»´æŠ¤åŒæ­¥é˜Ÿåˆ—ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰ã€‚</p>\n<h2 id=\"acquireå‡½æ•°\"><a class=\"anchor\" href=\"#acquireå‡½æ•°\">#</a> acquire å‡½æ•°</h2>\n<p><code>AQS</code>  ä¸­é˜Ÿåˆ—æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸€ä¸ªçº¿ç¨‹åªæœ‰åœ¨é€šè¿‡ <code>acquire(int arg)</code>  è·å–èµ„æºå¤±è´¥åï¼Œæ‰ä¼šè¢«åŒ…è£…æˆ <code>Node</code>  åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œè¯¥é˜Ÿåˆ—æ˜¯ <code>FIFO</code>  çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>acquire(int arg)</code>  æºç </p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token function\">acquireQueued</span><span class=\"token punctuation\">(</span><span class=\"token function\">addWaiter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXCLUSIVE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token function\">selfInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>acquire</code>  ä¼šå…ˆå°è¯•è·å–èµ„æºï¼Œä¹Ÿå°±æ˜¯ <code>tryAcquire</code> ï¼Œè€Œè¿™ä¸ªæ­£æ˜¯æˆ‘ä»¬éœ€è¦é‡å†™çš„æ–¹æ³•ï¼Œä»¥ä¸Šé¢çš„è‡ªå®šä¹‰åŒæ­¥å™¨é‡å†™çš„ <code>tryAcquire</code>  ä¸ºä¾‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> acquire<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">int</span> c <span class=\"token operator\">=</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">final</span> <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">compareAndSetState</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span>acquire<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token function\">setExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// åœ¨åŒæ­¥å™¨ä¸­è®¾ç½®ç‹¬å çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            \t<span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ­¤æ—¶å·²ç»æ‹¿åˆ°é”èµ„æºäº†</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t <span class=\"token operator\">==</span> <span class=\"token function\">getExclusiveOwnerThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>acquire<span class=\"token operator\">+</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ­¤å¤„æ˜¯é”é‡å…¥ï¼Œä¸å¿…æ‹…å¿ƒå¹¶å‘é—®é¢˜ï¼Œå› ä¸ºé”èµ„æºåœ¨å½“å‰çº¿ç¨‹æ‰‹ä¸­ã€‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// CAS æ“ä½œå¤±è´¥ï¼ˆæœ‰å…¶ä»–çº¿ç¨‹æ›´å¿«æ‹¿åˆ°é”ï¼‰</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å°è¯•è·å–èµ„æºå¤±è´¥åï¼Œ <code>AQS</code>  å°±ä¼šå°†è¯¥çº¿ç¨‹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ â€”â€” <code>addWaiter(Node.EXCLUSIVE),arg)</code> ã€‚</p>\n<p>æˆ‘ä»¬ä¹‹å‰çœ‹æºç ï¼Œå‘ç° <code>addWaiter</code>  ä¼ å…¥çš„å‚æ•°å…¶å®å¹¶ä¸æ˜¯å½“å‰çº¿ç¨‹å°è£…çš„ <code>Node</code> ï¼Œå‚æ•°åæ˜¯ <code>mode</code> ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹æ³¨è§£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * Creates and enqueues node for current thread and given mode.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @return the new node</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Node</span> <span class=\"token function\">addWaiter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> mode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬åœ¨ <code>acquire</code>  ä¸­ä¼ å…¥çš„æ˜¯ <code>Node.EXCLUSIVE</code> ï¼Œå°±è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯ç‹¬å æ¨¡å¼çš„èŠ‚ç‚¹ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåŒºåˆ†å‘¢ï¼Ÿå› ä¸ºæœ‰äº›è‡ªå®šä¹‰åŒæ­¥å™¨æ—¢å¯ä»¥ç‹¬å æ¨¡å¼ï¼Œåˆå¯ä»¥å…±äº«æ¨¡å¼ï¼Œè€Œ <code>AQS</code>  åªä¼šç»´æŠ¤ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¸¤ç§æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹éƒ½ä¼šåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥éœ€è¦åŒºåˆ†ã€‚</p>\n<p>å½“èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­åï¼Œ <code>AQS</code>  è®©è¯¥çº¿ç¨‹å†åšä¸€æ¬¡å°è¯•è·å–é”èµ„æºã€‚ä½†æ˜¯è¿™ç§å°è¯•æ˜¯æœ‰æ¡ä»¶çš„ï¼Œå› ä¸º <code>AQS</code>  æ˜¯ä¸¥æ ¼çš„ <code>FIFO</code> ï¼Œæ‰€ä»¥åªæœ‰å½“è¯¥çº¿ç¨‹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹æ‰å…è®¸å†æ¬¡å°è¯•è·å–èµ„æºï¼ˆå¤´èŠ‚ç‚¹ <code>head</code>  æŒ‡å‘ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„èŠ‚ç‚¹ï¼‰ã€‚åªæœ‰è¿™æ ·ï¼Œæ‰èƒ½æ˜¯å…¬å¹³çš„ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">acquireQueued</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">boolean</span> failed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token keyword\">boolean</span> interrupted <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token keyword\">final</span> <span class=\"token class-name\">Node</span> p <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span><span class=\"token function\">predecessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//node çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶å®å°±æ˜¯ node.prev</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">==</span> head <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// å¦‚æœ node å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ head å¹¶ä¸”å†æ¬¡å°è¯•è·å–èµ„æºæˆåŠŸ</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                    <span class=\"token function\">setHead</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// é‚£ä¹ˆ node å°±ä¸åº”è¯¥åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­äº†ï¼Œè®¾ç½® node ä¸º head</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    p<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// help GC</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    failed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token keyword\">return</span> interrupted<span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¿”å› false</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">shouldParkAfterFailedAcquire</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                    <span class=\"token function\">parkAndCheckInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    interrupted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>failed<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token function\">cancelAcquire</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¦‚æœä¸çœ‹ <code>shouldParkAfterFailedAcquire(p,node)</code>  è¿™ä¸€éƒ¨åˆ†çš„è¯­å¥ï¼Œè¯¥æ–¹æ³•å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œç³Ÿç³•çš„æ˜¯ï¼Œå³ä½¿ç¬¬äºŒä¸ª <code>if</code>  è¯­å¥å°† <code>interrupted = true</code> ï¼Œä½†æ˜¯åªè¦ç¬¬ä¸€ä¸ª <code>if</code>  è¯­å¥ä¸æ»¡è¶³ï¼Œå°±ä¼šä¸€ç›´æ­»å¾ªç¯ã€‚</p>\n<p>å…¶å®è¿™æ­£æ˜¯è®¾è®¡çš„é«˜æ˜ä¹‹å¤„ï¼Œæˆ‘ä»¬çŒœæµ‹è¿™éƒ¨åˆ†è¯­å¥å¯èƒ½å­˜åœ¨ <code>park</code>  è¯­å¥ï¼Œè®©çº¿ç¨‹åœä¸‹æ¥ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">shouldParkAfterFailedAcquire</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token function\">parkAndCheckInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    interrupted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç„¶åå½“ç‹¬å çº¿ç¨‹é€šè¿‡ <code>release</code>  æ–¹æ³•é‡Šæ”¾äº†é”èµ„æºï¼ŒåŒæ—¶ <code>release</code>  é€šè¿‡åŒæ­¥é˜Ÿåˆ—ä¸­ <code>head</code>  ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å–å¾—è¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ <code>t</code> ï¼Œç„¶åé€šè¿‡ <code>LockSupport.unpark(t)</code>  æ¥æ¢å¤ <code>t</code>  çš„è¿è¡Œï¼Œæ­¤æ—¶ <code>t</code>  è¿˜æ˜¯åœ¨æ­»å¾ªç¯ä¸­ï¼Œä½†æ˜¯ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œä»–å°±ä¼šå†æ¬¡å°è¯•è·å–é”èµ„æºã€‚</p>\n<p>å¹¶ä¸æ˜¯å¤§å®¶æƒ³åƒçš„é‚£ç§æœ‰ä¸ªçº¿ç¨‹ä¸€ç›´åœ¨é‚£é‡Œæ­»å¾ªç¯æµªè´¹ CPU èµ„æºï¼Œè€Œæ˜¯é€šè¿‡ <code>park</code>  ç›´æ¥è®©ä»–é˜»å¡ã€‚</p>\n<p>** ä¸Šè¿°åªæ˜¯æˆ‘çš„çŒœæµ‹ï¼Œä¸‹é¢ä¸€èµ·æ¥çœ‹æºç  **ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä¼ å…¥çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">shouldParkAfterFailedAcquire</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> pred<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> ws <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">.</span>waitStatus<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//pred èŠ‚ç‚¹çš„çŠ¶æ€ä¸º SIGNALï¼ŒSIGNAL è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ (å³å°†) è¢«é˜»å¡ (é€šè¿‡ park)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">==</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SIGNAL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// çŠ¶æ€ä¸º CANCELLEDï¼Œéœ€è¦ä»é˜Ÿåˆ—ä¸­åˆ é™¤</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            node<span class=\"token punctuation\">.</span>prev <span class=\"token operator\">=</span> pred <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">.</span>prev<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        pred<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// ä¸º PROPAGATE -3 æˆ–è€…æ˜¯ 0 è¡¨ç¤ºæ— çŠ¶æ€ï¼Œ(ä¸º CONDITION -2 æ—¶ï¼Œè¡¨ç¤ºæ­¤èŠ‚ç‚¹åœ¨ condition queue ä¸­) </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token function\">compareAndSetWaitStatus</span><span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SIGNAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// ä¸èƒ½è¿›è¡Œ park æ“ä½œ</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// ä¸€å¼€å§‹ï¼Œhead çš„ waitStatus æ˜¯ 0ï¼Œå¦‚æœ pred æ˜¯ headï¼Œé¦–å…ˆä¼šåœ¨ tryAcquire è¿”å› false</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// ç„¶åå°±ä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦ parkï¼Œåœ¨ head.waitStatus==0 çš„æƒ…å†µä¸‹ï¼Œhead çš„ waitStatus</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// ä¼šè¢«è®¾ç½®ä¸º SIGNALï¼Œä¹‹åå† acquireQueued é‡Œé¢å¾ªç¯ä¸€æ¬¡ï¼Œæœ€å node çš„çº¿ç¨‹ park</span></pre></td></tr></table></figure><p>åªæœ‰å½“è¯¥èŠ‚ç‚¹çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸º <code>SIGNAL</code>  æ—¶ï¼Œæ‰å¯ä»¥å¯¹è¯¥ç»“ç‚¹æ‰€å°è£…çš„çº¿ç¨‹è¿›è¡Œ <code>park</code>  æ“ä½œã€‚å¦åˆ™ï¼Œå°†ä¸èƒ½è¿›è¡Œ <code>park</code>  æ“ä½œã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è¿›è¡Œ park æ“ä½œå¹¶ä¸”è¿”å›è¯¥çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">parkAndCheckInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// åœ¨è®¸å¯å¯ç”¨ä¹‹å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è®¾ç½®äº† blocker</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å½“å‰çº¿ç¨‹æ˜¯å¦å·²è¢«ä¸­æ–­ï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡è®°ä½</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>parkAndCheckInterrupt</code>  æ–¹æ³•é‡Œçš„é€»è¾‘æ˜¯é¦–å…ˆæ‰§è¡Œ <code>park</code>  æ“ä½œï¼Œå³ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œç„¶åè¿”å›è¯¥çº¿ç¨‹æ˜¯å¦å·²ç»è¢«ä¸­æ–­ã€‚</p>\n<p>æœ€åçœ‹ä¸€ä¸‹ <code>final</code>  é‡Œé¢çš„ <code>cancelAcuqire</code>  æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å–æ¶ˆç»§ç»­è·å– (èµ„æº)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancelAcquire</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½® node ç»“ç‚¹çš„ thread ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    node<span class=\"token punctuation\">.</span>thread <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// æ‰¾åˆ° node å‰é©±ç»“ç‚¹ä¸­ç¬¬ä¸€ä¸ªçŠ¶æ€å°äº 0 çš„ç»“ç‚¹ï¼Œå³ä¸ä¸º CANCELLED çŠ¶æ€çš„ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Node</span> pred <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>prev<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        node<span class=\"token punctuation\">.</span>prev <span class=\"token operator\">=</span> pred <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">.</span>prev<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// è·å– pred ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token class-name\">Node</span> predNext <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½® node ç»“ç‚¹çš„çŠ¶æ€ä¸º CANCELLED</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    node<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">=</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">CANCELLED</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">==</span> tail <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">compareAndSetTail</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> pred<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">//node ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ï¼Œåˆ™è®¾ç½®å°¾ç»“ç‚¹ä¸º pred ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// æ¯”è¾ƒå¹¶è®¾ç½® pred ç»“ç‚¹çš„ next èŠ‚ç‚¹ä¸º null</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token function\">compareAndSetNext</span><span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> predNext<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">//node ç»“ç‚¹ä¸ä¸ºå°¾ç»“ç‚¹ï¼Œæˆ–è€…æ¯”è¾ƒè®¾ç½®ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">int</span> ws<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pred <span class=\"token operator\">!=</span> head <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ws <span class=\"token operator\">=</span> pred<span class=\"token punctuation\">.</span>waitStatus<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SIGNAL</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">compareAndSetWaitStatus</span><span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SIGNAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            pred<span class=\"token punctuation\">.</span>thread <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// (pred ç»“ç‚¹ä¸ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¹¶ä¸” pred ç»“ç‚¹çš„çŠ¶æ€ä¸º SIGNAL) æˆ–è€… </span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                                <span class=\"token comment\">//pred ç»“ç‚¹çŠ¶æ€å°äºç­‰äº 0ï¼Œå¹¶ä¸”æ¯”è¾ƒå¹¶è®¾ç½®ç­‰å¾…çŠ¶æ€ä¸º SIGNAL æˆåŠŸï¼Œå¹¶ä¸” pred ç»“ç‚¹æ‰€å°è£…çš„çº¿ç¨‹ä¸ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token comment\">// ä¿å­˜ç»“ç‚¹çš„åç»§</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">Node</span> next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> next<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// åç»§ä¸ä¸ºç©ºå¹¶ä¸”åç»§çš„çŠ¶æ€å°äºç­‰äº 0</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token function\">compareAndSetNext</span><span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> predNext<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ¯”è¾ƒå¹¶è®¾ç½® pred.next = next;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token function\">unparkSuccessor</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// é‡Šæ”¾ node çš„å‰ä¸€ä¸ªç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        node<span class=\"token punctuation\">.</span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span> <span class=\"token comment\">// help GC</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå†æ¥çœ‹ <code>acquireQueued</code>  æ–¹æ³•çš„æ•´ä¸ªçš„é€»è¾‘ã€‚é€»è¾‘å¦‚ä¸‹:</p>\n<ul>\n<li>åˆ¤æ–­ç»“ç‚¹çš„å‰é©±æ˜¯å¦ä¸º <code>head</code>  å¹¶ä¸”æ˜¯å¦æˆåŠŸè·å– (èµ„æº)ã€‚</li>\n<li>è‹¥æ­¥éª¤ 1 å‡æ»¡è¶³ï¼Œåˆ™è®¾ç½®ç»“ç‚¹ä¸º <code>head</code> ï¼Œä¹‹åä¼šåˆ¤æ–­æ˜¯å¦ <code>finally</code>  æ¨¡å—ï¼Œç„¶åè¿”å›ã€‚</li>\n<li>è‹¥æ­¥éª¤ 2 ä¸æ»¡è¶³ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦éœ€è¦ <code>park</code>  å½“å‰çº¿ç¨‹ï¼Œæ˜¯å¦éœ€è¦ <code>park</code>  å½“å‰çº¿ç¨‹çš„é€»è¾‘æ˜¯åˆ¤æ–­ç»“ç‚¹çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€æ˜¯å¦ä¸º <code>SIGNAL</code> ï¼Œè‹¥æ˜¯ï¼Œåˆ™ <code>park</code>  å½“å‰ç»“ç‚¹ï¼Œå¦åˆ™ï¼Œä¸è¿›è¡Œ <code>park</code>  æ“ä½œã€‚</li>\n<li>è‹¥ <code>park</code>  äº†å½“å‰çº¿ç¨‹ï¼Œä¹‹åæŸä¸ªçº¿ç¨‹å¯¹æœ¬çº¿ç¨‹ <code>unpark</code>  åï¼Œå¹¶ä¸”æœ¬çº¿ç¨‹ä¹Ÿè·å¾—æœºä¼šè¿è¡Œã€‚é‚£ä¹ˆï¼Œå°†ä¼šç»§ç»­è¿›è¡Œæ­¥éª¤â‘ çš„åˆ¤æ–­ã€‚</li>\n</ul>\n<p>æœ€åçš„ <code>cancelAcquire</code>  å’Œ <code>unparkSuccessor</code>  åªéœ€è¦è®°ä½ï¼Œæ˜¯å°† <code>node</code>  è®¾ä¸º <code>CANCELLED</code> ï¼Œæ‰§è¡Œåé¢çš„å‡½æ•°ï¼Œä¼šé‡Šæ”¾ <code>node</code>  çš„åç»§èŠ‚ç‚¹ã€‚</p>\n<p>é˜…è¯»è¿™äº›æºç æ˜¯æœ‰å¿…è¦çš„ï¼Œæœ€åç»™ä¸€ä¸ªæµç¨‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/11/d9bf2b419b32da5b.jpg\" alt=\"ACQ--acquireæ‰§è¡Œæµç¨‹\" /></p>\n<h2 id=\"releaseå‡½æ•°\"><a class=\"anchor\" href=\"#releaseå‡½æ•°\">#</a> release å‡½æ•°</h2>\n<p>ä»¥ç‹¬å æ¨¡å¼é‡Šæ”¾å¯¹è±¡ï¼Œå…ˆçœ‹æºç ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">tryRelease</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// é‡Šæ”¾æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// ä¿å­˜å¤´èŠ‚ç‚¹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Node</span> h <span class=\"token operator\">=</span> head<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> h<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¤´èŠ‚ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”å¤´èŠ‚ç‚¹çŠ¶æ€ä¸ä¸º 0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token function\">unparkSuccessor</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// é‡Šæ”¾å¤´èŠ‚ç‚¹çš„åç»§ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>tryRelease</code>  éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡å†™ï¼Œåœ¨ä¸Šé¢è‡ªå®šä¹‰åŒæ­¥å™¨çš„ä¾‹å­ä¸­ï¼Œ <code>release</code>  åœ¨é”é‡å…¥æ—¶ä¼šè¿”å› <code>false</code> ã€‚å¦‚æœ <code>tryRelease</code>  æˆåŠŸï¼Œé‚£ä¹ˆå¦‚æœå¤´èŠ‚ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”å¤´èŠ‚ç‚¹çš„çŠ¶æ€ä¸ä¸º 0ï¼Œåˆ™é‡Šæ”¾å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é‡Šæ”¾åç»§ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unparkSuccessor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// è·å– node ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> ws <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>waitStatus<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// çŠ¶æ€å€¼å°äº 0ï¼Œä¸º SIGNAL -1 æˆ– CONDITION -2 æˆ– PROPAGATE -3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// æ¯”è¾ƒå¹¶ä¸”è®¾ç½®ç»“ç‚¹ç­‰å¾…çŠ¶æ€ï¼Œè®¾ç½®ä¸º 0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token function\">compareAndSetWaitStatus</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// è·å– node èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token class-name\">Node</span> s <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// ä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºç©ºæˆ–è€…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€å¤§äº 0ï¼Œå³ä¸º CANCELLED</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> s<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">//s èµ‹å€¼ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        s <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// ä»å°¾ç»“ç‚¹å¼€å§‹ä»åå¾€å‰å¼€å§‹éå†</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Node</span> t <span class=\"token operator\">=</span> tail<span class=\"token punctuation\">;</span> t <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> t <span class=\"token operator\">!=</span> node<span class=\"token punctuation\">;</span> t <span class=\"token operator\">=</span> t<span class=\"token punctuation\">.</span>prev<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\">// æ‰¾åˆ°ç­‰å¾…çŠ¶æ€å°äºç­‰äº 0 çš„ç»“ç‚¹ï¼Œæ‰¾åˆ°æœ€å‰çš„çŠ¶æ€å°äºç­‰äº 0 çš„ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>waitStatus <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token comment\">// ä¿å­˜ç»“ç‚¹</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                s <span class=\"token operator\">=</span> t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è¯¥ç»“ç‚¹ä¸ä¸ºä¸ºç©ºï¼Œé‡Šæ”¾è®¸å¯</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">unpark</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¦ç»†æµç¨‹çœ‹ä¸‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/11/3b5873dbcddf51d0.jpg\" alt=\"unparkSuccessoræµç¨‹\" /></p>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>AQS ä¸­ acquire (int) æ–¹æ³•è°ƒç”¨ selfInterrupt çš„ç†è§£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZDI0Ni5jb20vYXJ0aWNsZS8xNjE4OTc2NTA1NTg2\">https://ld246.com/article/1618976505586</span></p>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1sb2NrLUFic3RyYWN0UXVldWVkU3luY2hyb25pemVyLmh0bWwjJUU3JUIxJUJCJUU3JTlBJTg0JUU2JUEwJUI4JUU1JUJGJTgzJUU2JTk2JUI5JUU2JUIzJTk1LS0tYWNxdWlyZSVFNiU5NiVCOSVFNiVCMyU5NQ==\">https://pdai.tech/md/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html# ç±»çš„æ ¸å¿ƒæ–¹æ³• ---acquire æ–¹æ³•</span></p>\n<p>ASQ ä¸­ cancelAcquire ä½•æ—¶ä¼šè¿è¡Œï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3ppeWFfYW5hbi9hcnRpY2xlL2RldGFpbHMvMTIyMDA5MjE1\">https://blog.csdn.net/ziya_anan/article/details/122009215</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/06/Shell/gawk%E7%A8%8B%E5%BA%8F%E8%BF%9B%E9%98%B6/",
            "url": "https://cecilia.cool/2022/08/06/Shell/gawk%E7%A8%8B%E5%BA%8F%E8%BF%9B%E9%98%B6/",
            "title": "gawkç¨‹åºè¿›é˜¶",
            "date_published": "2022-08-06T07:53:00.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>å…³äº <code>gawk</code>  è¿›é˜¶ï¼Œä½ å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼Œå¾ˆè¯¦ç»†ï¼Œä½†æ˜¯è¯·ä¸€å®šè¦çœ‹æœ¬æ–‡çš„<strong>ç»“æŸè¯­</strong></p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbG9uZ3N5L2FydGljbGUvZGV0YWlscy83NzA5NTEwMz9vcHNfcmVxdWVzdF9taXNjPSUyNTdCJTI1MjJyZXF1ZXN0JTI1NUZpZCUyNTIyJTI1M0ElMjUyMjE2NTk3NzgxMDExNjc4MjI0NjQxMjQ2NyUyNTIyJTI1MkMlMjUyMnNjbSUyNTIyJTI1M0ElMjUyMjIwMTQwNzEzLjEzMDEwMjMzNC5wYyUyNTVGYWxsLiUyNTIyJTI1N0QmYW1wO3JlcXVlc3RfaWQ9MTY1OTc3ODEwMTE2NzgyMjQ2NDEyNDY3JmFtcDtiaXpfaWQ9MCZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5hbGx+Zmlyc3RfcmFua19lY3BtX3YxfnBjX3JhbmtfMzQtMS03NzA5NTEwMy1udWxsLW51bGwuMTQyJTVFdjM5JTVFcGNfcmFua18zNCwxODUlNUV2MiU1RWNvbnRyb2wmYW1wO3V0bV90ZXJtPWdhd2slMjAlRTYlQTAlQkMlRTUlQkMlOEYlRTUlOEMlOTYlRTYlODklOTMlRTUlOEQlQjAmYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3\">gawk è¿›é˜¶</span>ã€‚</p>\n</blockquote>\n<h1 id=\"å†…å»ºå˜é‡\"><a class=\"anchor\" href=\"#å†…å»ºå˜é‡\">#</a> å†…å»ºå˜é‡</h1>\n<p><code>gawk</code>  ç¨‹åºä½¿ç”¨å†…å»ºå˜é‡æ¥å¼•ç”¨ç¨‹åºçš„æ•°æ®é‡Œçš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ã€‚</p>\n<h2 id=\"å­—æ®µå’Œè®°å½•åˆ†éš”ç¬¦çš„å˜é‡\"><a class=\"anchor\" href=\"#å­—æ®µå’Œè®°å½•åˆ†éš”ç¬¦çš„å˜é‡\">#</a> å­—æ®µå’Œè®°å½•åˆ†éš”ç¬¦çš„å˜é‡</h2>\n<p>ç±»ä¼¼äº <code>$1,$2</code>  æ˜¯æ•°æ®å­—æ®µå˜é‡ï¼Œå…¶æ ¹æ®å­—æ®µåˆ†éš”ç¬¦æ¥åˆ’å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå­—æ®µåˆ†éš”ç¬¦æ˜¯ç©ºç™½å­—ç¬¦ (ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦)ã€‚å¯ä»¥ä½¿ç”¨å†…å»ºå˜é‡ <code>FS</code>  æ›´æ”¹å­—æ®µåˆ†éš”ç¬¦ï¼ˆ <code>shell</code>  è„šæœ¬é‡Œé¢ç”¨çš„æ˜¯ <code>IFS</code> ï¼‰</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>FIELDWIDTHS--ç”±ç©ºæ ¼åˆ†éš”çš„ä¸€åˆ—æ•°å­—ï¼Œå®šä¹‰äº†æ¯ä¸ªæ•°æ®å­—æ®µç¡®åˆ‡å®½åº¦</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>FS--è¾“å…¥å­—æ®µä¹‹é—´åˆ†éš”ç¬¦</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OFS--è¾“å‡ºå­—æ®µä¹‹é—´åˆ†éš”ç¬¦</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>RS--è¾“å…¥è®°å½•åˆ†éš”ç¬¦</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ORS--è¾“å‡ºè®°å½•åˆ†éš”ç¬¦</pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>OFS</code>  æ˜¯ç©ºæ ¼ï¼Œæ‰€ä»¥ <code>print $1,$2,$3 --&gt; field1 field2 field3</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;OFS=\"-\"&#125; &#123;print $1,$2,$3&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dog-monkey-cat</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dog monkey <span class=\"token function\">cat</span> mouse</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># åœ¨ print ä¸­ï¼Œä½¿ç”¨ï¼Œéš”å¼€æ¯ä¸ªå˜é‡ï¼ŒåŒæ—¶ FS=\",\" è¦ä½¿ç”¨åŒå¼•å·</span></pre></td></tr></table></figure><p>è®¾ç½® <code>FIELDWIDTHS</code>  æ—¶ï¼Œè¯¥å˜é‡å…è®¸ä½ ä¸ä¾é å­—æ®µåˆ†éš”ç¬¦æ¥è¯»å–è®°å½•ï¼Œä¸€æ—¦è®¾ç½®ï¼Œ <code>gawk</code>  å°±ä¼šå¿½ç•¥ <code>FS</code> ï¼Œå¹¶æ ¹æ®æä¾›çš„å­—æ®µå®½åº¦æ¥è®¡ç®—å­—æ®µã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;FIELDWIDTHS=\"3 5 2 5\"&#125;&#123;print $1,$2,$3,$4&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># é‚£ä¹ˆå­—æ®µ $1 é•¿åº¦ä¸º 3,$2 é•¿åº¦ä¸º 5...</span></pre></td></tr></table></figure><p>å˜é‡ <code>RS</code>  å’Œ <code>ORS</code>  å®šä¹‰äº† <code>gawk</code>  ç¨‹åºå¦‚ä½•å¤„ç†æ•°æ®æµä¸­çš„è®°å½•ï¼Œé»˜è®¤ä¸‹ï¼Œéƒ½ä¸ºæ¢è¡Œç¬¦ï¼Œé»˜è®¤çš„ <code>RS</code>  å€¼è¡¨æ˜ï¼Œ<br />\nè¾“å…¥æ•°æ®æµä¸­çš„æ¯è¡Œæ–°æ–‡æœ¬å°±æ˜¯ä¸€æ¡æ–°çºªå½•ã€‚</p>\n<p>ä½ å¦‚æœä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå¯ä»¥å‚ç…§è¿™ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpaWZhYS9hcnRpY2xlL2RldGFpbHMvNzg4MjcwODA/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjIxNjU5NzczNzA1MTY3ODE2ODUzODI0MzglMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQuLiUyNTIyJTI1N0QmYW1wO3JlcXVlc3RfaWQ9MTY1OTc3MzcwNTE2NzgxNjg1MzgyNDM4JmFtcDtiaXpfaWQ9MCZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5hbGx+YmFpZHVfbGFuZGluZ192Mn5kZWZhdWx0LTEtNzg4MjcwODAtbnVsbC1udWxsLjE0MiU1RXYzOSU1RXBjX3JhbmtfMzQsMTg1JTVFdjIlNUVjb250cm9sJmFtcDt1dG1fdGVybT1nYXdrJTIwUlMmYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3\">RSã€FS ä¸ ORSã€OFS ç­‰å†…ç½®å˜é‡çš„ç”¨æ³•</span>ã€‚</p>\n<h2 id=\"æ•°æ®å˜é‡\"><a class=\"anchor\" href=\"#æ•°æ®å˜é‡\">#</a> æ•°æ®å˜é‡</h2>\n<p><code>gawk</code>  è¿˜æä¾›äº†ä¸€äº›å†…å»ºå˜é‡å¸®åŠ©ä½ äº†è§£æ•°æ®å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Œå¹¶æå– <code>shell</code>  ç¯å¢ƒçš„å˜åŒ–ï¼Œå¤ªå¤šäº†ï¼ŒæŒ‘å‡ ä¸ªå†™ã€‚</p>\n<p><code>ARGC</code>  å’Œ <code>ARGV</code>  å˜é‡å…è®¸ä» <code>shell</code>  ä¸­è·å–å‘½ä»¤è¡Œå‚æ•°çš„<strong>æ€»æ•°</strong>ä»¥åŠå®ƒä»¬çš„å€¼ï¼Œ <code>gawk</code>  å¹¶ä¸ä¼šå°†ç¨‹åºè„šæœ¬å½“æˆå‘½ä»¤è¡Œå‚æ•°çš„ä¸€éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;print ARGC,ARGV[1]&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span> data</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># ARGC è¡¨ç¤ºå‚æ•°ä¸ºä¸¤ä¸ªï¼ŒåŒ…æ‹¬ gawk å‘½ä»¤å’Œ data å‚æ•° (ç¨‹åºè„šæœ¬ä¸æ˜¯å‚æ•°ï¼)</span></pre></td></tr></table></figure><p><code>ENVIRON</code> -- ä½¿ç”¨å…³è”æ•°ç»„æ¥æå– <code>shell</code>  ç¯å¢ƒå˜é‡ï¼Œè¯¥æ•°ç»„ç”¨æ–‡æœ¬ä½œä¸ºæ•°ç»„çš„å¼•ç´¢å€¼ï¼Œè€Œä¸æ˜¯æ•°å€¼ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;print ENVIRON[\"HOME\"],ENVIRON[\"PATH\"]&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/home/cyan /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</pre></td></tr></table></figure><h1 id=\"è‡ªå®šä¹‰å˜é‡\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰å˜é‡\">#</a> è‡ªå®šä¹‰å˜é‡</h1>\n<p><code>gawk</code>  è‡ªå®šä¹‰å˜é‡ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œç›´æ¥èµ‹å€¼å³å¯ï¼Œä¸éœ€è¦ä½¿ç”¨ <code>$</code> ï¼ŒåŒæ—¶ï¼Œ <code>gawk</code>  åŒ…å«äº†æ ‡å‡†ç®—æ•°æ“ä½œç¬¦ <code>(*,^,**,%...)</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;x=4; x= x ** 3 + 1; print x&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">65</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;x=4; x= x ^ 3 + 1; print x&#125;'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">65</span></pre></td></tr></table></figure><h1 id=\"æ•°ç»„\"><a class=\"anchor\" href=\"#æ•°ç»„\">#</a> æ•°ç»„</h1>\n<p><code>gawk</code>  ä½¿ç”¨å…³è”æ•°ç»„æä¾›æ•°ç»„åŠŸèƒ½ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå…¶å¼•ç´¢å€¼å¯ä»¥æ˜¯ä»»æ„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå¼•ç´¢å­—ç¬¦ä¸²éƒ½å¿…é¡»èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†å‡ºèµ‹ç»™ä»–çš„æ•°æ®å…ƒç´ ã€‚æ¯ä¸ªæ•°ç»„åè‡ªå®šä¹‰ï¼Œæ•°æ®å¼•ç´¢å€¼è‡ªå®šä¹‰ï¼</p>\n<p>åŸºæœ¬å®šä¹‰æ ¼å¼ï¼š <code>arr[index_1]=val_1</code> ã€‚</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>1.éå†æ•°ç»„å˜é‡ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    for(var in array)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        statements</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>2.åˆ é™¤æ•°ç»„å˜é‡ï¼š</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    delete array[index]</pre></td></tr></table></figure><h1 id=\"ä½¿ç”¨æ¨¡å¼\"><a class=\"anchor\" href=\"#ä½¿ç”¨æ¨¡å¼\">#</a> ä½¿ç”¨æ¨¡å¼</h1>\n<p><code>gawk</code>  æ”¯æŒå¤šç§ç±»å‹çš„åŒ¹é…æ¨¡å¼æ¥è¿‡æ»¤æ•°æ®ï¼Œä¸ <code>sed</code>  å¤§åŒå°å¼‚ï¼Œ <code>BEGIN</code>  å’Œ <code>END</code>  å…³é”®å­—ç”¨åœ¨è¯»å–æ•°æ®æµä¹‹å‰ / åæ‰§è¡Œå‘½ä»¤çš„ç‰¹æ®Šæ¨¡å¼ï¼Œä¹Ÿå­˜åœ¨å…¶ä»–ç‰¹æ®Šæ¨¡å¼ï¼Œç”¨äºåœ¨<strong>åŒ¹é…</strong>æ•°æ®æµæ—¶æ‰§è¡Œä¸€äº›å‘½ä»¤ã€‚</p>\n<h2 id=\"æ­£åˆ™è¡¨è¾¾å¼\"><a class=\"anchor\" href=\"#æ­£åˆ™è¡¨è¾¾å¼\">#</a> æ­£åˆ™è¡¨è¾¾å¼</h2>\n<p>æ­£åˆ™è¡¨è¾¾å¼å¿…é¡»å‡ºç°åœ¨è¦æ§åˆ¶çš„ç¨‹åºè„šæœ¬çš„å·¦èŠ±æ‹¬å·ä¹‹å‰ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;FS=\",\"&#125; /11/&#123;print $1&#125;'</span> data</pre></td></tr></table></figure><h2 id=\"åŒ¹é…æ“ä½œç¬¦matching-operator\"><a class=\"anchor\" href=\"#åŒ¹é…æ“ä½œç¬¦matching-operator\">#</a> åŒ¹é…æ“ä½œç¬¦ (matching operator)</h2>\n<p>åŒ¹é…æ“ä½œç¬¦æ˜¯æ³¢æµªçº¿ <code>~</code> ï¼Œå…è®¸å°†æ­£åˆ™è¡¨è¾¾å¼é™å®šåœ¨è®°å½•ä¸­çš„ç‰¹å®šæ•°æ®å­—æ®µã€‚</p>\n<p>æ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸€å®šå±€é™æ€§ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨å¤„ç†çš„æ•°æ®ï¼Œä»è¡Œè®°å½•æ•°æ®ç»†åŒ–åˆ°äº†æŸä¸ªå­—æ®µçš„æ•°æ®ï¼ˆé€šè¿‡ <code>FS</code>  å­—æ®µåˆ†éš”ç¬¦ç»†åŒ–ï¼‰ï¼Œæ‰€ä»¥ï¼Œæ¯”å¦‚æˆ‘æƒ³åŒ¹é…æ¯è¡Œä¸­ï¼Œç¬¬äº”ä¸ªå­—æ®µä¸­æ˜¯å¦æœ‰ <code>cat</code>  è¿™ä¸ªå•è¯ï¼Œå•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ˜¯åšä¸åˆ°çš„ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$5</span> ~ /cat/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># $5 è¡¨ç¤ºè¡Œè®°å½•æ•°æ®ä¸­ç¬¬äº”ä¸ªå­—æ®µï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¿‡æ»¤å‡ºç¬¬äº”ä¸ªå­—æ®µåŒ…å« cat çš„æ‰€æœ‰è®°å½•</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸå…· -- ç”¨äºåœ¨æ•°æ®æ–‡ä»¶ä¸­æœç´¢ç‰¹å®šçš„æ•°æ®å…ƒç´ </span></pre></td></tr></table></figure><p>å®ƒè¿˜å¯ä»¥å’Œ <code>!</code>  ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºæ’é™¤ï¼Œæ²¡é”™ï¼Œå’Œ <code>sed</code>  ä¸€æ ·çš„åŠŸèƒ½</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$1</span> <span class=\"token operator\">!</span>~ /expression/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å¦‚æœåŒ¹é…å¤±è´¥å°±ä¼šæ‰§è¡ŒæŒ‡ä»¤</span></pre></td></tr></table></figure><h2 id=\"æ•°å­¦è¡¨è¾¾å¼\"><a class=\"anchor\" href=\"#æ•°å­¦è¡¨è¾¾å¼\">#</a> æ•°å­¦è¡¨è¾¾å¼</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> -F: <span class=\"token string\">'$4 == 0&#123;print $1&#125;'</span> /etc/passwd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># è¯¥è„šæœ¬æŸ¥çœ‹ç¬¬å››ä¸ªæ•°æ®å­—æ®µå«æœ‰ 0 çš„å€¼ (ç»„ ID=0--root ç”¨æˆ·ç»„)</span></pre></td></tr></table></figure><p>å¸¸è§çš„æ¯”è¾ƒï¼š <code>&gt;= , &lt;= , == ...</code> ï¼Œä¹Ÿå¯ä»¥å¯¹æ–‡æœ¬æ•°æ®ä½¿ç”¨è¡¨è¾¾å¼ï¼š <code>gawk '$1 == &quot;data&quot;&#123;print $2&#125;' data</code> ã€‚</p>\n<h1 id=\"ç»“æ„åŒ–è¯­å¥\"><a class=\"anchor\" href=\"#ç»“æ„åŒ–è¯­å¥\">#</a> ç»“æ„åŒ–è¯­å¥</h1>\n<h2 id=\"ifè¯­å¥\"><a class=\"anchor\" href=\"#ifè¯­å¥\">#</a> if è¯­å¥</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tstatement1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æˆ–è€…æ˜¯ï¼šif (condition) statement</span></pre></td></tr></table></figure><p>å¦‚æœè¦åœ¨ <code>if</code>  è¯­å¥ä¸­æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œè¦ä½¿ç”¨èŠ±æ‹¬å·ï¼Œå½“ç„¶ï¼Œ <code>gawk</code>  ä¹Ÿæ”¯æŒ <code>else</code>  å­å¥ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tstatements</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># ä¹Ÿå¯ä»¥åœ¨å•è¡Œä½¿ç”¨ elseï¼Œåªæ˜¯éœ€è¦åŠ ï¼›if (condition) statements; else statements</span></pre></td></tr></table></figure><h2 id=\"whileè¯­å¥\"><a class=\"anchor\" href=\"#whileè¯­å¥\">#</a> while è¯­å¥</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tstatements</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\"># while ä¸­æ”¯æŒ break å’Œ continue æ¥è·³å‡ºå¾ªç¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿˜æœ‰ <code>do-while</code>  è¯­å¥ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tstatements</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span>while <span class=\"token punctuation\">(</span>condition<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"forè¯­å¥\"><a class=\"anchor\" href=\"#forè¯­å¥\">#</a> for è¯­å¥</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>for<span class=\"token punctuation\">(</span> var assignment<span class=\"token punctuation\">;</span> condition<span class=\"token punctuation\">;</span> iteration process<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å…¶å®è·Ÿæ™®é€šçš„ for å¾ªç¯æ²¡å•¥åŒºåˆ«</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å¤§æ¦‚å°±æ˜¯è¿™æ ·</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> for<span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span>i++<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span>     total <span class=\"token operator\">+=</span> <span class=\"token variable\">$i</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœ€åè¿˜æ˜¯ä¸¾ä¸ªä¾‹å­</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> commands.awk</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token assign-left variable\">total</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        for<span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span> i++<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                print <span class=\"token variable\">$1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token parameter variable\">-f</span> commands.awk data</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dog</pre></td></tr></table></figure><h1 id=\"æ ¼å¼åŒ–æ‰“å°\"><a class=\"anchor\" href=\"#æ ¼å¼åŒ–æ‰“å°\">#</a> æ ¼å¼åŒ–æ‰“å°</h1>\n<p>å’Œ <code>c</code>  è¯­è¨€çš„ <code>printf</code>  å·®ä¸å¤šï¼Œé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦æ¥æ§åˆ¶ã€‚</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>d/i--éƒ½æ˜¯è¡¨ç¤ºæ•´æ•°</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>f--æµ®ç‚¹æ•°</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>e--ç§‘å­¦è®¡æ•°æ³•</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>g--ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼Œæˆ–æµ®ç‚¹æ•°</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>o--å…«è¿›åˆ¶</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>x--åå…­è¿›åˆ¶</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>X--åå…­è¿›åˆ¶ï¼Œå­—æ¯å¤§å†™</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>printf \"The answer is:%e\",val</pre></td></tr></table></figure><ul>\n<li>\n<p><code>width</code> -- æŒ‡å®šè¾“å‡ºå­—æ®µæœ€å°å®½åº¦çš„æ•°å­—å€¼ï¼Œå¦‚æœè¾“å‡ºå°äºè¿™ä¸ªå€¼ï¼Œæ–‡æœ¬å³å¯¹é½ï¼Œå¹¶ç”¨ç©ºæ ¼å¡«å……ï¼Œå¦åˆ™æŒ‰å®é™…å®½åº¦è¾“å‡ºã€‚</p>\n</li>\n<li>\n<p><code>prec</code> -- æŒ‡å®šäº†æµ®ç‚¹æ•°ä¸­å°æ•°ç‚¹åé¢çš„ä½æ•°ï¼Œæˆ–è€…æ–‡æœ¬å­—ç¬¦ä¸²ä¸­æ˜¾ç¤ºçš„æœ€å¤§å­—ç¬¦æ•°ã€‚</p>\n</li>\n<li>\n<p><code>-</code> (å‡å·)ï¼šæŒ‡æ˜åœ¨å‘æ ¼å¼åŒ–ç©ºé—´ä¸­æ”¾å…¥æ•°æ®æ—¶é‡‡å–å·¦å¯¹é½è€Œä¸æ˜¯å³å¯¹é½ã€‚</p>\n</li>\n</ul>\n<p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ï¼Œ<strong>FS æ˜¯ä¸€è¡Œæ•°æ®ä¸­å„ä¸ªå­—æ®µçš„åˆ†éš”ç¬¦ï¼ŒRS æ˜¯è¡Œæ•°æ®ä¹‹é—´çš„åˆ†éš”ç¬¦</strong>ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ•°æ®æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Riley Mullen,<span class=\"token punctuation\">(</span><span class=\"token number\">312</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-1234</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Frank Williams,<span class=\"token punctuation\">(</span><span class=\"token number\">317</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-9876</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Haley Snell,<span class=\"token punctuation\">(</span><span class=\"token number\">313</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-4938</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># å…ˆè¯•ä¸€ä¸‹ printf æ‰“å°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;FS=\",\";RS=\"\\n\"&#125; &#123;printf \"%s %s\\n\",$1,$2&#125;'</span> data</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Riley Mullen <span class=\"token punctuation\">(</span><span class=\"token number\">312</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-1234</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Frank Williams <span class=\"token punctuation\">(</span><span class=\"token number\">317</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-9876</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Haley Snell <span class=\"token punctuation\">(</span><span class=\"token number\">313</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-4938</pre></td></tr></table></figure><p>æˆ‘ä»¬å¸Œæœ›æ‰“å°ç»“æœå¯¹é½ä¸€ç‚¹ï¼Œä½†æ˜¯é»˜è®¤çš„æ˜¯å³å¯¹é½</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;FS=\",\";RS=\"\\n\"&#125; &#123;printf \"%20s %s\\n\",$1,$2&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        Riley Mullen <span class=\"token punctuation\">(</span><span class=\"token number\">312</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-1234</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      Frank Williams <span class=\"token punctuation\">(</span><span class=\"token number\">317</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-9876</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         Haley Snell <span class=\"token punctuation\">(</span><span class=\"token number\">313</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-4938</pre></td></tr></table></figure><p>æ‰€ä»¥è¦ä½¿ç”¨ <code>-</code> ï¼ŒæŒ‡å®šå·¦å¯¹é½ï¼Œå®Œç¾ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN&#123;FS=\",\";RS=\"\\n\"&#125; &#123;printf \"%-20s %s\\n\",$1,$2&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Riley Mullen         <span class=\"token punctuation\">(</span><span class=\"token number\">312</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-1234</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Frank Williams       <span class=\"token punctuation\">(</span><span class=\"token number\">317</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-9876</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Haley Snell          <span class=\"token punctuation\">(</span><span class=\"token number\">313</span><span class=\"token punctuation\">)</span><span class=\"token number\">555</span>-4938</pre></td></tr></table></figure><h1 id=\"å†…å»ºå‡½æ•°\"><a class=\"anchor\" href=\"#å†…å»ºå‡½æ•°\">#</a> å†…å»ºå‡½æ•°</h1>\n<h2 id=\"æ•°å­¦å‡½æ•°\"><a class=\"anchor\" href=\"#æ•°å­¦å‡½æ•°\">#</a> æ•°å­¦å‡½æ•°</h2>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>atan2(x,y)--x/yåæ­£åˆ‡ï¼Œxå’Œyæ˜¯å¼§åº¦</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cos(x),log(x),sin(x),sqrt(x),srand(x)ä¸ºè®¡ç®—æœºéšæœºæ•°æŒ‡å®šç§å­å€¼</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rand()--äº§ç”Ÿ0~1ä¹‹é—´çš„éšæœºå°æ•°(ä¸å«0,1)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>exp(x)--xçš„æŒ‡æ•°å‡½æ•°</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>int(x)--å–æ•´</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>é™¤äº†ä¸€èˆ¬çš„æ•°å­¦è¿ç®—å¤–ï¼Œgawkè¿˜æä¾›ä½è¿ç®—ï¼š</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>and(x,y),compl(x)--xçš„è¡¥è¿ç®—</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>lshift(x,count)--å·¦ç§»,rshift(x,count)--å³ç§»</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>or(x,y),xor(x,y)</pre></td></tr></table></figure><h2 id=\"å­—ç¬¦ä¸²å‡½æ•°\"><a class=\"anchor\" href=\"#å­—ç¬¦ä¸²å‡½æ•°\">#</a> å­—ç¬¦ä¸²å‡½æ•°</h2>\n<p>å…·ä½“è¯¦ç»†çš„ï¼Œè¦ä½¿ç”¨æ—¶ï¼Œè‡ªå·±å»æŸ¥</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>length([s])--é•¿åº¦</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>index(s,t)</pre></td></tr></table></figure><h2 id=\"æ—¶é—´å‡½æ•°\"><a class=\"anchor\" href=\"#æ—¶é—´å‡½æ•°\">#</a> æ—¶é—´å‡½æ•°</h2>\n<ul>\n<li><code>mktime(datespec)</code>  æŒ‰ <code>YYYY-MM-DD-HH-MM-SS[DST]</code>  æ ¼å¼æŒ‡å®šçš„æ—¥æœŸè½¬æ¢æˆæ—¶é—´æˆ³å€¼ã€‚</li>\n<li><code>strftime(formate [,timestamp])</code>  å°†å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³æˆ– <code>timestamp</code>  è½¬æ¢ä¸ºæ ¼å¼åŒ–æ—¥æœŸ (é‡‡ç”¨ <code>shell</code>  çš„ <code>date()</code> )<br />\n <code>systime()</code>  è¿”å›å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">gawk</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> date=systime()</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> date=strftime(\"%A, %B %d, %Y\",date)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> print date</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>&#125;'</span></pre></td></tr></table></figure><h1 id=\"è‡ªå®šä¹‰å‡½æ•°\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰å‡½æ•°\">#</a> è‡ªå®šä¹‰å‡½æ•°</h1>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> name<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>varuables<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#å¯ä»¥ä¼ å‚</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    statements</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token builtin class-name\">return</span> value <span class=\"token comment\">#å¯ä»¥ä½¿ç”¨ return è¿”å›å€¼</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#åœ¨è‡ªå®šä¹‰å‡½æ•°æ—¶ï¼Œå¿…é¡»å‡ºç°åœ¨æ‰€æœ‰ä»£ç å‰ (åŒ…æ‹¬ BEGIN ä»£ç å—)ï¼Œæœ‰åŠ©äºå°†å‡½æ•°ä»£ç å’Œ gawk ç¨‹åºå…¶ä»–éƒ¨åˆ†åˆ†å¼€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">gawk</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>> function fun()</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>> &#123;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>>   printf \"%-16s - %s\\n\",$1,$4</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>> &#125;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>> BEGIN&#123;FS=\"\\n\"; RS=\"\"&#125;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>> &#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>>   fun()    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>> &#125;'</span> data</pre></td></tr></table></figure><h1 id=\"åˆ›å»ºå‡½æ•°åº“\"><a class=\"anchor\" href=\"#åˆ›å»ºå‡½æ•°åº“\">#</a> åˆ›å»ºå‡½æ•°åº“</h1>\n<p>å¦‚æœå‡½æ•°ç»å¸¸ä½¿ç”¨ï¼Œå¯ä»¥å°†è¿™äº›å‡½æ•°æ”¾åœ¨ä¸“é—¨çš„å‡½æ•°åº“æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å¯ä»¥é€šè¿‡ <code>-f</code>  å‚æ•°æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œ <code>-f</code>  å‘½ä»¤è¡Œå‚æ•°ä¸èƒ½å’Œå†…è” <code>gawk</code>  è„šæœ¬æ”¾åˆ°ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨åŒä¸€è¡Œå‘½ä»¤è¡Œéœ€è¦ä½¿ç”¨å¤šä¸ª <code>-f</code>  å‚æ•° (ä¹Ÿå°±æ˜¯ï¼Œå°† <code>gawk</code>  è„šæœ¬ç¨‹åºä¹Ÿæ”¾åˆ°æ–‡ä»¶ä¸­)ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> <span class=\"token parameter variable\">-f</span> funclib <span class=\"token parameter variable\">-f</span> script data</pre></td></tr></table></figure><h1 id=\"ç»“æŸè¯­\"><a class=\"anchor\" href=\"#ç»“æŸè¯­\">#</a> ç»“æŸè¯­</h1>\n<p>è‡³æ­¤ï¼Œæš‘å‡å¼€çš„ <code>shell</code>  ç³»åˆ—æ›´æ–°ç»“æŸï¼ˆ2022.7.28--20228.6ï¼‰ï¼Œ<strong>æ‰€æœ‰æ–‡ç« å¤§è‡´å‚è€ƒã€ŠLinux å‘½ä»¤è¡Œä¸ shell è„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹ï¼Œä½œè€…æ˜¯ [ç¾] å¸ƒé²å§†ï¼ˆRichard Blumï¼‰ï¼Œå¸ƒé›·æ–¯çº³æ±‰ï¼ˆChristine Bresnahanï¼‰</strong>ã€‚ä¸ºä»€ä¹ˆè¯´å¤§è‡´å‘¢ï¼Ÿé¦–å…ˆï¼Œè¿™æœ¬ä¹¦æ˜¯æˆ‘åœ¨å¤§äºŒå¯’å‡çœ‹å®Œçš„ï¼Œå½“æ—¶ç¬”è®°åšçš„ä¸æ˜¯å¾ˆå®Œå–„è€Œä¸”è¿˜æœ‰å¾ˆå¤šé”™è¯¯ï¼Œæ‰€ä»¥è¿™æ¬¡åšå®¢æ›´æ–°ï¼Œæˆ‘å¹¶ä¸åªæ˜¯å•çº¯ä»ä¹‹å‰çš„ç¬”è®°ç²˜è´´å¤åˆ¶ã€‚ä½ ä»¬ç°åœ¨çœ‹åˆ°çš„ï¼Œå¾ˆå¤šä¾‹å­ï¼Œéƒ½æ˜¯æˆ‘è‡ªå·±æƒ³çš„ï¼Œé—®é¢˜çš„å¼•å…¥å’Œæ€è€ƒèŠ±è´¹äº†è¾ƒå¤šæ—¶é—´ï¼Œä½†æ˜¯ç»å¯¹ä¸èƒ½å¦è®¤çš„æ˜¯ï¼Œè¿™æœ¬ä¹¦è®©æˆ‘æ”¶è·æå¤§ã€‚</p>\n<p>æœ¬æ–‡å¼€å§‹æ¨èçš„åšå®¢ï¼Œå…¶å®å°±æ˜¯ã€ŠLinux å‘½ä»¤è¡Œä¸ shell è„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹çš„ gawk è¿›é˜¶çš„åŸæ–‡ï¼ˆä½œè€…åœ¨æ–‡æœ«ä¹Ÿè¯´äº†å‚è€ƒäº†æ­¤ä¹¦ï¼‰ï¼Œæˆ‘å¹¶ä¸å–œæ¬¢ç…§ç€ä¹¦æŠ„ç¬”è®°ï¼Œä¸€ä¸ªæ˜¯æˆ‘æ‡’ï¼Œå¦ä¸€ä¸ªæ˜¯è¿™æ ·æˆ‘è¿˜ä¸å¦‚è®©ä½ ç›´æ¥ä¹°ä¸€æœ¬ã€‚</p>\n<p>é€å›åƒé‡Œï¼Œç»ˆæœ‰ä¸€åˆ«ã€‚åœ¨ CUIï¼ˆä¸ä¼šåˆ°ç°åœ¨ä½ è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ CUI å§ï¼Ÿï¼‰å­¦ä¹ çš„è·¯ä¸Šï¼Œæˆ‘ä»¬éƒ½è¿˜å·®å¾—è¿œå‘¢ï¼Œå‰©ä¸‹çš„ï¼Œä¹Ÿæ˜¯å”¯ä¸€éœ€è¦è®°ä½çš„å°±æ˜¯ï¼Œä¿æŒå­¦ä¹ ï¼Œå°Šé‡åŸåˆ›ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/05/Shell/sed%E7%BC%96%E8%BE%91%E5%99%A8%E8%BF%9B%E9%98%B6/",
            "url": "https://cecilia.cool/2022/08/05/Shell/sed%E7%BC%96%E8%BE%91%E5%99%A8%E8%BF%9B%E9%98%B6/",
            "title": "sedç¼–è¾‘å™¨è¿›é˜¶",
            "date_published": "2022-08-05T13:49:28.000Z",
            "content_html": "<h1 id=\"å¤šè¡Œå‘½ä»¤\"><a class=\"anchor\" href=\"#å¤šè¡Œå‘½ä»¤\">#</a> å¤šè¡Œå‘½ä»¤</h1>\n<p><code>n</code>  å‘½ä»¤ -- <code>next</code> ï¼Œä¼šå°† <code>sed</code>  ç¼–è¾‘å™¨ç§»åŠ¨åˆ°æ•°æ®æµä¸­çš„<strong>ä¸‹ä¸€è¡Œ</strong>æ–‡æœ¬ï¼Œè€Œä¸ç”¨é‡æ–°å›åˆ°å‘½ä»¤çš„æœ€å¼€å§‹æ‰§è¡Œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'/head/&#123;n;d&#125;'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å½“åŒ¹é…åˆ° head ä¸€è¡Œï¼Œsed ä¼šé©¬ä¸Šç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œå¼€å¤´ï¼Œæ‰§è¡Œ d å‘½ä»¤</span></pre></td></tr></table></figure><p><code>N</code>  å‘½ä»¤ï¼Œå°†æ•°æ®æµä¸­ä¸¤ä¸ªæ–‡æœ¬è¡Œåˆå¹¶åˆ°åŒä¸€ä¸ª<strong>æ¨¡å¼ç©ºé—´</strong>ä¸­ï¼Œä¸¤è¡Œæ–‡æœ¬ä»ä»¥æ¢è¡Œç¬¦ç›¸éš”ï¼Œä½†æ˜¯ä¼šå°†ä¸¤è¡Œæ–‡æœ¬å½“ä½œä¸€è¡Œå¤„ç†ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>end</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token string\">'/cat/&#123;N;s/\\n/ /&#125;'</span> data</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">cat</span> end</pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªå‘½ä»¤å­˜åœ¨å±€é™ï¼Œæ¯”å¦‚å‰å››è¡Œï¼Œ <code>sed</code>  ä¼šå°†ç¬¬ 1ï¼Œ2 è¡Œçœ‹ä½œæ•´ä½“ï¼Œç¬¬ 3ï¼Œ4 è¡Œçœ‹ä½œæ•´ä½“ï¼Œå¦‚æœæœ€åä¸€è¡Œæ˜¯ç¬¬äº”è¡Œå•è¡Œï¼Œ <code>sed</code>  ä¸ä¼šæ£€æŸ¥ç¬¬äº”è¡Œï¼Œç›´æ¥ç»“æŸã€‚</p>\n<p><code>N,d</code>  ä¸¤ä¸ªå‘½ä»¤é…åˆå¯ä»¥å®ç°å¤šè¡Œåˆ é™¤ï¼Œå¯¹äºåŒ¹é…åˆ°çš„ï¼Œæ¨¡å¼ç©ºé—´ä¸­ä¸¤è¡Œéƒ½ä¼šåˆ é™¤ï¼Œ <code>D</code>  å°±åªä¼šåˆ é™¤æ¨¡å¼ç©ºé—´ç¬¬ä¸€è¡Œï¼Œç¬¬äºŒè¡Œè¢«ä¿ç•™ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>end</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token string\">\"N;/[c,e]*/d\"</span> data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>end</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># N å’Œ D çš„é…åˆä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤è¡Œå‰çš„ç©ºç™½è¡Œ</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>mouse</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>monkey</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token string\">\"N;/ /D\"</span> data</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>mouse</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>monkey</pre></td></tr></table></figure><p><code>N,P</code>  å‘½ä»¤å¯ä»¥å®ç°å¤šè¡Œæ‰“å°ï¼Œ <code>P</code>  å‘½ä»¤åªæ‰“å°æ¨¡å¼ç©ºé—´çš„ç¬¬ä¸€è¡Œã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mouse</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>monkey</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"4&#123;N;P&#125;\"</span> data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>mouse</pre></td></tr></table></figure><p>å…³äº <code>sed</code>  ä¸­ <code>p,P</code>  å‘½ä»¤çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy4xMzYubGEvc2hpZGEvc2hvdy00MTA1NTkuaHRtbA==\">http://www.136.la/shida/show-410559.html</span></p>\n</blockquote>\n<h1 id=\"ä¿æŒç©ºé—´\"><a class=\"anchor\" href=\"#ä¿æŒç©ºé—´\">#</a> ä¿æŒç©ºé—´</h1>\n<p>æ¨¡å¼ç©ºé—´æ˜¯ä¸€å—æ´»è·ƒçš„ç¼“å†²åŒºï¼Œsed ç¼–è¾‘å™¨è¿˜æœ‰å¦ä¸€å—ç§°ä½œ<strong>ä¿æŒç©ºé—´</strong>çš„ç¼“å†²åŒºã€‚å¯¹äºä¿æŒç©ºé—´ï¼Œå­˜åœ¨ 5 æ¡å‘½ä»¤ï¼Œç”¨æ¥å°†æ–‡æœ¬ä»æ¨¡å¼ç©ºé—´å¤åˆ¶åˆ°ä¿æŒç©ºé—´ã€‚è¿™å¯ä»¥æ¸…ç©ºæ¨¡å¼ç©ºé—´æ¥åŠ è½½å…¶ä»–è¦å¤„ç†çš„å­—ç¬¦ä¸²ã€‚</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>h--å°†æ¨¡å¼ç©ºé—´å¤åˆ¶åˆ°ä¿æŒç©ºé—´</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>H--å°†æ¨¡å¼ç©ºé—´é™„åŠ åˆ°ä¿æŒç©ºé—´</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>g--å°†ä¿æŒç©ºé—´å¤åˆ¶åˆ°æ¨¡å¼ç©ºé—´</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>G--å°†ä¿æŒç©ºé—´é™„åŠ åˆ°æ¨¡å¼ç©ºé—´</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>x--äº¤æ¢ä¸¤ä¸ªç©ºé—´çš„å†…å®¹</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sed -n '/first/ &#123;h;p;n;p;g;p&#125;' data</pre></td></tr></table></figure><p>ç°åœ¨ä½ ä¸ç”¨å¤ªç†è§£ï¼Œåªéœ€è¦æœ‰è¿™ä¹ˆä¸ªç©ºé—´å³å¯ã€‚</p>\n<h1 id=\"æ’é™¤å‘½ä»¤\"><a class=\"anchor\" href=\"#æ’é™¤å‘½ä»¤\">#</a> æ’é™¤å‘½ä»¤</h1>\n<p>åœ¨ <code>sed</code>  åŸºç¡€é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæåˆ° <code>!</code>  å¯ä»¥ä»£æ›¿ <code>/</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'s/cat/dog/'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'s!cat!dog!'</span> data</pre></td></tr></table></figure><p>åœ¨ <code>sed</code>  ä¸­ï¼Œä½¿ç”¨æ„Ÿå¹å· <code>!</code>  è¿˜å¯ä»¥æ’é™¤å‘½ä»¤ï¼Œè®©åŸæœ¬ä¼šèµ·ä½œç”¨çš„å‘½ä»¤ä¸èµ·ä½œç”¨ï¼Œæ¯”å¦‚åœ¨æœ€åä¸€è¡Œå–æ¶ˆä½¿ç”¨ <code>N</code>  å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'$!N;å…¶ä»–å‘½ä»¤'</span> data</pre></td></tr></table></figure><p>ç°åœ¨ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°æ¨¡å¼ç©ºé—´ï¼Œä¿æŒç©ºé—´ä»¥åŠæ’é™¤å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é€†åºæ‰“å°æ–‡æœ¬</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"first</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> second</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> third</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>> \"</span> <span class=\"token operator\">></span> data</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'&#123;1!G;h;$p&#125;'</span> data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>third</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>second</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>first</pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ï¼Œ <code>G,h</code>  æ˜¯å…³äºä¿æŒç©ºé—´çš„å‘½ä»¤ï¼Œæ¯æ¬¡å°†æ•°æ®è¯»å–åˆ°æ¨¡å¼ç©ºé—´ï¼Œä¿æŒç©ºé—´ä¸­çš„æ•°æ®éƒ½ä¼šé™„åŠ åˆ°æ¨¡å¼ç©ºé—´ (ç¬¬ä¸€è¡Œé™¤å¤–)ï¼Œç„¶åå†å¤åˆ¶åˆ°ä¿æŒç©ºé—´ã€‚å½“ç„¶ï¼Œ <code>Linux</code>  å‘½ä»¤ <code>tac</code>  å¯ä»¥ç›´æ¥é€†åºæ–‡æœ¬ï¼Œå…¶å® <code>tac</code>  å°±æ˜¯ <code>cat</code>  åç€å†™ã€‚</p>\n<p>ç­‰ä¸€ä¸‹ï¼Œæˆ‘å¥½åƒè¿˜æ²¡è®²è¿‡ä»€ä¹ˆæ˜¯æ¨¡å¼ç©ºé—´ï¼š <code>sed</code>  æ¯æ¬¡è¯»ä¸€è¡Œï¼Œéƒ½ä¼šæŠŠè¿™ä¸€è¡Œæ•°æ®è¯»åˆ°æ¨¡å¼ç©ºé—´ï¼Œåœ¨ä½¿ç”¨å‘½ä»¤å¤„ç†æ•°æ®ï¼Œåœ¨æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</p>\n<p>å…³äºé€†åºæ‰“å°æ–‡æœ¬ï¼Œå…·ä½“æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹å›¾</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/08/06/759084cf022ed038.png\" alt=\"image-20220806111008122\" /></p>\n<p>å¦‚æœä½ çœŸçš„ç†è§£äº†ï¼Œé‚£ä¹ˆä½ å°±çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥å®ç°é€†åº</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'&#123;1!G;$!h;$p&#125;'</span> data</pre></td></tr></table></figure><h1 id=\"åˆ†æ”¯\"><a class=\"anchor\" href=\"#åˆ†æ”¯\">#</a> åˆ†æ”¯</h1>\n<p>åˆ†æ”¯å‘½ä»¤å…±æœ‰ä¸¤æ¡ï¼šåˆ†æ”¯ï¼ˆbï¼‰å’Œæ›¿ä»£åˆ†æ”¯ï¼ˆtï¼‰ã€‚</p>\n<h2 id=\"bå‘½ä»¤\"><a class=\"anchor\" href=\"#bå‘½ä»¤\">#</a> b å‘½ä»¤</h2>\n<p>åŸºäºåœ°å€ï¼Œåœ°å€æ¨¡å¼æˆ–åœ°å€åŒºé—´<strong>æ’é™¤</strong>æ•´å—å‘½ä»¤ï¼š <code>[address]b [label]</code> ã€‚</p>\n<p><code>address</code>  å†³å®šå“ªäº›è¡Œè§¦å‘åˆ†æ”¯å‘½ä»¤ã€‚ <code>label</code>  å‚æ•°å®šä¹‰äº†è¦è·³è½¬çš„ä½ç½®ï¼Œå¦‚æœæ­¤å¤„æ²¡æœ‰ <code>label</code>  å‚æ•°ï¼Œè·³è½¬å‘½ä»¤ä¼šè·³è½¬åˆ°è„šæœ¬ç»“å°¾ï¼ˆæ³¨æ„ï¼Œæ˜¯å‘½ä»¤è„šæœ¬çš„ç»“å°¾ï¼‰ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'&#123;2,3b ; s/This is/Is this/ ;s/line./test?/&#125;'</span> data</pre></td></tr></table></figure><p><code>sed</code>  è¿˜å¯ä»¥ä½¿ç”¨æ ‡ç­¾ï¼Œä½¿ç”¨æ ‡ç­¾åï¼Œåªä¼šè·³è¿‡éƒ¨åˆ†å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ ‡ç­¾ä¹‹å‰çš„å‘½ä»¤ã€‚ç›´åˆ°è¿™é‡Œä½ å¯èƒ½ä¸æ˜¯å¾ˆæ‡‚ï¼Œæˆ‘è¦æé†’çš„æ˜¯ï¼Œåœ¨ <code>sed</code>  ä¸­å¼•å…¥åˆ†æ”¯ï¼Œæˆ‘å»ºè®®å°†å‘½ä»¤æ”¾åœ¨ <code>.sed</code>  å‘½ä»¤è„šæœ¬ä¸­ï¼Œè¿™æ ·ä½¿ç”¨èµ·æ¥æ‰æ–¹ä¾¿ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å‡è®¾æˆ‘ä»¬éœ€è¦éƒ½æ•°æ®æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œä¸€è¡Œæ•°æ®ä¸­ä¸€æ—¦å‡ºç° cat è¿™ä¸ªå•è¯ï¼Œæˆ‘ä»¬å°±æ‰“å°å…¶æ‰€åœ¨è¡Œå·</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å¦åˆ™ï¼Œå°±æ‰“å°è¯¥è¡Œ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># command.sed</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/cat/b error_print</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>/**/b true_print</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">:</span> error_print</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>b <span class=\"token comment\"># è·³åˆ°ç»“å°¾ï¼Œä¸ç„¶ä¼šæ‰§è¡Œ true_print çš„è¯­å¥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token builtin class-name\">:</span> true_print</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>p</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>b</pre></td></tr></table></figure><p>æ›´æ”¹ä¸€ä¸‹ <code>data</code>  çš„å†…å®¹ï¼Œæ‰§è¡Œ <code>sed</code>  å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"dog</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> monkey</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> cat</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> mouse</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>> \"</span> <span class=\"token operator\">></span> data</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token parameter variable\">-f</span> command.sed data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>monkey</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>mouse</pre></td></tr></table></figure><p>å¦‚æœä½ æŠŠæ ‡ç­¾æ”¾åˆ°åˆ†æ”¯è·³è½¬çš„å‰é¢ï¼Œå¾ˆå®¹æ˜“å½¢æˆæ­»å¾ªç¯ã€‚æ¯”å¦‚ï¼Œé€šè¿‡ <code>sed</code>  å°†æ•°æ®ä¸­çš„ <code>,</code>  å…¨éƒ¨åˆ é™¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This, is, a, test, to, remove, commas.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> :start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> s/,//p</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> b start</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>> &#125;'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>This is, a, test, to, remove, commas.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>This is a, test, to, remove, commas.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>This is a test, to, remove, commas.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to, remove, commas.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to remove, commas.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to remove commas.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>^C</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># æ¯æ¬¡å»æ‰ä¸€ä¸ªï¼Œç„¶åè·³å› start æ ‡ç­¾å¤„</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># å½“ç„¶ï¼Œç›´æ¥ä½¿ç”¨ g é€‰é¡¹</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>cyan@cyan-virtual-machine:~$  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This, is, a, test, to, remove, commas.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'s/,//gp'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to remove commas.</pre></td></tr></table></figure><p>ä¸Šè¿°ä¾‹å­ï¼Œä¸ºäº†è§£å†³æ­»å¾ªç¯ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªåœ°å€æ¨¡å¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This, is, a, test, to, remove, commas.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>:start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>s/,//p</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/,/b start</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>&#125;'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># åªæœ‰å†æ¬¡åŒ¹é…åˆ°ï¼Œæ‰ä¼šè·³è½¬</span></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ã€‚</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUxNjQyODE0L2FydGljbGUvZGV0YWlscy8xMTE0NjExMzc=\">https://blog.csdn.net/m0_51642814/article/details/111461137</span></p>\n</blockquote>\n<h1 id=\"tå‘½ä»¤\"><a class=\"anchor\" href=\"#tå‘½ä»¤\">#</a> t å‘½ä»¤</h1>\n<p>æµ‹è¯•å‘½ä»¤ ( <code>t</code> ) ä¹Ÿå¯ä»¥ç”¨æ¥æ”¹å˜ <code>sed</code>  æ‰§è¡Œæµç¨‹ï¼Œæ ¹æ®æµ‹è¯•æ¡ä»¶è·³è½¬ï¼Œè€Œä¸æ˜¯åœ°å€ï¼š <code>[address]t [label]</code> ã€‚</p>\n<p>å¦‚æœæ›¿æ¢å‘½ä»¤åŒ¹é…å¹¶æ›¿æ¢äº†ä¸€ä¸ªæ¨¡å¼ï¼Œæµ‹è¯•å‘½ä»¤å°±ä¼šè·³è½¬åˆ°æŒ‡å®šæ ‡ç­¾ï¼Œå¦åˆ™ä¸ä¼šè·³è½¬ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This, is, a, test, to, remove, commas.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>:start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>s/,//p</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>t start</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>&#125;'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>This is, a, test, to, remove, commas.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>This is a, test, to, remove, commas.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>This is a test, to, remove, commas.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to, remove, commas.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to remove, commas.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>This is a <span class=\"token builtin class-name\">test</span> to remove commas.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># æœ€åä¸€æ¬¡åŒ¹é…å¤±è´¥ï¼Œåœæ­¢è·³è½¬</span></pre></td></tr></table></figure><h1 id=\"æ¨¡å¼æ›¿ä»£\"><a class=\"anchor\" href=\"#æ¨¡å¼æ›¿ä»£\">#</a> æ¨¡å¼æ›¿ä»£</h1>\n<p><code>&amp;</code>  ç¬¦å·ï¼Œè¯¥ç¬¦å·å¯ä»¥ç”¨æ¥ä»£è¡¨æ›¿æ¢å‘½ä»¤ä¸­çš„åŒ¹é…çš„æ¨¡å¼ï¼Œæ¯”å¦‚æˆ‘éœ€è¦åŒ¹é… <code>hello</code>  è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥ç”¨ <code>&amp;</code>  æ¥ä»£æ›¿ <code>hello</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"The cat is cute.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/cu[^\\.\\ ]*/\"&amp;\"/'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>The <span class=\"token function\">cat</span> is <span class=\"token string\">\"cute\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p><code>&amp;</code>  åœ¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶ååˆ†æ–¹ä¾¿ï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“åŒ¹é…åˆ°çš„æ¨¡å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ <code>&amp;</code>  æ‹¿åˆ°æˆ‘ä»¬åŒ¹é…åˆ°çš„æ¨¡å¼ã€‚</p>\n<p>æ›¿ä»£å•ç‹¬å•è¯ï¼š <code>&amp;</code>  ç¬¦å·æå–åŒ¹é…æ›¿æ¢å‘½ä»¤æŒ‡å®šæ¨¡å¼çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæƒ³è¦æå–ç‹¬ç«‹çš„å•è¯ï¼Œéœ€è¦ä½¿ç”¨ <code>()</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"The system Adminstrator manual\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> s/\\(system\\) Adminstrator/\\1 user/'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>The system User manual</pre></td></tr></table></figure><p>è¢«ä½¿ç”¨æ—¶ï¼Œåœ†æ‹¬å·å®šä¹‰äº†æ›¿æ¢æ¨¡å¼ä¸­çš„å­æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ <code>\\1,2,3..</code>  æ¥è¡¨ç¤ºï¼Œåœ¨æ›¿æ¢å‘½ä»¤ä¸­ä½¿ç”¨åœ†æ‹¬å·æ—¶ï¼Œ<br />\nå¿…é¡»ä½¿ç”¨è½¬ä¹‰å­—ç¬¦å°†å®ƒä»¬æ ‡ç¤ºä¸ºåˆ†ç»„å­—ç¬¦è€Œä¸æ˜¯æ™®é€šçš„åœ†æ‹¬å·ã€‚</p>\n<p>æ‰€ä»¥æœ€å¼€å§‹çš„ä¾‹å­æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"The cat is cute.\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\\(cu[^\\.\\ ]*\\)/\"\\1\"/'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>The <span class=\"token function\">cat</span> is <span class=\"token string\">\"cute\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>æœ€åå†ä¸¾ä¸€ä¸ªä¾‹å­ï¼šæ¯ä¸‰ä½æ·»åŠ é€—å· (ç±»ä¼¼äºï¼Œé‡‘é’±é‡‘é¢åˆ†éš”è®¡æ•°)</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$input</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> : start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> s/\\(.*[0-9]\\)\\([0-9]\\&#123;3\\&#125;\\)/\\1,\\2/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> t start</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>> &#125;'</span></pre></td></tr></table></figure><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œ <code>grep</code>  å’Œ <code>sed</code>  é»˜è®¤ä¸æ”¯æŒ <code>ERE</code> -- æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œ <code>grep</code>  éœ€è¦åŠ  <code>-E</code>  é€‰é¡¹ï¼Œ <code>sed</code>  éœ€è¦ä½¿ç”¨ <code>-r</code>  é€‰é¡¹ã€‚å¦‚æœä¸åŠ é€‰é¡¹è¿˜æƒ³ä½¿ç”¨ <code>&#123;&#125;</code> ï¼Œå°±è¦åŠ è½¬ä¹‰å­—ç¬¦ <code>\\&#123;m\\&#125;</code> ã€‚</p>\n<p>åœ¨ç»™ä¾‹å­ä¹‹å‰ï¼Œæˆ‘éœ€è¦æç¤ºä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨ <code>()</code>  å…¶å®å°±æ˜¯æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢çš„ä¸œè¥¿ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰ä½¿ç”¨ <code>-r</code>  é€‰é¡¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$input</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>: start;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>s/(.*[0-9])([0-9]&#123;3&#125;)/\\1,\\2/;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>t start;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">10,913</span>,013</pre></td></tr></table></figure><h1 id=\"æœ€å\"><a class=\"anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>è¿™é‡Œæœ‰ä¸€ç¯‡æ±‚é—®åšå®¢ï¼Œæ˜¯å…³äº <code>sed</code>  å’Œæ­£åˆ™è¡¨è¾¾å¼é—®é¢˜çš„ï¼Œä½ èƒ½å…ˆä¸çœ‹è¯„è®ºåŒºï¼Œè‡ªå·±æ‰¾åˆ°åšä¸»æå‡ºçš„é—®é¢˜å—ï¼Ÿè¦æ˜¯ä½ èƒ½è‡ªå·±è§£å†³ï¼Œé‚£æ›´æ˜¯æœ€å¥½çš„ã€‚</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vb21ha2UuY29tL3F1ZXN0aW9uLzQyOTY1MzA=\">https://oomake.com/question/4296530</span></p>\n</blockquote>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/05/Shell/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/",
            "url": "https://cecilia.cool/2022/08/05/Shell/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/",
            "title": "æ­£åˆ™è¡¨è¾¾å¼",
            "date_published": "2022-08-05T08:06:02.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æœ¬æ–‡ä¸ä¼šä¸ºä½ ä»‹ç»æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ï¼Œä¸€æ˜¯æˆ‘æ¯”è¾ƒæ‡’ï¼ŒäºŒæ˜¯ä½ è®°ä¸ä½ã€‚è¿˜ä¸å¦‚ä¸Šç½‘å»æŸ¥ã€‚</p>\n<h1 id=\"å®šä¹‰\"><a class=\"anchor\" href=\"#å®šä¹‰\">#</a> å®šä¹‰</h1>\n<p>å…³äºæ­£åˆ™è¡¨è¾¾å¼ä¸æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œä½ å¯ä»¥è¿™ä¹ˆç†è§£</p>\n<pre><code>æ•°æ® --&gt; æ­£åˆ™è¡¨è¾¾å¼ --&gt; åŒ¹é…çš„æ•°æ®\n            |\n            v\n        æ»¤æ‰çš„æ•°æ®\n</code></pre>\n<p>è‡ªå®šä¹‰çš„æ¨¡å¼æ¨¡æ¿ (pattern template)ï¼Œ <code>Linux</code>  å·¥å…· (sed,gawk) ç”¨æ¥è¿‡æ»¤æ–‡æœ¬ã€‚</p>\n<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ ( <code>regular expression engine</code> ) å®ç°çš„ï¼Œè¯¥å¼•æ“æ˜¯ä¸€å¥—åº•å±‚è½¯ä»¶ï¼Œè´Ÿè´£è§£é‡Šæ­£åˆ™è¡¨è¾¾å¼å¹¶ä½¿ç”¨è¿™äº›æ¨¡å¼è¿›è¡Œ<strong>æ–‡æœ¬åŒ¹é…</strong>ã€‚</p>\n<p>åœ¨ <code>Linux</code>  ä¸­ï¼Œå­˜åœ¨ä¸¤ç§æµè¡Œçš„æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼š</p>\n<ul>\n<li><code>POSIX</code>  åŸºç¡€çš„æ­£åˆ™è¡¨è¾¾å¼ ( <code>basic regular expression,BRE</code> ) å¼•æ“ã€‚</li>\n<li><code>POSIX</code>  æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼ ( <code>extended regular expression,ERE</code> ) å¼•æ“ã€‚</li>\n</ul>\n<p>å¤§å¤šæ•° <code>Linux</code>  å·¥å…·éƒ½è‡³å°‘ç¬¦åˆ <code>BRE</code> , åƒ <code>sed</code>  ç­‰éƒ¨åˆ†å·¥å…·ï¼Œå‡ºäºé€Ÿåº¦æ–¹é¢çš„è€ƒè™‘ï¼Œåªèƒ½ç¬¦åˆ <code>BRE</code> ã€‚ <code>ERE</code>  é€šå¸¸å‡ºç°ä¾èµ–æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ–‡æœ¬è¿‡æ»¤çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¸ºå¸¸è§æ¨¡å¼æä¾›äº†é«˜çº§æ¨¡å¼ç¬¦å·å’Œç‰¹æ®Šç¬¦å·ã€‚ <code>gawk</code>  ç¨‹åºç”¨ <code>ERE</code>  å¼•æ“æ¥å¤„ç†å®ƒçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€‚</p>\n<h1 id=\"å®šä¹‰breæ¨¡å¼\"><a class=\"anchor\" href=\"#å®šä¹‰breæ¨¡å¼\">#</a> å®šä¹‰ BRE æ¨¡å¼</h1>\n<p>æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸å…³å¿ƒæ¨¡å¼åœ¨æ•°æ®æµä¸­çš„ä½ç½®ï¼Œä¹Ÿä¸å…³å¿ƒæ¨¡å¼å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œä¸€æ—¦åŒ¹é…åˆ°æ–‡æœ¬å­—ç¬¦ä¸²ä¸­ä»»æ„ä½ç½®ä¸Šçš„æ¨¡å¼ï¼Œå°±ä¼šå°†è¯¥å­—ç¬¦ä¸²ä¼ å› <code>Linux</code>  å·¥å…·ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç©ºæ ¼å’Œå…¶ä»–å­—ç¬¦å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>\n<h2 id=\"ç‰¹æ®Šå­—ç¬¦\"><a class=\"anchor\" href=\"#ç‰¹æ®Šå­—ç¬¦\">#</a> ç‰¹æ®Šå­—ç¬¦</h2>\n<p>æ­£åˆ™è¡¨è¾¾å¼å­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼š <code>.*[]^$&#123;&#125;\\+?|()</code> ã€‚è¦æƒ³åœ¨æ–‡æœ¬ä¸­ä½¿ç”¨è¿™äº›ç‰¹æ®Šç¬¦å·ï¼Œéœ€è¦åœ¨å‰åŠ ä¸Š <code>\\</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"/\\$/p\"</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å°½ç®¡æ­£æ–œçº¿ / å¹¶ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ˜¯è¦æ˜¯å‡ºç°åœ¨ sed å’Œ gawk çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œä¹Ÿè¦ä½¿ç”¨è½¬ä¹‰</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"/\\//p\"</span> data</pre></td></tr></table></figure><p>è¿™äº›ç‰¹æ®Šå­—ç¬¦å…·ä½“æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œåé¢è®²è§£ã€‚</p>\n<h2 id=\"é”šå­—ç¬¦\"><a class=\"anchor\" href=\"#é”šå­—ç¬¦\">#</a> é”šå­—ç¬¦</h2>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æŒ‡å®šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æ—¶ï¼Œåªè¦æ¨¡å¼å‡ºç°åœ¨æ•°æ®æµä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œå°±èƒ½åŒ¹é…ã€‚</p>\n<ul>\n<li>é”å®šè¡Œé¦–ï¼Œ <code>^</code> -- è„±å­—ç¬¦ï¼Œå®šä¹‰ä»æ•°æ®æµä¸­æ–‡æœ¬è¡Œçš„è¡Œé¦–å¼€å§‹çš„æ¨¡å¼ï¼Œå¦‚æœæ¨¡å¼å‡ºç°åœ¨è¡Œé¦–ä¹‹å¤–ï¼Œå°±æ— æ³•åŒ¹é…ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"the book store\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'/^the/p'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>the book store</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å¦‚æœæ˜¯ ^bookï¼Œå°±æ— æ³•åŒ¹é…</span></pre></td></tr></table></figure><ul>\n<li>é”å®šè¡Œå°¾ï¼Œä½¿ç”¨ <code>$</code>  ç¬¦å·ï¼Œæˆ‘è®°å¾—æˆ‘åœ¨ <code>sed</code>  è¿˜æ˜¯ <code>gawk</code>  é‚£ç¯‡æ–‡ç« è®²è¿‡ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"the book\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'/book$/p'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># åªæœ‰ä»¥ book ç»“å°¾çš„ï¼Œæ‰ä¼šè¢«åŒ¹é…</span></pre></td></tr></table></figure><h2 id=\"å…¶ä»–å­—ç¬¦\"><a class=\"anchor\" href=\"#å…¶ä»–å­—ç¬¦\">#</a> å…¶ä»–å­—ç¬¦</h2>\n<ul>\n<li>ç‚¹å­—ç¬¦ <code>.</code> ï¼Œç›¸å½“äºå ä½ç¬¦ï¼Œä½†æ˜¯è¯¥ä½ç½®ä¹Ÿå¿…é¡»è¦æœ‰å­—ç¬¦æ‰è¡Œã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'at the'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'/.at/p'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># åŒ¹é…å¤±è´¥</span></pre></td></tr></table></figure><ul>\n<li>å­—ç¬¦ç»„ <code>[]</code> ï¼Œè¯¥ä½ç½®å¦‚æœå‡ºç°å­—ç¬¦ç»„ä¸­çš„ä»»æ„å­—ç¬¦ï¼ŒåŒ¹é…ï¼š <code>echo &quot;to ac&quot; | sed -n '/[ab]c/p'</code> ã€‚å¯ä»¥è¿ç»­ä½¿ç”¨å¤šä¸ªå­—ç¬¦ç»„ï¼Œä½†æ˜¯ä¸€ä¸ªå­—ç¬¦ç»„åªèƒ½å ä¸€ä½ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è¿‡æ»¤é”™è¯¯çš„é‚®æ”¿ç¼–ç ï¼ˆç”± 5 ä½æ•°å­—ç»„æˆï¼‰</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> /^[0123456789][0123456789][0123456789][0123456789][0123456789]$/p</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> '</span> data</pre></td></tr></table></figure><ul>\n<li>æ’é™¤å‹å­—ç¬¦ç»„ï¼Œåœ¨å­—ç¬¦ç»„ä¸­å¼€å¤´åŠ ä¸Š <code>^</code> ï¼Œä»£è¡¨åè½¬ï¼Œå¦‚æœè¯¥ä½ç½®æ²¡æœ‰å­—ç¬¦ç»„ä¸­çš„å­—ç¬¦ï¼ŒåŒ¹é…æˆåŠŸã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'/[^ch]at/p'</span> data</pre></td></tr></table></figure><ul>\n<li>åŒºé—´ï¼Œå¯¹å­—ç¬¦ç»„çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ä» <code>a</code>  åˆ° <code>z</code>  ä¸ç”¨å†æŒ¨ä¸ªåˆ—å‡ºï¼š <code>[a-z]</code> , åŒºé—´é¡ºåºæ˜¯æ ¹æ® <code>Linux</code>  é‡‡ç”¨çš„å­—ç¬¦é›†ä¹Ÿå¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå½¢æˆä¸è¿ç»­çš„åŒºé—´å¹¶é›†ï¼š <code>[a-ch-m]</code> , åŒºé—´èŒƒå›´ä¸º <code>a-c,h-m</code> ã€‚</li>\n<li>ç‰¹æ®Šå­—ç¬¦ç»„ï¼ˆè®°ä¸ä½æ²¡å…³ç³»ï¼Œæˆ‘ä¹Ÿè®°ä¸ä½ï¼‰</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:alpha:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…ä»»æ„å­—æ¯å­—ç¬¦ï¼Œä¸ç®¡æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ (alphabet-- å…¨éƒ¨å­—æ¯ï¼›å­—æ¯è¡¨)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:alnum:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…ä»»æ„å­—æ¯æ•°å­—å­—ç¬¦ï¼Œ0-9,a-z,A-Z</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:blank:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:digit:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é… 0-9 ä¹‹é—´çš„æ•°å­—</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:lower:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é… a-z</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:upper:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é… A-Z</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:print:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…ä»»æ„å¯æ‰“å°å­—ç¬¦</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:punct:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…æ ‡ç‚¹ç¬¦å·</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>:sapce:<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\t\t<span class=\"token comment\"># åŒ¹é…ä»»æ„ç©ºç™½å­—ç¬¦ï¼šç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼ŒNLï¼ŒFFï¼ŒVTï¼ŒCR</span></pre></td></tr></table></figure><ul>\n<li>æ˜Ÿå·ï¼Œåœ¨å­—ç¬¦åé¢æ”¾ç½®æ˜Ÿå·ï¼Œè¡¨æ˜<strong>è¯¥å­—ç¬¦</strong>å¿…é¡»åœ¨åŒ¹é…æ¨¡å¼çš„æ–‡æœ¬ä¸­å‡ºç° 0 æ¬¡æˆ–å¤šæ¬¡ï¼ˆæˆ‘è§‰å¾—è¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½çŸ¥é“å§ï¼‰ï¼Œ <code>echo 'ik' | sed -n '/ie*k/p</code> ã€‚æ˜Ÿå·ä¹Ÿå¯ä»¥å’Œå­—ç¬¦ç»„åŒæ—¶ä½¿ç”¨ï¼Œ <code>[ac]*</code> ã€‚</li>\n</ul>\n<h1 id=\"æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ere\"><a class=\"anchor\" href=\"#æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ere\">#</a> æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ (ERE)</h1>\n<p><code>gawk</code>  ç¨‹åºèƒ½å¤Ÿè¯†åˆ« <code>ERE</code>  æ¨¡å¼ï¼Œä½†æ˜¯ <code>sed</code>  ä¸èƒ½ã€‚ <code>gawk</code>  å…·å¤‡è¿™äº›æ‰©å±•çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ­£å› ä¸ºå¦‚æ­¤ï¼Œ <code>gawk</code>  ç¨‹åºåœ¨å¤„ç†æ•°æ®æµæ—¶é€šå¸¸æ¯”è¾ƒæ…¢ã€‚</p>\n<ul>\n<li>é—®å· <code>?</code> ï¼Œç±»ä¼¼äº *, ä½†æ˜¯å‰é¢çš„å­—ç¬¦åªæ˜¯ 0 æ¬¡æˆ– 1 æ¬¡ï¼Œä¹Ÿå°±æ˜¯ï¼Œä¸ä¼šåŒ¹é…å¤šæ¬¡å‡ºç°çš„å­—ç¬¦ã€‚</li>\n<li>åŠ å· <code>+</code> ï¼Œä»ç„¶ç±»ä¼¼äº *, ä½†æ˜¯å¿…é¡»å‡ºç° 1 æ¬¡ã€‚</li>\n<li>èŠ±æ‹¬å· <code>&#123;&#125;</code> ï¼Œå…è®¸ä¸ºå¯é‡å¤çš„æ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šä¸€ä¸ªä¸Šé™ï¼Œé€šå¸¸ç§°ä¸ºé—´éš” ( <code>interval</code> ), å¯ä»¥ç”¨ä¸¤ç§æ ¼å¼æ¥æŒ‡å®šåŒºé—´ã€‚  <code>&#123;m&#125;</code> ï¼šæ­£åˆ™è¡¨è¾¾å¼å‡†ç¡®å‡ºç° <code>m</code>  æ¬¡ï¼Œ <code>&#123;m,n&#125;</code> ï¼šæ­£åˆ™è¡¨è¾¾å¼è‡³å°‘å‡ºç° <code>m</code>  æ¬¡ï¼Œè‡³å¤šå‡ºç° <code>n</code>  æ¬¡ã€‚å¯¹äº <code>gawk</code>  æ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>gawk</code>  ä¸ä¼šè¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼é—´éš”ï¼Œå¿…é¡»æŒ‡å®š <code>gawk</code>  ç¨‹åºçš„ <code>--re- interval</code>  å‘½ä»¤è¡Œé€‰é¡¹æ‰èƒ½è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼é—´éš”ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"bt\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> --re-interval <span class=\"token string\">'/be&#123;1&#125;t/&#123;print $0&#125;'</span> <span class=\"token comment\"># åŒ¹é…å¤±è´¥</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"bt\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> --re-interval <span class=\"token string\">'/be&#123;0,1&#125;t/&#123;print $0&#125;'</span> <span class=\"token comment\"># åŒ¹é…æˆåŠŸ</span></pre></td></tr></table></figure><ul>\n<li>ç®¡é“ç¬¦å· <code>|</code> ï¼Œç¬¦å·ç®¡é“å…è®¸åœ¨æ£€æŸ¥æ•°æ®æµæ—¶ï¼Œç”¨é€»è¾‘ <code>OR</code>  æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼è¦ç”¨çš„ä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡å¼ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªæ¨¡å¼åŒ¹é…äº†æ•°æ®æµæ–‡æœ¬ï¼Œæ–‡æœ¬é€šè¿‡æµ‹è¯•</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># expr1|expr2...</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'the cat is asleep'</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> <span class=\"token string\">'/cat|dog/&#123;print $0&#125;'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä½ è¿˜è®°å¾— lsof å‘½ä»¤çš„ - a é€‰é¡¹å—</span></pre></td></tr></table></figure><ul>\n<li>è¡¨è¾¾å¼åˆ†ç»„ <code>()</code> ï¼Œè¯¥ç»„ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ ‡å‡†å­—ç¬¦ï¼Œå¯ä»¥åƒå¯¹æ™®é€šå­—ç¬¦ä¸€æ ·ç»™è¯¥ç»„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"sta\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> <span class=\"token string\">'/sta(urday)?/&#123;print $0&#125;'</span>\t\t<span class=\"token comment\"># $0 è¡¨ç¤ºæ•´è¡Œæ•°æ®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å’Œç®¡é“ä¸€èµ·ä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"cat\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> <span class=\"token string\">'/(c|b)a(t|d)/&#123;print $0&#125;'</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/05/Shell/gawk%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/08/05/Shell/gawk%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/",
            "title": "gawkç¨‹åºåŸºç¡€",
            "date_published": "2022-08-05T02:29:39.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>gawk</code>  ç¨‹åºæ˜¯ <code>Unix</code>  ä¸­åŸå§‹ <code>gawk</code>  ç¨‹åºçš„ <code>GNU</code>  ç‰ˆæœ¬ï¼Œè®©æµç¼–è¾‘è¿ˆä¸Šäº†ä¸€ä¸ªæ–°çš„å°é˜¶ï¼Œå…¶ä½œç”¨ä¸ºï¼š</p>\n<ul>\n<li>å®šä¹‰å˜é‡ä¿å­˜æ•°æ®ã€‚</li>\n<li>ä½¿ç”¨ç®—æ•°å’Œå­—ç¬¦ä¸²æ“ä½œç¬¦å¤„ç†æ•°æ®ã€‚</li>\n<li>ä½¿ç”¨ç»“æ„åŒ–ç¼–ç¨‹æ¦‚å¿µæ¥ä¸ºæ•°æ®å¤„ç†å¢åŠ å¤„ç†é€»è¾‘ã€‚</li>\n<li>é€šè¿‡æå–æ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®å…ƒç´ ï¼Œå°†å…¶é‡æ–°æ’åˆ—æˆ–æ ¼å¼åŒ–ï¼Œç”Ÿæˆæ ¼å¼åŒ–æŠ¥å‘Š</li>\n</ul>\n<p>æ ¼å¼ï¼š <code>gawk options program file</code> ã€‚</p>\n<p><code>gawk</code>  å¼ºå¤§ä¹‹å¤„åœ¨äºç¨‹åºè„šæœ¬ï¼Œå¯ä»¥å†™è„šæœ¬æ¥è¯»å–æ–‡æœ¬è¡Œçš„æ•°æ®ï¼Œå¤„ç†å¹¶æ˜¾ç¤ºæ•°æ®ï¼Œåˆ›å»ºä»»ä½•ç±»å‹çš„è¾“å‡ºæŠ¥å‘Šã€‚</p>\n<p>å¦‚æœä½ æ²¡æœ‰ä¸‹è½½ <code>gwak</code> ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š <code>sudo apt install gawk</code> ã€‚</p>\n<h1 id=\"ä»å‘½ä»¤è¡Œè¯»å–è„šæœ¬ç¨‹åº\"><a class=\"anchor\" href=\"#ä»å‘½ä»¤è¡Œè¯»å–è„šæœ¬ç¨‹åº\">#</a> ä»å‘½ä»¤è¡Œè¯»å–è„šæœ¬ç¨‹åº</h1>\n<p><code>gawk</code>  ç¨‹åºè„šæœ¬ç”¨ä¸€å¯¹èŠ±æ‹¬å·å®šä¹‰ <code>&#123;&#125;</code> , å¿…é¡»å°†è„šæœ¬å‘½ä»¤æ”¾åœ¨èŠ±æ‹¬å·ä¸­ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> <span class=\"token string\">'&#123;print \"Hello World\"&#125;'</span></pre></td></tr></table></figure><p><code>print</code>  å‘½ä»¤ä¼šå°†æ–‡æœ¬æ‰“å°åˆ° <code>STDOUT</code>  ä¸­ï¼Œç”±äºæ²¡æœ‰åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šæ–‡ä»¶ï¼Œæ‰€ä»¥è¾“å…¥é»˜è®¤æ˜¯æ¥æ”¶ <code>STDIN</code> ã€‚ç”±äºè¯¥å‘½ä»¤å›ºå®šæ˜¾ç¤º <code>Hello World</code> ï¼Œæ‰€ä»¥ä¸è®ºè¾“å…¥ä»€ä¹ˆï¼Œéƒ½åªä¼šæ˜¾ç¤ºè¿™ä¸ªã€‚å¸Œæœ›ç»“æŸç¨‹åºï¼Œå¿…é¡»è¡¨æ˜æ•°æ®æµå·²ç»ç»“æŸï¼Œ <code>ctrl+d</code>  ä¼šäº§ç”Ÿä¸€ä¸ª <code>EOF</code>  å­—ç¬¦ï¼Œèƒ½å¤Ÿç»ˆæ­¢ <code>gawk</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> <span class=\"token string\">'&#123;print \"Hello world\"&#125;'</span> testfile   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># ä½¿ç”¨æ–‡ä»¶ä½œä¸ºè¾“å…¥</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ç”±äº gawk å‘½ä»¤è¡Œå‡å®šè„šæœ¬æ˜¯ä¸ªå•ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ ''</span></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨å¤šå‘½ä»¤ï¼Œè¿˜æ˜¯ä½¿ç”¨åˆ†å·</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"this is rich\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">gawk</span> <span class=\"token string\">'&#123;$4=\"Mike\";print $0&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\"># ä¹Ÿå¯ä»¥åˆ†è¡Œ</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     <span class=\"token function\">gawk</span> <span class=\"token string\">'&#123;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  > $3='</span><span class=\"token number\">123</span><span class=\"token string\">'</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  > print $0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  > &#125;'</span></pre></td></tr></table></figure><p>è¿™ä¸ªä¸ <code>sed</code>  çš„å¤šå‘½ä»¤ç›¸ä¼¼ï¼Œä¸¤è€…çš„æ ¼å¼åŒºåˆ«åœ¨äºï¼Œ <code>sed</code>  çš„å‘½ä»¤ç›´æ¥ä½¿ç”¨ <code>''</code> ï¼Œ <code>gawk</code>  ä½¿ç”¨ <code>'&#123;&#125;'</code> ï¼Œå¦‚æœå°†å‘½ä»¤æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œä¸¤è€…æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ä½¿ç”¨ <code>-f</code>  å‚æ•°ï¼Œæ–‡ä»¶åä¸ºäº†é¿å…æ··æ·†ï¼Œä¹Ÿä¼šä»¥. <code>gawk</code>  åç¼€å‘½åã€‚åœ¨ <code>gawk</code>  å‘½ä»¤æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å®šä¹‰å˜é‡ï¼ŒåŒæ—¶ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦ <code>$</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">text</span><span class=\"token operator\">=</span><span class=\"token string\">'213'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>print text</pre></td></tr></table></figure><h1 id=\"æ•°æ®å­—æ®µå˜é‡\"><a class=\"anchor\" href=\"#æ•°æ®å­—æ®µå˜é‡\">#</a> æ•°æ®å­—æ®µå˜é‡</h1>\n<p><code>gawk</code>  ä¼šç»™ä¸€è¡Œä¸­æ¯ä¸ªæ•°æ®å…ƒç´ åˆ†é…ä¸€ä¸ªå˜é‡ï¼ˆé»˜è®¤æ•°æ®åˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ï¼‰ <code>$0</code> -- æ•´è¡Œæ•°æ®     <code>$n</code> -- ç¬¬ <code>n</code>  ä¸ªæ•°æ®</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">gawk</span> -F: <span class=\"token string\">'&#123;print $1&#125;'</span> data</pre></td></tr></table></figure><p>æ‰“å° data æ¯è¡Œç¬¬ä¸€ä¸ªæ•°æ®ï¼Œ <code>-F</code>  æŒ‡å®šåˆ†éš”ç¬¦ï¼Œä»¥ <code>:</code>  ä¸ºåˆ†éš”ç¬¦ã€‚</p>\n<h1 id=\"ç¨‹åºè„šæœ¬çš„è¿è¡Œ\"><a class=\"anchor\" href=\"#ç¨‹åºè„šæœ¬çš„è¿è¡Œ\">#</a> ç¨‹åºè„šæœ¬çš„è¿è¡Œ</h1>\n<p><code>gawk</code>  å…è®¸æŒ‡å®šç¨‹åºè„šæœ¬<strong>ä½•æ—¶è¿è¡Œ</strong>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>gawk</code>  ä¼šä»è¾“å…¥è¯»å–ä¸€è¡Œè„šæœ¬ï¼Œç„¶åé’ˆå¯¹è¯¥è¡Œæ•°æ®è¿è¡Œç¨‹åºè„šæœ¬ï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶éœ€è¦åœ¨å¤„ç†æ•°æ®å‰è¿è¡Œè„šæœ¬ï¼Œæœ‰æ—¶åœ¨ä¹‹åå¤„ç†è„šæœ¬ã€‚</p>\n<ul>\n<li><code>BEGIN</code>  å…³é”®å­—ï¼šä¼šå¼ºåˆ¶ <code>gawk</code>  åœ¨è¯»å–æ•°æ®å‰æ‰§è¡Œ <code>BEIGIN</code>  å…³é”®å­—åæŒ‡å®šçš„ç¨‹åºè„šæœ¬</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN &#123;print \"hello\"&#125;'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>hello</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å› ä¸ºæ²¡æœ‰å…¶ä»–å¤„ç†æ•°æ®çš„å‘½ä»¤ï¼Œç›´æ¥é€€å‡º</span></pre></td></tr></table></figure><p><code>print</code>  æ˜¾ç¤ºå®Œæ–‡æœ¬åä¼šå¿«é€Ÿé€€å‡ºï¼Œä¸ç­‰å¾…ä»»ä½•æ•°æ®ï¼Œå¦‚æœæƒ³ä½¿ç”¨æ­£å¸¸çš„ç¨‹åºè„šæœ¬ä¸­å¤„ç†æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨å¦ä¸€ä¸ªè„šæœ¬åŒºåŸŸæ¥å®šä¹‰ç¨‹åºï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN &#123;print \"hello\"&#125;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> &#123;print $1&#125;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> '</span> data</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>hello</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr></table></figure><ul>\n<li><code>END</code>  å…³é”®å­—ï¼šä¼šåœ¨è¯»å–æ•°æ® (æ˜¯æ‰€æœ‰æ•°æ®) å¤„ç†å®Œä¹‹åï¼Œæ‰§è¡Œ <code>END</code>  åé¢çš„ç¨‹åºè„šæœ¬</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">gawk</span> <span class=\"token string\">'BEGIN &#123;print \"The data file content:\"&#125;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> &#123;print $1&#125;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> END &#123;print \"END of file\"&#125;'</span> data</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>The data <span class=\"token function\">file</span> content:</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>END of <span class=\"token function\">file</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/04/Shell/sed%E7%BC%96%E8%BE%91%E5%99%A8%E5%9F%BA%E7%A1%80/",
            "url": "https://cecilia.cool/2022/08/04/Shell/sed%E7%BC%96%E8%BE%91%E5%99%A8%E5%9F%BA%E7%A1%80/",
            "title": "sedç¼–è¾‘å™¨åŸºç¡€",
            "date_published": "2022-08-04T15:27:23.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>sed</code>  ç¼–è¾‘å™¨è¢«ç§°ä½œ<strong>æµç¼–è¾‘å™¨</strong> ( <code>stream editor</code> )ï¼Œæµç¼–è¾‘å™¨ä¼šåœ¨ç¼–è¾‘å™¨å¤„ç†æ•°æ®ä¹‹å‰åŸºäºé¢„å…ˆæä¾›çš„ä¸€ç»„<strong>æ•°æ®è§„åˆ™</strong>æ¥ç¼–è¾‘æ•°æ®æµã€‚æ ¹æ®å‘½ä»¤æ¥å¤„ç†æ•°æ®ï¼Œè¿™äº›å‘½ä»¤è¦ä¹ˆä»å‘½ä»¤è¡Œè¾“å…¥ï¼Œè¦ä¹ˆå­˜å‚¨åœ¨ä¸€ä¸ªå‘½ä»¤æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚</p>\n<p><code>sed</code>  ç¼–è¾‘å™¨å¤„ç†äº‹åŠ¡ï¼š</p>\n<ol>\n<li>ä¸€æ¬¡ä»è¾“å…¥ä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚</li>\n<li>æ ¹æ®æä¾›çš„ç¼–è¾‘å™¨å‘½ä»¤åŒ¹é…æ•°æ®ã€‚</li>\n<li>æŒ‰ç…§å‘½ä»¤ä¿®æ”¹æµä¸­çš„æ•°æ®ã€‚</li>\n<li>å°†æ–°çš„æ•°æ®è¾“å‡ºåˆ° <code>STDOUT</code> ã€‚</li>\n</ol>\n<p><code>sed</code>  å°†æ‰€æœ‰å‘½ä»¤ä¸ä¸€è¡Œæ•°æ®åŒ¹é…å®Œæ¯•åï¼Œè¯»å–ä¸‹ä¸€è¡Œæ•°æ®å¹¶é‡å¤è¯¥è¿‡ç¨‹ï¼Œå¤„ç†å®Œæ‰€æœ‰æ•°æ®ï¼Œç»ˆæ­¢ã€‚</p>\n<h1 id=\"åŸºæœ¬æ ¼å¼\"><a class=\"anchor\" href=\"#åŸºæœ¬æ ¼å¼\">#</a> åŸºæœ¬æ ¼å¼</h1>\n<p>æ ¼å¼ï¼š <code>sed options script file</code> ã€‚</p>\n<p>ä¸ºäº†æ›´å¥½ç†è§£ï¼Œä¸¾ä¸ªä¾‹å­ã€‚</p>\n<p>å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®æ–‡ä»¶ <code>data</code> ï¼Œå…¶ä¸­åŒ…å«<strong> 6 è¡Œ 'cat'</strong>ã€‚ç„¶åæˆ‘ä»¬å¸Œæœ›å°† 'cat' æ›¿æ¢ä¸º 'dog'ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token string\">'s/cat/dog/'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dog</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># â€˜s/cat/dog/â€™æ˜¯åè€…æ›¿æ¢å‰è€…</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># æ­¤æ¬¡å‘½ä»¤æ²¡æœ‰ä½¿ç”¨é€‰é¡¹ï¼Œscirpt å°±æ˜¯'s/cat/dog' file å°±æ˜¯ data</span></pre></td></tr></table></figure><p><code>sed</code>  å‘½ä»¤éå¸¸å¿«ã€‚å¤„ç†ä¸€è¡Œæ˜¾ç¤ºä¸€è¡Œï¼Œä½†æ˜¯ <code>sed</code>  å¹¶ä¸ä¼šä¿®æ”¹æ–‡ä»¶åŸå§‹æ•°æ®ï¼Œåªæ˜¯å°†ç»“æœä¼ ç»™ <code>STDOUT</code>  è€Œå·²ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é‡å®šå‘ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'s/cat/big cat/'</span> data <span class=\"token operator\">></span> result</pre></td></tr></table></figure><p><code>sed</code>  å¯ä»¥æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä½¿ç”¨ <code>-e</code>  é€‰é¡¹ï¼Œå¤šä¸ªå‘½ä»¤åˆ†å·éš”å¼€ï¼Œå¹¶ä¸”åˆ†å·ç´§é ä¸Šä¸€ä¸ªå‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/brown/green/; s/dog/cat/'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æˆ–è€…æ˜¯è¿™æ ·ï¼Œshell ä¸€æ—¦å‘ç°å°å°¾çš„å•å¼•å·ï¼Œå°±ä¼šæ‰§è¡Œå‘½ä»¤</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>> s/brown/green</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>> s/fox/cat</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>> '</span> data</pre></td></tr></table></figure><p>å¦‚æœè¦æ‰§è¡Œçš„å‘½ä»¤å¤ªå¤šï¼Œå¯ä»¥æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ <code>-f</code>  é€‰é¡¹ï¼Œè¯¥é€‰é¡¹ä¼šåœ¨å¤„ç†è¾“å…¥æ—¶ï¼Œå°†æ–‡ä»¶ä¸­æŒ‡å®šçš„å‘½ä»¤æ·»åŠ åˆ°å·²æœ‰çš„å‘½ä»¤ä¸­ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-f</span> script.sed data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># ä¸ºé¿å…æ··æ·†ï¼Œä¸€èˆ¬å°† sed çš„å‘½ä»¤æ–‡ä»¶åç¼€å†™ä¸º.sed</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä¾‹å­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> command.sed</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>s/cat/dog/</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>s/Jack/Mark/</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">cat</span> Jack</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">cat</span> Jack</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">cat</span> Jack</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">cat</span> Jack</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">cat</span> Jack</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-f</span> command.sed data</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>dog Mark</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>dog Mark</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>dog Mark</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>dog Mark</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>dog Mark</pre></td></tr></table></figure><p>å…³äº <code>s</code>  æ›¿æ¢å‘½ä»¤ï¼Œè¿˜æœ‰å…¶ä»–é€‰é¡¹</p>\n<ul>\n<li><code>sed 's/cat/dog/' data</code>  åªä¼šæ›¿æ¢æ¯è¡Œç¬¬ä¸€å¤„ <code>cat</code> ã€‚å¦‚æœæƒ³åœ¨ç¬¬ <code>n</code>  å¤„æ›¿æ¢ï¼Œ <code>s/cat/dog/n'</code> ã€‚</li>\n<li><code>g</code>  é€‰é¡¹ï¼Œæ‰€æœ‰åŒ¹é…åˆ°çš„æ ‡è®°éƒ½ä¼šè¢«æ›¿æ¢ã€‚</li>\n<li><code>p</code>  é€‰é¡¹ï¼Œæ–‡æœ¬åŸå…ˆè¡Œå†…å®¹æ›¿æ¢åè¦æ‰“å°å‡ºæ¥ï¼š <code>sed -n 's/cat/dog/p' data</code> , ä¸€èˆ¬å’Œ <code>-n</code>  é…åˆä½¿ç”¨ï¼Œ <code>-n</code>  ç¦æ­¢ <code>sed</code>  è¾“å‡ºï¼Œé…åˆ <code>p</code>  ä½¿ç”¨ï¼Œå°±åªä¼šæ‰“å°å«æœ‰æ ‡è®°çš„æ–‡æœ¬ã€‚</li>\n<li><code>w file</code> , å°†æ›¿æ¢çš„ç»“æœå†™åˆ°æ–‡ä»¶ä¸­ï¼š <code>sed 's/cat/dog/w aim.txt' data</code> ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sed</span> <span class=\"token string\">'s/cat/dog/w test_data'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> test_data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>dog Jack</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>dog Jack</pre></td></tr></table></figure><p>æœ‰æ—¶å€™ï¼Œ <code>/</code>  ä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>!</code>  æ¥ä»£æ›¿ï¼š <code>s!cat!dog!</code> ã€‚</p>\n<h1 id=\"ä½¿ç”¨åœ°å€\"><a class=\"anchor\" href=\"#ä½¿ç”¨åœ°å€\">#</a> ä½¿ç”¨åœ°å€</h1>\n<p>å¯ä»¥æŒ‡å®šå‘½ä»¤å¯¹æŸäº›ç‰¹å®šçš„è¡Œæ•°è¿›è¡Œå¤„ç†ï¼Œ <code>sed</code>  ç¼–è¾‘å™¨çš„è¡Œå¯»å€æœ‰ä¸¤ç§å½¢å¼ï¼š</p>\n<ul>\n<li>æ•°å­—è¡¨ç¤ºè¡ŒåŒºé—´</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 1. å¯¹å•è¡ŒæŒ‡å®šä¿®æ”¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'2s/cat/dog/'</span> data</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 2. å¯¹è¡ŒåŒºé—´è¿›è¡Œæ‰§è¡Œä¿®æ”¹</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'2,5s/cat/dog'</span> data <span class=\"token comment\"># 2~5 è¡Œè¢«ä¿®æ”¹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 3. ç¾å…ƒç¬¦å· $</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'2,$s/cat/dog/'</span> data   <span class=\"token comment\"># å¯¹ 2 è¡ŒåŠä»¥ä¸‹çš„æ•°æ®æ‰§è¡Œå‘½ä»¤</span></pre></td></tr></table></figure><ul>\n<li>æ–‡æœ¬æ¨¡å¼æ¥è¿‡æ»¤å‡ºè¡Œï¼Œ <code>/pattern/command</code> ã€‚æ¯”å¦‚ä¿®æ”¹ç”¨æˆ· <code>cyan</code>  çš„é»˜è®¤ <code>shell</code> ã€‚åŒ¹é…æ¨¡å¼ååˆ†ç±»ä¼¼ <code>grep</code> ï¼Œå›ºå®šæ–‡æœ¬ä½œç”¨æœ‰é™ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚ åŒ¹é…æ¨¡å¼ååˆ†ç±»ä¼¼ grepï¼Œå›ºå®šæ–‡æœ¬ä½œç”¨æœ‰é™ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">grep</span> cyan /etc/passwd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan:x:1000:1000:cyan,,,:/home/cyan:/bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$sed</span> <span class=\"token string\">'/cyan/s/bash/csh/'</span> /etc/psswd</pre></td></tr></table></figure><ul>\n<li>å½“æœ‰å¤šæ¡å‘½ä»¤æ—¶å€™ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>address <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">#å¤šæ¡å‘½ä»¤æ—¶ï¼Œéœ€è¦ç”¨ &#123;&#125; æ¥é™å®šä½œç”¨åŸŸ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        command1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        command2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># ä¾‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'2&#123;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>> commands    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>&#125;'</span> data.txt</pre></td></tr></table></figure><h1 id=\"åˆ é™¤ä¸ä¿®æ”¹\"><a class=\"anchor\" href=\"#åˆ é™¤ä¸ä¿®æ”¹\">#</a> åˆ é™¤ä¸ä¿®æ”¹</h1>\n<p><code>sed</code>  å¯ä»¥æ›¿æ¢ï¼Œä¹Ÿå¯ä»¥åˆ é™¤ï¼Œä½¿ç”¨ <code>d</code>  å‘½ä»¤ï¼š <code>sed '3d' data</code> ï¼Œå’Œè¡Œå¯»å€ä¸€èµ·ä½¿ç”¨å‘æŒ¥æœ€å¤§ä½œç”¨ã€‚è¾“å‡ºåˆ° STDOUT çš„ç»“æœæ˜¯åˆ é™¤æŒ‡å®šè¡Œä¹‹åçš„å‰©ä½™æ–‡æœ¬ã€‚</p>\n<p>å¦‚æœæˆ‘å¸Œæœ›åˆ é™¤æŸä¸ªåŒºé—´çš„æ–‡æœ¬ï¼ˆä½¿ç”¨æ–‡æœ¬åŒ¹é…ï¼‰</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>num start</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>num <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>num <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>num end</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>num <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>num start again</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>kk</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>nn</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># æ‰§è¡Œå‘½ä»¤ï¼šsed '/start/,/end/d' data</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># ç»“æœ num 4</span></pre></td></tr></table></figure><p>ä¸€å¼€å§‹é‡åˆ° <code>start</code> ï¼Œæ‰“å¼€åˆ é™¤æ¨¡å¼ï¼ŒæŒç»­åˆ é™¤ï¼Œç›´åˆ°é‡åˆ° <code>end</code> ï¼Œå…³é—­åˆ é™¤æ¨¡å¼ (æ²¡é‡åˆ°å°±ä¸€ç›´åˆ é™¤ï¼‰ã€‚å†æ¬¡é‡åˆ° <code>start</code>  æ—¶ ( <code>num start again</code> )ï¼Œæ‰“å¼€åˆ é™¤æ¨¡å¼ï¼Œå¹¶æŒç»­åˆ é™¤ã€‚</p>\n<p><code>sed</code>  ç¼–è¾‘å™¨æ˜¯ä¸ä¼šä¿®æ”¹åŸå§‹æ–‡ä»¶çš„ï¼Œä¿®æ”¹çš„åªæ˜¯ä» <code>sed</code>  ç¼–è¾‘å™¨çš„è¾“å‡ºä¸­æ¶ˆå¤±äº†ã€‚</p>\n<p>è‡³äºä¿®æ”¹è¡Œçš„å†…å®¹ï¼Œä¹‹å‰çš„ <code>s</code>  å‘½ä»¤éœ€è¦åŒ¹é…ï¼Œè€Œ <code>c</code>  å‘½ä»¤æ˜¯ç›´æ¥ä¿®æ”¹æ•´è¡Œå†…å®¹ï¼Œ <code>c--change</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'1c\\this is changed line'</span> data.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'/num 1/c\\this is changed line'</span> data.txt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'2,3c\\this is changed line'</span> data.txt</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># c å‘½ä»¤ä¹‹åç”¨çš„æ˜¯åæ–œæ  \\, å¹¶ä¸”æ²¡æœ‰å°å°¾ï¼Œä¹Ÿå°±æ˜¯ line åæ²¡æœ‰ \\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ç¬¬ä¸‰ä¸ªä½¿ç”¨åŒºé—´ä¿®æ”¹è¡Œï¼Œå¹¶ä¸æ˜¯å°†åŒºé—´çš„æ¯ä¸€è¡Œéƒ½ä¿®æ”¹ä¸ºæŒ‡å®šè¡Œï¼Œè€Œæ˜¯ç”¨è¯¥æŒ‡å®šè¡Œæ›¿æ¢æ•°æ®æµä¸­åŒºé—´çš„æ‰€æœ‰æ–‡æœ¬</span></pre></td></tr></table></figure><h1 id=\"æ’å…¥å’Œé™„åŠ æ–‡æœ¬\"><a class=\"anchor\" href=\"#æ’å…¥å’Œé™„åŠ æ–‡æœ¬\">#</a> æ’å…¥å’Œé™„åŠ æ–‡æœ¬</h1>\n<p>æ’å…¥ <code>insert--i</code> : ä¼šåœ¨æŒ‡å®šè¡Œ<strong>å‰</strong>å¢åŠ ä¸€ä¸ªè¡Œï¼Œ <code>echo &quot;test line 2&quot; | sed 'i\\test line 1'</code> ã€‚<br />\né™„åŠ  <code>append--a</code> : ä¼šåœ¨æŒ‡å®šè¡Œ<strong>å</strong>å¢åŠ ä¸€ä¸ªè¡Œï¼Œ <code>echo &quot;test line 2&quot; | sed 'a\\test line 1'</code> ã€‚</p>\n<p>å¦‚æœæƒ³è¦é™„åŠ åˆ°è¡Œå°¾ï¼Œåªéœ€è¦ä½¿ç”¨ç¾å…ƒç¬¦å·ï¼š <code>sed '$a\\new line' data</code> ã€‚<strong>ä¸ªäººè§‰å¾—ç¾å…ƒç¬¦å·æ˜¯æ•°æ®æµæœ€åä¸€è¡Œçš„æ„æ€</strong>ã€‚<br />\nè¦æ’å…¥ï¼ˆé™„åŠ ï¼‰å¤šè¡Œæ•°æ®ï¼Œéœ€è¦åœ¨æ¯è¡Œä¹‹é—´ä½¿ç”¨ <code>\\</code> ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'1i\\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>> line 1\\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>> line 2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>> '</span> data</pre></td></tr></table></figure><h1 id=\"è½¬æ¢å‘½ä»¤\"><a class=\"anchor\" href=\"#è½¬æ¢å‘½ä»¤\">#</a> è½¬æ¢å‘½ä»¤</h1>\n<p><code>y</code>  å‘½ä»¤æ˜¯å”¯ä¸€å¯ä»¥å¤„ç†å•ä¸ªå­—ç¬¦çš„ <code>sed</code>  ç¼–è¾‘å™¨å‘½ä»¤   <code>[address]y/inchars/outchars/</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'y/123/789/'</span> data</pre></td></tr></table></figure><p><code>inchars</code>  çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šè¢«æ˜ å°„ä¸º <code>outchars</code>  çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å¤„ç†å®ŒæŒ‡å®šå­—ç¬¦ã€‚å…¶ä¸­ï¼Œå¦‚æœä¸¤è€…é•¿åº¦ä¸ä¸€æ ·ï¼Œä¼šæŠ¥é”™ã€‚<br />\nè½¬æ¢å‘½ä»¤æ˜¯å…¨å±€å‘½ä»¤ï¼Œæ— æ³•é™å®šåªè½¬æ¢åœ¨ç‰¹å®šåœ°æ–¹å‡ºç°çš„å­—ç¬¦ (ä»¥è¡Œä¸ºå•ä½)ï¼Œä¹Ÿå°±æ˜¯<strong>ä¸€è¡Œæ‰€æœ‰çš„å­—ç¬¦éƒ½è¦è¢«è½¬æ¢</strong>ã€‚</p>\n<h1 id=\"æ‰“å°å‘½ä»¤\"><a class=\"anchor\" href=\"#æ‰“å°å‘½ä»¤\">#</a> æ‰“å°å‘½ä»¤</h1>\n<p>ä¹‹å‰ä½¿ç”¨ <code>s</code>  æ›¿æ¢å‘½ä»¤æ—¶ï¼Œé…åˆ <code>-n</code>  å’Œ <code>p</code>  é€‰é¡¹ï¼Œæ‰“å°å‡ºä¿®æ”¹çš„è¡Œï¼Œè¿˜æœ‰äº›å‘½ä»¤ä¹Ÿèƒ½æ‰“å°æ•°æ®æµä¿¡æ¯ã€‚</p>\n<p><code>=</code>  å‘½ä»¤æ‰“å°<strong>è¡Œå·</strong>ï¼Œ<strong>è¡Œå·ç”±æ•°æ®æµä¸­çš„æ¢è¡Œç¬¦æ¥å†³å®š</strong>ï¼Œæ¯å‡ºç°ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œsed ç¼–è¾‘å™¨å°±è®¤ä¸ºä¸€è¡Œç»“æŸäº†ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'='</span> data</pre></td></tr></table></figure><p><code>l</code>  å‘½ä»¤å¯ä»¥æ‰“å°å‡ºæ•°æ®æµä¸­çš„æ–‡æœ¬å’Œä¸å¯æ‰“å°çš„ ASCII å­—ç¬¦ (ä¸€èˆ¬æ˜¯æ ‡å‡† C é£æ ¼æˆ–å…«è¿›åˆ¶)ï¼Œ <code>l</code>  å°±æ˜¯ <code>list</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'l'</span> data</pre></td></tr></table></figure><h1 id=\"å¤„ç†æ–‡ä»¶\"><a class=\"anchor\" href=\"#å¤„ç†æ–‡ä»¶\">#</a> å¤„ç†æ–‡ä»¶</h1>\n<ul>\n<li>å†™å…¥æ–‡ä»¶ï¼š <code>[address]w filename</code> ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">'1,2w aim.txt'</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token comment\"># åœ¨ aim.txt è¿½åŠ </span></pre></td></tr></table></figure><ul>\n<li>è¯»å–æ–‡ä»¶ï¼š <code>[address]r filename</code> ã€‚ å…è®¸å°†ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶ä¸­çš„æ•°æ®æ’å…¥åˆ°æ•°æ®æµä¸­ï¼Œæ’å…¥åˆ°æŒ‡å®šè¡Œåã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token string\">'3r sources.txt'</span> data</pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/04/Shell/%E5%87%BD%E6%95%B0/",
            "url": "https://cecilia.cool/2022/08/04/Shell/%E5%87%BD%E6%95%B0/",
            "title": "å‡½æ•°",
            "date_published": "2022-08-03T16:46:24.000Z",
            "content_html": "<h1 id=\"åˆ›å»ºå‡½æ•°\"><a class=\"anchor\" href=\"#åˆ›å»ºå‡½æ•°\">#</a> åˆ›å»ºå‡½æ•°</h1>\n<p>æ ¼å¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ ¼å¼ 1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function-name function\">name</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tcommands</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># æ ¼å¼ 2, æ›´æ¨èä½¿ç”¨</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function-name function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tcommands</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># ä½¿ç”¨æ—¶åªéœ€è¦ä½¿ç”¨å‡½æ•°åå³å¯ --name</span></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•°é€€å‡ºçŠ¶æ€ç æ˜¯å‡½æ•°ä¸­æœ€åä¸€æ¡å‘½ä»¤è¿”å›çš„é€€å‡ºçŠ¶æ€ç ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œå¯ä»¥ç”¨æ ‡å‡†å˜é‡ <code>$?</code>  æ¥ç¡®å®šå‡½æ•°é€€å‡ºçŠ¶æ€ç ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># return è¯­å¥</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> <span class=\"token parameter variable\">-p</span> <span class=\"token string\">\"please input the value:\"</span> value</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token builtin class-name\">return</span> <span class=\"token variable\">$value</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é€€å‡ºçŠ¶æ€ç åœ¨ <code>0~255</code> ï¼Œå¦åˆ™å°±ä¼šè¿”å›é”™è¯¯å€¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token string\">'abc'</span> <span class=\"token comment\"># ä¼šæŠ¥é”™ï¼šline 5: return: abc: numeric argument required</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token builtin class-name\">return</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>fun</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># å¦‚æœä¸­é—´æœ‰å…¶ä»–å‘½ä»¤ï¼Œ$? å°±ä¼šè¢«ç½® 0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$?</span></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœå¸Œæœ›ä»å‡½æ•°é‚£å¾—åˆ°ä¸€ä¸ªä»»æ„å¯¹è±¡ï¼Œå°±åƒå¼ºç±»å‹è¯­è¨€é‚£æ · <code>return</code>  è¯­å¥è¿”å›å€¼å¯ä»¥ç”¨å˜é‡æ¥æ”¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">value</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> $<span class=\"token punctuation\">[</span><span class=\"token variable\">$value</span>*2<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">reslut</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>fun<span class=\"token variable\">`</span></span> <span class=\"token comment\">#æˆ–è€…æ˜¯ $(fun)</span></pre></td></tr></table></figure><p>å¦‚æ­¤å¯ä»¥è·å¾—ä»»ä½•ç±»å‹çš„å‡½æ•°è¾“å‡ºï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨å˜é‡ä¸­ã€‚</p>\n<h1 id=\"å‡½æ•°ä¸­ä½¿ç”¨å˜é‡\"><a class=\"anchor\" href=\"#å‡½æ•°ä¸­ä½¿ç”¨å˜é‡\">#</a> å‡½æ•°ä¸­ä½¿ç”¨å˜é‡</h1>\n<p><strong>ä¼ å‚ï¼š</strong></p>\n<ul>\n<li><code>bash shell</code>  ä¼šå°†å‡½æ•°å½“æˆä¸€ä¸ªå°å‹è„šæœ¬æ¥å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä¼ é€’å‚æ•°ï¼Œå¦‚åŒè„šæœ¬ä¸€æ ·ã€‚</li>\n<li>å¦‚åŒè„šæœ¬ä¸€æ ·ï¼Œå¯¹äºä¼ å…¥å‚æ•°ï¼Œä¾æ—§æ˜¯ä½¿ç”¨ <code>$0,$1...</code> ï¼Œ <code>$#</code> æ˜¯ä¼ å…¥å‚æ•°æ•°é‡ã€‚ <code>value=$(fun 10 15)</code> , å‚æ•°ç›´æ¥å†™åœ¨åé¢å³å¯ã€‚</li>\n<li>ç”±äºå‡½æ•°ä½¿ç”¨ç‰¹æ®Šå‚æ•°ç¯å¢ƒå˜é‡ä½œä¸ºè‡ªå·±çš„å‚æ•°å€¼ï¼Œå› æ­¤ä»–æ— æ³•ç›´æ¥è·å–è„šæœ¬åœ¨å‘½ä»¤è¡Œè·å–çš„å‚æ•°å€¼ã€‚</li>\n</ul>\n<p><strong>å¤„ç†å˜é‡ï¼š</strong></p>\n<p>æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯å˜é‡çš„ä½œç”¨åŸŸã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>å®šä¹‰çš„å˜é‡éƒ½æ˜¯å…¨å±€å˜é‡</strong>ï¼Œå‡½æ•°å¤–å®šä¹‰çš„å˜é‡ï¼Œå‡½æ•°å†…éƒ¨ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å‡½æ•°å†…å®šä¹‰çš„å˜é‡å‡½æ•°å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token builtin class-name\">return</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>fun</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr></table></figure><p>å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„ä»»ä½•å˜é‡éƒ½å¯ä»¥è¢«å£°æ˜æˆå±€éƒ¨å˜é‡ï¼Œåªéœ€è¦åŠ ä¸Š <code>local</code>  å…³é”®å­—å³å¯ã€‚</p>\n<p><code>local temp=$[$value + 2]</code> , åœ¨å‡½æ•°å†…ä½¿ç”¨ <code>temp</code> ï¼Œä¸ä¼šå½±å“ä¸»ä½“è„šæœ¬çš„ <code>temp</code>  çš„å€¼ã€‚</p>\n<h1 id=\"æ•°ç»„\"><a class=\"anchor\" href=\"#æ•°ç»„\">#</a> æ•°ç»„</h1>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">arr</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>one two three<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç›´æ¥ <code>$arr</code>  åªä¼šæ˜¾ç¤º <code>one</code> ï¼Œä½¿ç”¨æ ¼å¼ä¸ºï¼š <code>$&#123;arr[1]&#125;</code> , ä¸€æ¬¡æ€§å…¨éƒ¨æ˜¾ç¤ºï¼Œå°±æ˜¯ <code>$&#123;arr[*]&#125;</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token builtin class-name\">local</span> <span class=\"token assign-left variable\">arr</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">1,2</span>,3,4<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">i</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">$&#123;arr<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">$i</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token builtin class-name\">echo</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>fun</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#ç»“æœï¼š1,2,3,4</span></pre></td></tr></table></figure><h1 id=\"åˆ›å»ºåº“\"><a class=\"anchor\" href=\"#åˆ›å»ºåº“\">#</a> åˆ›å»ºåº“</h1>\n<p>æ€»æœ‰ä¸€äº›æ–¹æ³•ï¼Œæˆ‘åœ¨å¾ˆå¤šè„šæœ¬æ–‡ä»¶ä¸­éƒ½ä¼šä½¿ç”¨ï¼Œä¸ºäº†é¿å…æ¯ä¸ªè„šæœ¬æ–‡ä»¶éƒ½å†™ä¸€æ¬¡ï¼Œ <code>bash shell</code>  å…è®¸åˆ›å»ºå‡½æ•°åº“æ–‡ä»¶ï¼Œç„¶ååœ¨å¤šä¸ªè„šæœ¬ä¸­å¼•ç”¨ã€‚</p>\n<p>æˆ‘ä»¬åœ¨è¿è¡Œä¸€ä¸ªè„šæœ¬æ–‡ä»¶æ—¶ï¼Œå½“å‰çš„ <code>shell</code>  ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>shell</code>  è¿è¡Œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./testfile <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">89708</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--forest</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token number\">88948</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token number\">89708</span> pts/1    00:00:08  <span class=\"token punctuation\">\\</span>_ testfile</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token number\">89710</span> pts/1    00:00:00  <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">ps</span></pre></td></tr></table></figure><p><code>shell</code>  å‡½æ•°ä»…ä»…åœ¨å®šä¹‰å®ƒçš„ <code>shell</code>  ä¼šå†…æœ‰æ•ˆï¼Œæ‰€ä»¥å¦‚æœåœ¨ <code>shell</code>  å‘½ä»¤è¡Œç•Œé¢çš„æç¤ºç¬¦ä¸‹è¿è¡Œåº“å‡½æ•°è„šæœ¬ï¼Œ <code>shell</code>  ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>shell</code>  è¿è¡Œã€‚è¿™ä¸ª <code>shell</code>  ä¼šé‡æ–°å®šä¹‰åº“å‡½æ•°ï¼Œå½“å…¶ä»–è„šæœ¬æƒ³ç”¨æ—¶ï¼Œæ˜¯ä¸èƒ½çš„ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>./funs_file</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><p>å“ªæ€•åœ¨ <code>test</code>  ä¸­è¿è¡Œ <code>funs_file</code>  åº“æ–‡ä»¶ï¼Œè¿™äº›åº“å‡½æ•°ï¼Œä¹Ÿåªèƒ½åœ¨è¿è¡Œåº“æ–‡ä»¶çš„ <code>shell</code>  é‡Œé¢æ‰ä¼šç”Ÿæ•ˆã€‚</p>\n<h2 id=\"sourceå‘½ä»¤\"><a class=\"anchor\" href=\"#sourceå‘½ä»¤\">#</a> source å‘½ä»¤</h2>\n<p>è¯¥å‘½ä»¤ä¼šåœ¨å½“å‰ <code>shell</code>  ä¸Šä¸‹æ–‡æ‰§è¡Œå‘½ä»¤ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>shell</code> ï¼Œå¹¶ä¸” <code>source</code>  å‘½ä»¤æœ‰ä¸ªå¿«æ·åˆ«å -- ç‚¹æ“ä½œç¬¦.  <code>./fun_file</code> ã€‚</p>\n<p>ç¼–å†™ä¸€ä¸ªè„šæœ¬</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr></table></figure><p>å¦‚æœä¸ä½¿ç”¨ <code>source</code>  å‘½ä»¤ï¼Œé‚£ä¹ˆ <code>var</code>  å¯¹äºå½“å‰ <code>shell</code>  æ˜¯ä¸å¯è§çš„</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr></table></figure><p>ä½¿ç”¨ä¹‹å</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">.</span> ./testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">10</span></pre></td></tr></table></figure><h1 id=\"ç»ˆç«¯ä½¿ç”¨å‡½æ•°\"><a class=\"anchor\" href=\"#ç»ˆç«¯ä½¿ç”¨å‡½æ•°\">#</a> ç»ˆç«¯ä½¿ç”¨å‡½æ•°</h1>\n<p>æ ¼å¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ ¼å¼ 1ï¼Œåˆ†å·ç»“å°¾</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>echo <span class=\"token string\">\"ok\"</span><span class=\"token punctuation\">;</span><span class=\"token builtin class-name\">read</span> value<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æ ¼å¼ 2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function-name function\">fun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"adc\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>.bashrc</code>  æ–‡ä»¶å®šä¹‰å‡½æ•°ï¼šå‡½æ•°å®šä¹‰æ”¾åœ¨ä¸€ä¸ªç‰¹æ®Šçš„ä½ç½®ï¼Œæ¯æ¬¡å¯åŠ¨æ–° <code>shell</code>  éƒ½ä¼šç”± <code>shell</code>  é‡æ–°åœ¨ <code>.bashrc</code>  ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œç”šè‡³å¯ä»¥åœ¨è‡ªå·±å†™çš„è„šæœ¬ä¸­ç›´æ¥ä½¿ç”¨ã€‚</p>\n<p>å…³äº <code>.bashrc</code> ï¼Œå°±æ˜¯ä¸ªå¯åŠ¨æ–‡ä»¶ï¼Œ <code>shell</code>  å¯åŠ¨æ—¶ä¼šæ‰§è¡Œä¸€ä¸‹ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/04/Shell/%E6%8E%A7%E5%88%B6%E8%84%9A%E6%9C%AC/",
            "url": "https://cecilia.cool/2022/08/04/Shell/%E6%8E%A7%E5%88%B6%E8%84%9A%E6%9C%AC/",
            "title": "æ§åˆ¶è„šæœ¬",
            "date_published": "2022-08-03T16:21:37.000Z",
            "content_html": "<h1 id=\"ä¿¡å·\"><a class=\"anchor\" href=\"#ä¿¡å·\">#</a> ä¿¡å·</h1>\n<p><code>Linux</code>  åˆ©ç”¨ä¿¡å·ä¸è¿è¡Œåœ¨ç³»ç»Ÿä¸­çš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œå¸¸è§çš„ <code>Linux</code>  ç³»ç»Ÿä¿¡å·ï¼š</p>\n<ul>\n<li>1-- <code>SIGHUP</code> -- æŒ‚èµ·è¿›ç¨‹</li>\n<li>2-- <code>SIGINT</code> -- ç»ˆæ­¢è¿›ç¨‹</li>\n<li>3-- <code>SIGQUIT</code> -- åœæ­¢è¿›ç¨‹</li>\n<li>9-- <code>SIGLIKILL</code> -- æ— æ¡ä»¶ç»ˆæ­¢è¿›ç¨‹</li>\n<li>15-- <code>SIHTERM</code> -- å°½å¯èƒ½ç»ˆæ­¢è¿›ç¨‹</li>\n<li>17-- <code>SIGSTOP</code> -- æ— æ¡ä»¶åœæ­¢è¿›ç¨‹ï¼Œä½†ä¸æ˜¯ç»ˆæ­¢</li>\n<li>18-- <code>SIGTSTP</code> -- åœæ­¢æˆ–æš‚åœè¿›ç¨‹ï¼Œä½†ä¸æ˜¯ç»ˆæ­¢</li>\n<li>19-- <code>SIGCONT</code> -- ç»§ç»­è¿è¡Œåœæ­¢çš„è¿›ç¨‹</li>\n</ul>\n<p><code>crtl+c</code>  ä¼šç”Ÿæˆ <code>SIGINT</code>  ä¿¡å·ï¼Œåœæ­¢ <code>shell</code>  å½“å‰è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ã€‚<br />\n <code>ctrl+z</code>  ä¼šç”Ÿæˆ <code>SIGTSTP</code>  ä¿¡å·ï¼Œåœæ­¢ <code>shell</code>  ä¸­è¿è¡Œçš„ä»»ä½•è¿›ç¨‹ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">sleep</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>^Z</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Stopped                 <span class=\"token function\">sleep</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-l</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>F S   <span class=\"token environment constant\">UID</span>     PID    <span class=\"token environment constant\">PPID</span>  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">0</span> S  <span class=\"token number\">1000</span>   <span class=\"token number\">30447</span>   <span class=\"token number\">30445</span>  <span class=\"token number\">0</span>  <span class=\"token number\">80</span>   <span class=\"token number\">0</span> -  <span class=\"token number\">3559</span> do_wai pts/0    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">0</span> T  <span class=\"token number\">1000</span>   <span class=\"token number\">33293</span>   <span class=\"token number\">30447</span>  <span class=\"token number\">0</span>  <span class=\"token number\">80</span>   <span class=\"token number\">0</span> -  <span class=\"token number\">2789</span> do_sig pts/0    00:00:00 <span class=\"token function\">sleep</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">0</span> R  <span class=\"token number\">1000</span>   <span class=\"token number\">33294</span>   <span class=\"token number\">30447</span>  <span class=\"token number\">0</span>  <span class=\"token number\">80</span>   <span class=\"token number\">0</span> -  <span class=\"token number\">3623</span> -      pts/0    00:00:00 <span class=\"token function\">ps</span></pre></td></tr></table></figure><p><code>S</code>  åˆ—ä¸­ï¼Œ <code>T</code>  æ ‡å¿—å°±æ˜¯è¿›ç¨‹è¢«æš‚åœã€‚ä½¿ç”¨ <code>ps</code>  è·å¾—å¸Œæœ›æ€æ­»çš„è¿›ç¨‹çš„ <code>PID</code> ï¼Œä½¿ç”¨ <code>kill -9 PID</code> ã€‚</p>\n<h2 id=\"trapå‘½ä»¤\"><a class=\"anchor\" href=\"#trapå‘½ä»¤\">#</a> trap å‘½ä»¤</h2>\n<p><code>trap</code>  å‘½ä»¤ï¼šå…è®¸æŒ‡å®š <code>shell</code>  è„šæœ¬ç›‘çœ‹å¹¶ä» <code>shell</code>  ä¸­æ‹¦æˆªçš„ <code>Linux</code>  ä¿¡å·ã€‚å¦‚æœè„šæœ¬æ”¶åˆ°äº† <code>trap</code>  å‘½ä»¤ä¸­åˆ—å‡ºçš„ä¿¡å·ï¼Œè¯¥ä¿¡å·ä¸å†ç”± <code>shell</code>  å¤„ç†ã€‚è€Œæ˜¯æœ¬åœ°å¤„ç†ã€‚</p>\n<p>å…¶ä½¿ç”¨æ ¼å¼ä¸ºï¼š <code>trap commands signals</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">trap</span> <span class=\"token string\">\"echo 'I have trapped ctrl-c'\"</span> SIGINT</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sleep</span> <span class=\"token number\">1000</span></pre></td></tr></table></figure><p>åœ¨ç¡çœ æœŸé—´ä½¿ç”¨ <code>ctrl+c</code>  å°±ä¼šæ‰“å°è¿™å¥è¯ã€‚</p>\n<p>åœ¨å¾ˆå¤šç¨‹åºä¸­ï¼Œæƒ³è¦å®ç°ç¨‹åºæ­£å¸¸è¿è¡Œç»“æŸæˆ–è€…å¤–éƒ¨å‘é€ä¿¡å·é€€å‡ºï¼Œéƒ½ä¼šæ‰“å° <code>Goodby...</code> ï¼Œå¯ä»¥åŠ ä¸Šè¿™å¥è¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">trap</span> <span class=\"token string\">\"echo 'Goodby...'\"</span> Exit</pre></td></tr></table></figure><p><code>trap</code>  å¯ä»¥ä¿®æ”¹æˆ–æ˜¯ç§»é™¤ï¼Œå…¶é‡ç‚¹å°±æ˜¯<strong>å…ˆåˆ°å…ˆå ä½</strong>ï¼Œæ¯”å¦‚ç¬¬ä¸€è¡Œè®¾ç½®äº† <code>trap</code>  æŒ‡ä»¤ï¼Œåœ¨ç¬¬ 20 è¡Œä¿®æ”¹æˆ–ç§»é™¤äº†è¯¥ä¿¡å·ï¼Œé‚£ä¹ˆç¬¬ä¸€è¡Œ <code>trap</code>  çš„åªä¼šåœ¨ 1~19 è¡Œç”Ÿæ•ˆã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># åˆ é™¤ï¼Œå•ï¼ˆåŒï¼‰çŸ­æ¨ªçº¿éƒ½å¯ä»¥</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">trap</span> <span class=\"token parameter variable\">--SIGINT</span></pre></td></tr></table></figure><h1 id=\"åå°æ¨¡å¼\"><a class=\"anchor\" href=\"#åå°æ¨¡å¼\">#</a> åå°æ¨¡å¼</h1>\n<p>æœ€å¼€å§‹å°±æåˆ°è¿‡ï¼Œåœ¨è¿è¡Œè„šæœ¬æ—¶åŠ ä¸Š <code>&amp;</code> ï¼Œå°±èƒ½å°†è¿›ç¨‹ç½®å…¥åå°ã€‚åå°æ¨¡å¼ä¸­ï¼Œè¿›ç¨‹ä¸ä¼šå’Œç»ˆç«¯ä¼šè¯ä¸Šçš„ <code>STDIN</code> ï¼Œ <code>STDOUT</code> ï¼Œ <code>STDERR</code>  å…³è” ã€‚</p>\n<h1 id=\"æœ€å\"><a class=\"anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p><code>shell</code>  è„šæœ¬çš„åŸºæœ¬ç¼–ç¨‹åˆ°æ­¤ä¸ºæ­¢ï¼Œä¹‹åæˆ‘ä»¬ä¼šè¿›å…¥é«˜çº§ <code>shell</code>  è„šæœ¬ç¼–ç¨‹ï¼Œå…¶ä¸­ä¼šæ¶‰åŠåˆ°å‡½æ•°ï¼Œè‘—åçš„æµç¼–è¾‘å™¨ <code>sed</code>  å’Œ <code>gawk</code> ï¼Œä»¥åŠæ­£åˆ™è¡¨è¾¾å¼å››ä¸ªä¸»è¦éƒ¨åˆ†ã€‚ç„¶åå°±å¯ä»¥ç»“æŸæ­¤æ¬¡ <code>Linux</code>  ä¸ <code>shell</code>  ç¼–ç¨‹çš„å­¦ä¹ äº†ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/03/Shell/%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/",
            "url": "https://cecilia.cool/2022/08/03/Shell/%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/",
            "title": "å‘ˆç°æ•°æ®",
            "date_published": "2022-08-03T03:30:29.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¹‹å‰å…³äºæ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºé‡å®šå‘çš„æ–‡ç« ï¼Œæˆ‘æåˆ°å¼€å§‹æ¥è§¦æµï¼Œå¹¶ä¸”åœ¨æ–‡ä¸­è®²è§£æ—¶ä½¿ç”¨ä¹Ÿæ˜¯ä»¥æµæ¥å…·ä½“åŒ–é‡å®šå‘çš„ä½œç”¨ï¼Œä½†æ˜¯è®²è§£çš„éå¸¸ä¸ä¸¥è°¨ã€‚æœ¬æ–‡ç›¸å½“äºå¯¹é‡å®šå‘æ·±å…¥è®²è§£ï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰é‡å®šå‘ã€‚</p>\n<h1 id=\"æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦\"><a class=\"anchor\" href=\"#æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦\">#</a> æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦</h1>\n<p><code>Linux</code>  ç³»ç»Ÿå°†æ¯ä¸ªå¯¹è±¡å½“ä½œæ–‡ä»¶å¤„ç†ï¼ˆæœ‰å¥è¯å°±æ˜¯ä¸€åˆ‡çš†æ–‡ä»¶ï¼‰ï¼ŒåŒ…æ‹¬è¾“å…¥å’Œè¾“å‡ºï¼Œç”¨æ–‡ä»¶æè¿°ç¬¦<strong>æ ‡è¯†</strong>æ¯ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ª<strong>éè´Ÿæ•´æ•°</strong>ï¼Œå¯ä»¥å”¯ä¸€è¡¨ç¤ºä¼šè¯ä¸­æ‰“å¼€çš„æ–‡ä»¶ã€‚å‡ºäºç‰¹æ®Šç›®çš„ï¼Œ <code>bash shell</code>  åœ¨æ¯ä¸ªè¿›ç¨‹ï¼Œåªä¿ç•™äº† 3 ä¸ªæ–‡ä»¶æ ‡è¯†ç¬¦ (0,1,2)</p>\n<ul>\n<li><code>STDIN</code> -- æ ‡å‡†è¾“<strong>å…¥</strong>ã€‚å¯¹äºç»ˆç«¯ç•Œé¢ï¼Œ<strong>æ ‡å‡†è¾“å…¥æ˜¯é”®ç›˜</strong>ã€‚ <code>shell</code>  ä» <code>STDIN</code>  å¯¹åº”çš„é”®ç›˜è·å¾—è¾“å…¥ã€‚ä½¿ç”¨è¾“å…¥é‡å®šå‘ç¬¦å· <code>&lt;</code> ï¼Œ <code>Linux</code>  ä¼šä½¿ç”¨é‡å®šå‘æŒ‡å®šçš„æ–‡ä»¶æ¥æ›¿æ¢æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ï¼Œä¼šè¯»å–æ–‡ä»¶å¹¶æå–æ•°æ®ï¼Œå¦‚åŒæ˜¯åœ¨é”®ç›˜ä¸Šé”®å…¥çš„ã€‚</li>\n<li><code>STDOUT</code> -- æ ‡å‡†è¾“<strong>å‡º</strong>ã€‚åŒæ ‡å‡†è¾“å…¥ç±»ä¼¼ï¼Œshell æ‰€æœ‰è¾“å‡ºéƒ½ä¼šè¢«å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºå™¨ã€‚</li>\n<li><code>STDERR</code> -- é”™è¯¯æ¶ˆæ¯å¯¹äºé”™è¯¯æ¶ˆæ¯ï¼Œ<strong>ä¹Ÿæ˜¯é‡å®šå‘åˆ°æ˜¾ç¤ºå™¨çš„</strong>ï¼Œä½†æ˜¯é”™è¯¯æ¶ˆæ¯å’Œä¸€èˆ¬æ ‡å‡†è¾“å‡ºæ˜¯åˆ†å¼€çš„ã€‚æ¯”å¦‚ï¼š <code>ls -l badfile &gt; test</code> ï¼Œå¦‚æœæ²¡æœ‰ <code>badfile</code>  å°±ä¼šæŠ¥é”™ï¼Œä½†æ˜¯é”™è¯¯ä¿¡æ¯å¹¶æ²¡æœ‰ç»™ <code>test</code> ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬ä¹‹å‰çŸ¥é“å¦‚ä½•é‡å®šå‘æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºï¼Œç°åœ¨è®²è§£å¦‚ä½•é‡å®šå‘é”™è¯¯ä¿¡æ¯ã€‚</p>\n<ul>\n<li>åªé‡å®šå‘é”™è¯¯ï¼šå°† <code>STDERR</code>  æ–‡ä»¶æè¿°ç¬¦çš„å€¼ <code>(2)</code>  ç´§ç´§æ”¾åœ¨é‡å®šå‘ç¬¦å·å‰ï¼Œ <code>ls -al badfile 2&gt; test</code> ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•ï¼Œå¦‚æœè¯¥å‘½ä»¤çš„è¾“å‡ºæ—¢åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œä¹ŸåŒ…å«æ ‡å‡†è¾“å‡ºï¼Œé‚£ä¹ˆæ ‡å‡†è¾“å‡ºè¿˜æ˜¯ä¼šè¾“å‡ºåˆ°å±å¹•ä¸­ã€‚</li>\n<li>é‡å®šå‘é”™è¯¯å’Œæ•°æ®ï¼šæˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›é‡å®šå‘çš„æ•°æ®å’Œé”™è¯¯ä¿¡æ¯åœ¨åŒä¸€æ–‡ä»¶ä¸­ï¼ˆéš¾é“ä½ å¸Œæœ›é”™è¯¯æ—¥å¿—é‡Œé¢è¿˜ç»™ä½ ä¿å­˜å‡ å¥è«åå…¶å¦™çš„æ‰“å°è¯­å¥å—ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ä¸¤ä¸ªé‡å®šå‘ç¬¦å·ï¼Œéœ€è¦åœ¨ç¬¦å·é¢å‰æ”¾ä¸Šå„è‡ªæ–‡ä»¶æè¿°ç¬¦å€¼ï¼š <code>ls -al test test2 test3 badtest 2&gt; testSTDERR 1&gt; testSTDOUT</code> ï¼ˆå…¶ä¸­ <code>test*</code>  æ–‡ä»¶éƒ½å­˜åœ¨ï¼Œ <code>badtest</code>  ä¸å­˜åœ¨ï¼‰ã€‚   å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å’Œé”™è¯¯é‡å®šå‘åˆ°åŒä¸€æ–‡ä»¶ï¼š  <code>ll n_File bad_File new_File &amp;&gt; STD_ALL</code> ã€‚ <code>bash shell</code>  è‡ªåŠ¨èµ‹äºˆäº†é”™è¯¯æ¶ˆæ¯æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œæ–¹ä¾¿é›†ä¸­æµè§ˆé”™è¯¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>ll A B C</code>  ä¸­ <code>B</code>  æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¾“å‡ºæ—¶ä¼šä¼˜å…ˆè¾“å‡ºå…³äº <code>B</code>  çš„é”™è¯¯ä¿¡æ¯ã€‚</li>\n</ul>\n<h1 id=\"è„šæœ¬ä¸­çš„æ ‡å‡†é‡å®šå‘è¾“å‡ºå’Œè¾“å…¥\"><a class=\"anchor\" href=\"#è„šæœ¬ä¸­çš„æ ‡å‡†é‡å®šå‘è¾“å‡ºå’Œè¾“å…¥\">#</a> è„šæœ¬ä¸­çš„æ ‡å‡†é‡å®šå‘è¾“å‡ºå’Œè¾“å…¥</h1>\n<p>å¯¹äºä¸‰ä¸ªæ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€å®šè¦è®°ä½ï¼Œä½¿ç”¨ <code>exec</code>  å‘½ä»¤æ—¶æ•°å­—æ”¾åœ¨ç®­å¤´å·¦è¾¹ã€‚å½“æ•°å­—å‡ºç°åœ¨å³è¾¹ï¼Œè¦ç”¨ <code>&amp;</code>  ç¬¦å·ã€‚</p>\n<h2 id=\"ä¸´æ—¶é‡å®šå‘\"><a class=\"anchor\" href=\"#ä¸´æ—¶é‡å®šå‘\">#</a> ä¸´æ—¶é‡å®šå‘</h2>\n<p>åœ¨è„šæœ¬ä¸­ç”Ÿæˆé”™è¯¯æ¶ˆæ¯ï¼Œå¯ä»¥å°†å•ç‹¬çš„ä¸€è¡Œè¾“å‡ºé‡å®šå‘åˆ° <code>STDERR</code> ï¼Œä¸åŒçš„æ˜¯ï¼Œåœ¨è„šæœ¬ä¸­ï¼Œæ ¼å¼ä¸º <code>&gt;&amp;2</code> ã€‚ <code>echo &quot;This is error&quot; &gt;&amp;2</code> ï¼Œè¿™æ ·ï¼Œè¯¥è¡Œå°±ä¼šæŒ‡å‘ <code>STDERR</code>  çš„ä½ç½®ï¼Œä¹Ÿå°±ç±»ä¼¼äºç»ˆç«¯ä¸Šçš„é”™è¯¯ä¿¡æ¯ä¸€æ ·ã€‚</p>\n<p>è¿™ç§æ“ä½œå¯ä»¥ç”¨äºæ£€æµ‹è„šæœ¬è¿è¡Œæ—¶ä¼ å…¥çš„é€‰å‹æˆ–è€…å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®å°±å¯ä»¥é€šè¿‡ <code>&gt;&amp;2</code>  æ¥ç”Ÿæˆé”™è¯¯ä¿¡æ¯ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This is error\"</span> <span class=\"token operator\">></span><span class=\"token file-descriptor important\">&amp;2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This is normal\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># è¿è¡Œè„šæœ¬ï¼Œå¹¶å°†è„šæœ¬çš„é”™è¯¯ä¿¡æ¯é‡å®šå‘åˆ° result1 æ–‡ä»¶ä¸­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>./test <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span> result1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>This is normal</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">cat</span> result1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>This is an error</pre></td></tr></table></figure><h2 id=\"æ°¸ä¹…é‡å®šå‘\"><a class=\"anchor\" href=\"#æ°¸ä¹…é‡å®šå‘\">#</a> æ°¸ä¹…é‡å®šå‘</h2>\n<p>ä¸Šé¢çš„ä¸´æ—¶é‡å®šå‘ï¼Œæ¯”å¦‚æˆ‘ä¸€ä¸ªè„šæœ¬æœ‰å¾ˆå¤šè¡Œç”Ÿæˆé”™è¯¯ä¿¡æ¯å¹¶éœ€è¦é‡å®šå‘ï¼Œè€Œæ¯ä¸€è¡Œéƒ½æ˜¯ç”¨ <code>&gt;&amp;2</code>  å¤ªéº»çƒ¦äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ <code>exec</code>  å‘½ä»¤æ¥è¿›è¡Œæ°¸ä¹…é‡å®šå‘ã€‚</p>\n<p><code>exec</code>  å‘½ä»¤å‘Šè¯‰ <code>shell</code>  åœ¨è„šæœ¬ä¸­æ‰§è¡ŒæœŸé—´é‡å®šå‘æŸä¸ªç‰¹å®šæ–‡ä»¶æè¿°ç¬¦ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> STD_output_file</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># é‚£ä¹ˆè„šæœ¬ä¸­è¯¥å‘½ä»¤ä¹‹ä¸‹çš„æ‰€æœ‰æ ‡å‡†è¾“å‡ºéƒ½é‡å®šå‘åˆ°äº† STD_output_file ä¸­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># åŒç†ï¼Œæ”¹å˜æ ‡å‡†è¾“å…¥ï¼Œè¿™å¯¹äºä»å¾…å¤„ç†æ–‡ä»¶ä¸­è¯»å–æ•°æ®æœ‰å¾ˆå¤§å¸®åŠ©</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span> STD_input_file</pre></td></tr></table></figure><h1 id=\"è‡ªå®šä¹‰é‡å®šå‘\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰é‡å®šå‘\">#</a> è‡ªå®šä¹‰é‡å®šå‘</h1>\n<p><code>Linux</code>  ç³»ç»Ÿæœ¬æ¥æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰<strong> 9 ä¸ª</strong>æ–‡ä»¶æè¿°ç¬¦ï¼Œ3 ä¸ªæ ‡å‡†ï¼Œå‰©ä¸‹ 6 ä¸ªéƒ½å¯ä»¥ç”¨äºè‡ªå®šä¹‰ï¼Œ<strong>è¿™ 6 ä¸ªå¯ä»¥ä»»æ„ä½œä¸ºè¾“å…¥è¿˜æ˜¯è¾“å‡º</strong>ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">6</span>></span> testout</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"This is a data\"</span><span class=\"token operator\">></span><span class=\"token file-descriptor important\">&amp;6</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># å¦‚æœä½¿ç”¨ >> å°±æ˜¯è¿½åŠ æ¨¡å¼</span></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³æ¢å¤ä¸€ä¸ªè¢«é‡å®šå‘çš„æ–‡ä»¶æè¿°ç¬¦</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>></span><span class=\"token file-descriptor important\">&amp;1</span>   <span class=\"token comment\">#3 æŒ‡å‘ 1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span>testout</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span><span class=\"token file-descriptor important\">&amp;3</span></pre></td></tr></table></figure><p>åˆ›å»º<strong>è¯»å†™</strong>æ–‡ä»¶æè¿°ç¬¦</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">4</span>&lt;></span> testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># è¾“å…¥è¾“å‡ºæ—¶ï¼Œæ–‡ä»¶æŒ‡é’ˆæ˜¯å…±äº«çš„ã€‚åŒæ—¶æ³¨æ„ >> çš„è¿½åŠ æ¨¡å¼ä¸è¯¥ç‰¹æ€§çš„ä½¿ç”¨</span></pre></td></tr></table></figure><p>å…³é—­æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œä¸€èˆ¬åˆ›å»ºäº†æ–°çš„è¾“å…¥è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ï¼Œè„šæœ¬é€€å‡ºæ—¶ï¼Œ <code>shell</code>  å°±ä¼šè‡ªåŠ¨å…³é—­å®ƒä»¬ã€‚æ‰‹åŠ¨å…³é—­ï¼š <code>exec 3&gt;&amp;-</code> ã€‚ä¸€æ—¦å…³é—­ï¼Œå°±ä¸èƒ½åœ¨å†™å…¥ / è¯»å–æ•°æ®ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p>\n<h1 id=\"lsofå‘½ä»¤\"><a class=\"anchor\" href=\"#lsofå‘½ä»¤\">#</a> lsof å‘½ä»¤</h1>\n<p>ç½‘ä¸Šç»™çš„çŸ¥è¯†æœ‰äº›å‡Œä¹±ï¼Œç”šè‡³æœ‰äº›é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä¼šæ€»ç»“å‡ ç¯‡æ–‡ç« ï¼Œæœ€åç»™ä¸€ä¸‹å‚è€ƒã€‚</p>\n<p><code>lsof--list open files</code> ï¼Œåˆ—å‡ºå½“å‰ç³»ç»Ÿå·²ç»æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸€èˆ¬ <code>lsof</code>  å‘½ä»¤ä½äº <code>/usr/bin/losf</code>  æˆ–è€…æ˜¯ <code>/usr/sbin/lsof</code> ã€‚å› ä¸ºç»ˆç«¯è¿è¡Œæ—¶ï¼Œä¼šæœ‰å¾ˆå¤šæ–‡ä»¶è¢«æ‰“å¼€ä½¿ç”¨ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ <code>lsof</code>  ä¼šå‡ºç°å¾ˆå¤šç»“æœï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ä¸€å®šè¦çµæ´»ä½¿ç”¨ç›¸å…³çš„é€‰é¡¹æ¥æ§åˆ¶è¾“å‡ºã€‚</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">é€‰é¡¹</th>\n<th style=\"text-align:center\">æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-a</td>\n<td style=\"text-align:center\">å¯¹ç»™çš„é€‰é¡¹è¿›è¡Œ<strong>ä¸</strong>è¿ç®—</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-p&lt;pid&gt;</td>\n<td style=\"text-align:center\">åˆ—å‡ºæŒ‡å®šè¿›ç¨‹å·æ‰€æ‰“å¼€çš„æ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-d &lt;æ–‡ä»¶å·&gt;</td>\n<td style=\"text-align:center\">åˆ—å‡ºå ç”¨è¯¥æ–‡ä»¶å·çš„æ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">+d &lt;ç›®å½•&gt;</td>\n<td style=\"text-align:center\">åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-c &lt;è¿›ç¨‹å&gt;</td>\n<td style=\"text-align:center\">åˆ—å‡ºæŒ‡å®šè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<p>æ ¹æ®ä¸Šé¢çš„éƒ¨åˆ†é€‰é¡¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸‹è¯¥å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">lsof</span> <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-p</span> <span class=\"token variable\">$$</span> <span class=\"token parameter variable\">-d</span> <span class=\"token number\">0,1</span>,2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>COMMAND   PID <span class=\"token environment constant\">USER</span>   FD   TYPE DEVICE SIZE/OFF NODE NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">29075</span> cyan    0u   CHR  <span class=\"token number\">136,0</span>      0t0    <span class=\"token number\">3</span> /dev/pts/0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">29075</span> cyan    1u   CHR  <span class=\"token number\">136,0</span>      0t0    <span class=\"token number\">3</span> /dev/pts/0</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">29075</span> cyan    2u   CHR  <span class=\"token number\">136,0</span>      0t0    <span class=\"token number\">3</span> /dev/pts/0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># å˜é‡ $$ è¡¨ç¤ºå½“å‰ shell çš„ pid</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># COMMAND: æ­£åœ¨è¿è¡Œçš„å‘½ä»¤åçš„å‰ 9 ä¸ªå­—ç¬¦</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># FD: æ–‡ä»¶æè¿°ç¬¦å·ä»¥åŠè®¿é—®ç±»å‹ (r-- è¯»ï¼Œw-- å†™ï¼Œu-- è¯»å†™)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># TYPE: æ–‡ä»¶çš„ç±»å‹ (CHR-- å­—ç¬¦å‹ï¼ŒBLK-- å—å‹ï¼ŒDIR-- ç›®å½•ï¼ŒREG-- å¸¸è§„æ–‡ä»¶)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># NAMEï¼šæ–‡ä»¶æè¿°ç¬¦æ‰€ä½¿ç”¨çš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å</span></pre></td></tr></table></figure><p>ç°åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„è„šæœ¬ <code>test</code> ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯è®²è§£æ–‡ä»¶æè¿°ç¬¦ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">4</span>></span> four_data</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$var</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">#æ­»å¾ªç¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>&amp;</code>  å°†è¯¥è„šæœ¬ç½®å…¥åå°è¿è¡Œï¼š <code>./test&amp;</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./test<span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">88214</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">88084</span> pts/3    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token number\">88214</span> pts/3    00:00:19 <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token number\">88218</span> pts/3    00:00:00 <span class=\"token function\">ps</span></pre></td></tr></table></figure><p>å†ä½¿ç”¨ <code>lsof</code>  æ¥æŸ¥çœ‹ä½¿ç”¨äº†å“ªäº›æ–‡ä»¶æè¿°ç¬¦</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">lsof</span> <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">88214</span> <span class=\"token parameter variable\">-d</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>COMMAND   PID <span class=\"token environment constant\">USER</span>   FD   TYPE DEVICE SIZE/OFF   NODE NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">test</span>    <span class=\"token number\">88214</span> cyan    4w   REG    <span class=\"token number\">8,5</span>        <span class=\"token number\">0</span> <span class=\"token number\">935362</span> /home/cyan/Templates/four_data</pre></td></tr></table></figure><p><code>-p 88214</code>  æ˜¯å¯»æ‰¾è¿›ç¨‹ä¸º <code>pid=88214</code>  çš„è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œ <code>-d 4</code>  æ‰¾åˆ°ä½¿ç”¨ <code>4</code>  æ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶ï¼Œ <code>-a</code>  å¯¹ <code>-p 88214</code>  å’Œ <code>-d 4</code>  è¿›è¡Œä¸è¿ç®—ã€‚</p>\n<p>æ‰€ä»¥ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•ä»¥ä¸‹å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">lsof</span> <span class=\"token parameter variable\">-p</span> pid</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹çš„æ–‡ä»¶åˆ°åº•å ç”¨äº†å“ªäº›æè¿°ç¬¦</span></pre></td></tr></table></figure><p>å®Œæˆæ¡ˆä¾‹è®²è§£ï¼Œå°† <code>test</code>  çš„è¿›ç¨‹æ€æ­»</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">kill</span> <span class=\"token number\">88214</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">88084</span> pts/3    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">88243</span> pts/3    00:00:00 <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Terminated              ./test</pre></td></tr></table></figure><p><code>lsof</code>  å‘½ä»¤å¾ˆå¼ºå¤§ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯ç”¨æ¥æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœä½ æƒ³è¦æ·±å…¥äº†è§£ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« </p>\n<blockquote>\n<p>Linux æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS93M2Nub3RlL2xpbnV4LWNoZWNrLXBvcnQtdXNhZ2UuaHRtbA==\">https://www.runoob.com/w3cnote/linux-check-port-usage.html</span></p>\n<p>lsof å‘½ä»¤è¯¦è§£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20va2xhdXNhZ2UvcC8xNDk5NTA0Mi5odG1s\">https://www.cnblogs.com/klausage/p/14995042.html</span> ï¼ˆå…¶å®å¹¶ä¸æ˜¯å¾ˆè¯¦ç»†ï¼‰</p>\n<p>lsof å…¥é—¨ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucWllc2VvLmNvbS8xNjI4OTYuaHRtbA==\">https://www.qieseo.com/162896.html</span></p>\n</blockquote>\n<h1 id=\"é˜»æ­¢å‘½ä»¤è¾“å‡º\"><a class=\"anchor\" href=\"#é˜»æ­¢å‘½ä»¤è¾“å‡º\">#</a> é˜»æ­¢å‘½ä»¤è¾“å‡º</h1>\n<p><code>Linux</code>  æœ‰ä¸€ä¸ªæ–‡ä»¶å« <code>null(/dev/null)</code> ï¼Œ <code>shell</code>  è¾“å‡ºåˆ° <code>null</code>  æ–‡ä»¶çš„ä»»ä½•æ•°æ®éƒ½ä¸ä¼šè¢«ä¿å­˜ï¼Œå…¨éƒ¨éƒ½è¢«ä¸¢æ‰ã€‚æ‰€ä»¥ï¼Œä¸å¸Œæœ›åå°è¾“å‡ºé”™è¯¯ä¿¡æ¯æ—¶ï¼Œ <code>shell</code>  å‘é€ç”µå­é‚®ä»¶ç»™è¿›ç¨‹å±ä¸»çš„è¯ï¼Œå°±å°† <code>STDERR</code>  é‡å®šå‘åˆ° <code>null</code> ã€‚ <code>null</code>  æ–‡ä»¶å¯ä»¥å¿«é€Ÿæ¸…é™¤ç°æœ‰æ–‡ä»¶ä¸­çš„æ•°æ®è€Œä¸éœ€è¦åˆ é™¤æ–‡ä»¶å†é‡æ–°åˆ›å»º <code>cat /dev/null &gt; testfile</code> ï¼Œç±»ä¼¼äºæ¸…ç©ºæ—¥å¿—æ–‡ä»¶ã€‚å“¦ï¼Œå…¶å®æˆ‘ä¸ªäººæ›´å–œæ¬¢ <code>echo &quot;&quot; &gt; testfile</code> ã€‚</p>\n<h1 id=\"åˆ›å»ºä¸´æ—¶æ–‡ä»¶\"><a class=\"anchor\" href=\"#åˆ›å»ºä¸´æ—¶æ–‡ä»¶\">#</a> åˆ›å»ºä¸´æ—¶æ–‡ä»¶</h1>\n<p><code>/tmp</code>  ç›®å½•æ˜¯ <code>Linux</code>  ç”¨æ¥å­˜æ”¾ä¸æ°¸ä¹…ä¿ç•™çš„æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ† <code>Linux</code>  å‘è¡Œç‰ˆé…ç½®äº†ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ é™¤ <code>/tmp</code>  ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ã€‚ä»»ä½•ç”¨æˆ·è´¦æˆ·éƒ½æœ‰æƒé™åœ¨ <code>/tmp</code>  è¯»å†™ã€‚<br />\nå•ç‹¬ <code>mktemp</code>  å‘½ä»¤å¯ä»¥åœ¨ <code>/tmp</code>  ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ä¸´æ—¶æ–‡ä»¶ã€‚ <code>shell</code>  ä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä½†ä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„ <code>umask</code> ï¼Œä¼šå°†æ–‡ä»¶è¯»å’Œå†™æƒé™åˆ†ç»™å±ä¸»ï¼Œå¹¶å°†ä½ è®¾ä¸ºå±ä¸»ã€‚ä½†æ˜¯å…¶ä»–äººæ²¡æ³•è®¿é—® (root é™¤å¤–)ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ mktemp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/tmp/tmp.thPVXNPVJp</pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ–‡ä»¶åï¼Œä½†æ˜¯ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºè¯¥æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># mktemp ä¼šç”¨ 6 ä¸ªå­—ç¬¦æ›¿æ¢ 6 ä¸ª Xï¼Œä¿è¯æ–‡ä»¶åå”¯ä¸€</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ mktemp test.XXXXXX</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>test.k5CvV0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># åœ¨è„šæœ¬ä¸­ï¼Œä¸€èˆ¬å°†åˆ›å»ºçš„æ–‡ä»¶åä¿å­˜åœ¨å˜é‡ä¸­</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">filename</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp test.XXXXXX<span class=\"token variable\">)</span></span></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨é€‰é¡¹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># åœ¨ /tmp ä¸‹åˆ›å»ºï¼Œè¿”å›å…¨è·¯å¾„å</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ mktemp <span class=\"token parameter variable\">-t</span> test.XXXXXX</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/tmp/test.LRNlpY</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># -d é€‰é¡¹åˆ›å»ºä¸´æ—¶ç›®å½•</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ mktemp <span class=\"token parameter variable\">-d</span> dir.XXXXXX</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>dir.Adr0Q6</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ mktemp <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-t</span> dir.XXXXXX</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>/tmp/dir.H9rIut</pre></td></tr></table></figure><h1 id=\"è®°å½•æ¶ˆæ¯\"><a class=\"anchor\" href=\"#è®°å½•æ¶ˆæ¯\">#</a> è®°å½•æ¶ˆæ¯</h1>\n<p><code>tee</code>  å‘½ä»¤ï¼š<br />\nç›¸å½“äºç®¡é“çš„ <code>T</code>  å‹æ¥å¤´ï¼Œå°†ä» <code>STDIN</code>  è¿‡æ¥çš„æ•°æ®åŒæ—¶å‘é€åˆ° <code>STDOUT</code>  å’Œ <code>tee</code>  å‘½ä»¤è¡Œæ‰€æŒ‡å®šçš„æ–‡ä»¶åï¼š <code>tee testfile</code> ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$  <span class=\"token function\">date</span> <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> testfile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 03æ—¥ æ˜ŸæœŸä¸‰ <span class=\"token number\">15</span>:51:57 CST</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> testfile</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 03æ—¥ æ˜ŸæœŸä¸‰ <span class=\"token number\">15</span>:51:57 CST</pre></td></tr></table></figure><p><code>tee</code>  æ¯æ¬¡éƒ½ä¼šè¦†ç›–æ–‡ä»¶å†…å®¹ï¼Œ <code>-a</code>  é€‰å‹æ˜¯è¿½åŠ æ¨¡å¼ï¼š <code>who | tee -a testfile</code> ã€‚</p>\n<h1 id=\"å®ä¾‹\"><a class=\"anchor\" href=\"#å®ä¾‹\">#</a> å®ä¾‹</h1>\n<p>ä¸‹é¢è„šæœ¬æ¶‰åŠ <code>sql</code>  è¯­å¥ï¼Œå¦‚æœä½ ä¸ä¼šï¼Œå¯ä»¥è·³è¿‡ã€‚è¯¥è„šæœ¬ä¸»è¦æ˜¯ä».csv æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¿«é€Ÿç”Ÿæˆ <code>sql</code>  æ‰§è¡Œæ–‡ä»¶ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æ–‡ä»¶å create_sql_file</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">outfile</span><span class=\"token operator\">=</span><span class=\"token string\">'members.sql'</span> <span class=\"token comment\"># è¦è¾“å‡ºçš„æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">IFS</span></span><span class=\"token operator\">=</span><span class=\"token string\">','</span> <span class=\"token comment\"># é‡æ–°å®šä¹‰åˆ†éš”ç¬¦</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> lname fname address city state <span class=\"token function\">zip</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">cat</span> <span class=\"token operator\">>></span> <span class=\"token variable\">$outfile</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>INSERT INTO members (lname,fname,address,city,state,zip) VALUES</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>('<span class=\"token variable\">$lname</span>','<span class=\"token variable\">$fname</span>','<span class=\"token variable\">$address</span>','<span class=\"token variable\">$city</span>','<span class=\"token variable\">$state</span>','<span class=\"token variable\">$zip</span>')</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>EOF</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">done</span> <span class=\"token operator\">&lt;</span> <span class=\"token variable\">$&#123;1&#125;</span> <span class=\"token comment\"># read çš„æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ° $&#123;1&#125; æ–‡ä»¶ã€‚</span></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨ <code>cat &lt;&lt; file</code>  å¯ä»¥è¿½åŠ æ•°æ®åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ <code>ctrl+d</code>  ç»“æŸã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>&lt;&lt; ç»“æŸç¬¦</code> ï¼Œé€šè¿‡è¾“å…¥ç»“æŸç¬¦æ¥ç»“æŸè¾“å…¥ã€‚</p>\n<p>æˆ‘ä»¬å†™ä¸€ä¸ª <code>mebers.csv</code>  æ•°æ®</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> members.csv</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Cyan,Jack,US,qiqo,iasui,iwah</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Mike,Smith,Japen,isaui,uwif,ianas</pre></td></tr></table></figure><p>ç„¶åè¿è¡Œè„šæœ¬ç”Ÿæˆ <code>sql</code>  æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./create_sql_file members.csv</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> members.sql</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>INSERT INTO members <span class=\"token punctuation\">(</span>lname,fname,address,city,state,zip<span class=\"token punctuation\">)</span> VALUES</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'Cyan'</span>,<span class=\"token string\">'Jack'</span>,<span class=\"token string\">'US'</span>,<span class=\"token string\">'qiqo'</span>,<span class=\"token string\">'iasui'</span>,<span class=\"token string\">'iwah'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>INSERT INTO members <span class=\"token punctuation\">(</span>lname,fname,address,city,state,zip<span class=\"token punctuation\">)</span> VALUES</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token string\">'Mike'</span>,<span class=\"token string\">'Smith'</span>,<span class=\"token string\">'Japen'</span>,<span class=\"token string\">'isaui'</span>,<span class=\"token string\">'uwif'</span>,<span class=\"token string\">'ianas'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/02/Shell/%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/",
            "url": "https://cecilia.cool/2022/08/02/Shell/%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/",
            "title": "å¤„ç†ç”¨æˆ·è¾“å…¥",
            "date_published": "2022-08-02T14:44:02.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æˆ‘ä»¬ä¹‹å‰åªæ˜¯è®²äº†è„šæœ¬å¦‚ä½•è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ <code>echo</code> ï¼Œæœ¬æ–‡ä¼šè®²è§£è„šæœ¬å¦‚ä½•å¤„ç†ç”¨æˆ·çš„è¾“å…¥ã€‚åŒæ—¶æˆ‘ä»¬ä¼šæ¶‰åŠåˆ°å¦å¤–ä¸€äº›å˜é‡çš„è®²è§£ã€‚</p>\n<h1 id=\"ä½ç½®å‚æ•°\"><a class=\"anchor\" href=\"#ä½ç½®å‚æ•°\">#</a> ä½ç½®å‚æ•°</h1>\n<p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡è®¸å¤šå‘½ä»¤ï¼Œä»–ä»¬æœ‰äº›å¯ä»¥æ¥æ”¶è‹¥å¹²ä¸ªå‚æ•°ï¼Œè¿™å…¶å®æ˜¯é€šè¿‡ä½ç½®å‚æ•°æ¥å®ç°çš„ã€‚</p>\n<p><code>$0</code>  æ˜¯ç¨‹åºåï¼Œ <code>$1~$9</code>  æ˜¯ç¬¬ <code>1~9</code>  ä¸ªå‚æ•°ï¼Œè¶…è¿‡ 9 æ—¶ï¼Œå°±è¦ä½¿ç”¨ <code>$&#123;&#125;</code> ï¼Œæ¯”å¦‚ <code>$&#123;10&#125;</code> ï¼Œè¿™æ ·ï¼Œå°±å…è®¸åœ¨è¿è¡Œæ—¶åŠ å…¥ä»»æ„ä¸ªå‚æ•°ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> tmp.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt var1 var2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>./tmp.txt</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>var1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>var2</pre></td></tr></table></figure><p><code>$0</code>  æ˜¯å‘½ä»¤è¡Œè¾“å…¥çš„ç¨‹åºåï¼Œä»¥ç»å¯¹ (ç›¸å¯¹) è·¯å¾„è¿è¡Œï¼Œ <code>$0</code>  å°±æ˜¯ç»å¯¹ (ç›¸å¯¹) è·¯å¾„ã€‚è¯¥ç‰¹æ€§ä¼šå¯¹è„šæœ¬é€ æˆä¸åŒç¨‹åº¦çš„å½±å“ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>basename</code>  å‘½ä»¤ï¼Œåªä¼šè¿”å›ä¸åŒ…å«è·¯å¾„çš„è„šæœ¬åï¼š <code>name=$(basename $0)</code>        â€‹ <code>$()</code>  æ˜¯å‘½ä»¤æ›¿æ¢ã€‚<br />\næ³¨ï¼š</p>\n<ul>\n<li>åœ¨ä½ç½®å‚æ•°ä½¿ç”¨æ—¶ï¼Œæœ‰å¯èƒ½å¹¶æ²¡æœ‰è¾“å…¥è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å‰éœ€è¦æµ‹è¯•å‚æ•°ï¼š <code>if [ -n &quot;$1&quot; ]</code>   æµ‹è¯•å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œ<strong> å¿…é¡»è¦åŠ å¼•å·</strong>ã€‚</li>\n<li><code>$#</code> æ˜¯å«æœ‰è„šæœ¬è¿è¡Œæ—¶æºå¸¦çš„å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°ï¼Œ <code>$@</code> åŒ…å«æ‰€æœ‰å‚æ•°ï¼Œå½“ä½œåŒä¸€å­—ç¬¦ä¸²å¤šä¸ªç‹¬ç«‹å•è¯ï¼Œ <code>$*</code>  æ˜¯åŒä¸€å­—ç¬¦ä¸²ï¼Œæ‰€æœ‰å‚æ•°çœ‹ä½œä¸€ä¸ªå•è¯ã€‚</li>\n<li>ä½ç½®å˜é‡ä¸­ï¼Œæƒ³è¦å°†æ•°å­—ä½¿ç”¨å˜é‡ä»£æ›¿ (æ¯”å¦‚ <code>$1</code> )ï¼š <code>$(!var)</code>  å…¶ä¸­ var å€¼ä¸º 1, <code>$&#123;!#&#125;</code>  è¡¨ç¤ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œ <code>$&#123;&#125;</code>  ä¸­ä¸èƒ½ä½¿ç”¨ <code>$</code>  è€Œæ˜¯ä½¿ç”¨ <code>!</code>  ä»£æ›¿ã€‚</li>\n</ul>\n<p>è¿™å‡ ä¸ªå‚æ•°çš„ä½¿ç”¨å’Œä¸Šè¿°ä¾‹å­å·®ä¸å¤šï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>\n<h1 id=\"ç§»åŠ¨å˜é‡\"><a class=\"anchor\" href=\"#ç§»åŠ¨å˜é‡\">#</a> ç§»åŠ¨å˜é‡</h1>\n<p><code>shift</code>  å‘½ä»¤ä¼šé»˜è®¤å°†æ‰€æœ‰ä½ç½®å‚æ•°éƒ½å‘å·¦ç§»åŠ¨ä¸€ä½ï¼Œä¹Ÿå°±æ˜¯ <code>$1</code>  çš„å€¼å˜æˆäº† <code>$2</code> ã€‚ <code>$0</code>  çš„å€¼å§‹ç»ˆä¸ä¼šå˜ã€‚ä½¿ç”¨ shift æ˜¯éå†ä½ç½®å‚æ•°çš„ä¸€ä¸ªå¥½æ–¹æ³•</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># demonstrating the shift command </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">do</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Parameter #<span class=\"token variable\">$count</span> = <span class=\"token variable\">$1</span>\"</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span>$<span class=\"token punctuation\">[</span> <span class=\"token variable\">$count</span> + <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token builtin class-name\">shift</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç»™ shift ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡æ˜å‚æ•°ç§»åŠ¨çš„è·ç¦»ã€‚</p>\n<h1 id=\"getoptå‘½ä»¤\"><a class=\"anchor\" href=\"#getoptå‘½ä»¤\">#</a> getopt å‘½ä»¤</h1>\n<p>è¯´å®è¯ï¼Œè¿™éƒ¨åˆ†å½“æ—¶ä¹¦ä¸Šè®²å¾—æŒºè®©æˆ‘éš¾å—çš„ï¼Œç—›è‹¦.jpgã€‚</p>\n<p><code>getopt</code>  å‘½ä»¤å¯ä»¥æ¥å—ä¸€ç³»åˆ—ä»»æ„å½¢å¼çš„<strong>å‘½ä»¤è¡Œé€‰é¡¹å’Œå‚æ•°</strong>ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€‚å½“çš„æ ¼å¼ã€‚è¯´ç™½äº†ï¼Œè¯¥å‡½æ•°å°±æ˜¯ç”¨æ¥<strong>è§£æ</strong>å‘½ä»¤è¡Œé€‰é¡¹å‚æ•°çš„ã€‚</p>\n<p>ä½¿ç”¨ï¼š <code>getopt optstring parameters</code> ã€‚</p>\n<p><code>optstring</code>  å®šä¹‰äº†å‘½ä»¤å¯ä»¥æ¥å—çš„å‘½ä»¤è¡Œæœ‰æ•ˆçš„<strong>é€‰é¡¹å­—æ¯</strong>ï¼ˆè¦åˆ†æçš„å‚æ•°ï¼‰ï¼Œåœ¨æ¯ä¸ªéœ€è¦å‚æ•°å€¼çš„é€‰é¡¹å­—æ¯åé¢åŠ ä¸€ä¸ªå†’å·ï¼Œå…¶å‚æ•°ç´§è·Ÿåœ¨é€‰é¡¹åé¢æˆ–è€…éš”ä¸€ä¸ªç©ºæ ¼ï¼›å¦‚æœé€‰é¡¹å­—æ¯åé¢åŠ äº† 2 ä¸ªå†’å·ï¼Œåˆ™å‚æ•°å’Œé€‰é¡¹ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ <code>getopt</code>  ä¼šåŸºäºå®šä¹‰çš„ <code>optstring</code>  è§£ææä¾›çš„å‚æ•°ã€‚</p>\n<p><code>paramters</code>  æ˜¯å®é™…çš„å‚æ•°åˆ—è¡¨ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ä¸¾ä¸ªä¾‹å­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~$ getopt ab:cd <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-b</span> test1 <span class=\"token parameter variable\">-cd</span> test2 test3</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-b</span> test1 <span class=\"token parameter variable\">-c</span> <span class=\"token parameter variable\">-d</span> -- test2 test3</pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œ <code>optstring</code>  æ˜¯ <code>ab:cd</code> ï¼Œè§„å®šäº†å‘½ä»¤å¯ä»¥æ¥å—çš„æœ‰æ•ˆçš„é€‰é¡¹ <code>a,b,c,d</code> ã€‚ <code>b</code>  çš„åé¢æœ‰å†’å·ï¼Œæ‰€ä»¥ <code>-b</code>  é€‰é¡¹åé¢å¿…é¡»è·Ÿä¸€ä¸ªå‚æ•°ï¼Œä¾‹å­ä¸­æ˜¯ <code>test1</code> ã€‚ <code>-a -b test1 -cd test2 test3</code>  æ˜¯ <code>parameters</code> ï¼Œé‡Œé¢å‡ºç°çš„é€‰é¡¹ä¸èƒ½æ˜¯ <code>optstring</code>  ä¹‹å¤–çš„é€‰é¡¹ã€‚</p>\n<p>æ³¨æ„ï¼Œå®ƒä¼šè‡ªåŠ¨å°† <code>-cd</code>  é€‰é¡¹åˆ†ä¸ºä¸¤ä¸ªå•ç‹¬çš„é€‰é¡¹ï¼Œå¹¶<strong>æ’å…¥åŒç ´æŠ˜å·</strong>æ¥åˆ†éš”è¡Œä¸­çš„é¢å¤–å‚æ•°ã€‚</p>\n<p>ä¸ºäº†å¸®ä½ æ›´å¥½ç†è§£è¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šå†™ä¸€ä¸ªè„šæœ¬ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½çŸ¥é“ <code>set</code>  å‘½ä»¤ã€‚è¯¥å‘½ä»¤ä¼šå°†ä½ç½®å‚æ•°è®¾ç½®ä¸ºå›ºå®šçš„å€¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$1</span> <span class=\"token variable\">$2</span> <span class=\"token variable\">$3</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> -- å‚æ•°1 å‚æ•°2 å‚æ•°3</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$1</span> <span class=\"token variable\">$2</span> <span class=\"token variable\">$3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./new_File para1 para2 para3</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>para1 para2 para3</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>å‚æ•°1 å‚æ•°2 å‚æ•°3</pre></td></tr></table></figure><p>ç°åœ¨å†™ä¸€ä¸ªè„šæœ¬</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#set -- ä¼šå°†å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢æˆ set å‘½ä»¤çš„å‘½ä»¤è¡Œå€¼ï¼ŒæŒºé‡è¦çš„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#-q å¯ä»¥å»æ‰æŠ¥é”™ä¿¡æ¯ï¼Œ$@æ˜¯å¾—åˆ°è„šæœ¬åé¢è·Ÿç€çš„å‚æ•°ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼ŒåŒä¸€ä¸ªå­—ç¬¦ä¸²å¤šä¸ªå•è¯ï¼‰</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> -- <span class=\"token variable\"><span class=\"token variable\">$(</span>getopt <span class=\"token parameter variable\">-q</span> ab:cd <span class=\"token string\">\"<span class=\"token variable\">$@</span>\"</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">$1</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">case</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token keyword\">in</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    -a<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -a option\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    -b<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">param</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$2</span>\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -b option,with parameter value <span class=\"token variable\">$param</span>\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token builtin class-name\">shift</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    -c<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -c option\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    --<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">shift</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token builtin class-name\">break</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    *<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span> is not an option\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">esac</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token builtin class-name\">shift</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å‘½ä»¤çš„é€‰é¡¹ + å‚æ•°ï¼Œå…¶åŸç†å·®ä¸å¤šå°±æ˜¯è¿™æ ·çš„ï¼ˆå½“ç„¶ä¸æ’é™¤æ›´å¤æ‚çš„ï¼‰ã€‚(âŠ™ï¹âŠ™)ï¼Œæˆ‘è§‰å¾—åŠ ä¸Šè¿™ä¸ªè„šæœ¬ä¾‹å­ï¼Œä½ åº”è¯¥å¾ˆæ˜ç™½ <code>getopt</code>  åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„äº†å§ã€‚</p>\n<h1 id=\"getoptså‘½ä»¤\"><a class=\"anchor\" href=\"#getoptså‘½ä»¤\">#</a> getopts å‘½ä»¤</h1>\n<p>æ²¡é”™ï¼Œæˆ‘å½“æ—¶ä¹Ÿå¾ˆéš¾å—ï¼Œè´¹å·¥å¤«ç†è§£ <code>getopt</code>  ä¹‹åï¼Œåˆæ¥ä¸€ä¸ªã€‚</p>\n<p>è¯¥å‘½ä»¤å†…å»ºäº <code>bash shell</code> ï¼Œæ¯” <code>getopt</code>  å¤šäº†ä¸€äº›æ‰©å±•åŠŸèƒ½ã€‚ä½¿ç”¨æ ¼å¼ä¸ºï¼š <code>getopts optstring variable</code> <br />\n<strong> æ¯æ¬¡åªå¤„ç†å‘½ä»¤è¡Œä¸€ä¸ªå‚æ•°</strong>ï¼Œå¤„ç†å®Œæ‰€æœ‰å‚æ•°åï¼Œå°±ä¼šé€€å‡ºå¹¶è¿”å›ä¸€ä¸ªå¤§äº 0 çš„é€€å‡ºç ã€‚</p>\n<ol>\n<li>å¦‚æœè¦æƒ³ <code>getiopt -q</code>  é‚£æ ·å»æ‰é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦åœ¨ <code>optstring</code>  å‰åŠ ä¸Šä¸€ä¸ªå†’å·ã€‚</li>\n<li><code>getopts</code>  å‘½ä»¤ä¼šå°†å½“å‰å‚æ•°ï¼ˆé€‰é¡¹ï¼‰ä¿å­˜åœ¨å‘½ä»¤è¡Œä¸­å®šä¹‰çš„ <code>variable</code>  ä¸­</li>\n<li><code>getopts</code>  å‘½ä»¤ä¼šç”¨åˆ°ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚é€‰é¡¹å¦‚æœéœ€è¦ä¸€ä¸ªå‚æ•°å€¼ï¼Œ <code>OPTARG</code>  ç¯å¢ƒå˜é‡å°±ä¼šä¿å­˜è¿™ä¸ªå€¼ã€‚ <code>OPTIND</code>  ç¯å¢ƒå˜é‡ä¿å­˜å‚æ•°åˆ—è¡¨ä¸­ <code>getopts</code>  æ­£åœ¨å¤„ç†çš„å‚æ•°ä½ç½®ã€‚</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OPTINDçš„å€¼ä¸º:<span class=\"token environment constant\">$OPTIND</span>\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æ ¹æ®ç¬¬ 2 ç‚¹ï¼Œå½“å‰é€‰é¡¹ä¼šè¢«ä¿å­˜åœ¨ opt ä¸­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">getopts</span> :ab:c opt</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">case</span> <span class=\"token string\">\"<span class=\"token variable\">$opt</span>\"</span> <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\"># æˆ‘å†™çš„æ˜¯ a è€Œä¸æ˜¯ - a</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        a<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -a option\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        b<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -b option,with value <span class=\"token variable\">$OPTARG</span>\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># é€‰é¡¹åçš„å‚æ•°å€¼</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        c<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Found the -c option\"</span> <span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        *<span class=\"token punctuation\">)</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Unkown option:<span class=\"token variable\">$opt</span>\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">esac</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OPTINDçš„å€¼ä¸º:<span class=\"token environment constant\">$OPTIND</span>\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ç»™çš„çœŸå®çš„å‚æ•°åˆ—è¡¨ä¸ºï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-btest1</span> <span class=\"token parameter variable\">-c</span> test2 test3</pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœå°±æ˜¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Found the <span class=\"token parameter variable\">-a</span> option</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Found the <span class=\"token parameter variable\">-b</span> option,with value test1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:3</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Found the <span class=\"token parameter variable\">-c</span> option</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:4</pre></td></tr></table></figure><p>ä»è¯¥è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† <code>getopts</code>  å¦‚ä½•æ ¹æ®ä¸¤ä¸ªç³»ç»Ÿå˜é‡è¿›è¡Œå‚æ•°æ§åˆ¶çš„ã€‚æˆ‘ä»¬ä¸å¦¨å°†è„šæœ¬å†…å®¹æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OPTINDçš„å€¼ä¸º:<span class=\"token environment constant\">$OPTIND</span>\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æ ¹æ®ç¬¬ 2 ç‚¹ï¼Œå½“å‰é€‰é¡¹ä¼šè¢«ä¿å­˜åœ¨ opt ä¸­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">getopts</span> :ab:c opt</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token comment\"># case \"$opt\" in</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">#    a) echo \"Found the -a option\" ;;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">#    b) echo \"Found the -b option,with value $OPTARG\" ;; # é€‰é¡¹åçš„å‚æ•°å€¼</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">#    c) echo \"Found the -c option\" ;;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">#   *) echo \"Unkown option:$opt\";;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">#esac</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$opt</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OPTINDçš„å€¼ä¸º:<span class=\"token environment constant\">$OPTIND</span>\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>å‚æ•°åˆ—è¡¨ä¸å˜</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-btest1</span> <span class=\"token parameter variable\">-c</span> test2 test3</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:3</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>c</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token environment constant\">OPTIND</span>çš„å€¼ä¸º:4</pre></td></tr></table></figure><p>åœ¨ <code>opt=c</code>  ä¹‹åè¿˜è¿›è¡Œäº†ä¸€æ¬¡å¾ªç¯ï¼Œæ­¤æ—¶ opt åº”è¯¥æ˜¯åˆ°äº†å…¶ä»–å‚æ•°ï¼ˆ <code>test2,test3</code> ï¼‰é‚£é‡Œï¼Œä½†æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åº”çš„å€¼ï¼Œ <code>opt</code>  åªå­˜å‚¨é€‰é¡¹çš„å€¼ã€‚</p>\n<h1 id=\"readå‘½ä»¤\"><a class=\"anchor\" href=\"#readå‘½ä»¤\">#</a> read å‘½ä»¤</h1>\n<p><code>read</code>  å‘½ä»¤ç”¨äºè·å–ç”¨æˆ·è¾“å…¥ï¼š</p>\n<ul>\n<li><code>read name</code>  è¾“å…¥çš„æ•°æ®å°±ä¼šä¿å­˜åœ¨ <code>name</code>  ä¸­ã€‚</li>\n<li><code>read -p &quot;Please enter your age:&quot; age</code> ï¼Œ  <code>-p</code>  å‚æ•°å…è®¸æŒ‡å®šè¾“å…¥æç¤ºè¯­å¥ã€‚</li>\n<li><code>read -p &quot;Please enter your name:&quot; firstname lastname</code>  å¯ä»¥æŒ‡å®šå¤šä¸ªå˜é‡ï¼Œå¦‚æœè¾“å…¥å¤§äºå˜é‡ä¸ªæ•°ï¼Œå°±ä¼šå°†å‰©ä¸‹çš„è¾“å…¥å…¨éƒ¨ä¿å­˜åœ¨æœ€åä¸€ä¸ªå˜é‡ä¸­ã€‚</li>\n<li>ä¸æŒ‡å®šä¿å­˜å˜é‡æ—¶ï¼Œä¼šå°†è¾“å…¥ä¿å­˜åœ¨ç¯å¢ƒå˜é‡ <code>REPLY</code>  ä¸­ã€‚</li>\n<li><code>read -t 5 age</code>  è®¾ç½®è¶…æ—¶é€‰é¡¹ï¼Œå¦‚æœè§„å®šæ—¶é—´æ²¡æœ‰å®Œæˆè¾“å…¥ï¼Œå°±ä¼šç»§ç»­æ‰§è¡Œï¼Œå•ä½æ˜¯ç§’ã€‚</li>\n<li><code>read -n1 -p &quot;Please enter [Y/N] to continue:&quot; ans</code> ï¼Œå¯ä»¥é€šè¿‡ <code>-n</code>  å¯¹è¾“å…¥é•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œæ•°å­—å¯ä»¥ä¸é€‰é¡¹ <code>-n</code>  ä¸€èµ·ä½¿ç”¨ã€‚ç»™çš„ä¾‹å­ä¸­å¹¶ä¸”åªè¦æŒ‰ä¸‹å•ä¸ªå­—ç¬¦åï¼Œä¸éœ€è¦æŒ‰å›è½¦å°±ä¼šç»§ç»­æ‰§è¡Œã€‚</li>\n<li><code>read -s -p &quot;Please enter the password:&quot; passwd</code> ï¼Œ <code>-s</code>  ä¼šè®©è¾“å…¥æ—¶æ•°æ®éšè—ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œæ¯æ¬¡è°ƒç”¨ read å‘½ä»¤å°±ä¼šè¯»å–ä¸€è¡Œæ–‡æœ¬ï¼Œå½“æ–‡ä»¶æ²¡æœ‰å†…å®¹æ—¶ï¼Œread å°±ä¼šé€€å‡ºå¹¶è¿”å›é 0 é€€å‡ºçŠ¶æ€ç </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æ–‡ä»¶æ•°æ®ä¼ ç»™ readï¼Œæœ€å¸¸è§çš„å°±æ˜¯ä½¿ç”¨ catï¼Œå°†ç»“æœé€šè¿‡ç®¡é“ç›´æ¥ä¼ ç»™å«æœ‰ read å‘½ä»¤çš„ while å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">cat</span> data.txt <span class=\"token operator\">|</span> <span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> line</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Line <span class=\"token variable\">$count</span>:<span class=\"token variable\">$line</span>\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span>$<span class=\"token punctuation\">[</span><span class=\"token variable\">$count</span> + <span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Finished proceessign the file\"</span></pre></td></tr></table></figure><h1 id=\"æœ€å\"><a class=\"anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>è¯·å¤šåŠ ç»ƒä¹ ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/01/Shell/%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC(2)/",
            "url": "https://cecilia.cool/2022/08/01/Shell/%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC(2)/",
            "title": "æ„å»ºåŸºæœ¬è„šæœ¬(2)",
            "date_published": "2022-08-01T10:09:46.000Z",
            "content_html": "<h1 id=\"æ•°å­¦è¿ç®—\"><a class=\"anchor\" href=\"#æ•°å­¦è¿ç®—\">#</a> æ•°å­¦è¿ç®—</h1>\n<p>åœ¨è„šæœ¬ä¸­è¿›è¡Œæ•°å­¦è¿ç®—æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä½ å¯ä»¥ä»ä¸‹é¢é€‰å‡ ç§å–œæ¬¢çš„</p>\n<ul>\n<li><code>exper</code>  å‘½ä»¤ï¼Œæ”¯æŒåŸºæœ¬çš„ï¼ˆé€»è¾‘ã€æ¯”è¾ƒï¼‰è¿ç®—ç¬¦ï¼Œå¯¹äºæœ‰æ­§ä¹‰çš„ç¬¦å· (å¦‚ <code>*</code> )ï¼Œéœ€è¦ç”¨ <code>\\*</code> ï¼Œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9saW51eC9saW51eC1jb21tLWV4cHIuaHRtbA==\">ä¼ é€é—¨</span>ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># expr è¡¨è¾¾å¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">expr</span> length â€œthis is a testâ€\t<span class=\"token comment\">#è®¡ç®—å­—ä¸²é•¿åº¦</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">expr</span> <span class=\"token number\">14</span> % <span class=\"token number\">9</span>\t\t<span class=\"token comment\">#æ•´æ•°è¿ç®—</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">expr</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">\\</span>* <span class=\"token number\">10</span>\t<span class=\"token comment\">#æ³¨æ„ã€‚å‚æ•°å’Œç¬¦å·ä¹‹é—´å¿…é¡»è¦æœ‰ç©ºæ ¼</span></pre></td></tr></table></figure><ul>\n<li><code>$[è¡¨è¾¾å¼]</code> ï¼Œæ›´åŠ æ–¹ä¾¿ï¼Œç¬¦å·ä¸ä¼šå‡ºç°æ­§ä¹‰ï¼Œä½†æ˜¯åªèƒ½æ•´æ•°è¿ç®—ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">var1</span><span class=\"token operator\">=</span>$<span class=\"token punctuation\">[</span><span class=\"token number\">1</span>+5<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul>\n<li><code>bc</code>  è®¡ç®—å™¨ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œ <code>-q</code>  å¯ä»¥ä¸æ˜¾ç¤º <code>bash</code>  è®¡ç®—å™¨å†—é•¿çš„æ¬¢è¿ä¿¡æ¯ã€‚æµ®ç‚¹è¿ç®—æ˜¯ç”±å†…å»ºå˜é‡ <code>scale</code>  æ§åˆ¶çš„ï¼Œå¿…é¡»å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºè®¡ç®—ç»“æœå¸Œæœ›ä¿ç•™çš„å°æ•°ä½æ•° <code>scale</code>  é»˜è®¤æ˜¯ 0ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">bc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># æ¬¢è¿ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">bc</span> <span class=\"token number\">1.07</span>.1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Copyright <span class=\"token number\">1991</span>-1994, <span class=\"token number\">1997</span>, <span class=\"token number\">1998</span>, <span class=\"token number\">2000</span>, <span class=\"token number\">2004</span>, <span class=\"token number\">2006</span>, <span class=\"token number\">2008</span>, <span class=\"token number\">2012</span>-2017 Free Software Foundation, Inc.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>This is <span class=\"token function\">free</span> software with ABSOLUTELY NO WARRANTY.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>For details <span class=\"token builtin class-name\">type</span> `warranty<span class=\"token string\">'.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>1+3</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>4</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>319+42</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>361</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>cyan@cyan-virtual-machine:~$ bc -q</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>21/3</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>7</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>#å†…å»ºå˜é‡ä¸èƒ½åœ¨å¤–é¢ä¿®æ”¹</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>cyan@cyan-virtual-machine:~$ echo $scale</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>cyan@cyan-virtual-machine:~$ bc -q</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>scale=3 #è¿›å…¥bcä¿®æ”¹å†…å»ºå˜é‡</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>21/3</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>7.000</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre># è¿˜æœ‰ä¸€ç§ä¿®æ”¹å†…å»ºå˜é‡çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºè„šæœ¬ä¸­ï¼Œæ ¼å¼ä¸ºecho \"options;expression\" | bc</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>cyan@cyan-virtual-machine:~$ echo '</span><span class=\"token number\">21</span>/4<span class=\"token string\">' | bc</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>5</pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>cyan@cyan-virtual-machine:~$ echo '</span>scale<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span><span class=\"token number\">21</span>/4' <span class=\"token operator\">|</span> <span class=\"token function\">bc</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">5.2500</span></pre></td></tr></table></figure><p>å¯è§ï¼Œé€šè¿‡ç®¡é“ï¼Œ <code>bc</code>  è®¡ç®—å™¨è¿˜æ˜¯æŒºå¥½ç”¨çš„ã€‚å†çœ‹ä¸€ä¸ªè¾“å…¥é‡å®šå‘çš„ä¾‹å­</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">cat</span> math.dat</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">scale</span><span class=\"token operator\">=</span><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">var1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">var2</span><span class=\"token operator\">=</span><span class=\"token number\">29</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">var3</span><span class=\"token operator\">=</span><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>var1/var3+var2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token assign-left variable\">result</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">bc</span> <span class=\"token operator\">&lt;</span> math.dat<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$result</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">29.2000</span></pre></td></tr></table></figure><p>æœ‰ä¸€ç‚¹ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ <code>bc</code>  ä¸­ä½¿ç”¨å˜é‡æ²¡æœ‰åŠ  <code>$</code>  ç¬¦å·ã€‚æœ€åï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•<strong>å†…è”è¾“å…¥é‡å®šå‘</strong>ï¼Œæˆ‘æƒ³ï¼Œåº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜å§ï¼Ÿ</p>\n<h1 id=\"ç»“æ„åŒ–è¯­å¥\"><a class=\"anchor\" href=\"#ç»“æ„åŒ–è¯­å¥\">#</a> ç»“æ„åŒ–è¯­å¥</h1>\n<p>è¯¥éƒ¨åˆ†æˆ‘å°±ç›´æ¥ç»™æ ¼å¼äº†ï¼Œä½ è®°ä½äº†å°±ä¼šä½¿ç”¨ã€‚</p>\n<h2 id=\"é€‰æ‹©è¯­å¥\"><a class=\"anchor\" href=\"#é€‰æ‹©è¯­å¥\">#</a> é€‰æ‹©è¯­å¥</h2>\n<p>æˆ‘ä»¬å¦‚ä½•å¯¹ <code>if</code>  ä¸­çš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Ÿ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> condition1      <span class=\"token comment\">#(é€€å‡ºçŠ¶æ€ç æ˜¯ 0)   </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    commands_1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">elif</span> condition2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    commands_2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    commands_3</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr></table></figure><p><code>condition</code>  å¯ä»¥æ˜¯ä¸€ä¸ªå‘½ä»¤çš„æ­£ç¡®æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ•°å€¼æ¯”è¾ƒï¼Œæ–‡ä»¶æ¯”è¾ƒã€‚</p>\n<p>åˆ¤æ–­ <code>condition</code>  çš„å‘½ä»¤ä¸º <code>test condtion</code>  æˆ–è€… <code>[ condition ](å¿…é¡»æœ‰ç©ºæ ¼)</code> ã€‚åŒæ ·çš„ï¼Œå¦‚æœæœ‰å¤šä¸ª <code>condition</code>  å¯ä»¥ä½¿ç”¨ <code>&amp;&amp; , ||</code> ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> tmp.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$var</span> <span class=\"token parameter variable\">-ge</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$var</span> <span class=\"token parameter variable\">-le</span> <span class=\"token number\">190</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'æ‰§è¡Œifè¯­å¥å—'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'æ‰§è¡Œelseè¯­å¥å—'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>æ‰§è¡Œifè¯­å¥å—</pre></td></tr></table></figure><p>å†æ¬¡å£°æ˜ï¼Œä½¿ç”¨ <code>[]</code>  è¦åŠ <strong>ç©ºæ ¼</strong>ã€‚</p>\n<h2 id=\"æ¯”è¾ƒæ–¹å¼\"><a class=\"anchor\" href=\"#æ¯”è¾ƒæ–¹å¼\">#</a> æ¯”è¾ƒæ–¹å¼</h2>\n<p><strong>æ•°å€¼æ¯”è¾ƒ</strong>ï¼š <code>n1 -eq n2</code></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">ç¬¦å·é€‰é¡¹</th>\n<th style=\"text-align:center\">å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-eq</td>\n<td style=\"text-align:center\">equals(==)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-gt</td>\n<td style=\"text-align:center\">greater than(&gt;)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-ge</td>\n<td style=\"text-align:center\">greater equals(&gt;=)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-lt</td>\n<td style=\"text-align:center\">less than(&lt;)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-le</td>\n<td style=\"text-align:center\">less equals(&lt;=)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-ne</td>\n<td style=\"text-align:center\">not equals(!=)</td>\n</tr>\n</tbody>\n</table>\n<p><code>if [ $val -gt 5]</code>  ï¼Œæ³¨æ„ï¼Œbash shell åªèƒ½ä½¿ç”¨æ•´æ•°ã€‚</p>\n<p><strong>å­—ç¬¦ä¸²æ¯”è¾ƒ</strong>ï¼š</p>\n<p>ç›´æ¥ä½¿ç”¨ <code>=,!=,\\&gt;,\\&lt;</code> (å¤§äºå°äºï¼Œå¿…é¡»ä½¿ç”¨è½¬ä¹‰ï¼Œå¦åˆ™å°±ä¼šè¢«è®¤ä¸ºæ˜¯é‡å®šå‘)ã€‚ åœ¨æ¯”è¾ƒæµ‹è¯•ä¸­ï¼Œ<strong>å¤§å†™å­—æ¯ &lt; å°å†™å­—æ¯</strong>ï¼Œå¦‚ <code>a&gt;z&gt;A</code> ã€‚è€Œ <code>sort</code>  å‘½ä»¤æ°å¥½ç›¸åï¼Œ <code>sort</code>  ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿæœ¬åœ°åŒ–è¯­è¨€è®¾ç½®ä¸­å®šä¹‰çš„æ’åºé¡ºåºã€‚å¯¹äºè‹±è¯­ï¼Œ<strong>æœ¬åœ°åŒ–è®¾ç½®æŒ‡å®šåœ¨æ’åºé¡ºåºä¸­ï¼Œå°å†™å­—æ¯å‡ºç°åœ¨å¤§å†™å­—æ¯å‰</strong>ã€‚</p>\n<p><code>-n</code>  å’Œ <code>-z</code>  å¯ä»¥æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦å«æœ‰æ•°æ® (æœªè¢«å®šä¹‰çš„å˜é‡é»˜è®¤é•¿åº¦ä¸º 0)</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>if<span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">$val</span> <span class=\"token punctuation\">]</span>\t<span class=\"token comment\">#å¦‚æœ val é•¿åº¦ä¸ä¸º 0ï¼Œå°±æ‰§è¡Œ then</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>if<span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token variable\">$val</span> <span class=\"token punctuation\">]</span>\t<span class=\"token comment\">#å¦‚æœ val é•¿åº¦ä¸º 0ï¼Œå°±æ‰§è¡Œ thenï¼Œz--zero</span></pre></td></tr></table></figure><p><strong>æ–‡ä»¶æ¯”è¾ƒ</strong>ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">ç¬¦å·é€‰é¡¹</th>\n<th style=\"text-align:center\">å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-d file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯ä¸€ä¸ªç›®å½• (directory)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-e file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨ (exits)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-f file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-r file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦å¯è¯»</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-s file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦éç©º</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-w file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦å¯å†™</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-x file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦å¯æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-G file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶ä¸”é»˜è®¤ç»„ä¸å½“å‰ç”¨æˆ·ç›¸åŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">-O file</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file æ˜¯å¦å­˜åœ¨å¹¶æ˜¯å¦å¹¶å±å½“å‰ç”¨æˆ·æ‰€æœ‰</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">file1 -nt file2</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file1 æ˜¯å¦æ¯” file2 æ–°</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">file1 -ot file2</td>\n<td style=\"text-align:center\">æ£€æŸ¥ file1 æ˜¯å¦æ¯” file2 æ—§</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"caseè¯­å¥\"><a class=\"anchor\" href=\"#caseè¯­å¥\">#</a> case è¯­å¥</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">case</span> variable <span class=\"token keyword\">in</span>                            </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>pattern1 <span class=\"token operator\">|</span> pattern2<span class=\"token punctuation\">)</span>    commands1<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pattern3<span class=\"token punctuation\">)</span>   commands2<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>                         </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>*<span class=\"token punctuation\">)</span> defalut commands3<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>                      </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">esac</span>                                       </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># ä¾‹å­</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">case</span> <span class=\"token environment constant\">$USER</span> <span class=\"token keyword\">in</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Bob <span class=\"token operator\">|</span> Mike<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Number one\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Cyan<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Cyan\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Have not found\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">esac</span></pre></td></tr></table></figure><h2 id=\"å¾ªç¯è¯­å¥\"><a class=\"anchor\" href=\"#å¾ªç¯è¯­å¥\">#</a> å¾ªç¯è¯­å¥</h2>\n<h3 id=\"forå¾ªç¯\"><a class=\"anchor\" href=\"#forå¾ªç¯\">#</a> for å¾ªç¯</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">var</span> <span class=\"token keyword\">in</span> list         </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    commands                </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">done</span>                    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#ä¾‹å­</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">test</span> <span class=\"token keyword\">in</span> Alabama Alaska Arizona Arkansas California</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token builtin class-name\">echo</span> The state is <span class=\"token variable\">$test</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>$test</code>  å˜é‡åœ¨å‰©ä½™çš„ <code>shell</code>  è„šæœ¬ä¸€ç›´æœ‰æ•ˆå¹¶ä¸”ä¿æŒç€æœ€åä¸€ä¸ªå˜é‡çš„å€¼ (å½“ç„¶æ˜¯å¯ä»¥ä¿®æ”¹çš„)</p>\n</li>\n<li>\n<p><code>list</code>  ä¸­å•ä¸ªå…ƒç´ å‡ºç°äº†å•å¼•å·ï¼Œç©ºæ ¼ç­‰ï¼Œè¦ä¹ˆåœ¨è¿™ä¸ªå•ç‹¬å˜é‡å¤–éƒ¨ç›´æ¥å†ä½¿ç”¨ä¸€å¯¹å¼•å·ï¼Œè¦ä¹ˆç›´æ¥ä½¿ç”¨ <code>\\</code>  è½¬ä¹‰å­—ç¬¦</p>\n</li>\n<li>\n<p><code>list</code>  çš„è·å–ï¼Œä¹Ÿå¯ä»¥ç”¨<strong>å‘½ä»¤çš„è¾“å‡º + å‘½ä»¤æ›¿æ¢</strong>ï¼š <code>for var in $(cat file)</code> ï¼Œç”šè‡³æ˜¯ <code>/home/cyan/test/*</code>  è·¯å¾„ã€‚å½“ç„¶ï¼Œå¦‚æœå˜é‡æ˜¯æ–‡ä»¶åï¼Œè¦è€ƒè™‘æ–‡ä»¶åå¯èƒ½å‡ºç°ç©ºæ ¼ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ—¶å°±è¦ä½¿ç”¨å¼•å·ï¼š <code>&quot;$file&quot;</code> ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æ¨¡æ‹Ÿ ls æŒ‡ä»¤ï¼Œæ‰“å°æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆå½“ç„¶è¿™é‡Œç›®å½•å›ºå®šä¸º home/cyanï¼‰</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># å¦‚æœæƒ³åƒ ls è·¯å¾„é‚£æ ·ä¼ å‚æ•°ï¼Œéœ€è¦ç”¨åˆ°ä¹‹åçš„çŸ¥è¯†</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> tmp.txt</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#/bin/bash</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">file_name</span> <span class=\"token keyword\">in</span> /home/cyan/*</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$file_name</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>/home/cyan/Desktop</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>/home/cyan/Documents</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>/home/cyan/Downloads</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>/home/cyan/Files</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>/home/cyan/Music</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>/home/cyan/OSIntroduction</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>/home/cyan/Pictures</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>/home/cyan/Public</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>/home/cyan/shtool-2.0.8</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>/home/cyan/shtool-2.0.8.tar.gz</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>/home/cyan/snap</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>/home/cyan/Templates</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>/home/cyan/Videos</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>/home/cyan/vmware-tools-distrib</pre></td></tr></table></figure><ul>\n<li>åœ¨ <code>list</code>  ä¸­ï¼Œå„ä¸ªå…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯ç”± <code>IFS</code> -- å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦å†³å®šçš„ï¼Œä¸€èˆ¬ä¼šå°†<strong>ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦</strong>ä½œä¸ºé»˜è®¤å­—æ®µåˆ†éš”ç¬¦å¦‚æœæƒ³è¦æ›´æ”¹åˆ†éš”ç¬¦ï¼Œå°±å¿…é¡»åœ¨ <code>shell</code>  è„šæœ¬ <code>for</code>  å¾ªç¯å‰é¢æ›´æ”¹ <code>IFS</code> ã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> data</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jack bob cyan mike</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mary smith</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> tmp.txt</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#/bin/bash</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">name</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">cat</span> data<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$name</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#å¾—åˆ°çš„ç»“æœ</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>jack</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>bob</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>cyan</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>mike</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>mary</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>smith</pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º <code>IFS</code>  é»˜è®¤çš„æ˜¯ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ã€‚åœ¨é‡åˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œå°±å·²ç»åˆ†éš”äº†ã€‚å¦‚æœæƒ³è¦åªä»¥æ¢è¡Œç¬¦ä¸ºåˆ†éš”ç¬¦</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> tmp.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">oldIFS</span><span class=\"token operator\">=</span><span class=\"token environment constant\">$IFS</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">IFS</span></span><span class=\"token operator\">=</span><span class=\"token string\">$'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">file_name</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">cat</span> data<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$file_name</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">IFS</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$oldIFS</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./tmp.txt</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>jack bob cyan mike</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>mary smith</pre></td></tr></table></figure><p>C è¯­è¨€é£æ ¼çš„ for å¾ªç¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token variable\"><span class=\"token punctuation\">((</span> i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span> <span class=\"token punctuation\">))</span></span> <span class=\"token comment\"># i=$(expr $i+1)  i=$[$i + 1]   i=$(echo \"scale=0;$i + 1\" | bc)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    commands</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><h3 id=\"whileå¾ªç¯\"><a class=\"anchor\" href=\"#whileå¾ªç¯\">#</a> while å¾ªç¯</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">test</span> conitions</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    commands</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># test çš„æ›¿ä»£ç‰© [] éœ€è¦ä¸¤è¾¹ç©ºæ ¼ï¼Œè€Œ expr çš„æ›¿ä»£ç‰© $[] ä¸éœ€è¦ä¸¤è¾¹ç©ºæ ¼</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># while å‘½ä»¤å…è®¸æ‰§è¡Œå¤šä¸ªæµ‹è¯•å‘½ä»¤ï¼Œä½†æ˜¯åªæœ‰æœ€åä¸€ä¸ªæµ‹è¯•å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ä¼šè¢«ç”¨äºå†³å®šä»€ä¹ˆæ—¶å€™ç»“æŸå¾ªç¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#   æ¯”å¦‚ï¼šwhile [$var1 -ge 0]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#               echo $var1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#   å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#æ³¨æ„ï¼Œæ¯ä¸ªæµ‹è¯•å‘½ä»¤å•ç‹¬ä¸€è¡Œ</span></pre></td></tr></table></figure><h3 id=\"untilå‘½ä»¤\"><a class=\"anchor\" href=\"#untilå‘½ä»¤\">#</a> until å‘½ä»¤</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">until</span> <span class=\"token builtin class-name\">test</span> commands</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    commands</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># until è¯­å¥ï¼Œåªæœ‰æµ‹è¯•æ¡ä»¶çš„é€€å‡ºç é 0ï¼Œæ‰ä¼šæ‰§è¡Œå¾ªç¯ä¸­åˆ—å‡ºçš„å‘½ä»¤ã€‚</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/08/01/Shell/%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC(1)/",
            "url": "https://cecilia.cool/2022/08/01/Shell/%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC(1)/",
            "title": "æ„å»ºåŸºæœ¬è„šæœ¬(1)",
            "date_published": "2022-08-01T02:11:11.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä¹‹å‰åœ¨ <code>shell</code>  å¿«é€Ÿå…¥é—¨ä¸­å·²ç»è®²äº†å¦‚ä½•æ„å»ºä¸€ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼š</p>\n<ul>\n<li>ç¬¬ä¸€è¡Œè¦æŒ‡å®š shell ç±»å‹ <code>#!/bin/bash</code> ã€‚</li>\n<li>å®ŒæˆåŸºæœ¬çš„è„šæœ¬æ„å»ºåï¼Œå¢åŠ æ‰§è¡Œæƒé™ <code>chmod u+x æ–‡ä»¶å(uæ˜¯å±ä¸»)</code> ã€‚</li>\n<li>è¦å–æ¶ˆ <code>echo</code>  çš„æ¢è¡Œï¼Œå°±è¦ä½¿ç”¨ <code>-n</code>  å‚æ•° <code>echo -n &quot;abcd&quot;</code> ã€‚</li>\n<li>ä½¿ç”¨ç¾å…ƒç¬¦å· <code>$</code>  æ¥å¼•ç”¨å˜é‡ï¼Œå¦‚æœæƒ³å•çº¯ä½¿ç”¨è¿™ä¸ªç¬¦å·ï¼Œè¦åŠ ä¸Šè½¬ä¹‰ç¬¦ <code>\\$</code> ã€‚</li>\n<li>åœ¨è„šæœ¬ä¸­è‡ªè¡Œè®¾ç½®å˜é‡æ—¶ï¼Œ= ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä¸ç„¶ shell ä¼šè®¤ä¸ºæ˜¯å‘½ä»¤è€Œä¸æ˜¯å˜é‡ <code>var=100</code> ã€‚</li>\n</ul>\n<p>æœ¬æ–‡ä¼šæ¥ç€ä»‹ç»å…¶ä»–ä¸è„šæœ¬ç¼–ç¨‹ç›¸å…³çš„çŸ¥è¯†ã€‚</p>\n<h1 id=\"å‘½ä»¤æ›¿æ¢\"><a class=\"anchor\" href=\"#å‘½ä»¤æ›¿æ¢\">#</a> å‘½ä»¤æ›¿æ¢</h1>\n<p><code>shell</code>  è„šæœ¬æœ€æœ‰ç”¨çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å¯ä»¥<strong>ä»å‘½ä»¤è¾“å‡ºä¸­æå–ä¿¡æ¯</strong>ï¼Œè¯· <code>get</code>  å…³é”®è¯ï¼Œ<strong>å‘½ä»¤è¾“å‡º</strong>å’Œ<strong>æå–ä¿¡æ¯</strong>ã€‚</p>\n<p>è¯¥ç‰¹æ€§æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>\n<ul>\n<li>ä½¿ç”¨åå¼•å·ï¼ˆå°±æ˜¯ <code>Tab</code>  é”®ä¸Šé¢é‚£ä¸ªï¼‰</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#date å‘½ä»¤å¯ä»¥å¾—åˆ°å½“å‰æ—¶é—´ cyan@cyan-virtual-machine:~/Templates$ cat new_File</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">214391248</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">214391248</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span><span class=\"token variable\">`</span></span> <span class=\"token operator\">></span> new_File</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 01æ—¥ æ˜ŸæœŸä¸€ <span class=\"token number\">10</span>:42:33 CST</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span><span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 01æ—¥ æ˜ŸæœŸä¸€ <span class=\"token number\">10</span>:21:55 CST</pre></td></tr></table></figure><ul>\n<li>ä½¿ç”¨ <code>$()</code> ï¼Œæœ‰äº› <code>shell</code>  ä¸æ”¯æŒè¿™ç§</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 01æ—¥ æ˜ŸæœŸä¸€ <span class=\"token number\">10</span>:23:19 CST</pre></td></tr></table></figure><p>å‘½ä»¤æ›¿æ¢ä¼šåˆ›å»ºä¸€ä¸ªå­ <code>shell</code>  æ¥è¿è¡Œå¯¹åº”å‘½ä»¤ï¼Œå­ <code>shell</code>  æ˜¯ç”±è¿è¡Œè„šæœ¬çš„ <code>shell</code>  åˆ›å»ºçš„ä¸€ä¸ªç‹¬ç«‹çš„å­ <code>shell</code> ã€‚å› æ­¤ï¼Œè¯¥å­ <code>shell</code>  æ‰€æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•ä½¿ç”¨è„šæœ¬ä¸­æ‰€åˆ›å»ºçš„å˜é‡çš„ã€‚åœ¨å‘½ä»¤è¡Œæç¤ºç¬¦ä¸‹ä½¿ç”¨è·¯å¾„./ æ¥è¿è¡Œå‘½ä»¤ï¼Œä¹Ÿä¼šåˆ›å»ºå­ <code>shell</code></p>\n<p>å…³äº <code>date</code>  å‘½ä»¤ï¼Œä½ å¦‚æœå¸Œæœ›å¾—åˆ°è‡ªå·±å¸Œæœ›çš„æ ¼å¼åŒ–ç»“æœ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">date</span> +%y-%m-%d<span class=\"token punctuation\">\\</span> %H:%M:%S</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">22</span>-08-01 <span class=\"token number\">10</span>:25:33</pre></td></tr></table></figure><h1 id=\"é‡å®šå‘\"><a class=\"anchor\" href=\"#é‡å®šå‘\">#</a> é‡å®šå‘</h1>\n<p>ä»è¿™é‡Œå¼€å§‹ï¼Œä½ å°±ç®—æ¥è§¦æµè¿™ä¸ªä¸œè¥¿äº†ï¼Œè¾“å…¥æµè¾“å‡ºæµï¼Œ<strong>é‡å®šå‘å°±æ˜¯å¯¹æµçš„æ–¹å‘é‡æ–°å®šä¹‰</strong>ï¼ˆä½ ç°åœ¨å¯ä»¥è¿™ä¹ˆç†è§£ï¼‰ã€‚</p>\n<h2 id=\"æ ‡å‡†è¾“å‡ºé‡å®šå‘\"><a class=\"anchor\" href=\"#æ ‡å‡†è¾“å‡ºé‡å®šå‘\">#</a> æ ‡å‡†è¾“å‡ºé‡å®šå‘</h2>\n<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œ <code>echo</code>  å°†æ•°æ®æ‰“å°åˆ°å±å¹•ä¸Šï¼ˆæ ‡å‡†è¾“å‡ºæµï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹ <code>echo</code>  çš„æµçš„æ–¹å‘é‡æ–°<strong>æŒ‡å‘</strong></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">214391248</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">214391248</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span><span class=\"token variable\">`</span></span> <span class=\"token operator\">></span> new_File</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> new_File</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2022</span>å¹´ 08æœˆ 01æ—¥ æ˜ŸæœŸä¸€ <span class=\"token number\">10</span>:42:33 CST</pre></td></tr></table></figure><p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ <code>echo</code>  é€šè¿‡ <code>&gt;</code>  ç¬¦å·ï¼Œå°†è¾“å‡ºé‡å®šå‘åˆ° <code>new_File</code>  è¿™ä¸ªæ–‡ä»¶é‡Œé¢äº†ã€‚å¹¶ä¸”<strong>å…ˆæ¸…ç©ºæ–‡ä»¶åŸæœ¬å†…å®¹</strong>ã€‚</p>\n<p><code>command &gt;&gt; outputfile</code>   æ˜¯è¿½åŠ æ¨¡å¼ã€‚</p>\n<h2 id=\"æ ‡å‡†è¾“å…¥é‡å®šå‘\"><a class=\"anchor\" href=\"#æ ‡å‡†è¾“å…¥é‡å®šå‘\">#</a> æ ‡å‡†è¾“å…¥é‡å®šå‘</h2>\n<p>å°†æ–‡ä»¶å†…å®¹é‡å®šå‘åˆ°å‘½ä»¤ï¼š <code>command &lt; inputfile</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># wc å‘½ä»¤å¯ä»¥å¯¹æ•°æ®æ–‡æœ¬è¿›è¡Œè®¡æ•°ï¼šæ–‡æœ¬è¡Œæ•°  æ–‡æœ¬å­—æ•°  æ–‡æœ¬å­—èŠ‚æ•°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">wc</span> <span class=\"token operator\">&lt;</span> new_File</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token number\">1</span>  <span class=\"token number\">6</span> <span class=\"token number\">43</span></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œ <code>&lt;</code>  æ˜¯æ”¹å˜æ ‡å‡†è¾“å‡ºï¼ˆå±å¹•ï¼‰ï¼Œ <code>&gt;</code>  æ˜¯æ”¹å˜æ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜ï¼‰ã€‚<strong>é‡å®šå‘ä¸æ˜¯ä»£æ›¿å‚æ•°ï¼Œè€Œæ˜¯æ”¹å˜æ ‡å‡†è¾“å…¥è¾“å‡º</strong>ã€‚</p>\n<p>æ¯”å¦‚ä»¥ä¸‹å‘½ä»¤å°±ä¸è¡Œ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token operator\">&lt;</span> new_File</pre></td></tr></table></figure><p><code>echo</code>  çš„ä½¿ç”¨æ ¼å¼æ˜¯ <code>echo å‚æ•°</code> ï¼Œé‡å®šå‘ä¸èƒ½æ›¿ä»£å‚æ•°ã€‚</p>\n<p><code>wc</code>  åé¢æ¥æ”¶çš„å¯ä»¥æ˜¯æ ‡å‡†è¾“å…¥</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">wc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>line1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>line2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token number\">2</span>       <span class=\"token number\">2</span>      <span class=\"token number\">12</span> <span class=\"token comment\"># ä½¿ç”¨ ctrl+d ç»“æŸå‘½ä»¤å¹¶ç»Ÿè®¡</span></pre></td></tr></table></figure><h2 id=\"å†…è”é‡å®šå‘\"><a class=\"anchor\" href=\"#å†…è”é‡å®šå‘\">#</a> å†…è”é‡å®šå‘</h2>\n<blockquote>\n<p>å¯ä»¥å‚è€ƒï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MTU2MTA0L2FydGljbGUvZGV0YWlscy8xMTAzNzU4ODk=\">https://blog.csdn.net/qq_38156104/article/details/110375889</span></p>\n</blockquote>\n<p>æ›¿æ¢æ–‡ä»¶ä¸ºæ–‡æœ¬ï¼Œæ•°æ®æµå‘å‘½ä»¤ï¼š <code>command &lt;&lt; ç‰¹æ®Šå­—ç¬¦</code></p>\n<p>æ•°æ®çš„å¼€å§‹å’Œç»“æŸæ–‡æœ¬æ ‡è®°è¦ä¸€è‡´ã€‚æœ¬è´¨å°±æ˜¯å°†å¼€å§‹ç¬¦å’Œç»“æŸç¬¦ä¹‹é—´çš„æ•°æ®ä¼ ç»™å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">wc</span> <span class=\"token operator\">&lt;&lt;</span>EOF</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token number\">123</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token number\">4142</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> EOF</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token number\">2</span> <span class=\"token number\">9</span></pre></td></tr></table></figure><h1 id=\"ç®¡é“\"><a class=\"anchor\" href=\"#ç®¡é“\">#</a> ç®¡é“</h1>\n<p>ä¸€ä¸ªå‘½ä»¤çš„<strong>æ ‡å‡†è¾“å‡º</strong>ä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å…¥</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rpm</span> <span class=\"token parameter variable\">-qa</span> <span class=\"token operator\">></span> rpm.list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sort</span> <span class=\"token operator\">&lt;</span> rpm.list</pre></td></tr></table></figure><p><code>rpm</code>  å‘½ä»¤é€šè¿‡ <code>RedHat</code>  åŒ…ç®¡ç†ç³»ç»Ÿ ( <code>RPM</code> ) å¯¹ç³»ç»Ÿä¸Šå®‰è£…çš„è½¯ä»¶åŒ…è¿›è¡Œç®¡ç†ã€‚é…åˆ <code>-qa</code>  é€‰é¡¹ä½¿ç”¨æ—¶ï¼Œä¼šç”Ÿæˆå·²å®‰è£…åŒ…çš„åˆ—è¡¨ï¼Œå°½ç®¡ä¸ä¼šæ’åºã€‚(è™½ç„¶æˆ‘åœ¨ç»ˆç«¯æ‰§è¡Œä¸Šé¢ä¸¤ä¸ªå‘½ä»¤æ²¡å•¥ååº”)</p>\n<p>é‡å®šå‘åœ¨å‘½ä»¤ä¹‹é—´æ•°æ®ä¼ è¾“æ¯”è¾ƒç¹çï¼Œä½¿ç”¨ç®¡é“  <code>|</code>  è§£å†³ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">command</span> <span class=\"token operator\">|</span> <span class=\"token builtin class-name\">command</span></pre></td></tr></table></figure><p>ä¸ºäº†æ›´å¥½äº†è§£ç®¡é“ï¼Œæˆ‘å†™äº†ä¸€ä¸ª <code>c</code>  ç¨‹åºï¼Œæ–‡ä»¶ä¸º <code>test.c</code> ã€‚</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fcntl.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> start<span class=\"token punctuation\">,</span>end<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">int</span> fd <span class=\"token operator\">=</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./tmp\"</span><span class=\"token punctuation\">,</span>O_RDONLY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">char</span> bf<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>start<span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span>bf<span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>end<span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token comment\">//printf(\"%s\",bf);</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>end<span class=\"token punctuation\">.</span>tv_usec <span class=\"token operator\">-</span> start<span class=\"token punctuation\">.</span>tv_usec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>linux</code>  ä¸­å¯ä»¥ç”¨ <code>cat</code>  æŸ¥çœ‹ï¼Œå¦‚æœåœ¨åé¢æ¥ä¸Š <code>sort</code>  å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> test.c <span class=\"token operator\">|</span> <span class=\"token function\">sort</span></pre></td></tr></table></figure><p>å…¶è¾“å‡ºç»“æœä¸º</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">char</span> bf<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>end<span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>start<span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fcntl.h></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">int</span> fd <span class=\"token operator\">=</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./tmp\"</span><span class=\"token punctuation\">,</span>O_RDONLY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>end<span class=\"token punctuation\">.</span>tv_usec <span class=\"token operator\">-</span> start<span class=\"token punctuation\">.</span>tv_usec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token comment\">//printf(\"%s\",bf);</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span>bf<span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> start<span class=\"token punctuation\">,</span>end<span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/31/Shell/Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/",
            "url": "https://cecilia.cool/2022/07/31/Shell/Linux%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/",
            "title": "Linuxæ–‡ä»¶æƒé™",
            "date_published": "2022-07-31T11:19:13.000Z",
            "content_html": "<h1 id=\"linuxå®‰å…¨æ€§\"><a class=\"anchor\" href=\"#linuxå®‰å…¨æ€§\">#</a> Linux å®‰å…¨æ€§</h1>\n<p><code>Linux</code>  å®‰å…¨ç³»ç»Ÿæ ¸å¿ƒæ˜¯ç”¨æˆ·è´¦æˆ·ï¼Œç”¨æˆ·è´¦æˆ·é€šè¿‡åˆ›å»ºç”¨æˆ·æ—¶åˆ†é…çš„ç”¨æˆ· <code>ID(UID)</code>  æ¥è·Ÿè¸ªã€‚ <code>/etc/password</code>  æ–‡ä»¶å°†ç”¨æˆ·çš„ç™»å½•ååŒ¹é…åˆ°å¯¹åº”çš„ <code>UID</code>  çš„å€¼<br />\n <code>root</code>  è´¦æˆ·æ˜¯ <code>Linux</code>  ç®¡ç†å‘˜ï¼Œå›ºå®šåˆ†é…ç»™çš„ <code>UID</code>  æ˜¯ 0ã€‚ <code>Linux</code>  ä¼šä¸ºå„ç§å„æ ·çš„åŠŸèƒ½åˆ›å»ºä¸åŒçš„ç”¨æˆ·è´¦æˆ·ï¼Œè¿™äº›è´¦æˆ·ä¸æ˜¯çœŸæ­£çš„ç”¨æˆ·ï¼Œè€Œæ˜¯ç³»ç»Ÿè´¦æˆ·ï¼Œæ˜¯ç³»ç»Ÿä¸Šè¿è¡Œå„ç§æœåŠ¡è¿›ç¨‹è®¿é—®èµ„æºç”¨çš„ç‰¹æ®Šè´¦æˆ·ã€‚æ‰€æœ‰è¿è¡Œåœ¨åå°çš„æœåŠ¡éƒ½éœ€è¦ç”¨ä¸€ä¸ªç³»ç»Ÿç”¨æˆ·è´¦æˆ·ç™»å½•åˆ° Linux ç³»ç»Ÿä¸Šï¼ï¼<strong>åœ¨æ„è¯†åˆ°å®‰å…¨é—®é¢˜ä¹‹å‰</strong>ï¼Œè®¸å¤šæœåŠ¡éƒ½ç”¨ <code>root</code>  ç™»é™†ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæœåŠ¡è¢«æ”»é™·ï¼Œ <code>root</code>  æƒé™å°±ä¼šè¢«å…¥ä¾µã€‚</p>\n<p><code>/etc/shadow</code>  æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è®°å½•å„ä¸ªè´¦æˆ·ä¹‹é—´å¯†ç è®°å½•ã€‚è¯¥æ–‡ä»¶åªæœ‰ <code>root</code>  æ‰æœ‰æƒé™æ“ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æ˜¯ <code>root</code>  ç”¨æˆ·ç™»å½•ï¼Œå°±éœ€è¦ä½¿ç”¨ <code>sudo</code>  å‘½ä»¤ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">sudo</span> <span class=\"token function\">cat</span> /etc/shadow</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>sudo<span class=\"token punctuation\">]</span> password <span class=\"token keyword\">for</span> cyan:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>root:<span class=\"token operator\">!</span>:18999:0:99999:7:::</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># å…¶ä»–ä¿¡æ¯å°±ä¸å±•ç¤ºäº†</span></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œåˆ†ä¸ºä¹ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NoZXJsb2NrbWovYXJ0aWNsZS9kZXRhaWxzLzEwNjc4NjUyMA==\"> å‚è€ƒæ–‡ç« ä¼ é€é—¨</span></p>\n<ul>\n<li>ä¸ <code>/etc/passwd</code>  æ–‡ä»¶ä¸­å¯¹åº”çš„ç™»å½•åã€‚</li>\n<li><strong>åŠ å¯†å</strong>çš„å¯†ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½ç›´æ¥çœ‹åˆ°è¿™ä¸ªå¯†ç ã€‚</li>\n<li>è‡ªä¸Šæ¬¡ä¿®æ”¹å¯†ç åè¿‡å»çš„å¤©æ•°ï¼Œä¸Šé¢çš„ <code>root</code>  æ˜¯ 18999ï¼Œå°±æ˜¯ä» 1970.1.1 ä¸æ–­ç´¯åŠ å¾—åˆ°çš„æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤  <code>date -d &quot;1970-01-01 18999 days&quot;</code>  æŸ¥çœ‹å…·ä½“æ—¶é—´ã€‚</li>\n<li>æœ€å°ä¿®æ”¹æ—¶é—´é—´éš”ï¼Œè¯¥å­—æ®µè§„å®šäº†ä»ç¬¬ 3 å­—æ®µï¼ˆæœ€åä¸€æ¬¡ä¿®æ”¹å¯†ç çš„æ—¥æœŸï¼‰èµ·ï¼Œ<strong>å¤šé•¿æ—¶é—´ä¹‹å†…ä¸èƒ½ä¿®æ”¹å¯†ç </strong>ã€‚å¦‚æœæ˜¯ 0ï¼Œåˆ™å¯†ç å¯ä»¥éšæ—¶ä¿®æ”¹ï¼›å¦‚æœæ˜¯ 10ï¼Œåˆ™ä»£è¡¨å¯†ç ä¿®æ”¹å 10 <strong>å¤©</strong>ä¹‹å†…ä¸èƒ½å†æ¬¡ä¿®æ”¹å¯†ç ã€‚</li>\n<li>å¯†ç æœ‰æ•ˆæœŸï¼Œé»˜è®¤å€¼ä¸º 99999ï¼Œä¹Ÿå°±æ˜¯ 273 å¹´ã€‚</li>\n<li>å¯†ç éœ€è¦å˜æ›´å‰çš„è­¦å‘Šå¤©æ•°ï¼Œå½“è´¦æˆ·å¯†ç æœ‰æ•ˆæœŸå¿«åˆ°æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºè­¦å‘Šä¿¡æ¯ç»™æ­¤è´¦æˆ·ï¼Œæé†’ç”¨æˆ· &quot;å†è¿‡ n å¤©ä½ çš„å¯†ç å°±è¦è¿‡æœŸäº†ï¼Œè¯·å°½å¿«é‡æ–°è®¾ç½®ä½ çš„å¯†ç ï¼&quot;ã€‚</li>\n<li>å¯†ç è¿‡æœŸåçš„å®½é™å¤©æ•°ï¼Œè¿‡æœŸåï¼Œåœ¨å®½é™å¤©æ•°å†…è¿˜æ˜¯å¯ä»¥ç™»å½•ã€‚</li>\n<li>è´¦å·å¤±æ•ˆæ—¶é—´ï¼Œè¯¥å­—æ®µé€šå¸¸è¢«ä½¿ç”¨åœ¨å…·æœ‰æ”¶è´¹æœåŠ¡çš„ç³»ç»Ÿä¸­ã€‚</li>\n<li>æœ€åä¸€ä¸ªï¼Œä¿ç•™ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨ã€‚</li>\n</ul>\n<h1 id=\"æ·»åŠ æ–°ç”¨æˆ·\"><a class=\"anchor\" href=\"#æ·»åŠ æ–°ç”¨æˆ·\">#</a> æ·»åŠ æ–°ç”¨æˆ·</h1>\n<p>ä½¿ç”¨ <code>useradd</code>  å‘½ä»¤ï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·åŠè®¾ç½®ç”¨æˆ· <code>HOME</code>  ç›®å½•ç»“æ„ã€‚ <code>useradd</code>  å‘½ä»¤ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼ä»¥åŠå‘½ä»¤è¡Œå‚æ•°è®¾ç½®ç”¨æˆ·è´¦æˆ·ã€‚</p>\n<p>ç³»ç»Ÿé»˜è®¤å€¼è¢«è®¾ç½®åœ¨ <code>/etc/default/useradd</code> ï¼Œå¯ä»¥ä½¿ç”¨ <code>useradd -D</code>  æ£€æŸ¥é»˜è®¤å€¼</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token function\">useradd</span> <span class=\"token parameter variable\">-D</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">GROUP</span><span class=\"token operator\">=</span><span class=\"token number\">100</span>\t\t<span class=\"token comment\"># æ–°ç”¨æˆ·è¢«æ·»åŠ åˆ° GID=100 çš„å…¬å…±ç»„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/home\t\t<span class=\"token comment\"># æ–°çš„ home ç›®å½•ä½äº /home/loginname</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">INACTIVE</span><span class=\"token operator\">=</span>-1\t\t<span class=\"token comment\"># å¯†ç è¿‡æœŸåä¸ä¼šè¢«ç¦ç”¨</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">EXPIRE</span><span class=\"token operator\">=</span>\t\t\t<span class=\"token comment\"># æœªè®¾ç½®è¿‡æœŸæ—¥æœŸ</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\"><span class=\"token environment constant\">SHELL</span></span><span class=\"token operator\">=</span>/bin/sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">SKEL</span><span class=\"token operator\">=</span>/etc/skel\t<span class=\"token comment\"># å°† /etc/skel ç›®å½•ä¸‹å†…å®¹å¤åˆ¶åˆ°ç”¨æˆ·çš„ home ä¸‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">CREATE_MAIL_SPOOL</span><span class=\"token operator\">=</span>no\t<span class=\"token comment\"># æ˜¯å¦ä¸ºè¯¥ç”¨æˆ·åœ¨ mail ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ¥å—é‚®ä»¶çš„æ–‡ä»¶</span></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ç³»ç»Ÿé»˜è®¤å€¼æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œåœ¨ <code>useradd</code>  æ—¶ï¼ŒåŠ å…¥å‚æ•°è¿›è¡Œæ›´æ”¹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token parameter variable\">-b</span>  default_home    <span class=\"token comment\"># æ›´æ”¹é»˜è®¤çš„åˆ›å»ºç”¨æˆ· HOME ç›®å½•çš„ä½ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-e</span>  expirtion_date  <span class=\"token comment\"># æ›´æ”¹é»˜è®¤çš„æ–°è´¦æˆ·çš„è¿‡æœŸæ—¥æœŸ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-f</span>  inactive        <span class=\"token comment\"># æ›´æ”¹é»˜è®¤çš„æ–°ç”¨æˆ·ä»å¯†ç è¿‡æœŸåˆ°è´¦æˆ·è¢«ç¦ç”¨çš„å¤©æ•°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-g</span>  group           <span class=\"token comment\"># æ›´æ”¹é»˜è®¤çš„ç»„åç§°æˆ– GID</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token parameter variable\">-s</span>  shell           <span class=\"token comment\"># æ›´æ”¹é»˜è®¤ç™»å½• shell</span></pre></td></tr></table></figure><h1 id=\"åˆ é™¤ç”¨æˆ·\"><a class=\"anchor\" href=\"#åˆ é™¤ç”¨æˆ·\">#</a> åˆ é™¤ç”¨æˆ·</h1>\n<p><code>userdel</code>  å‘½ä»¤ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šåˆ é™¤ <code>/etc/passwd</code>  æ–‡ä»¶ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸ä¼šåˆ é™¤ç³»ç»Ÿä¸­å±äºè¯¥è´¦æˆ·çš„ä»»ä½•æ–‡ä»¶ï¼Œ <code>userdel -r</code>  ä¼šåˆ é™¤ç”¨æˆ·çš„ HOME ç›®å½•ä»¥åŠé‚®ä»¶ç›®å½•ã€‚</p>\n<h1 id=\"ä¿®æ”¹ç”¨æˆ·\"><a class=\"anchor\" href=\"#ä¿®æ”¹ç”¨æˆ·\">#</a> ä¿®æ”¹ç”¨æˆ·</h1>\n<p><code>usermod,chsh,chfn,chage</code>  è¿™å‡ ä¸ªæŒ‡ä»¤è¦ç”¨åˆ°å†è‡ªå·±ç™¾åº¦ï¼Œå¹³æ—¶ç”¨ä¸åˆ°ï¼Œéš”ä¸äº†å¤šä¹…å°±ä¼šå¿˜è®°ã€‚</p>\n<h1 id=\"linuxç»„\"><a class=\"anchor\" href=\"#linuxç»„\">#</a> Linux ç»„</h1>\n<p>linux é€šè¿‡å°†å…·æœ‰ç›¸åŒç‰¹æ€§çš„ç”¨æˆ·åˆ’å½’ä¸ºä¸€ä¸ªç»„ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–ç”¨æˆ·çš„ç®¡ç†ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¹‹é—´æ–‡ä»¶çš„å…±äº«ã€‚ä»»ä½•ä¸€ä¸ªç”¨æˆ·éƒ½è‡³å°‘å±äºä¸€ä¸ªç»„ï¼Œè¿™ä¸ªç»„ç§°ä¸ºåˆå§‹ç»„ï¼Œå¯ä»¥åŒæ—¶å±äºå¤šä¸ªé™„åŠ ç»„ã€‚ç”¨æˆ·ä¸ä»…æ‹¥æœ‰åˆå§‹ç»„çš„æƒé™ï¼Œè¿˜æ‹¥æœ‰é™„åŠ ç»„çš„æƒé™ã€‚</p>\n<p>åœ¨ <code>/etc/group</code>  æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ç³»ç»Ÿä¸Šç”¨åˆ°çš„æ¯ä¸ªç»„çš„ä¿¡æ¯ï¼Œ4 ä¸ªå­—æ®µï¼š<strong>ç»„åï¼šç»„å¯†ç ï¼šGID: å±äºè¯¥ç»„çš„ç”¨æˆ·åˆ—è¡¨</strong></p>\n<p>ç”¨æˆ·åˆ—è¡¨ä¸­æŸäº›ç»„æ²¡æœ‰åˆ—å‡ºç”¨æˆ·ï¼Œå¹¶ä¸ä»£è¡¨æ²¡æœ‰æˆå‘˜ï¼Œåªæ˜¯åŠ å…¥äº†æˆå‘˜ï¼Œä¸ä¼šå‡ºç°åœ¨è¯¥æ–‡ä»¶ä¸­ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># åˆ›å»ºç»„</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">groupadd</span> ç»„å</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># åæœŸå°†æˆå‘˜åŠ å…¥åˆ°æŒ‡å®šç»„</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-G</span> ç»„å æˆå‘˜å</pre></td></tr></table></figure><h1 id=\"æ–‡ä»¶æƒé™\"><a class=\"anchor\" href=\"#æ–‡ä»¶æƒé™\">#</a> æ–‡ä»¶æƒé™</h1>\n<p>åœ¨æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸ºäº†è¿è¡Œä¸€ä¸ªæ–°å»ºè„šæœ¬ï¼Œéœ€è¦ä½¿ç”¨ <code>chmod u+x æ–‡ä»¶å</code> ã€‚æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ll</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">16</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>drwxr-xr-x  <span class=\"token number\">2</span> cyan cyan <span class=\"token number\">4096</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">30</span> <span class=\"token number\">19</span>:09 ./</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>drwxr-xr-x <span class=\"token number\">21</span> cyan cyan <span class=\"token number\">4096</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">30</span> <span class=\"token number\">19</span>:09 <span class=\"token punctuation\">..</span>/</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-rw-rw-r--  <span class=\"token number\">1</span> cyan cyan    <span class=\"token number\">0</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">28</span> <span class=\"token number\">15</span>:50 new_File</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rwxrw-r--  <span class=\"token number\">1</span> cyan cyan   <span class=\"token number\">49</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">30</span> <span class=\"token number\">19</span>:09 test*</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-rwxrw-r--  <span class=\"token number\">1</span> cyan cyan   <span class=\"token number\">31</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">29</span> <span class=\"token number\">16</span>:18 test_1.sh*</pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœä¸­ï¼Œç¬¬ä¸€ä½æœ‰äº›æ˜¯ <code>d</code> ï¼Œæœ‰äº›æ˜¯ <code>-</code> ã€‚ç¬¬ä¸€ä¸ªä»£è¡¨äº†æ–‡ä»¶ (-)/ ç›®å½• (d)/ é“¾æ¥ (l)/ å­—ç¬¦å‹è®¾å¤‡ (c)/ å—è®¾å¤‡ (b)/ ç½‘ç»œè®¾å¤‡ (n)ã€‚</p>\n<p>åé¢ä¸€å…±æ˜¯ 9 ä½ï¼Œæ¯ 3 ä½ä¸ºä¸€ä¸ªéƒ¨åˆ†ï¼ˆåˆ†åˆ«è¡¨ç¤º rwxï¼‰ï¼Œè¿™<strong>ä¸‰ä¸ªéƒ¨åˆ†</strong>ä¾æ¬¡å±äº<strong>æ–‡ä»¶å±ä¸»ï¼ˆåˆ›å»ºæ–‡ä»¶çš„ç”¨æˆ·ï¼‰</strong>ï¼Œ<strong>å±ç»„æˆå‘˜</strong>ï¼Œ<strong>å…¶ä»–ç”¨æˆ·</strong>æƒé™ã€‚</p>\n<p>ç›®å½•æˆ–è€…æ–‡ä»¶ä¸€å¼€å§‹åˆ›å»ºæ—¶ï¼Œä¼šæˆäºˆé»˜è®¤æƒé™ï¼Œé»˜è®¤æƒé™ä¸ <code>umask</code>  å€¼æœ‰å…³ã€‚ä¸‰ä¸ªç”¨æˆ·æƒé™ï¼ˆ<strong>ä¸‰ä¸ªéƒ¨åˆ†</strong>ï¼‰å„è‡ªå ç”¨ä¸€ä¸ªå…«è¿›åˆ¶ä½ï¼ˆ0-7ï¼‰ï¼Œä¸€ä¸ªéƒ¨åˆ†çš„æƒé™ä» <code>'---'</code>  åˆ° <code>'rwx'</code>  åœ¨å…«è¿›åˆ¶ä½ä¸­è¡¨ç¤ºä¸º <code>0-7</code> ï¼Œå¦‚ <code>rw-</code>  å°±æ˜¯ 6ã€‚ä¸‰ä¸ªéƒ¨åˆ†åˆåœ¨ä¸€ä¸ªï¼Œå°±æ˜¯ <code>000-777</code> ï¼Œä¹Ÿå°±æ˜¯ <code>---------åˆ°rwxrwxrwx</code> ã€‚</p>\n<p><code>umask</code>  å‘½ä»¤ç”¨äº<strong>è®¾ç½®</strong>åˆ›å»ºæ–‡ä»¶æˆ–æ˜¯ç›®å½•çš„<strong>é»˜è®¤æƒé™</strong>ï¼Œæˆ‘ä»¬å…ˆåœ¨ç»ˆç«¯è¾“å…¥ <code>umask</code>  å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">umask</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>0002</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä½ çš„ç»ˆç«¯å¯èƒ½ä¼šè¾“å‡º 0022ï¼Œæˆ‘å¥½åƒæ˜¯åœ¨ç¯å¢ƒæ–‡ä»¶åšè¿‡æŒä¹…åŒ–æ›´æ”¹ï¼ˆæœ‰ç‚¹è®°ä¸æ¸…äº†ï¼‰</span></pre></td></tr></table></figure><p>ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªå…³äºç‰¹æ®Šæƒé™çš„ä½ï¼Œå¯ä»¥æš‚æ—¶ä¸ç®¡ã€‚åé¢ä¸‰ä¸ªä¸é»˜è®¤æƒé™æœ‰å…³ã€‚</p>\n<p>å¯¹äºæ–‡ä»¶è€Œè¨€ï¼Œé»˜è®¤çš„æœ€å¤§æƒé™å°±æ˜¯ <code>666</code> ï¼Œä¹Ÿå°±æ˜¯ <code>rw-rw-rw-</code> ï¼Œç›®å½•çš„é»˜è®¤æœ€å¤§æƒé™æ˜¯ <code>777</code> ã€‚å¦‚æœä½ å­¦è¿‡è®¡ç®—æœºç½‘ç»œï¼Œä½ ä¼šçŸ¥é“<strong>æ©ç </strong>è¿™ä¸ªä¸œè¥¿ã€‚è¿™é‡Œå°±æ˜¯ï¼Œæœ€å¤§é»˜è®¤æƒé™<strong>å‡å»</strong>æ©ç å°±ä¼šå¾—åˆ°æ–‡ä»¶ï¼ˆç›®å½•ï¼‰åˆ›å»ºæ—¶èµ‹äºˆçš„æƒé™ã€‚</p>\n<p>æ¯”å¦‚æˆ‘çš„æ©ç  <code>umask=0002</code> ï¼Œé‚£ä¹ˆåˆ›å»ºæ–‡ä»¶æ—¶ï¼Œ <code>666-002=664</code> ï¼Œå¾—åˆ°çš„æƒé™å°±æ˜¯ <code>rw-rw-r--</code></p>\n<p>éªŒè¯ä¸€ä¸‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">touch</span> tmp.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ll tmp.txt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rw-rw-r-- <span class=\"token number\">1</span> cyan cyan <span class=\"token number\">0</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">31</span> <span class=\"token number\">21</span>:30 tmp.txt</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">umask</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>0002</pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ç¯‡<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS91XzE1MTI3NjczLzI4MDM1MTc=\">æ–‡ç« </span>å‚è€ƒã€‚</p>\n<h1 id=\"æ›´æ”¹æƒé™\"><a class=\"anchor\" href=\"#æ›´æ”¹æƒé™\">#</a> æ›´æ”¹æƒé™</h1>\n<p>é€šè¿‡ <code>chmod</code>  å‘½ä»¤ï¼Œå¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># chmod 3 ä½å…«è¿›åˆ¶æƒé™ç  æ–‡ä»¶å</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">chmod</span> <span class=\"token number\">777</span> tmp.txt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ll tmp.txt</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter variable\">-rwxrwxrwx</span> <span class=\"token number\">1</span> cyan cyan <span class=\"token number\">0</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">31</span> <span class=\"token number\">21</span>:30 tmp.txt*</pre></td></tr></table></figure><p>å¦‚æœä½ åªæ˜¯æƒ³æ”¹å˜æŸä¸€éƒ¨åˆ†ï¼ˆå±ä¸»ï¼Œç»„å†…ç”¨æˆ·ï¼Œå…¶ä»–ç”¨æˆ·ï¼‰çš„æƒé™ï¼Œå¯ä»¥ä½¿ç”¨</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> u+x æ–‡ä»¶å <span class=\"token comment\"># å±ä¸»å¢åŠ æ‰§è¡Œæƒé™</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">chmod</span> g-rx æ–‡ä»¶å <span class=\"token comment\"># ç»„å†…ç”¨æˆ·å‡å°‘</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">chmod</span> <span class=\"token assign-left variable\">o</span><span class=\"token operator\">=</span>rwx æ–‡ä»¶å <span class=\"token comment\"># å…¶ä»–ç”¨æˆ·çš„æƒé™ä¸º rwx</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># ä¸¾ä¾‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">chmod</span> g-rx tmp.txt</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ll tmp.txt</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-rwx-w-rwx <span class=\"token number\">1</span> cyan cyan <span class=\"token number\">0</span> <span class=\"token number\">7</span>æœˆ  <span class=\"token number\">31</span> <span class=\"token number\">21</span>:30 tmp.txt*</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># è¯´æ˜</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># u: è¡¨ç¤ºç”¨æˆ· (å±ä¸»)  g: è¡¨ç¤ºç»„  o: è¡¨ç¤ºå…¶ä»–  a: è¡¨ç¤ºæ‰€æœ‰</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># +: å¢åŠ   -: å‡å°‘  =: èµ‹å€¼</span></pre></td></tr></table></figure>",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/31/Database/MySQL/B-%E6%A0%91%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "url": "https://cecilia.cool/2022/07/31/Database/MySQL/B-%E6%A0%91%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "title": "B+æ ‘ç´¢å¼•çš„ä½¿ç”¨",
            "date_published": "2022-07-31T03:57:38.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æœ¬æ–‡ä¸»è¦è®²è§£ç´¢å¼•çš„å…·ä½“å·¥ä½œåŸç†ä»¥åŠä»£ä»·ï¼Œå¦‚ä½•æ­£ç¡®çš„å»ºç«‹ç´¢å¼•æ‰èƒ½ä½¿æŸ¥è¯¢å˜å¿«ã€‚åœ¨é˜…è¯»æœ¬æ–‡å‰ï¼Œè¯·ä¸€å®šä¿è¯å¯¹ä¹‹å‰æ›´æ–°çš„å†…å®¹ï¼ˆB + æ ‘ç´¢å¼•ï¼‰ç†è§£æ˜ç™½ã€‚</p>\n<p>ç°åœ¨æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œä¹‹åæ–¹ä¾¿ä¸¾ä¾‹</p>\n<pre><code class=\"language-mysql\">create table single_table (\n    id int not null auto_increment\n    key1 varchar(100),\n    key2 int\n    key3 varchar(100),\n    key_part1 varchar(100),\n    key_part2 varchar(100),\n    key_part3 varchar(100),\n    common_field varchar(100),\n    primary key(id),\n    key idx_key1(key1),\n    unique key uk_key2(key2),\n    key idx_key3(key3),\n    key idx_key_part(key_part1,key_part2,key_part3)\n) engine=InnoDB character set=utf8; \n</code></pre>\n<h1 id=\"ç®€åŒ–bæ ‘ç¤ºæ„å›¾\"><a class=\"anchor\" href=\"#ç®€åŒ–bæ ‘ç¤ºæ„å›¾\">#</a> ç®€åŒ– B + æ ‘ç¤ºæ„å›¾</h1>\n<p>æˆ‘ä»¬çŸ¥é“ï¼ŒB + æ ‘çš„éå¶å­èŠ‚ç‚¹æ˜¯ç›®å½•é¡¹ï¼Œå®ƒæ˜¯ä¸ºäº†å®šä½ä¸‹ä¸€å±‚èŠ‚ç‚¹ï¼Œç›´åˆ°åœ¨å¶å­èŠ‚ç‚¹æ‰¾åˆ°å¯¹åº”çš„è®°å½•ã€‚å…¶æŸ¥è¯¢ç®—æ³•çš„æœ¬è´¨è¿˜æ˜¯åœ¨æ¯ä¸ªé¡µä¸­ä½¿ç”¨<strong>äºŒåˆ†æŸ¥æ‰¾</strong>æ‰¾åˆ°ä¸‹ä¸€å±‚å¯¹åº”çš„é¡µã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸å¦‚å°† B + æ ‘ç›´æ¥ç®€åŒ–ï¼Œåªå‰©ä¸‹å¶å­èŠ‚ç‚¹ã€‚</p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/30/Shell/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3shell/",
            "url": "https://cecilia.cool/2022/07/30/Shell/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3shell/",
            "title": "æ·±å…¥ç†è§£shell",
            "date_published": "2022-07-30T10:36:32.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>ä»¥ä¸‹æ˜¯ç»´åŸºç™¾ç§‘å¯¹ <code>shell</code>  çš„å®šä¹‰</p>\n<blockquote>\n<p>æ™®é€šæ„ä¹‰ä¸Šçš„ shell å°±æ˜¯å¯ä»¥æ¥å—ç”¨æˆ·è¾“å…¥å‘½ä»¤çš„ç¨‹åºï¼ŒUnix æ“ä½œç³»ç»Ÿä¸‹çš„ shell æ—¢æ˜¯ç”¨æˆ·äº¤äº’çš„ç•Œé¢ï¼Œä¹Ÿæ˜¯æ§åˆ¶ç³»ç»Ÿçš„è„šæœ¬è¯­è¨€ã€‚</p>\n</blockquote>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£ï¼Œå½“ä½ æ‰“å¼€ç»ˆç«¯æ—¶ï¼Œå…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª <code>shell</code> ï¼Œ <code>shell</code>  æœ‰å¾ˆå¤šç§ï¼Œå¦‚ <code>bash,zsh,csh</code>  ç­‰ã€‚</p>\n<p>åœ¨ <code>/etc/passwd</code>  ä¸­åˆ—å‡ºäº†å½“å‰ç”¨æˆ·é»˜è®¤çš„ <code>shell</code> ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:/etc$ <span class=\"token function\">cat</span> <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>root:x:0:0:root:/root:/bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cyan:x:1000:1000:cyan,,,:/home/cyan:/bin/bash</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>mysql:x:127:133:MySQL Server,,,:/nonexistent:/bin/false</pre></td></tr></table></figure><p>æˆ‘ä»¬åªçœ‹éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯ <code>bash shell</code> ã€‚</p>\n<h1 id=\"çˆ¶å­shell\"><a class=\"anchor\" href=\"#çˆ¶å­shell\">#</a> çˆ¶å­ shell</h1>\n<p>ç³»ç»Ÿä¸€å¼€å§‹å¯åŠ¨çš„ <code>shell</code>  æ˜¯çˆ¶ <code>shell</code> ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯åŠ¨å…¶ä»– <code>shell</code>  æˆ–æ˜¯ä½¿ç”¨å‘½ä»¤ <code>/bin/bash</code> ï¼Œè¢«ç§°ä¸ºå­ <code>shell</code> ã€‚å½“å‰è¿›ç¨‹ä¸‹çš„ <code>shell</code> ï¼Œåœ¨ç”Ÿæˆå­ <code>shell</code>  è¿›ç¨‹æ—¶ï¼Œçˆ¶è¿›ç¨‹çš„éƒ¨åˆ†ç¯å¢ƒè¢«å¤åˆ¶åˆ°å­ <code>shell</code>  ä¸­ã€‚</p>\n<p>ç»“åˆ <code>ps -f / ps --forest</code>  å‘½ä»¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å½“å‰ <code>shell</code>  çš„å…³ç³»</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é¦–å…ˆè¿›å…¥ç»ˆç«¯ï¼Œç„¶åä½¿ç”¨ bash å¼€å¯ä¸€ä¸ªæ–°çš„ shell</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:/$ <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># ä½¿ç”¨ ps -f æŸ¥çœ‹å½“å‰ shellï¼Œåœ¨ 18:42 æ‰“å¼€ç»ˆç«¯ï¼ˆçˆ¶ shellï¼ŒPID=67792ï¼‰ï¼Œåœ¨ 18:49 è°ƒç”¨ bashï¼Œè¿›å…¥å­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># shell(PID=69555,PPID=67792,PPID--Parent PID)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:/$ <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-f</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token environment constant\">UID</span>          PID    <span class=\"token environment constant\">PPID</span>  C STIME TTY          TIME CMD</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan       <span class=\"token number\">67792</span>   <span class=\"token number\">67791</span>  <span class=\"token number\">0</span> <span class=\"token number\">18</span>:42 pts/1    00:00:00 <span class=\"token parameter variable\">-bash</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cyan       <span class=\"token number\">69555</span>   <span class=\"token number\">67792</span>  <span class=\"token number\">0</span> <span class=\"token number\">18</span>:49 pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cyan       <span class=\"token number\">69562</span>   <span class=\"token number\">69555</span>  <span class=\"token number\">0</span> <span class=\"token number\">18</span>:49 pts/1    00:00:00 <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-f</span></pre></td></tr></table></figure><p>è¿™ä¹ˆçœ‹ä¸æ˜¯å¾ˆå½¢è±¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>--forest</code>  é€‰é¡¹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:/$ <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--forest</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">69555</span> pts/1    00:00:00  <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">69564</span> pts/1    00:00:00      <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">ps</span></pre></td></tr></table></figure><p>è¿™é‡Œå¾ˆæ˜æ˜¾ <code>PID=69555</code>  çš„ <code>bash</code>  æ˜¯ <code>PID=67792</code>  çš„ <code>bash</code>  çš„å­ <code>shell</code> ã€‚å¯æ˜¯æ›´ä¸‹é¢ä¸ºä»€ä¹ˆè¿˜æœ‰ä¸ª <code>ps</code> ï¼Œè¿™æ˜¯åè¯ã€‚</p>\n<h1 id=\"è¿›ç¨‹åˆ—è¡¨\"><a class=\"anchor\" href=\"#è¿›ç¨‹åˆ—è¡¨\">#</a> è¿›ç¨‹åˆ—è¡¨</h1>\n<p>å¦‚æœä½ æƒ³ä¸€æ¬¡æ€§æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œè€Œä¸æ˜¯æ‰§è¡Œä¸€ä¸ªè¾“å…¥ä¸€ä¸ªï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤ä¹‹é—´ä½¿ç”¨åˆ†å·</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:/$ <span class=\"token builtin class-name\">pwd</span><span class=\"token punctuation\">;</span><span class=\"token function\">ls</span><span class=\"token punctuation\">;</span><span class=\"token builtin class-name\">cd</span> /etc<span class=\"token punctuation\">;</span><span class=\"token builtin class-name\">pwd</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/ <span class=\"token comment\">#ç¬¬ä¸€ä¸ª pwd æŒ‡ä»¤ç»“æœ</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bin   cdrom  etc   lib    lib64   lost+found  mnt  proc  run   snap  swapfile  tmp  var</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>boot  dev    home  lib32  libx32  media       opt  root  sbin  srv   sys       usr</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/etc <span class=\"token comment\"># ç¬¬äºŒä¸ª pwd æŒ‡ä»¤ç»“æœ</span></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨<strong>è¿›ç¨‹åˆ—è¡¨</strong>ï¼Œéœ€è¦å°†è¿™äº›å‘½ä»¤åŠ å…¥æ‹¬å·ä¸­ï¼Œ <code>(pwd;ls;cd /etc;pwd;ps -f)</code> ã€‚è¿™æ ·ä¼š<strong>åˆ›å»ºä¸€ä¸ªå­ shell æ¥æ‰§è¡Œå¯¹åº”å‘½ä»¤</strong>ï¼Œå…¶å®è¿›ç¨‹åˆ—è¡¨æ˜¯ä¸€ç§å‘½ä»¤åˆ†ç»„ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ls</span><span class=\"token punctuation\">;</span><span class=\"token function\">ps</span> --forest<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>new_File  <span class=\"token builtin class-name\">test</span>  test_1.sh</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">69654</span> pts/1    00:00:00  <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token punctuation\">(</span>ls<span class=\"token punctuation\">;</span><span class=\"token function\">ps</span> --forest<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>new_File  <span class=\"token builtin class-name\">test</span>  test_1.sh</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token number\">69641</span> pts/1    00:00:00  <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token number\">69643</span> pts/1    00:00:00      <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">ps</span></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œ <code>ï¼ˆls;ps --forest)</code>  æ˜¯åœ¨å­ <code>shell</code>  ä¸­è¿è¡Œçš„ã€‚</p>\n<p>å…¶å®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ç¯å¢ƒå˜é‡ <code>BASH_SUBSHELL</code>  æŸ¥çœ‹å­ shell æ˜¯å¦åˆ›å»ºï¼Œè¯¥ç¯å¢ƒå˜é‡è¿”å›å­ shell çš„ä¸ªæ•°ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token punctuation\">(</span>echo <span class=\"token variable\">$BASH_SUBSHELL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr></table></figure><p>å¦ä¸€ç§è¿›ç¨‹åˆ†ç»„ï¼š <code>&#123; pwd;ls;cd ~; &#125;</code>  èŠ±æ‹¬å· + æœ«å°¾åˆ†å·ï¼Œä½†æ˜¯<strong>ä¸ä¼šåˆ›å»ºå­ shell</strong>, éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>èŠ±æ‹¬å·ä¸å‘½ä»¤å’Œåˆ†å·ä¹‹é—´å­˜åœ¨ç©ºæ ¼</strong>ã€‚</p>\n<blockquote>\n<p>é€€å‡ºä¸€ä¸ª <code>shell</code>  éœ€è¦ä½¿ç”¨ <code>exit</code> ï¼Œè¦æ˜¯ä½¿ç”¨ <code>exit</code>  æ—¶å‡ºç°ï¼š <code>logout There are stopped jobs.</code> ï¼Œè¯´æ˜è¿™ä¸ªå­ <code>shell</code>  ä¸­è¿˜å­˜åœ¨ <code>stopped</code>  çš„è¿›ç¨‹ï¼Œå¯ä»¥é€šè¿‡ <code>kill -9 pid</code>  å¼ºåˆ¶æ€æ­»è¿›ç¨‹ã€‚</p>\n</blockquote>\n<p>ä¸ºäº†ä½¿è¯»è€…å¯¹è¿™ä¸ªé—®é¢˜æœ‰æ›´å¥½çš„è®¤è¯†ï¼Œç°åœ¨ç¼–å†™ä»¥ä¸‹è„šæœ¬</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#è„šæœ¬æ–‡ä»¶å test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­»å¾ªç¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥å­ <code>shell</code>  æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä½ ä¼šçœ‹åˆ°è„šæœ¬åœ¨ä¸æ–­å¾ªç¯è€Œä¸ä¼šç»“æŸï¼Œæ­¤æ—¶ä½¿ç”¨ <code>ctrl+z</code>  æŒ‚èµ·è¿™ä¸ªçº¿ç¨‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ ./test</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>^Z</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Stopped                 ./test</pre></td></tr></table></figure><p>ç°åœ¨ä½ å°±é€€ä¸å‡ºå­ <code>shell</code>  äº†ï¼Œè¯•è¯• <code>exit</code>  è¯­å¥</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>There are stopped jobs.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token number\">69675</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token number\">69681</span> pts/1    00:00:01 <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token number\">69683</span> pts/1    00:00:00 <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>There are stopped jobs.</pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œ <code>exit</code>  æ²¡æœ‰è®©ä½ é€€å‡ºå­ <code>shell</code> ï¼Œæˆ‘ä»¬çœ‹åˆ° <code>test</code>  è¿›ç¨‹çš„ <code>PID</code>  ä¸º 69681</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> <span class=\"token number\">69681</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">69675</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token number\">69689</span> pts/1    00:00:00 <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Killed                  ./test</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>å“¦ï½æœ‰æ²¡æœ‰è§‰å¾—è‡ªå·±ä¸€ä¸‹å­å­¦äº†å¾ˆå¤šä¸œè¥¿ã€‚</p>\n<h1 id=\"åå°æ¨¡å¼\"><a class=\"anchor\" href=\"#åå°æ¨¡å¼\">#</a> åå°æ¨¡å¼</h1>\n<p>åœ¨å‘½ä»¤åä½¿ç”¨ <code>&amp;</code> , å°†å…¶ç½®å…¥åå°æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ <code>ps / jobs</code>  æ¥æ˜¾ç¤ºåå°ä½œä¸šä¿¡æ¯ã€‚ <code>jobs</code>  å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå‡ºå½“å‰è¿è¡Œåœ¨åå°æ¨¡å¼ä¸­çš„æ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">sleep</span> <span class=\"token number\">1000</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">69698</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">jobs</span> <span class=\"token parameter variable\">-l</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+ <span class=\"token number\">69698</span> Running                 <span class=\"token function\">sleep</span> <span class=\"token number\">1000</span> <span class=\"token operator\">&amp;</span></pre></td></tr></table></figure><p>1 æ˜¯ä½œä¸šå·ï¼Œ <code>shell</code>  ä¸­è¿è¡Œçš„æ¯ä¸ªè¿›ç¨‹è¢«ç§°ä¸ºä½œä¸šã€‚åæ˜¾ç¤ºä½œä¸šçŠ¶æ€ä»¥åŠå‘½ä»¤ï¼Œ-l æ˜¾ç¤ºå‘½ä»¤ PIDã€‚ä½¿ç”¨ &amp; å°†å‘½ä»¤ç½®å…¥åå°ä¸ä¼šåˆ›å»ºå­ <code>shell</code> ã€‚</p>\n<p>ä½ åº”è¯¥çŸ¥é“ä¸ºä»€ä¹ˆè¦å°†å‘½ä»¤æ‰§è¡Œç½®å…¥åå°ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªä¸€ç›´åœ¨å¾ªç¯çš„è„šæœ¬ï¼Œå¦‚æœè¿™ä¸ªè„šæœ¬ä¸æ‰§è¡Œå®Œï¼Œé‚£ä½ å°±ä¸èƒ½è¾“å…¥å…¶ä»–å‘½ä»¤ã€‚</p>\n<h2 id=\"åç¨‹\"><a class=\"anchor\" href=\"#åç¨‹\">#</a> åç¨‹</h2>\n<p>ä¼šåå°ç”Ÿæˆå­ <code>shell</code> ï¼Œå­ <code>shell</code>  æ‰§è¡ŒæŒ‡ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ coproc <span class=\"token function\">sleep</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">69704</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--forest</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    PID TTY          TIME CMD</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token number\">67792</span> pts/1    00:00:00 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token number\">69706</span> pts/1    00:00:00  <span class=\"token punctuation\">\\</span>_ <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Done                    coproc COPROC <span class=\"token function\">sleep</span> <span class=\"token number\">10</span></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥å’Œè¿›ç¨‹åˆ—è¡¨ä¸€èµ·ä½¿ç”¨ï¼Œè¿˜å¯ä»¥å‘½å</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>coproc My_Job <span class=\"token punctuation\">(</span>ls<span class=\"token punctuation\">;</span><span class=\"token function\">sleep</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>My_Job æ˜¯è¿›ç¨‹çš„åå­—ï¼Œé»˜è®¤æ˜¯ COPROCã€‚åç¨‹ coproc ä¸è¿›ç¨‹åˆ—è¡¨ä¸€èµ·ä½¿ç”¨ï¼Œä¼šäº§ç”ŸåµŒå¥—å­ shellã€‚<strong>éœ€è¦ç‰¢è®°çš„æ˜¯ï¼Œç”Ÿæˆå­ shell çš„æˆæœ¬ä¸ä½</strong>ã€‚</p>\n<h1 id=\"å†…å»ºå‘½ä»¤\"><a class=\"anchor\" href=\"#å†…å»ºå‘½ä»¤\">#</a> å†…å»ºå‘½ä»¤</h1>\n<p>ç°åœ¨ä¸æƒ³æ›´è¿™ä¸ªï¼Œé¸½ä¸€ä¸‹</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/29/Shell/Linux%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/",
            "url": "https://cecilia.cool/2022/07/29/Shell/Linux%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/",
            "title": "Linuxç¯å¢ƒå˜é‡",
            "date_published": "2022-07-29T07:21:39.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>åœ¨äº†è§£ <code>Linux</code>  çš„ç¯å¢ƒå˜é‡å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å˜é‡ã€‚</p>\n<p>åœ¨è„šæœ¬ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç </p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">echo</span> val</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\" testing... \"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#ä¼šå¾ªç¯æ‰“å°ï¼š</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#val</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#testing...</span></pre></td></tr></table></figure><p>åœ¨è„šæœ¬ä¸­æˆ‘ä»¬ç›´æ¥å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œè¯¥æ€ä¹ˆç”¨å‘¢ï¼Ÿç›´æ¥åœ¨ç»ˆç«¯å®šä¹‰å˜é‡ï¼Œæ­¤æ—¶å˜é‡æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<h1 id=\"ç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#ç¯å¢ƒå˜é‡\">#</a> ç¯å¢ƒå˜é‡</h1>\n<p>åˆ’åˆ†ä¸ºå±€éƒ¨å’Œå…¨å±€å˜é‡ï¼Œå±€éƒ¨å˜é‡åªå¯¹åˆ›å»ºä»–ä»¬çš„ shell å¯è§ï¼Œ<strong>ç³»ç»Ÿç¯å¢ƒå˜é‡åŸºæœ¬éƒ½æ˜¯å¤§å†™å­—æ¯</strong>ï¼ŒåŒºåˆ«äºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡ï¼ŒæŸ¥çœ‹å…¨å±€å˜é‡å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>env </code> æˆ–è€… <code>printenv</code> ã€‚</p>\n<p>æŸ¥çœ‹å•ä¸ªå˜é‡çš„å€¼ï¼š <code>printenv $HOME</code>  æˆ–è€… <code>echo $HOME</code> ã€‚è¿™é‡Œç»™å‡ºå‡ ä¸ªå¸¸è§çš„ç³»ç»Ÿç¯å¢ƒå˜é‡</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$HOME</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/home/cyan</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$PATH</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$SHELL</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>/bin/bash</pre></td></tr></table></figure><p>ä½ å¯ä»¥æŠŠå˜é‡å‰é¢çš„ç¾å…ƒç¬¦å· <code>$</code>  çœ‹ä½œå–å€¼ï¼Œåœ¨å˜é‡å‰åŠ ä¸Š <code>$</code>  å¯ä»¥åŒºåˆ†å®ƒåˆ°åº•æ˜¯å˜é‡è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$SHELL</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/bin/bash</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">SHELL</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token environment constant\">SHELL</span></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å®šä¹‰è‡ªå·±çš„å˜é‡ï¼Œç›´æ¥å®šä¹‰å³å¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># é€šè¿‡ cat å‘½ä»¤æŸ¥çœ‹ test æ–‡ä»¶å†…å®¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> val</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># è‡ªå®šä¹‰å˜é‡ value</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token assign-left variable\">value</span><span class=\"token operator\">=</span>./test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#å°è¯•ä½¿ç”¨ value æ¥è¿è¡Œ./test</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ value</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>value: <span class=\"token builtin class-name\">command</span> not found</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#å°è¯•ä½¿ç”¨ value çš„å€¼æ¥è¿è¡Œ./testï¼Œä½†æ˜¯æ‰“å°å‡ºæ¥çš„ä¸æ˜¯ 10ï¼Œè€Œæ˜¯ val</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token variable\">$value</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>val</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#å¯è§ï¼Œåœ¨è„šæœ¬ä¸­ï¼Œå˜é‡å‰ä¹Ÿéœ€è¦ä½¿ç”¨ $</span></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å¯¹å˜é‡æœ‰äº†å¤§æ¦‚çš„äº†è§£ã€‚ <code>$</code>  ç›¸å½“äºå–å‡ºå˜é‡çš„å€¼ï¼Œæƒ³è¦å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç›´æ¥å®šä¹‰å³å¯ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ª<strong>è‡´å‘½çš„å‘</strong>ï¼Œæˆ‘ä»¬å¹³æ—¶å†™ä»£ç ï¼Œä¸ºäº†æœ‰è¾ƒé«˜çš„å¯è¯»æ€§ï¼Œä¸€èˆ¬åœ¨å˜é‡å’Œ <code>=</code>  ä»¥åŠå€¼ä¹‹é—´éƒ½ä¼šåŠ ä¸Š<strong>ç©ºæ ¼</strong>ï¼Œä½†æ˜¯è¿™åœ¨ç»ˆç«¯é‡Œé¢æ˜¯è‡´å‘½çš„é”™è¯¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ val <span class=\"token operator\">=</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Command <span class=\"token string\">'val'</span> not found, did you mean:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'pal'</span> from deb pal <span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span>.3-8.1build4<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'cal'</span> from deb bsdmainutils <span class=\"token punctuation\">(</span><span class=\"token number\">11.1</span>.2ubuntu3<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'vala'</span> from deb valac-bin <span class=\"token punctuation\">(</span><span class=\"token number\">0.48</span>.6-0ubuntu1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'fal'</span> from deb dnet-progs <span class=\"token punctuation\">(</span><span class=\"token number\">2</span>.65build2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'vax'</span> from deb simh <span class=\"token punctuation\">(</span><span class=\"token number\">3.8</span>.1-6<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'al'</span> from deb mono-devel <span class=\"token punctuation\">(</span><span class=\"token number\">6.8</span>.0.105+dfsg-2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'vam'</span> from deb vim-addon-manager <span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span>.10<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'pval'</span> from deb snacc <span class=\"token punctuation\">(</span><span class=\"token number\">1.3</span>.1-7build2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token builtin class-name\">command</span> <span class=\"token string\">'vl'</span> from deb atfs <span class=\"token punctuation\">(</span><span class=\"token number\">1</span>.4pl6-14<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Try: <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token operator\">&lt;</span>deb name<span class=\"token operator\">></span></pre></td></tr></table></figure><p>å› ä¸ºåŠ ä¸Šç©ºæ ¼ï¼Œ <code>shell</code> ï¼ˆæˆ‘çš„æ˜¯ <code>bash</code> ï¼‰å°±ä¼šè®¤ä¸ºï¼Œä½ çš„ <code>val</code> ï¼ˆå˜é‡åï¼‰æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œç©ºæ ¼åé¢çš„æ˜¯è¯¥å‘½ä»¤çš„å‚æ•°ã€‚è€Œ <code>shell</code>  æ²¡æœ‰æ‰¾åˆ° <code>val</code>  è¿™ä¸ªå‘½ä»¤å°±ä¼šæŠ¥é”™ã€‚</p>\n<p>å…¶å®éšç€ä¹‹åçš„å­¦ä¹ ï¼Œä½ ä¼šè¶Šæ¥è¶Šç†è§£ <code>Linux</code>  ä¸­å„ç§è®¾è®¡çš„å·§å¦™ï¼Œæˆ‘ä»¬è°ƒç”¨çš„ä¸€ä¸ªåˆä¸€ä¸ªå‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†ï¼‰ï¼Œè¯´ç©¿äº†å…¶å®æ˜¯ä¸€ä¸ªåˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœä½ ä¹‹å‰åœ¨ç»™ <code>IDEA</code> ï¼Œ <code>VsCode</code>  è¿™äº›å·¥å…·é…ç½®ç¯å¢ƒå˜é‡æ—¶å¥½å¥½äº†è§£è¿‡åˆ°åº•ä¸ºä»€ä¹ˆéœ€è¦ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä½ å¾ˆæ¸…æ¥šæˆ‘åˆšæ‰åœ¨è¯´ä»€ä¹ˆã€‚</p>\n<p>å¯¹äºå±€éƒ¨ç¯å¢ƒå˜é‡ï¼Œbash å¹¶æ²¡æœ‰ä»€ä¹ˆæŒ‡ä»¤å¯ä»¥å•ç‹¬æ˜¾ç¤ºï¼Œ <code>set</code>  å‘½ä»¤ä¼šæ˜¾ç¤ºä¸ºæŸä¸ªç‰¹å®šè¿›ç¨‹è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œè¾“å‡ºæ—¶ä¼šæŒ‰ç…§å­—æ¯é¡ºåºæ’åº</p>\n<h2 id=\"è®¾ç½®ç”¨æˆ·å®šä¹‰å˜é‡\"><a class=\"anchor\" href=\"#è®¾ç½®ç”¨æˆ·å®šä¹‰å˜é‡\">#</a> è®¾ç½®ç”¨æˆ·å®šä¹‰å˜é‡</h2>\n<p>ä¸Šé¢å·²ç»è®²å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œå†ç»™å‡ºå‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</p>\n<ul>\n<li>å¦‚æœå˜é‡çš„å€¼ä¸­å«æœ‰ç©ºæ ¼ï¼Œè¯·ä½¿ç”¨ç”¨å•ï¼ˆåŒï¼‰å¼•å·ï¼Œ <code>val = &quot;hello world&quot;</code> ã€‚</li>\n<li>å®šä¹‰ç”¨æˆ·å˜é‡ï¼Œè¯·åšæŒä½¿ç”¨<strong>å°å†™</strong>å­—æ¯ã€‚</li>\n<li>å˜é‡åï¼Œç­‰å·ï¼Œå€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</li>\n</ul>\n<h2 id=\"è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡\">#</a> è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡</h2>\n<p>æˆ‘ä»¬ä¹‹å‰ç›´æ¥åˆ›å»ºçš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œå¯¹å…¶ä»– <code>shell</code> ï¼ˆçˆ¶å­ <code>shell</code> ï¼‰æ˜¯ä¸å¯è§å¾—ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$var</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">10</span></pre></td></tr></table></figure><p>å…³äºçˆ¶å­ <code>shell</code> ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« è¿‡å¤šè®²è§£ï¼Œä½ è¦æ˜¯æ±‚çŸ¥å¿ƒåˆ‡ï¼Œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlkdS5jb20=\">ä¼ é€é—¨</span>ã€‚</p>\n<p>ä½ ç°åœ¨å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ <code>bash shell</code>  ä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œæˆ‘ä»¬æ‰“å¼€ç»ˆç«¯æ—¶ï¼Œ <code>bash</code>  ä¹Ÿå¯åŠ¨äº†ï¼Œæ—¢ç„¶ <code>bash</code>  æ˜¯ç¨‹åºï¼Œé‚£æˆ‘ä»¬åœ¨ç»ˆç«¯ä¹Ÿå¯ä»¥è¿è¡Œ <code>bash</code> ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¤„äº<strong>å­ shell</strong>ï¼Œ<strong>çˆ¶å­ shell</strong> ä½¿ç”¨ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥åœ¨<strong>çˆ¶ shell</strong> åˆ›å»ºçš„å±€éƒ¨å˜é‡å¯¹<strong>å­ shell</strong> æ˜¯ä¸å¯è§çš„ã€‚</p>\n<p>åˆ›å»ºå…¨å±€ç¯å¢ƒå˜é‡çš„æ–¹æ³•ï¼šå…ˆåˆ›å»ºå±€éƒ¨ç¯å¢ƒå˜é‡ï¼Œå†å¯¼å‡ºåˆ°å…¨å±€å˜é‡</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">var</span><span class=\"token operator\">=</span><span class=\"token string\">'global'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token string\">'global'</span> <span class=\"token comment\">#export å°±æ˜¯å¯¼å‡ºå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¼å‡ºï¼šexport var=global</span></pre></td></tr></table></figure><p>åœ¨<strong>å­ shell</strong> ä¸­ä¿®æ”¹å…¨å±€å˜é‡ä¸ä¼šå½±å“<strong>çˆ¶ shell</strong> ä¸­è¯¥å˜é‡çš„å€¼ã€‚æ ¹æ®è¯¥æ€§è´¨ï¼Œåœ¨<strong>å­ shell</strong> ä¸­è®¾ç½®å…¨å±€å˜é‡æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå…¶è®¾ç½®çš„å€¼ï¼Œæ ¹æœ¬ä¸ä¼ ç»™çˆ¶ shellã€‚</p>\n<h2 id=\"åˆ é™¤ç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#åˆ é™¤ç¯å¢ƒå˜é‡\">#</a> åˆ é™¤ç¯å¢ƒå˜é‡</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">unset</span> var</pre></td></tr></table></figure><p>è§£é‡Šï¼š</p>\n<ul>\n<li>ä½¿ç”¨ <code>unset</code>  æŒ‡ä»¤ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤å˜é‡ï¼Œä¸éœ€è¦åŠ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>ã€‚</mtext></mrow><annotation encoding=\"application/x-tex\">ã€‚</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord cjk_fallback\">ã€‚</span></span></span></span>çš„æœ¬è´¨æ˜¯ï¼Œå¾—åˆ°ç¯å¢ƒå˜é‡çš„å€¼ï¼</li>\n<li><code>printenv</code>  æŒ‡å®šäº†ï¼Œä¼ å…¥çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ˆè‡ªå®šä¹‰å˜é‡ä¸è¡Œï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>\n<li>åœ¨å­ shell ä¸­å¯¹å…¨å±€å˜é‡çš„ä¿®æ”¹æ— èƒ½åæ˜ åˆ°çˆ¶ shellï¼Œå“ªæ€•æ˜¯åˆ é™¤</li>\n</ul>\n<h2 id=\"è®¾ç½®pathç¯å¢ƒå˜é‡\"><a class=\"anchor\" href=\"#è®¾ç½®pathç¯å¢ƒå˜é‡\">#</a> è®¾ç½® PATH ç¯å¢ƒå˜é‡</h2>\n<p><code>PATH</code>  ç¯å¢ƒå˜é‡å®šä¹‰äº†ç”¨äºè¿›è¡Œå‘½ä»¤å’Œç¨‹åºæŸ¥æ‰¾çš„ç›®å½•ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cyan@cyan-virtual-machine:~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token environment constant\">$PATH</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</pre></td></tr></table></figure><ul>\n<li>å¦‚æœå‘½ä»¤æˆ–ç¨‹åºä½ç½®æ²¡æœ‰åŒ…å«åœ¨ <code>PATH</code>  ä¸­ï¼Œå¦‚æœä¸ä½¿ç”¨è·¯å¾„ï¼Œ <code>shell</code>  æ˜¯æ²¡æ³•æ‰¾åˆ°å¹¶è¿è¡Œçš„ã€‚å°±åƒä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <code>./test.sh</code>  æ‰èƒ½è¿è¡Œè¯¥æ–‡ä»¶ï¼Œä½¿ç”¨ <code>test.sh</code>  æ˜¯ä¸è¡Œçš„ã€‚</li>\n<li>çŸ­æš‚çš„ä¿®æ”¹ <code>PATH</code>  å‘½ä»¤å°±æ˜¯ï¼š <code>PATH=$PATH:.</code> ï¼Œä¸€èˆ¬åŠ  <code>.</code>  å°±æ˜¯åŒ…å«å½“å‰ç›®å½•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ å…¶ä»–è·¯å¾„ã€‚è¿™ç§ä¿®æ”¹ï¼Œåœ¨ <code>exit</code>  åä¼šå¤±æ•ˆã€‚</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>new_File  <span class=\"token builtin class-name\">test</span>  test_1.sh</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># æŸ¥çœ‹æ–‡ä»¶ test_1.sh è„šæœ¬å†…å®¹ -- æ‰“å° Hello World</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token function\">cat</span> test_1.sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Hello World\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># å¸Œæœ›ç›´æ¥ä½¿ç”¨è¿™ä¸ªè„šæœ¬åä½œä¸ºå‘½ä»¤</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ test_1.sh</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>test_1.sh: <span class=\"token builtin class-name\">command</span> not found</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># å°†å½“å‰ç›®å½•åŠ åˆ° PATH ä¸­</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>cyan@cyan-virtual-machine:~/Templates$ test_1.sh</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>Hello World</pre></td></tr></table></figure><p>å¦‚æœä½ è¿˜æ²¡æ˜ç™½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è¿™ä¸ªï¼ˆæˆ‘è§‰å¾—å’Œæˆ‘è®²çš„å·®ä¸å¤šï¼‰<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5tYW5vbmdqYy5jb20vZGV0YWlsLzI0LWJyYXhocnpnY3pma3B3dC5odG1s\">å¦‚ä½•ç†è§£ PATH</span>ã€‚å¦‚æœè¿˜æ˜¯ä¸æ‡‚ï¼ŒçœŸæ‹¿ä½ æ²¡åŠæ³•ï¼Œå°±å†ç»™ä¸ª <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlkdS5jb20=\">çœŸæ­£çš„ä¼ é€é—¨</span>ã€‚</p>\n<h1 id=\"æœ€å\"><a class=\"anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>å…³äºå¦‚ä½•æŒä¹…åŒ–åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™æ¶‰åŠåˆ°ä¿®æ”¹ä¸€äº›ç³»ç»Ÿæ–‡ä»¶ï¼Œæ–‡ä»¶æƒé™ä»¥åŠ <code>shell</code>  è¿›ç¨‹çš„ä¸€äº›çŸ¥è¯†ï¼Œä¹‹åå†è¯´å§ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/29/Tools/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%8C%87%E5%8D%97/",
            "url": "https://cecilia.cool/2022/07/29/Tools/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%8C%87%E5%8D%97/",
            "title": "Hexoæ­å»ºåšå®¢æŒ‡å—",
            "date_published": "2022-07-29T06:16:57.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>ä½¿ç”¨ Hexo+Github æ­å»ºåšå®¢ï¼Œå› ä¸ºæ¶‰åŠåˆ°éƒ¨åˆ†æ’ä»¶æˆ–è€…å®‰è£…åŒ…çš„ä¸‹è½½ï¼Œ<sub>å»ºè®®ä½¿ç”¨é­”æ³•ä¸Šç½‘</sub>ã€‚</p>\n<blockquote>\n<p>æ¨èæ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yNjYyNTI0OQ==\">https://zhuanlan.zhihu.com/p/26625249</span></p>\n<p>æ¨èè§†é¢‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW1VNHkxajcybj9zcG1faWRfZnJvbT0zMzMuMzM3LnNlYXJjaC1jYXJkLmFsbC5jbGljayZhbXA7dmRfc291cmNlPTVhY2Y1YTdiMjNkMjhlNzYzM2U1YTliMzgxYzU3YzQy\">https://www.bilibili.com/video/BV1mU4y1j72n?spm_id_from=333.337.search-card.all.click&amp;vd_source=5acf5a7b23d28e7633e5a9b381c57c42</span></p>\n</blockquote>\n<h1 id=\"å‡†å¤‡å·¥ä½œ\"><a class=\"anchor\" href=\"#å‡†å¤‡å·¥ä½œ\">#</a> å‡†å¤‡å·¥ä½œ</h1>\n<h2 id=\"ä¸‹è½½nodejs\"><a class=\"anchor\" href=\"#ä¸‹è½½nodejs\">#</a> ä¸‹è½½ Node.js</h2>\n<p>ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vdjgv\">Chrome V8</span> å¼•æ“çš„ <strong>JavaScript è¿è¡Œç¯å¢ƒ</strong>ã€‚Node.js ä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ I/O çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚Node.js çš„åŒ…ç®¡ç†å™¨ <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tLw==\">npm</span>ï¼Œæ˜¯å…¨çƒæœ€å¤§çš„å¼€æºåº“ç”Ÿæ€ç³»ç»Ÿã€‚</p>\n<p>å®˜ç½‘ä¸‹è½½:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2VuL2Rvd25sb2FkLw==\">https://nodejs.org/en/download/</span></p>\n<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡ŒæŸ¥çœ‹ï¼š <code>node -v</code>  æ˜¾ç¤ºå®‰è£…ç‰ˆæœ¬ï¼Œ <code>npm -v</code>  æ˜¾ç¤º npm ç‰ˆæœ¬ã€‚æ–°ç‰ˆçš„ Node.js å·²è‡ªå¸¦ npmï¼Œå®‰è£… Node.js æ—¶ä¼šä¸€èµ·å®‰è£…ï¼Œ<strong>npm çš„ä½œç”¨å°±æ˜¯å¯¹ Node.js ä¾èµ–çš„åŒ…è¿›è¡Œç®¡ç†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºç”¨æ¥å®‰è£… / å¸è½½ Node.js éœ€è¦çš„ä¸œè¥¿ã€‚</strong></p>\n<h3 id=\"ç¯å¢ƒé…ç½®\"><a class=\"anchor\" href=\"#ç¯å¢ƒé…ç½®\">#</a> ç¯å¢ƒé…ç½®</h3>\n<p>npm åœ¨å®‰è£… node.js éœ€è¦çš„ä¾èµ–æ—¶ï¼Œä¼šé»˜è®¤æ”¾åœ¨ C ç›˜ <code>C:|Users|ç”¨æˆ·å\\AppData\\Roaming\\npm</code> ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½® npm å®‰è£…çš„å…¨å±€æ¨¡å—æ‰€åœ¨çš„è·¯å¾„ï¼Œä»¥åŠç¼“å­˜ cache å¾—è·¯å¾„ã€‚</p>\n<p>åœ¨ nodejs æ–‡ä»¶å¤¹ä¸‹åˆ›å»º node_cache,node_global å³å¯ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/29/90aec5c64426e20a.png\" alt=\"image-20220729144241266\" /></p>\n<p>æ‹¿åˆ°ç›¸åº”çš„è·¯å¾„ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> config <span class=\"token builtin class-name\">set</span> prefix <span class=\"token string\">\"S:\\DevTools\\Nodejs<span class=\"token entity\" title=\"\\n\">\\n</span>ode_global\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> config <span class=\"token builtin class-name\">set</span> cache <span class=\"token string\">\"S:\\DevTools\\Nodejs<span class=\"token entity\" title=\"\\n\">\\n</span>ode_cache\"</span></pre></td></tr></table></figure><p>ç„¶åå†é…ç½®ç¯å¢ƒå˜é‡ï¼Œå…ˆé…ç½®ç³»ç»Ÿå˜é‡</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/29/b18f9f922882f863.png\" alt=\"image-20220729144419380\" /></p>\n<p>ç„¶åå†é…ç½®ç”¨æˆ·å˜é‡ä¸­çš„ pathï¼Œä¹‹å‰çš„å€¼ä¸ºï¼š  <code>C:\\Users\\Cyan\\AppData\\Roaming\\npm</code> ï¼Œå°†å…¶æ”¹ä¸ºä¸‹é¢çš„å€¼</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/29/71d161b1f67a1e9f.png\" alt=\"image-20220729144448110\" /></p>\n<h2 id=\"ä¸‹è½½git\"><a class=\"anchor\" href=\"#ä¸‹è½½git\">#</a> ä¸‹è½½ Git</h2>\n<p>ä¸å¤šè¯´</p>\n<h2 id=\"ä¸‹è½½hexo\"><a class=\"anchor\" href=\"#ä¸‹è½½hexo\">#</a> ä¸‹è½½ Hexo</h2>\n<p>åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-cli <span class=\"token parameter variable\">--location</span><span class=\"token operator\">=</span>global</pre></td></tr></table></figure><p>å¦‚æœä¸‹è½½å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯æ˜¾ç¤ºæƒé™ä¸è¶³ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œ cmdã€‚</p>\n<p>ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨ <code>hexo -v</code>  æŸ¥çœ‹ hexo ç‰ˆæœ¬</p>\n<h2 id=\"githubç›¸å…³æ“ä½œ\"><a class=\"anchor\" href=\"#githubç›¸å…³æ“ä½œ\">#</a> Github ç›¸å…³æ“ä½œ</h2>\n<p>ä¸‹é¢æ“ä½œä»¥æˆ‘çš„ Github ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p>\n<h3 id=\"å»ºç«‹ä»“åº“\"><a class=\"anchor\" href=\"#å»ºç«‹ä»“åº“\">#</a> å»ºç«‹ä»“åº“</h3>\n<p>æˆ‘çš„ Github çš„æ˜µç§°æ˜¯ <code>Cyan-N</code> ï¼Œæ‰€ä»¥è¦å»ºç«‹ä¸€ä¸ªä»“åº“å«åšï¼š <code>Cyan-N.github.io</code> ã€‚<strong>åç¼€åç»Ÿä¸€ï¼Œå‰é¢å¿…é¡»æ˜¯è´¦å·çš„æ˜µç§°</strong>ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/29/87a0634c1fc7f4b2.png\" alt=\"image-20220729144929165\" /></p>\n<h3 id=\"ç”Ÿæˆsshå¯†é’¥\"><a class=\"anchor\" href=\"#ç”Ÿæˆsshå¯†é’¥\">#</a> ç”Ÿæˆ ssh å¯†é’¥</h3>\n<p>éšä¾¿è¿›å…¥æ–‡ä»¶å¤¹ï¼Œç„¶åå³é”®è¿›å…¥  <code>Git Bash Here</code> ï¼Œè°ƒç”¨å‘½ä»¤ï¼š <code>ssh-keygen -t rsa -C &quot;é‚®ç®±&quot;</code> ï¼Œ<strong>æ­¤æ—¶ä¸è¦å…³é—­ Git</strong>ã€‚ç„¶åå°±ä¼šåœ¨  <code>C:\\Users\\Cyan\\.ssh</code>  é‡Œé¢ç”Ÿæˆ <code>id_rsa</code>  å’Œ <code>id_rsa.pub</code>  æ–‡ä»¶ï¼Œè®°äº‹æœ¬è¿›å…¥ <code>id_rsa.pub</code> ï¼Œ <code>ctrl+aï¼Œctrl+c</code>  å¤åˆ¶å…¨éƒ¨æŒ‡ä»¤ã€‚</p>\n<p>åœ¨ <code>Github</code>  ä¸­ï¼Œè¿›å…¥ <code>setting-&gt;SSH and GPG keys</code>  åˆ›å»º <code>SSH Key</code> ï¼Œ <code>title</code>  éšä¾¿å–ï¼Œç„¶ååœ¨ <code>key</code>  ä¸­ç²˜è´´åˆšæ‰å¤åˆ¶çš„å†…å®¹ã€‚ç„¶ååœ¨åˆšæ‰çš„ Git ç•Œé¢è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š <code>ssh -T git@github.com</code> ã€‚æµ‹è¯• ssh æ˜¯å¦ç»‘å®šæˆåŠŸã€‚</p>\n<p>å†æ¬¡å¼ºè°ƒï¼Œ <code>Github</code>  æ˜¯å›½å¤–ç½‘ç«™ï¼Œä¼šæŠ½é£ã€‚</p>\n<h1 id=\"ä½¿ç”¨hexo\"><a class=\"anchor\" href=\"#ä½¿ç”¨hexo\">#</a> ä½¿ç”¨ Hexo</h1>\n<h2 id=\"ç”Ÿæˆæœ¬åœ°ç½‘é¡µ\"><a class=\"anchor\" href=\"#ç”Ÿæˆæœ¬åœ°ç½‘é¡µ\">#</a> ç”Ÿæˆæœ¬åœ°ç½‘é¡µ</h2>\n<p>æ‰¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾ä½ çš„åšå®¢æ–‡ä»¶ï¼Œæ­¤å¤„æˆ‘å‘½åä¸º Blogã€‚ç„¶ååœ¨è¿™ä¸ªç•Œé¢ä¸­  <code>Git Bash Here</code> ã€‚å…¶å®å»ºè®®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>Git</code> ã€‚ç„¶åè¾“å…¥å‘½ä»¤ï¼š <code>hexo init</code>  ç”¨äºåˆå§‹åŒ–ã€‚</p>\n<p><code>hexo s</code>  ç”¨äºå¯åŠ¨æœåŠ¡ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºä¸€ä¸ªç½‘å€ï¼Œå°±å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æŸ¥çœ‹ï¼Œ <code>ctrl+c</code>  å…³é—­æœ¬åœ°æœåŠ¡å™¨ï¼Œå°±ä¸èƒ½å†è®¿é—®äº†ã€‚</p>\n<h2 id=\"ä¿®æ”¹é…ç½®\"><a class=\"anchor\" href=\"#ä¿®æ”¹é…ç½®\">#</a> ä¿®æ”¹é…ç½®</h2>\n<p>åœ¨å­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°_config.yml æ–‡ä»¶ï¼Œåœ¨æœ€åé¢ä¿®æ”¹ä¸ºä¸‹é¢ä»£ç ï¼š</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Deployment</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">## Docs: https://hexo.io/docs/one-command-deployment</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> git</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//github.com/Cyan<span class=\"token punctuation\">-</span>N/Cyan<span class=\"token punctuation\">-</span>N.github.io.git <span class=\"token comment\">#æ­¤å¤„å°±æ˜¯ä»“åº“åœ°å€</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> main</pre></td></tr></table></figure><h2 id=\"ä¸‹è½½å·¥å…·\"><a class=\"anchor\" href=\"#ä¸‹è½½å·¥å…·\">#</a> ä¸‹è½½å·¥å…·</h2>\n<p>åœ¨å­˜æ”¾åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥ Gitï¼Œè¿™é‡Œè¿˜æ˜¯å»ºè®®ç®¡ç†å‘˜èº«ä»½ã€‚æ‰§è¡Œå‘½ä»¤ï¼š <code>npm install hexo-deployer-git --save</code>  å®‰è£… Git éƒ¨ç½²æ’ä»¶ã€‚</p>\n<p>ç„¶åæ‰§è¡Œï¼š <code>hexo g</code>  ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œå†æ‰§è¡Œï¼š <code>hexo d</code>  æäº¤åˆ° Github ä¸Šï¼Œè¿™ä¸€æ­¥å¯èƒ½ä¼šè¿æ¥è¶…æ—¶ï¼Œå¤šè¯•å‡ æ¬¡ã€‚</p>\n<h1 id=\"ç»“å°¾\"><a class=\"anchor\" href=\"#ç»“å°¾\">#</a> ç»“å°¾</h1>\n<p>ç°åœ¨ä½ å·²ç»å®Œæˆäº†åšå®¢çš„æ­å»ºï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®ä½ çš„ä»“åº“åœ°å€ï¼Œå°±æ˜¯<strong>ä¿®æ”¹é…ç½®</strong>é‡Œé¢çš„é‚£ä¸ªç½‘å€æ¥è®¿é—®ä½ çš„åšå®¢ã€‚å…¶å®è¿˜æœ‰ä¸€äº›æˆ‘æ²¡æœ‰è®²ï¼Œæ¯”å¦‚åŸŸåæ›¿æ¢å’Œ https ä½¿ç”¨ï¼Œæ›´æ¢ä¸»é¢˜ï¼Œé€šè¿‡ä¿®æ”¹ä¸»é¢˜ä¸­çš„_config.yml å®ç°ä¸ªæ€§åŒ–åšå®¢ã€‚</p>\n<p>è¿˜ç¥èµ·çˆªå­å•Šï¼Œä¸ªäººèµ¶é—¨å»æœä¸€å“ˆï¼ˆç¿»è¯‘ï¼šè¿˜æ„£ç€å¹²ä»€ä¹ˆï¼Œè‡ªå·±é©¬ä¸Šå»æœä¸€ä¸‹ï¼‰</p>\n",
            "tags": [
                "tools"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/28/Shell/shell%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/",
            "url": "https://cecilia.cool/2022/07/28/Shell/shell%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/",
            "title": "shellå¿«é€Ÿå…¥é—¨",
            "date_published": "2022-07-28T06:58:49.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æœ¬æ–‡åŠåç»­æ–‡ç« éƒ½æ˜¯åŸºäº <code>bash shell</code>  è®²è§£ï¼Œ <code>Linux</code>  å‘è¡Œç‰ˆæœ¬ä¸º <code>Ubuntu</code> ã€‚æœ¬æ–‡æŒ‡å¯¼è¯»è€…å¿«é€Ÿå…¥é—¨ <code>shell</code>  è„šæœ¬ç¼–ç¨‹è€Œåˆ»æ„æ¨¡ç³ŠåŒ–å…¶ä»–åŸºæœ¬æ¦‚å¿µï¼Œæœ¬ç³»åˆ—äº <code>2022-07-28</code>  å¼€å§‹æ›´æ–°ï¼Œæ¯å¤©æ›´æ–°ä¸€ä¸ªå°èŠ‚ï¼Œç›´åˆ°ç»“æŸï¼Œä¸»è¦æ˜¯è®²è§£ <code>shell</code>  ç¼–ç¨‹ï¼Œå…¶ä¸­ä¹Ÿä¼šæ¶‰åŠåˆ°ç›¸å…³çš„ <code>Linux</code>  çŸ¥è¯†ã€‚</p>\n<p>æ•´ä¸ª <code>shell</code>  ç³»åˆ—ä¸ä¼šè®²è§£å¦‚ä½•å®‰è£…åŒç³»ç»Ÿï¼Œä¹Ÿä¸ä¼šè®²è§£å¦‚ä½•å®‰è£…è™šæ‹Ÿæœºä»¥åŠ <code>Linux</code>  ç›¸å…³ç‰ˆæœ¬çš„é•œåƒæ–‡ä»¶ã€‚å¦‚æœä½ éœ€è¦ç›¸å…³çš„è™šæ‹Ÿæœºå’Œ Linux çš„å®‰è£…è§†é¢‘ï¼Œæˆ‘æ¨èè¿™ä¸ªï¼š</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMThVNHkxVzdhdj9zcG1faWRfZnJvbT0zMzMuOTk5LjAuMCZhbXA7dmRfc291cmNlPTVhY2Y1YTdiMjNkMjhlNzYzM2U1YTliMzgxYzU3YzQy\">https://www.bilibili.com/video/BV18U4y1W7av?spm_id_from=333.999.0.0&amp;vd_source=5acf5a7b23d28e7633e5a9b381c57c42</span></p>\n</blockquote>\n<p>B ç«™å…³æ³¨<strong> Micro_Frank</strong>ã€‚</p>\n<h1 id=\"sshè¿æ¥ubuntu\"><a class=\"anchor\" href=\"#sshè¿æ¥ubuntu\">#</a> ssh è¿æ¥ Ubuntu</h1>\n<p>æˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢åœ¨è™šæ‹Ÿæœºé‡Œé¢ä½¿ç”¨å‘½ä»¤è¡Œï¼Œæ‰€ä»¥å°±åœ¨å¤–éƒ¨é€šè¿‡ç»ˆç«¯æ¥è®¿é—®è™šæ‹Ÿæœºä¸Šçš„ <code>Ubuntu</code> ã€‚</p>\n<ul>\n<li>åœ¨ <code>Ubuntu</code>  ä¸­ä½¿ç”¨å‘½ä»¤ <code>ifcofig</code>  æŸ¥çœ‹ç³»ç»Ÿ <code>IP</code>  åœ°å€ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/28/e434cc286d6c0917.png\" alt=\"image-20220728152200134\" /></p>\n<p>å½“ç„¶ï¼Œæœ‰å¯èƒ½ä½¿ç”¨äº† <code>ipconfig</code>  æŸ¥ä¸åˆ° <code>IP</code>  åœ°å€ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ <code>sudo dhclient ens33</code>  å‘½ä»¤ï¼Œå…·ä½“ä½ å¯ä»¥ç™¾åº¦ã€‚</p>\n<ul>\n<li>åœ¨è‡ªå·±æ¡Œé¢ä½¿ç”¨ <code>win+r</code> ï¼Œè¾“å…¥ <code>cmd</code> ã€‚ä½¿ç”¨ <code>ssh</code>  è¿æ¥ï¼š <code>ssh ç”¨æˆ·å@IPåœ°å€</code> ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/28/573c6233451b027a.png\" alt=\"image-20220728152655411\" /></p>\n<p>ä¹‹å‰å› ä¸ºæŸäº›åŸå› ï¼Œæˆ‘çš„ <code>Ubuntu</code>  ä¿®æ”¹è¿‡ <code>ssh</code>  è¿æ¥çš„ç«¯å£å·ï¼Œæ‰€ä»¥åœ¨è¿æ¥æ—¶éœ€è¦é€šè¿‡ <code>-p</code>  é€‰é¡¹æ¥æŒ‡å®šç«¯å£å·ã€‚å¦‚æœä½ æ²¡æœ‰æ”¹è¿‡ï¼Œå°±ä¸éœ€è¦æŒ‡å®šäº†ã€‚</p>\n<h1 id=\"ä¸‹è½½vim\"><a class=\"anchor\" href=\"#ä¸‹è½½vim\">#</a> ä¸‹è½½ Vim</h1>\n<p><code>Vim</code>  æ˜¯ä¸€ä¸ªè¶…çº§å¼ºå¤§çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œä¸»è¦å°±æ˜¯ç”¨çš„å°‘ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">vim</span></pre></td></tr></table></figure><p>æˆ‘å·²ç»ä¸‹è½½è¿‡äº†ï¼Œå°±ä¸æˆªå›¾äº†ï¼Œå®åœ¨ä¸ä¼šä½ å°±å»ç™¾åº¦ã€‚</p>\n<h1 id=\"åˆ›å»ºè„šæœ¬æ–‡ä»¶\"><a class=\"anchor\" href=\"#åˆ›å»ºè„šæœ¬æ–‡ä»¶\">#</a> åˆ›å»ºè„šæœ¬æ–‡ä»¶</h1>\n<p>ä½œä¸ºå­¦ä¹ ä½¿ç”¨ï¼Œæˆ‘å»ºè®®ä½ å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾ä½ å¹³æ—¶å†™çš„ç»ƒä¹ è„šæœ¬ï¼Œæ–‡ä»¶åå¯ä»¥å« <code>Shell_Files</code> ï¼Œéšä¾¿ä½ å•¦ã€‚</p>\n<ul>\n<li>è¿›å…¥ä½ åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼š <code>cd Shell_Files</code> ã€‚</li>\n<li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š <code>touch test_1</code> ï¼Œä¸éœ€è¦è·Ÿåç¼€ã€‚æ–‡ä»¶åç¼€çš„ä½œç”¨æ— éå°±æ˜¯æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„æ–¹å¼ï¼ˆä½ ç°åœ¨å¯ä»¥è¿™ä¹ˆç†è§£ï¼‰ï¼Œä¹Ÿå¯ä»¥è·Ÿ <code>sh</code>  åç¼€ï¼Œæ¯”å¦‚ <code>touch test_1.sh</code> ã€‚</li>\n<li>ä½¿ç”¨ <code>vim</code>  æ¥ç¼–å†™è„šæœ¬ç¨‹åºï¼š <code>vim test_1.sh</code> ã€‚è¿›å…¥åˆ°ç¼–è¾‘ç•Œé¢åï¼Œè¯·ä¸è¦ä¹±åŠ¨é”®ç›˜ï¼Œä½ ç°åœ¨å¹¶æ²¡æœ‰å¤„äºç¼–è¾‘æ¨¡å¼ã€‚æ•²å‡» <code>i</code>  é”®è¿›å…¥ <code>insert</code>  æ¨¡å¼ï¼Œä½ å°±å¯ä»¥ç¼–è¾‘äº†ï¼Œä½ å¯ä»¥è¾“å…¥ä»¥ä¸‹ä»£ç </li>\n</ul>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">val</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\" testing... \"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>åœ¨ <code>shell</code>  ä¸­ï¼Œ <code>#</code> åé¢è·Ÿçš„æ˜¯æ³¨é‡Šï¼Œä½†æ˜¯åœ¨ç¼–å†™è„šæœ¬æ—¶ï¼Œä½ å¿…é¡»åŠ ä¸Šç¬¬ä¸€è¡Œçš„æ³¨é‡Šæ¥æŒ‡å®šä½ è¦æ˜¯ç”¨çš„ <code>shell</code> ï¼Œä½ ä¸ä¼šä»¥ä¸º <code>shell</code>  é‡Œé¢åªæœ‰ <code>bash</code>  å§ï¼Ÿç¬¬äºŒè¡Œæ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ï¼ˆå¼±ç±»å‹è¯­è¨€ï¼‰ï¼Œ <code>while</code>  é‡Œé¢åº”è¯¥è·Ÿä¸Šåˆ¤æ–­æ¡ä»¶ï¼Œæ¡ä»¶ä¸º <code>true</code>  ç»§ç»­æ‰§è¡Œï¼Œä¸º <code>false</code>  ç»“æŸæ‰§è¡Œã€‚ä½†æ˜¯ <code>echo</code>  æ˜¯è‡ªåŠ¨æ¢è¡Œçš„<strong>æ‰“å°è¯­å¥</strong>ï¼Œæ‰€ä»¥<strong>æˆåŠŸæ‰§è¡Œ</strong>äº† <code>echo &quot;&quot;</code> ï¼Œ <code>while</code>  é‡Œé¢å°±åˆ¤æ–­ä¸º <code>true</code> ã€‚ç„¶åæ‰§è¡Œ <code>echo &quot;testing... &quot;</code> ã€‚</p>\n<p>ä»£ç ç¼–å†™å®Œåï¼Œæ•²å‡» <code>Esc</code> ï¼Œå†è¾“å…¥å†’å·ï¼Œå†è¾“å…¥ <code>wq</code> ï¼Œ <code>w</code>  æ˜¯ <code>write</code> ï¼Œ <code>q</code>  æ˜¯ <code>quit</code> ã€‚å›è½¦ï¼Œå³å¯ä¿å­˜é€€å‡ºã€‚åŒå­¦ï¼Œæˆ‘åŠä½ ä¸è¦ä¹±ç‚¹å•ŠğŸ¶ã€‚</p>\n<h1 id=\"ä¿®æ”¹æ–‡ä»¶æƒé™\"><a class=\"anchor\" href=\"#ä¿®æ”¹æ–‡ä»¶æƒé™\">#</a> ä¿®æ”¹æ–‡ä»¶æƒé™</h1>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ åˆšåˆ›å»ºçš„æ–‡ä»¶åªæœ‰è¯» <code>r</code>  å’Œå†™ <code>w</code>  çš„æƒé™ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ <code>x</code>  è¯¥æ–‡ä»¶çš„æƒé™ã€‚è¯·æŒ‰é¡ºåºè°ƒç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<ul>\n<li><code>chmod u+x test_1.sh</code> ï¼Œè¯¥å‘½ä»¤ä¸ºè„šæœ¬æ–‡ä»¶èµ‹äºˆå¯æ‰§è¡Œçš„æƒé™ï¼Œå…¶å®åˆ°è¿™é‡Œï¼Œä½ çš„è„šæœ¬æ–‡ä»¶å°±å¯ä»¥æ‰§è¡Œäº†ã€‚</li>\n<li><code>touch new_file</code>  åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åªæœ‰è¯»å’Œå†™çš„æƒé™</li>\n<li><code>ll</code> ï¼Œå…¶å®è¯¥å‘½ä»¤å°±æ˜¯ <code>ls -al</code>  çš„ç®€å†™ã€‚</li>\n</ul>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/28/2a7d3da1cb4c1b84.png\" alt=\"image-20220728155413986\" /></p>\n<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä¸‹é¢ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆç»¿è‰²ï¼‰æ¯” <code>new_File</code>  å¤šäº†ä¸€ä¸ª <code>x</code> ï¼Œè¿™å…¶å®å°±æ˜¯æ‰§è¡Œæƒé™ã€‚</p>\n<h1 id=\"è¿è¡Œè„šæœ¬æ–‡ä»¶\"><a class=\"anchor\" href=\"#è¿è¡Œè„šæœ¬æ–‡ä»¶\">#</a> è¿è¡Œè„šæœ¬æ–‡ä»¶</h1>\n<p>è¿è¡Œæ–‡ä»¶ï¼Œåªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./test_1.sh</pre></td></tr></table></figure><p>å…¶ä¸­ <code>./</code>  è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹ï¼Œ <code>test_1.sh</code>  æ˜¯æŒ‡å®šæ–‡ä»¶åã€‚ä¸ºä»€ä¹ˆéè¦åŠ  <code>./</code>  å‘¢ï¼Ÿæˆ‘æ˜æ˜å·²ç»åœ¨å½“å‰ç›®å½•ä¸‹äº†ï¼Œèƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ <code>test_1.sh</code>  æ¥è¿è¡Œå‘¢ï¼Ÿå¯ä»¥ï¼Œè¿™ä¸ªæ¶‰åŠåˆ°ç¯å¢ƒå˜é‡ï¼Œè¿™æ˜¯åè¯ï¼Œniceï¼ŒåˆæŒ–ä¸€ä¸ªå‘ï¼Œä½ è¦æ˜¯æ±‚çŸ¥å¿ƒåˆ‡ï¼Œå°±å»ç™¾åº¦å§ã€‚</p>\n<p>å“¦ï¼Œä½ æƒ³è¦åœä¸‹ä½ çš„è„šæœ¬è¿è¡Œï¼Œä½¿ç”¨ <code>ctrl+c</code>  å³å¯ã€‚</p>\n",
            "tags": [
                "shell"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/28/Database/MySQL/B-%E6%A0%91%E7%B4%A2%E5%BC%95/",
            "url": "https://cecilia.cool/2022/07/28/Database/MySQL/B-%E6%A0%91%E7%B4%A2%E5%BC%95/",
            "title": "B+æ ‘ç´¢å¼•",
            "date_published": "2022-07-28T01:42:18.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>æˆ‘ä»¬ä½¿ç”¨ sql è¯­å¥æŸ¥è¯¢æŸæ¡è®°å½•æ—¶</p>\n<pre><code class=\"language-mysql\">select * from è¡¨å where åˆ—å = xxx;\n</code></pre>\n<p><code>where</code>  åé¢è·Ÿç€çš„æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œæˆ‘ä»¬ä¹‹å‰å­¦çš„ï¼Œé¡µä¸­çš„è®°å½•æ˜¯æ ¹æ®ä¸»é”®æ’åºçš„ï¼ˆå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±æ ¹æ®ä¸èƒ½ä¸º NULL çš„å”¯ä¸€çš„æ•°æ®æ’åºï¼Œå¦‚æœè¿™æ ·çš„å±æ€§ä¹Ÿæ²¡æœ‰ï¼Œå°±æŒ‰ç…§ <code>row_id</code>  æ’åºï¼‰ã€‚</p>\n<p>é‚£ä¹ˆåœ¨æ²¡æœ‰åˆ›å»ºç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢æ¡ä»¶æ˜¯æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œé‚£ä¹ˆåœ¨é¡µä¸­å°±å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿè·å–æ•°æ®ï¼Œä½†æ˜¯å¦‚æœ <code>where</code>  åé¢è·Ÿç€çš„æ˜¯ä¸€ä¸ªéä¸»é”®å±æ€§ï¼Œé‚£ä¹ˆåœ¨é¡µä¸­å°±åªèƒ½ä» <code>Infimum</code>  åˆ° <code>Supremum</code>  ä¸€æ¡ä¸€æ¡çš„<strong>é¡ºåºæŸ¥æ‰¾</strong>ï¼Œ<strong>ä¸€ä¸‹å­å°±æ…¢å¾ˆå¤š</strong>ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ç§é«˜æ•ˆçš„æœç´¢æ–¹æ³• â€”â€” ç´¢å¼•ã€‚</p>\n<h1 id=\"ç´¢å¼•\"><a class=\"anchor\" href=\"#ç´¢å¼•\">#</a> ç´¢å¼•</h1>\n<p>å…ˆå»ºä¸€ä¸ªè¡¨ï¼Œåé¢æ–¹ä¾¿æ¼”ç¤ºä¾‹å­ã€‚</p>\n<pre><code class=\"language-mysql\">create table index_demo (\n    c1 int,\n    c2 int,\n    c3 char(1)ï¼Œ\n    primary key (c1)\n) row_format = COMPACT;\n</code></pre>\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªé¡µé»˜è®¤åªæœ‰ 16KBï¼Œå­˜å‚¨çš„è®°å½•æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨å¾€å¾€éœ€è¦å¾ˆå¤šä¸ªé¡µï¼Œ<strong>é¡µä¹‹é—´çš„è®°å½•ä¹Ÿå¿…é¡»ä¿æŒé¡ºåº</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>é¡µ A çš„è®°å½•ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µçš„è®°å½•ä¸»é”®å€¼ï¼Œå°äºä¸‹ä¸€é¡µçš„è®°å½•çš„ä¸»é”®å€¼</strong>ï¼ˆå½“ç„¶ï¼Œè¿™é‡Œé¢ä¸åŒ…å« <code>Infimum</code>  å’Œ <code>Supremum</code> ï¼‰ã€‚</p>\n<p>å‰æ–‡è®²é¡µç»“æ„æ—¶ï¼Œ <code>File Header</code>  ä¸­å¯¹äºé¡µå·çš„è§„å®šä½¿å¾—<strong>æ•°æ®é¡µä¹‹é—´è¿æˆåŒå‘é“¾è¡¨</strong>ï¼Œæˆ‘ä»¬æœŸæœ›ä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œå»ºç«‹ä¸€ä¸ªåˆ«çš„ç›®å½•ï¼Œè¯¥ç›®å½•å®ç°ï¼š</p>\n<ul>\n<li>ä¸‹ä¸€ä¸ªæ•°æ®é¡µçš„è®°å½•çš„ä¸»é”® &gt; ä¸Šä¸€ä¸ªæ•°æ®é¡µè®°å½•çš„ä¸»é”®ã€‚</li>\n</ul>\n<p>ä¸ºäº†å®ç°è¿™ä¸ªçŠ¶æ€ï¼Œå­˜åœ¨<strong>é¡µåˆ†è£‚</strong>çš„æœºåˆ¶ã€‚å‡è®¾ä¸Šä¸€ä¸ªé¡µå·²ç»æ»¡äº†ï¼Œæœ€åä¸€æ¡è®°å½•ä¸»é”®æ˜¯ 100ï¼Œç°åœ¨åˆåŠ å…¥ä¸€æ¡è®°å½•ï¼Œä¸»é”®ä¸º 90ã€‚é‚£ä¹ˆæ–°åŠ å…¥çš„è¿™æ¡è®°å½•å°±ä¼šæ”¾åˆ°è¯¥é¡µæœ«å°¾ï¼Œä¸»é”®ä¸º 100 çš„è®°å½•ä¼šè¢«åˆ†åˆ°æ–°çš„ä¸€ä¸ªé¡µã€‚</p>\n<ul>\n<li>ç»™æ‰€æœ‰é¡µå»ºç«‹ä¸€ä¸ª<strong>ç›®å½•é¡¹</strong></li>\n</ul>\n<p>æ­¤å¤„æ˜¯å…³äºé¡µçš„ç›®å½•å…¶å®å¯¹äºé¡µçš„æŸ¥æ‰¾ä¹Ÿæ˜¯äºŒåˆ†ï¼ˆå°±æ˜¯æ ¹æ®é¡µç›®å½•ï¼Œä¹‹å‰çš„æ§½ <code>Slot</code>  æ˜¯å…³äºè®°å½•çš„ <code>Page Directory</code> ï¼‰ã€‚<strong>æ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªç›®å½•é¡¹</strong>ï¼Œæ¯ä¸ª<strong>ç›®å½•é¡¹</strong>åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š<strong>é¡µçš„æœ€å°ä¸»é”®å€¼</strong> +<strong> é¡µå·</strong> <code>page_no</code> ã€‚æ’å…¥è®°å½•æ—¶ï¼Œæ ¹æ®ä¸»é”®å€¼ï¼Œåœ¨æ‰€æœ‰<strong>ç›®å½•é¡¹</strong>ä¸‹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åˆé€‚çš„é¡µåï¼Œæ ¹æ®é¡µä¸­çš„ <code>Page Directory</code>  è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œç„¶åé¡µåˆ†è£‚ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚æœ€é‡è¦çš„å°±æ˜¯ï¼Œè¿™ä¸ªç›®å½•å°±å« â€”â€”<strong> ç´¢å¼•</strong>ã€‚</p>\n<h2 id=\"ç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#ç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ\">#</a> ç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ</h2>\n<p>ä¸ºäº†å®ç°é€šè¿‡<strong>ç›®å½•é¡¹</strong>æ¥è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ä¹Ÿè¦<strong>ç®¡ç†ç›®å½•é¡¹</strong>ï¼Œä½¿å…¶åœ¨å¢åˆ æ”¹æŸ¥æ—¶ä¿æŒæœ‰åºï¼Œæ‰€ä»¥ä¹ŸæŠŠå®ƒä»¬æ”¾åœ¨é¡µä¸­è¿›è¡Œç®¡ç†ï¼Œè¿™ç§è®°å½•å°±æ˜¯<strong>ç›®å½•é¡¹è®°å½•</strong> <code>record_type = 1</code> ï¼ˆä½ è¿˜è®°å¾— <code>record_type</code>  ä¸º 0ï¼Œ2ï¼Œ3 æ—¶æ˜¯ä»€ä¹ˆæ„æ€å—ï¼‰, è¯¥è®°å½•ä¹Ÿå°±åªæœ‰ä¸»é”®å€¼å’Œé¡µå·ï¼Œ<strong>å½“ç„¶å¤´ä¿¡æ¯ä¹Ÿæ˜¯å­˜åœ¨çš„</strong>ï¼Œå› ä¸ºåªæœ‰ä¸»é”®å€¼ï¼ˆå¦‚æœä¸æ˜¯å˜é•¿å­—æ®µæˆ–å˜é•¿å­—ç¬¦é›†ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼Œä¹Ÿæ²¡æœ‰ NULL åˆ—è¡¨ã€‚</p>\n<p>ä¸æ–­ç´¯ç§¯ï¼Œç›®å½•é¡¹é¡µä¹Ÿå­˜åœ¨ç›®å½•é¡¹ï¼Œè¿™æ ·çš„ç›®å½•é¡¹åˆè¢«æ”¾è¿›æ–°çš„ç›®å½•é¡¹é¡µï¼ˆåªä¸è¿‡åœ¨ä¸Šä¸€å±‚ï¼‰ï¼Œä¸æ–­å‘ä¸Šé€’å½’ï¼Œå½¢æˆ B + æ ‘ã€‚</p>\n<p>è¯´äº†é‚£ä¹ˆå¤šï¼Œä¸çœ‹å›¾æ€»æ˜¯æ‡µé€¼çš„ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/28/f4fdab5241230111.png\" alt=\"image-20220728104845461\" /></p>\n<p>è¿™ä¸ªå›¾ç”»çš„æˆ‘éš¾å—ã€‚ã€‚ã€‚ã€‚</p>\n<p>ä¸Šå›¾ä¸ºäº†ç®€ç•¥ï¼Œä¸€ä¸ªè®°å½•çš„å†…å®¹æˆ‘åªç”»äº†ï¼š <code>record_type</code> + <code>next_record</code> + <code>c1</code> + <code>c2</code> + <code>c3</code> ã€‚</p>\n<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çœŸæ­£çš„è®°å½•æ˜¯æ”¾åœ¨ B + æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹ï¼Œå­˜æ”¾ç›®å½•é¡¹è®°å½•çš„éƒ½æ˜¯å†…èŠ‚ç‚¹ã€‚</p>\n<p><code>Page Header</code>  é‡Œé¢æœ‰ä¸ªå±æ€§å°±æ˜¯ <code>PAGE_LEVEL</code>  è¡¨ç¤ºè¯¥é¡µåœ¨ B + æ ‘ä¸­çš„å±‚çº§ã€‚å…¶å®æˆ‘ä»¬è°ˆç´¢å¼•ï¼Œä»€ä¹ˆå¯¹æŸä¸ªå±æ€§ A åˆ›å»ºç´¢å¼•ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä»¥ A æ’åºçš„ B + æ ‘ï¼ˆå½“ç„¶ï¼Œè¿™ä¹ˆè¯´ä¸å‡†ç¡®ï¼ŒB + æ ‘å†…å®¹ä¸åŒï¼Œä½†æ˜¯ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼‰ã€‚æˆ‘ä»¬ä¸€å¼€å§‹åˆ›å»ºè¡¨ï¼ŒæŒ‡å®š <code>c1</code>  ä¸ºä¸»é”®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ’å…¥è®°å½•æ—¶ï¼Œ <code>InnoDB</code>  å°±ä¼šç»´æŠ¤ä¸Šå›¾çš„ B + æ ‘ï¼Œä½¿å…¶æœ‰åºã€‚å¦‚æœæˆ‘ä»¬åˆ›å»ºå…³äº <code>c2</code>  çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªå…³äº <code>c2</code>  æ’åºçš„ B + æ ‘ã€‚</p>\n<blockquote>\n<p>ç´¢å¼•çš„ B + æ ‘å’ŒçœŸæ­£çš„ä¸»é”®çš„ B + æ ‘æœ‰ä»€ä¹ˆä¸åŒï¼Œä¹‹åè®²åˆ°å›è¡¨ä½ å°±æ‡‚äº†</p>\n</blockquote>\n<h2 id=\"ç´¢å¼•ç§ç±»\"><a class=\"anchor\" href=\"#ç´¢å¼•ç§ç±»\">#</a> ç´¢å¼•ç§ç±»</h2>\n<p><strong>èšç°‡ç´¢å¼•</strong>ï¼šåœ¨ InnoDB ä¸­ï¼Œèšç°‡ç´¢å¼•å°±æ˜¯æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œæ‰€æœ‰è®°å½•éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼Œâ€œç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•â€</p>\n<p>äºŒçº§ç´¢å¼•ï¼šèšç°‡ç´¢å¼•åªæœ‰åœ¨æœç´¢æ¡ä»¶ä¸ºä¸»é”®æ—¶æ‰èƒ½å‘æŒ¥ä½œç”¨ï¼Œå¦‚æœä»¥å…¶ä»–åˆ—ä¸ºæœç´¢æ¡ä»¶ï¼Œå°±è¦åˆ›å»ºå…³äºä»–ä»¬çš„ç´¢å¼•ï¼ˆB + æ ‘ï¼‰æ‰è¡Œï¼Œè¿™å°±æ˜¯äºŒçº§ç´¢å¼•ã€‚å‡è®¾å¯¹ <code>c2</code>  åˆ›å»ºç´¢å¼•ï¼Œè¯¥äºŒçº§ç´¢å¼• B + æ ‘çš„å¶å­èŠ‚ç‚¹çš„è®°å½•å­˜å‚¨çš„å°±æ˜¯<strong> c2 + ä¸»é”®å€¼</strong>ã€‚å½“æˆ‘ä»¬åœ¨äºŒçº§ç´¢å¼•ä¸­æ‰¾åˆ°å¯¹åº”çš„ <code>c2</code> ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œç„¶å<strong>å†å»èšç°‡ç´¢å¼•ä¸­æ‰¾åˆ°çœŸæ­£å®Œæ•´çš„æ•°æ®ï¼Œè¿™å°±æ˜¯å›è¡¨</strong>ã€‚äºŒçº§ç´¢å¼•ä¹‹æ‰€ä»¥ä¸å­˜å‚¨å®Œæ•´çš„è®°å½•ï¼Œ<strong>é‚£è‚¯å®šæ˜¯ä¸ºäº†èŠ‚çœç©ºé—´å•Š</strong>ã€‚</p>\n<p>è”åˆç´¢å¼•ï¼šå…¶æœ¬è´¨å°±æ˜¯äºŒçº§ç´¢å¼•ï¼Œå› ä¸ºæœ‰æ—¶æˆ‘ä»¬ä¼šè¿™ä¹ˆæŸ¥è¯¢</p>\n<pre><code class=\"language-mysql\">select * from index_demo where c2 = 1 and c3 = '1';\n</code></pre>\n<p>æ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶å°±è¦åˆ›å»ºå…³äº <code>c2,c3</code>  çš„è”åˆç´¢å¼•ã€‚</p>\n<p>ä¸€ä¸ªç´¢å¼•çš„æ ¹é¡µé¢ï¼Œä¸€æ—¦è¢«åˆ›å»ºï¼Œå…¶é¡µå·å°±ä¸ä¼šæ”¹å˜ã€‚ä¸€å¼€å§‹æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œæ¯å½“å­˜åœ¨æ•°æ®æ’å…¥ï¼Œéƒ½æ˜¯åœ¨è¿™ä¸ªæ ¹èŠ‚ç‚¹ä¸‹æ’å…¥</p>\n<h1 id=\"sqlè¯­å¥\"><a class=\"anchor\" href=\"#sqlè¯­å¥\">#</a> sql è¯­å¥</h1>\n<pre><code class=\"language-mysql\"># keyå’Œindexæ˜¯åŒä¹‰è¯ï¼Œéšä¾¿æŒ‡å®šä¸€ä¸ªå³å¯\ncreate table è¡¨å (\n    å„ä¸ªåˆ—ä¿¡æ¯\n    (key|index) ç´¢å¼•å (è¦æŒ‡å®šçš„åˆ—)\n)\n\nalter table è¡¨å add (key|index) ç´¢å¼•å (è¦æŒ‡å®šçš„åˆ—)\n\n# åˆ é™¤ç´¢å¼•\nalter table drop (index|key) ç´¢å¼•å\n</code></pre>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/26/Database/MySQL/InnoDB%E9%A1%B5%E7%BB%93%E6%9E%84/",
            "url": "https://cecilia.cool/2022/07/26/Database/MySQL/InnoDB%E9%A1%B5%E7%BB%93%E6%9E%84/",
            "title": "InnoDBé¡µç»“æ„",
            "date_published": "2022-07-26T02:49:58.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>ä¹‹å‰è¯´è¿‡ï¼Œé¡µæ˜¯ InnoDB<strong> ç®¡ç†ç£ç›˜ç©ºé—´</strong>çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªé¡µçš„å¤§å°åŸºæœ¬ä¸Šæ˜¯ 16KBã€‚MySQL è§„å®šä¸€é¡µè‡³å°‘å­˜ä¸¤æ¡è®°å½•ã€‚æˆ‘ä»¬ä»å®¢æˆ·ç«¯å†™å…¥è¡¨ä¸­çš„è®°å½•ä¼šè¢«å­˜åœ¨é¡µä¸­ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§è®°å½•ï¼Œå®ƒå­˜åœ¨äº B + æ ‘çš„éå¶å­èŠ‚ç‚¹çš„é¡µä¸­ï¼Œå…¶å¤´ä¿¡æ¯ä¸­çš„ <code>record_type=1</code> ã€‚</p>\n<p>ç›®å‰ä½ åªéœ€ç†è§£ï¼Œé¡µä¸­å­˜å‚¨çš„è®°å½•è¦ä¹ˆæ˜¯æˆ‘ä»¬ä»å®¢æˆ·ç«¯å†™å…¥çš„çœŸå®çš„è®°å½• <code>record_type=0</code> ã€‚è¿™æ ·çš„é¡µç§°ä¸º<strong>ç´¢å¼•é¡µ</strong>ï¼›å¦ä¸€ä¸ªæ˜¯ B + æ ‘éå¶å­èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½• <code>record_type=1</code> ã€‚</p>\n<h2 id=\"é¡µç»“æ„\"><a class=\"anchor\" href=\"#é¡µç»“æ„\">#</a> é¡µç»“æ„</h2>\n<p>æœ¬èŠ‚å†…å®¹ä¸»è¦æ˜¯å°±è¦äº†è§£é¡µçš„å¤§è‡´ç»“æ„å’Œå…¶å­˜å‚¨è®°å½•çš„æ–¹å¼ï¼Œä¸‹å›¾ä¸ºä¸€ä¸ªé¡µçš„åŸºæœ¬ç»“æ„ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/55c753f812c612e5.png\" alt=\"image-20220726110822415\" /></p>\n<p>ä¹‹åæˆ‘ä»¬ä¼šå¯¹å…¶ä¸­çš„ç»“æ„ä¸€ ä¸€è®²è§£ã€‚ä½†æ˜¯ç›´æ¥ç»™å‡ºå¾ˆå¤šæ¦‚å¿µä¼šè®©ä½ å¤±å»é˜…è¯»å…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è®°å½•æ€ä¹ˆåœ¨é¡µä¸­å­˜å‚¨ã€‚</p>\n<h2 id=\"è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨\"><a class=\"anchor\" href=\"#è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨\">#</a> è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨</h2>\n<p>è¯·çœ‹ä¸Šå›¾çš„ <code>User Records</code>  å’Œ <code>Free Space</code> ï¼Œæˆ‘ä»¬çš„è®°å½•å°±å­˜æ”¾åœ¨ <code>User Records</code> ï¼Œå¦‚æœ <code>User Records</code>  çš„ç©ºé—´ä¸å¤Ÿäº†ï¼Œå°±å‘ <code>Free Space</code>  å»ç”³è¯·ç©ºé—´ã€‚æ‰€ä»¥ä¸€ä¸ªé¡µåˆšå¼€å§‹åˆ›å»ºçš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰ <code>User Records</code>  çš„ã€‚å½“ <code>Free Space</code>  å…¨éƒ¨è¢« <code>User Record</code>  ä»£æ›¿æ—¶ï¼Œè¯¥é¡µå°±æ»¡äº†ã€‚æ­å–œï¼Œé¡µç»“æ„ä¸ƒä¸ªæ¦‚å¿µä½ å·²ç»æ‡‚äº†ä¸¤ä¸ªã€‚</p>\n<p>æˆ‘ä»¬çš„è®°å½•åœ¨ <code>User Record</code>  é‡Œé¢æ˜¯ä¸€æ¡ä¸€æ¡æ‘†æ”¾è¿›å»çš„ï¼Œä½†æ˜¯æˆ‘ç°åœ¨è¦æä¸€ä¸‹ä¸€æ¡è®°å½•é‡Œçš„<strong>å¤´ä¿¡æ¯</strong>ï¼ˆä½ ä¸ä¼šå·²ç»å¿˜äº†ä»€ä¹ˆæ˜¯å¤´ä¿¡æ¯äº†å§ï¼Œä¸ä¼šå§ï¼Œä¸ä¼šå§ï¼‰ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/81205e50ebf500f5.png\" alt=\"image-20220725112044762\" /></p>\n<p><code>record_type</code>  å¯ä»¥æ˜¯ï¼Œ0-- æ™®é€šè®°å½•ï¼Œ1--B + æ ‘éå¶å­èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•ï¼Œ2--Infimumï¼Œ3--supremumã€‚è¯·çœ‹é¡µç»“æ„å›¾ï¼Œçº¢è‰²åŒºåŸŸå°±æ˜¯ <code>Infimum,supremum</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªé¡µå›ºå®šéƒ½æœ‰è¿™ä¸¤æ¡è®°å½•ï¼Œä»–ä»¬ä»£è¡¨æ‰€æœ‰è®°å½•ä¸­çš„æœ€å°è®°å½•ï¼ˆé“¾è¡¨å¤´èŠ‚ç‚¹ï¼‰ä»¥åŠæ‰€æœ‰è®°å½•ä¸­çš„æœ€å¤§è®°å½•ï¼ˆé“¾è¡¨å°¾èŠ‚ç‚¹ï¼‰ï¼Œ** å°½ç®¡å®ƒä»¬æ²¡æœ‰ä¸»é”®å€¼ï¼Œä½†å®ƒä»¬å°±æ˜¯æœ€å°å’Œæœ€å¤§ã€‚** è¿™ä¸¤æ¡è®°å½•æ²¡æœ‰å®é™…å†…å®¹ï¼Œä½†è¿™æ˜¯è§„å®šï¼è¿™æ ·æ¯æ¬¡æŸ¥è¯¢è®°å½•æ—¶ï¼Œéƒ½èƒ½ä»ä¸€ä¸ªå›ºå®šçš„èµ·ç‚¹æŸ¥è¯¢ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/986c7070b2da0836.png\" alt=\"image-20220726131306378\" /></p>\n<p><code>User Record</code>  é‡Œé¢çš„è®°å½•æ’åˆ—ç´§å¯†ï¼Œä¸€æ¡ç´§æ¥å¦ä¸€æ¡ã€‚è¿™ä¸ªå…¶å®å°±æ˜¯å †ï¼Œ <code>heap_no</code>  å°±æ˜¯è¯¥è®°å½•åœ¨å †ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚æ¯”å¦‚æˆ‘é¡ºåºå†™å…¥äº† a,b,c ä¸‰æ¡è®°å½•ï¼Œå®ƒä»¬çš„ <code>heap_no</code>  å°±æ˜¯ 2ï¼Œ3ï¼Œ4ã€‚è‡³äº 0 å’Œ 1ï¼Œå®ƒä»¬æ˜¯ <code>Infimum,supremum</code>  çš„ <code>heap_no</code>  å€¼ã€‚å…¶å®ä»å›¾å°±å¯ä»¥çœ‹å‡ºï¼Œ <code>Infimum,supremum</code>  åœ¨ <code>User_record</code>  ä¸Šé¢ã€‚</p>\n<h3 id=\"next_recordçš„è®¡ç®—\"><a class=\"anchor\" href=\"#next_recordçš„è®¡ç®—\">#</a> next_record çš„è®¡ç®—</h3>\n<p>å¾ˆå¥½ï¼Œè¿›å…¥åˆ°äº†å–œé—»ä¹è§çš„è®¡ç®—ç¯èŠ‚ï¼Œæˆ‘ä¼šå°½é‡è®©ä½ æ‡‚çš„ã€‚</p>\n<p><code>next_record</code>  ä¸å°±æ˜¯æŒ‡å‘ä¸‹ä¸€æ¡è®°å½•å˜›ï¼Œé‚£å®ƒæŒ‡å‘ä¸‹ä¸€æ¡è®°å½•çš„é‚£ä¸ªéƒ¨ä½å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œå¤´ä¿¡æ¯å³è¾¹æ˜¯é»˜è®¤æ·»åŠ æ•°æ®ï¼ˆå°±æ˜¯ row_id,trx_id,roll_pointer)ï¼Œæ¥ç€æ˜¯çœŸå®ä¿¡æ¯ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/e4c3645b69edae43.png\" alt=\"image-20220726115106879\" /></p>\n<p><code>next_record</code>  æŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®ä¿¡æ¯ï¼Œå…¶å®å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä»¥å­—èŠ‚ä¸ºå•ä½çš„åç§»é‡ã€‚æ¯”å¦‚ç¬¬å››æ¡è®°å½•çš„ <code>next_record=-111</code> , å°±æ˜¯æŒ‡ä»ç¬¬å››æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€å¼€å§‹ï¼Œä¸Šå‰æ‰¾ 111 ä¸ªå­—èŠ‚å°±æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„åœ°å€ã€‚</p>\n<p>æ‰€ä»¥ï¼Œé¡µä¸­çš„è®°å½•å› ä¸º <code>next_record</code>  è€Œå½¢æˆäº†é“¾è¡¨ï¼Œåœ¨æ’å…¥æ–°çš„è®°å½•æ—¶ï¼ŒInnoDB å§‹ç»ˆç»´æŠ¤é“¾è¡¨ä¸­èŠ‚ç‚¹çš„ä»å°åˆ°å¤§çš„é¡ºåºï¼ˆç»´æŠ¤é¡ºåºå½“ç„¶æ˜¯ä¸ºäº†äºŒåˆ†æŸ¥æ‰¾ï¼‰ã€‚</p>\n<p>ä¸ºäº†è®©è¯»è€…æ„Ÿå—ä¸€ä¸‹ <code>next_record</code>  çš„è®¡ç®—è¿‡ç¨‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ç©ä¸€ä¸‹</p>\n<pre><code class=\"language-mysql\">create table test_next_record (\n\tc1 int,\n    c2 int,\n    c3 varchar(10000),\n    primary key (c1)\n) character set acsii,row_format=COMPACTï¼›\n#ä½¿ç”¨ asciiå­—ç¬¦é›†ï¼Œä¸€ä¸ªå­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤º \n\n#æ’å…¥ä¸€æ¡æ•°æ®\ninsert into test_next_record values(1,100,'aaaa');\n</code></pre>\n<p>é‚£ä¹ˆåœ¨é¡µä¸­å®é™…æ˜¯è¿™ä¸ªæ ·å­çš„</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/71735b9e7f52f0b7.png\" alt=\"image-20220726130854616\" /></p>\n<p><code>Infimum</code>  ä¸­çš„ 41 æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼š <code>Infimum</code> 8 å­—èŠ‚ <code>+Supremum</code>  æ•´æ¡è®°å½• 13 å­—èŠ‚ + å˜é•¿å­—æ®µ 1 å­—èŠ‚ + NULL å€¼åˆ—è¡¨ 1 å­—èŠ‚ + å¤´ä¿¡æ¯ 5 å­—èŠ‚ + <code>trx_id</code> 6 å­—èŠ‚ + <code>roll_pointer</code> 7 å­—èŠ‚ = 41 å­—èŠ‚ã€‚</p>\n<p><code>next_record</code>  æŒ‡å‘çœŸå®ä¿¡æ¯å’Œå¤´ä¿¡æ¯ä¸­é—´ï¼Œè¿™ä¸ªä½ç½®åˆšåˆšå¥½ï¼Œå‘å·¦æ˜¯ NULL å€¼åˆ—è¡¨ï¼ˆé€†åºå­˜æ”¾ï¼‰å’Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼ˆé€†åºå­˜æ”¾ï¼‰ï¼Œå‘å³æ˜¯çœŸå®ä¿¡æ¯ã€‚é€†åºå¯ä»¥ä½¿å¾—è®°å½•ä¸­é å‰çš„å­—æ®µå’Œå®ƒä»¬å¯¹åº”çš„å­—æ®µé•¿åº¦åˆ—è¡¨åœ¨å†…å­˜ä¸­é å¾—æ›´è¿‘ï¼Œå¯èƒ½ä¼š<strong>æé«˜ç¼“å­˜å‘½ä¸­ç‡</strong>ã€‚</p>\n<h2 id=\"file-header\"><a class=\"anchor\" href=\"#file-header\">#</a> File Header</h2>\n<p>æ ¡éªŒå’Œï¼šå¯¹äºä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡ç®—æ³•è®¡ç®—å‡ºæ¯”è¾ƒçŸ­çš„å€¼ä»£è¡¨è¿™ä¸ªé•¿å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå€¼å°±æ˜¯æ ¡éªŒå’Œã€‚</p>\n<table>\n<thead>\n<tr>\n<th>å±æ€§</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>FIL_PAGE_SPACE_OR_CHKSUM</td>\n<td>(4Byte) ç©ºé—´æˆ–æ ¡éªŒå’Œï¼ŒMySQL ç‰ˆæœ¬ä½äº 4.0.14 æ—¶ï¼Œè¯¥å±æ€§è¡¨ç¤ºæœ¬é¡µé¢æ‰€åœ¨çš„<strong>è¡¨ç©ºé—´ ID</strong>ï¼›ä¹‹åçš„ç‰ˆæœ¬è¡¨ç¤ºé¡µçš„<strong>æ ¡éªŒå’Œ</strong></td>\n</tr>\n<tr>\n<td>FIL_PAGE_OFFSET</td>\n<td><strong>é¡µå·</strong>ï¼Œå¯¹äºé¡µå·çš„åˆ†é…ï¼Œå¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>ä½¿ç”¨çš„é¡µåœ¨ç£ç›˜ä¸Šå¯èƒ½å¹¶ä¸æŒ¨ç€ï¼ˆå½“ç„¶æ˜¯å°½å¯èƒ½æŒ¨ç€ï¼‰</strong></td>\n</tr>\n<tr>\n<td>FIL_PAGE_PREV</td>\n<td>ä¸Šé¡µçš„é¡µå·</td>\n</tr>\n<tr>\n<td>FIL_PAGE_NEXT</td>\n<td>ä¸‹é¡µçš„é¡µå·ï¼ˆå½¢æˆåŒå‘é“¾è¡¨ï¼‰</td>\n</tr>\n<tr>\n<td>FIL_PAGE_TYPE</td>\n<td><strong>é¡µçš„ç±»å‹</strong></td>\n</tr>\n<tr>\n<td>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</td>\n<td>é¡µå±äºå“ªä¸ªè¡¨ç©ºé—´</td>\n</tr>\n<tr>\n<td>FIL_PAGE_LSN</td>\n<td>é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„ LSNï¼ˆLog Sequence Numberï¼Œæ—¥å¿—åºåˆ—å·ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<p>è¡¨æ ¼ä¸­å†…å®¹çœ‹èµ·æ¥æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ¢³ç†ä¸€ä¸‹å°±å¾ˆæ¸…æ™°ã€‚</p>\n<p>é¦–å…ˆï¼ŒMySQL å…·æœ‰è‰¯å¥½çš„å¥å£®æ€§ï¼Œæ¯”å¦‚å†…å­˜ä¸­çš„é¡µ<strong>æ­£åœ¨</strong>è¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶çªç„¶æ–­ç”µäº†ï¼Œå¯¼è‡´åˆ·æ–°æ—¶åªåˆ·äº†ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ ¡éªŒå’Œæ¥åˆ¤æ–­ä¸€ä¸ªé¡µæ˜¯å¦è¢«å®Œæ•´çš„åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œè¿™ä¸ªåœ¨ <code>File Trailer</code>  éƒ¨åˆ†ä¼šè®²è§£åˆ°ã€‚</p>\n<p>å…¶å®ï¼ŒB + æ ‘çš„èŠ‚ç‚¹å°±æ˜¯é¡µï¼Œé¡µä¸é¡µä¹‹é—´å½¢æˆä¸€ä¸ªå¤šå‰æ ‘çš„åŒæ—¶ï¼ŒåŒä¸€å±‚çš„èŠ‚ç‚¹åˆå½¢æˆåŒå‘é“¾è¡¨ã€‚</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/26/d5d6dec569020c94.png\" alt=\"image-20220726112224302\" /></p>\n<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±è®°ä½äº†ä¸­é—´ä¸‰ä¸ªå±æ€§ã€‚æœ€åçš„ <code>FIL_PAGE_TYPE</code>  è¡¨ç¤ºé¡µçš„ç±»å‹ï¼Œè‚¯å®šå•Šï¼ŒMySQL è¿™ä¹ˆå¤§ï¼Œè‚¯å®šä¸å¯èƒ½åªæœ‰ 1 ç§é¡µã€‚</p>\n<h2 id=\"page-directory\"><a class=\"anchor\" href=\"#page-directory\">#</a> Page Directory</h2>\n<p>ç°åœ¨è®°å½•é€šè¿‡ <code>next_record</code>  è¿æˆäº†ä¸€ä¸ªæœ‰åºå•å‘é“¾è¡¨ï¼Œå¯¹é“¾è¡¨ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å°†è®°å½•åˆ†ä¸ºè‹¥å¹²ç»„ï¼Œæ¯ä¸ªç»„æœ€å¤§çš„é‚£ä¸ªè®°å½•ï¼Œå…¶ <code>n_owned</code>  è¡¨ç¤ºè¯¥ç»„è®°å½•æ•°ã€‚</li>\n<li>å°†æ¯ç»„æœ€å¤§è®°å½•çš„åœ°å€åç§»é‡æ‹¿å‡ºæ¥ï¼ŒæŒ‰é¡ºåºæ’åˆ—åœ¨ <code>Page Dierctory</code>  ä¸­ã€‚</li>\n<li>è¿™äº›åç§»é‡è¢«ç§°ä¸ºæ§½ -- <code>slot</code> ï¼Œæ¯ä¸ªæ§½ä½ 2 å­—èŠ‚ï¼Œ <code>Page Dierctory</code>  å°±æ˜¯ç”±è‹¥å¹²ä¸ªæ§½ç»„æˆã€‚</li>\n<li>ä½ å¯ä»¥æŠŠä¸€ä¸ªä¸ªé¡ºåºæ’åˆ—çš„æ§½çœ‹ä½œä¸€ä¸ªæ•°ç»„ï¼Œæ§½å¯¹åº”çš„è®°å½•è¶Šå°ï¼Œå°±è¶Šæ¥è¿‘ <code>File Trailer</code> ã€‚</li>\n</ul>\n<p>å…³é”®çš„é—®é¢˜æ˜¯æ€ä¹ˆåˆ†ç»„ï¼Œæœºåˆ¶ä¸ºï¼š</p>\n<ul>\n<li>å¯¹äº <code>Infimum</code>  è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼Œåªèƒ½æœ‰ä¸€æ¡è®°å½•ã€‚å³æœ€é è¿‘ <code>File Trailer</code>  çš„æ§½å§‹ç»ˆæ˜¯ <code>Infimum</code> ã€‚</li>\n<li>å¯¹äº <code>supermum</code>  è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼Œå¯ä»¥æœ‰ 1~8 æ¡è®°å½•ã€‚</li>\n<li>å…¶ä½™ç»„åªèƒ½æœ‰ 4~8 æ¡è®°å½•ï¼Œå¦‚æœç»„ä¸­è®°å½•å¤§äº 8 æ¡ï¼Œä¼š 4,5 åˆ†ä¸ºä¸¤ç»„ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>slot</code> ã€‚</li>\n<li>æ¯æ¬¡æ’å…¥ä¸€æ¡è®°å½•ï¼Œè¯¥è®°å½•éƒ½ä¼šä»é¡µç›®å½•ä¸­å¯»æ‰¾å¯¹åº”è®°å½•çš„ä¸»é”®å€¼æ¯”å¾…æ’å…¥è®°å½•ä¸»é”®å€¼å¤§ä¸”å·®å€¼æœ€å°çš„ <code>slot</code> ï¼ˆç„¶åæ‰¾åˆ°å‰ä¸€ä¸ªæ§½ Aï¼ŒA å¯¹åº”çš„è®°å½•å¼€å§‹éå†æ’å…¥å³å¯ï¼‰</li>\n</ul>\n<p>é…åˆè¿™ç§æœºåˆ¶ï¼Œå“ªæ€•è®°å½•æ’å…¥è¡¨ä¸­ï¼Œè®°å½•åœ¨æ¯ä¸ªæ§½ä¸­ä¹Ÿä¼šä¿æŒæœ‰åºï¼Œå¹¶ä¸”æ¯ä¸ªç»„ä¸­è®°å½•çš„ä¸»é”®é€æ¸ç´§å‡‘ã€‚</p>\n<p>ä¸‹å›¾çœç•¥äº†è®°å½•ä¹‹é—´çš„è¿æ¥ï¼š</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/27/350085bbd3bc62f9.png\" alt=\"image-20220727133511829\" /></p>\n<p>ä¸Šå›¾ç›¸å½“äºæ˜¯ï¼š <code>slot_0=Infimum</code> ï¼Œ <code>slot_1=4</code> ï¼Œ <code>slot_2=Supremum</code> ã€‚å‡è®¾è¦æŸ¥è¯¢è®°å½• 7ï¼Œå°±ç›¸å½“äºåœ¨æ•°ç»„ <code>[Min,4,Max]</code>  é‡Œé¢è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæœ€åæ‰¾åˆ° 4ï¼Œè®°å½• 4 çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æ§½ 2 çš„ç»„çš„è®°å½•ï¼Œå°±ç›¸å½“äºéå†æ§½ 2 çš„ç»„ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡è®°å½•ã€‚</p>\n<h2 id=\"page-header\"><a class=\"anchor\" href=\"#page-header\">#</a> Page Header</h2>\n<p>æ€»å…± 56 å­—èŠ‚ï¼Œè¯¥ç»“æ„æ˜¯å­˜å‚¨æ•°æ®é¡µä¸­è®°å½•çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚é¡µä¸­çš„è®°å½•æ•°ï¼Œ <code>Free Space</code>  çš„åç§»é‡ï¼Œé¡µç›®å½•æœ‰å¤šå°‘ä¸ªæ§½ç­‰ã€‚ä¸‹å›¾åªæ˜¯éƒ¨åˆ†ç»“æ„ï¼Œæ²¡æœ‰å†™å®Œï¼Œè®°ä¸ä½é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯çœ‹åˆ°è¿™é‡Œï¼Œä¸‹é¢çš„éƒ¨åˆ†å±æ€§ä½ è‚¯å®šå¾ˆç†Ÿæ‚‰ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>å±æ€§</th>\n<th>é•¿åº¦</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>PAGE_HEAP_TOP</td>\n<td>2Byte</td>\n<td>è¿˜æœªä½¿ç”¨çš„ç©ºé—´çš„æœ€å°åœ°å€ï¼Œå‘åèµ°å°±æ˜¯ Free Space</td>\n</tr>\n<tr>\n<td>PAGE_N_HEAP</td>\n<td>2Byte</td>\n<td>ç¬¬ 1 ä½è¡¨ç¤ºæ˜¯å¦ä¸ºç´§å‡‘å‹è®°å½•ï¼Œå‰©ä½™çš„ 15 ä½è¡¨ç¤ºæœ¬é¡µçš„å †ä¸­çš„è®°å½•ï¼ˆåŒ…æ‹¬ Infimumu,supermum å’Œå·²åˆ é™¤è®°å½•ï¼‰</td>\n</tr>\n<tr>\n<td>PAGE_FREE</td>\n<td>2Byte</td>\n<td>åƒåœ¾é“¾è¡¨å¤´èŠ‚ç‚¹å¯¹åº”è®°å½•åœ¨é¡µé¢ä¸­çš„åç§»é‡</td>\n</tr>\n<tr>\n<td>PAGE_GARBAGE</td>\n<td>2Byte</td>\n<td>å·²åˆ é™¤è®°å½•å ç”¨çš„å­—èŠ‚æ•°</td>\n</tr>\n<tr>\n<td>PAGE_DIRECTION</td>\n<td>2Byte</td>\n<td>è®°å½•æ’å…¥çš„æ–¹å‘ï¼Œå‘åæ˜¯ right</td>\n</tr>\n<tr>\n<td>PAGE_N_DIRECTION</td>\n<td>2Byte</td>\n<td>è®°å½•è¿ç»­æ’å…¥åŒä¸€ä¸ªæ–¹å‘çš„è®°å½•æ¡æ•°ï¼Œå½“æ’å…¥æ–¹å‘ä¸åŒæ—¶ï¼Œé©¬ä¸Šé‡ç½®åˆ·æ–°</td>\n</tr>\n<tr>\n<td>PAGE_N_RECS</td>\n<td>2Byte</td>\n<td>è¯¥é¡µç”¨æˆ·è®°å½•çš„æ•°é‡ï¼ˆä¸åŒ…æ‹¬ Infimumu,supermum å’Œå·²åˆ é™¤è®°å½•ï¼‰</td>\n</tr>\n<tr>\n<td>PAGE_MAX_TRX_ID</td>\n<td>8Byte</td>\n<td>ä¿®æ”¹å½“å‰é¡µçš„æœ€å¤§äº‹åŠ¡ idï¼Œè¯¥å€¼ä»…åœ¨äºŒçº§ç´¢å¼•é¡µé¢ä¸­å®šä¹‰</td>\n</tr>\n<tr>\n<td>PAGE_LEVEL</td>\n<td>2Byte</td>\n<td>2Byte, è¯¥é¡µåœ¨ B + æ ‘ä¸­çš„å±‚çº§</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"file-trailer\"><a class=\"anchor\" href=\"#file-trailer\">#</a> File Trailer</h1>\n<p>åœ¨ <code>File Header</code>  æåˆ°è¿‡æ ¡éªŒå’Œã€‚å¦‚æœé¡µä»å†…å­˜åˆ·æ–°åˆ°ç£ç›˜ä¸­æ–­ç”µäº†ï¼Œå¯¼è‡´ä¹‹åˆ·æ–°äº†ä¸€éƒ¨åˆ†åˆ°ç£ç›˜ä¸­è¯¥æ€ä¹ˆåŠï¼Ÿ <code>File Trailer</code>  å°±æ˜¯ä¸ºäº†<strong>æ£€éªŒ</strong>ä¸€ä¸ªé¡µæ˜¯å¦åˆ·æ–°å®Œæ•´ï¼ˆè‡³äºå¦‚ä½•æ¢å¤ï¼Œé‚£å°±çš„å­¦åˆ°æ—¥å¿—é‚£æ‰çŸ¥é“äº†ï¼‰</p>\n<p>è¯¥éƒ¨åˆ†ç”± 8 ä¸ªå­—èŠ‚ç»„æˆï¼š</p>\n<ul>\n<li>å‰å››ä¸ªå­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œï¼Œè¯¥éƒ¨åˆ†ä¸ <code>File Header</code>  çš„æ ¡éªŒå’Œç›¸å¯¹åº”ã€‚ <strong>æ¯æ¬¡</strong>é¡µåœ¨å†…å­˜ä¸­å‘ç”Ÿ<strong>ä¿®æ”¹</strong>æ—¶ï¼Œåœ¨åˆ·æ–°å‰å°±è¦æŠŠæ ¡éªŒå’Œç®—å‡ºæ¥ã€‚ä»¥é¡µ Aï¼ˆå‡è®¾æ ¡éªŒå’Œä¸º 1ï¼‰åˆšä»ç£ç›˜è¯»åˆ°å†…å­˜ä¸ºä¾‹ï¼Œä¿®æ”¹ä¹‹åæ ¡éªŒå’Œä¸º 2ï¼Œé‚£ä¹ˆæ­¤æ—¶ç£ç›˜ä¸­çš„é¡µ A å’Œå†…å­˜ä¸­çš„é¡µ A æ ¡éªŒå’Œä¸ä¸€æ ·ã€‚åˆ·æ–°åˆ°ç£ç›˜æ—¶ï¼Œ <code>File Header</code>  çš„ç£ç›˜å…ˆè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œå¦‚æœæ–­ç”µå¯¼è‡´ <code>File Trailer</code>  çš„æ ¡éªŒå’Œæ²¡æœ‰åˆ·æ–°è¿›å»ï¼Œé‚£ä¹ˆç£ç›˜ä¸­çš„ <code>File Header</code>  ä¸ <code>File  trailer</code>  çš„æ ¡éªŒå’Œå°±ä¸ä¸€æ ·ã€‚</li>\n<li>åå››ä¸ªå­—èŠ‚æ˜¯é¡µé¢æœ€åè¢«ä¿®æ”¹æ—¶å¯¹åº”çš„ LSN çš„å 4 ä¸ªå­—èŠ‚ï¼Œä¸ <code>File Header</code>  ç›¸å¯¹åº”ï¼Œä¹Ÿæ˜¯æ£€éªŒé¡µå®Œæ•´æ€§ã€‚</li>\n</ul>\n<h1 id=\"å¼•ç”¨\"><a class=\"anchor\" href=\"#å¼•ç”¨\">#</a> å¼•ç”¨</h1>\n<blockquote>\n<p>æœ¬æ–‡æ€»ç»“äºã€Šä»æ ¹ä¸Šç†è§£ MySQLã€‹ç¬¬äº”ç«  p72-p89ï¼Œä½œè€…ï¼šå°å­©å­ 4919ã€‚å¯¹äºæœ‰èƒ½åŠ›æˆ–è€…å…´è¶£çš„è¯»è€…ï¼Œé„™äººå¼ºçƒˆæ¨èè¿™æœ¬ä¹¦ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿé€šè¿‡æ­£è§„æ¸ é“è´­ä¹°ï¼Œæ”¯æŒä½œè€…ï¼Œæ”¯æŒæ­£ç‰ˆï¼Œæ”¯æŒæ¯ä¸€é¢—çƒ­çˆ±æŠ€æœ¯çš„å¿ƒï¼Œæˆ‘å°†æ„Ÿæ¿€ä¸å°½ã€‚</p>\n</blockquote>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/25/Java/%E5%B9%B6%E5%8F%91/JUC_%E5%8E%9F%E5%AD%90%E7%B1%BB1-CAS%E4%B8%8EUnsafe/",
            "url": "https://cecilia.cool/2022/07/25/Java/%E5%B9%B6%E5%8F%91/JUC_%E5%8E%9F%E5%AD%90%E7%B1%BB1-CAS%E4%B8%8EUnsafe/",
            "title": "J.U.CåŸå­ç±»(1)--CASä¸Unsafe",
            "date_published": "2022-07-25T07:06:33.000Z",
            "content_html": "<h1 id=\"çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•\"><a class=\"anchor\" href=\"#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•\">#</a> çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h1>\n<h2 id=\"äº’æ–¥åŒæ­¥\"><a class=\"anchor\" href=\"#äº’æ–¥åŒæ­¥\">#</a> äº’æ–¥åŒæ­¥</h2>\n<p>ä½¿ç”¨ <code>synchronized</code>  å’Œ <code>ReentrantLock</code></p>\n<h2 id=\"éé˜»å¡åŒæ­¥\"><a class=\"anchor\" href=\"#éé˜»å¡åŒæ­¥\">#</a> éé˜»å¡åŒæ­¥</h2>\n<p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯<strong>çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜</strong>ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p>\n<p>äº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é” (è¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”)ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p>\n<h3 id=\"atomicinteger\"><a class=\"anchor\" href=\"#atomicinteger\">#</a> AtomicInteger</h3>\n<p>è¯¥ç±»æ˜¯æ•´æ•°åŸå­ç±»ï¼Œå…¶ä¸­å¾ˆå¤šæ–¹æ³•éƒ½ä½¿ç”¨äº† Unsafe ç±»çš„ CAS æ“ä½œï¼Œä»¥ <code>incrementAndGet()</code>  ä¸ºä¾‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//AtomicInteger ç±»çš„ increment () æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> unsafe<span class=\"token punctuation\">.</span><span class=\"token function\">getAndAddInt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> valueOffset<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//Unsafe ç±»çš„ getAndInt (Object var1,long var2,int var4) æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getAndAddInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> var1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> var2<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> var4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//var1 æŒ‡ç¤ºå¯¹è±¡å†…å­˜åœ°å€ï¼Œvar2 æŒ‡ç¤ºè¯¥å­—æ®µç›¸å¯¹å¯¹è±¡å†…å­˜åœ°å€çš„åç§»ï¼Œvar4 æ˜¯è¦åŠ çš„æ•°å€¼</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> var5<span class=\"token punctuation\">;</span><span class=\"token comment\">//step1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// é€šè¿‡ var1,var2 æ‹¿åˆ°æ—§å€¼ï¼Œstep2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        var5 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getIntVolatile</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">,</span> var2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSwapInt</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">,</span> var2<span class=\"token punctuation\">,</span> var5<span class=\"token punctuation\">,</span> var5 <span class=\"token operator\">+</span> var4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">// è¿›è¡Œ CAS æ“ä½œï¼Œæ¯”è¾ƒæœŸæœ›çš„æ—§å€¼ var5 å’Œå½“å‰å†…å­˜çš„å€¼æ˜¯å¦ç›¸åŒã€‚è¿›è¡Œç›¸åŠ æ“ä½œ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> var5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ <code>step1</code>  å’Œ <code>step2</code>  ä»¥åŠ <code>step2-&gt;step3</code>  è¿‡ç¨‹éƒ½å¯èƒ½å‡ºç°å¹¶å‘é—®é¢˜ï¼Œæœ‰å¯èƒ½ <code>step2</code>  æ‹¿åˆ° <code>var5</code>  ä¹‹åï¼Œé‚£ç‰‡å†…å­˜çš„å€¼åˆè¢«ä¿®æ”¹ï¼Œäºæ˜¯ <code>while</code>  æ¡ä»¶ä¸­çš„ CAS æ“ä½œè¿”å› <code>false</code> ï¼Œç»§ç»­å¾ªç¯ï¼Œä¸æ–­å†²çªæ£€æµ‹ï¼Œç›´åˆ°å°†æ•°åŠ åˆ°å†…å­˜ä¸­ã€‚</p>\n<h2 id=\"æ— åŒæ­¥æ–¹æ¡ˆ\"><a class=\"anchor\" href=\"#æ— åŒæ­¥æ–¹æ¡ˆ\">#</a> æ— åŒæ­¥æ–¹æ¡ˆ</h2>\n<p>æ¶‰åŠçº¿ç¨‹æ± ï¼Œæš‚ä¸åŠ è®²è§£</p>\n<h1 id=\"cas\"><a class=\"anchor\" href=\"#cas\">#</a> CAS</h1>\n<p>æˆ‘ä»¬å¸Œæœ›åœ¨å¹¶å‘çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆæ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™å°±é‡‡å–è¡¥å¿æªæ–½ã€‚è¿™ç§<strong>åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚çš„æ“ä½œ</strong>è®¸å¤šå®ç°éƒ½ä¸éœ€è¦å°†çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p>\n<p><strong>ä¹è§‚é”</strong>éœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ï¼Œè¿™é‡Œçš„åŸå­æ€§ä¸èƒ½å¤Ÿä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯ï¼Œåªèƒ½é <strong>ç¡¬ä»¶</strong>æ¥å®Œæˆã€‚ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯: <strong>æ¯”è¾ƒå¹¶äº¤æ¢</strong> ( <code>Compare-and-Swapï¼ŒCAS</code> )ã€‚ <code>CAS</code>  æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€  <code>V</code> ã€æ—§çš„é¢„æœŸå€¼  <code>A</code>  å’Œæ–°å€¼  <code>B</code> ã€‚å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œåªæœ‰å½“  <code>V</code>  çš„å€¼ç­‰äº  <code>A</code> ï¼Œæ‰å°†  <code>V</code>  çš„å€¼æ›´æ–°ä¸º  <code>B</code> ã€‚</p>\n<p>å› ä¸º <code>CAS</code>  æ“ä½œæ—¶åŸå­æ€§çš„ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹å¹¶å‘ä½¿ç”¨ <code>CAS</code>  æ›´æ–°æ•°æ®æ—¶ä¸ç”¨é”ã€‚ç±»ä¼¼ <code>sql</code>  ä¸­çš„æ¡ä»¶æ›´æ–°ä¸€æ ·ï¼š <code>update set id=3 from table where id=2</code> ã€‚å› ä¸ºå•æ¡ <code>sql</code>  æ‰§è¡Œå…·æœ‰åŸå­æ€§ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ­¤ <code>sql</code>  è¯­å¥ï¼Œåªæœ‰ä¸€æ¡èƒ½æ›´æ–°æˆåŠŸï¼ˆå°±æ˜¯æœ€åä¸€ä¸ªæ‰§è¡Œçš„é‚£ä¸ªï¼‰ã€‚</p>\n<p><code>CAS</code>  æ–¹å¼ä¸ºä¹è§‚é”ï¼Œ <code>synchronized</code>  ä¸ºæ‚²è§‚é”ã€‚å› æ­¤ä½¿ç”¨  <code>CAS</code>  è§£å†³å¹¶å‘é—®é¢˜é€šå¸¸æƒ…å†µä¸‹æ€§èƒ½æ›´ä¼˜ã€‚</p>\n<p>åœ¨åº”ç”¨æ–¹é¢ï¼Œæ¯”å¦‚ <code>Unsafe</code>  ç±»ï¼Œ <code>AtomicInteger</code>  ç±»ç­‰ï¼Œä¹‹åä¼šä¸€ ä¸€è®²è§£ã€‚</p>\n<p>é—®é¢˜ï¼š</p>\n<ul>\n<li><code>ABA</code>  é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯  <code>A</code>  å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº†  <code>B</code> ï¼Œåæ¥åˆè¢«æ”¹å›ä¸ºãƒ»ï¼Œé‚£  <code>CAS</code>  æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚ <code>J.U.C</code>  åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»  <code>AtomicStampedReference</code>  æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„<strong>ç‰ˆæœ¬</strong>æ¥ä¿è¯  <code>CAS</code>  çš„æ­£ç¡®æ€§ã€‚åœ¨å˜é‡å‰åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬åŠ  1ï¼Œé‚£ä¹ˆ <code>A-&gt;B-&gt;A</code>  å°±ä¼šå˜æˆ <code>1A-&gt;2B-&gt;3A</code> ï¼Œä»å‰æ˜¯æ¯”è¾ƒæœŸæœ›çš„æ—§å€¼å’Œå½“å‰å€¼ï¼Œç°åœ¨å¤šæ¯”è¾ƒä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆ <code>compareAndSet</code>  æ–¹æ³•ï¼‰ï¼Œæ›´æ–°æ—¶ä¸¤ä¸ªä¸€èµ·æ›´æ–°ã€‚<strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§</strong>ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œ<strong>æ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆ</strong>ã€‚</li>\n<li>ä¸æ–­å¾ªç¯å…¶å®å°±æ˜¯è‡ªæ—‹ï¼Œè‡ªæ—‹ <code>CAS</code>  å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ <code>CPU</code>  å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</li>\n<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼Œå¤šäº†å°±å¯ä»¥ç”¨é”ã€‚</li>\n</ul>\n<h1 id=\"unsafeç±»è¯¦è§£\"><a class=\"anchor\" href=\"#unsafeç±»è¯¦è§£\">#</a> Unsafe ç±»è¯¦è§£</h1>\n<p>Unsafe æ˜¯ä½äº <code>sun.misc</code>  åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œ<strong>ä½çº§åˆ«</strong>ã€<strong>ä¸å®‰å…¨</strong>æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œè¿™äº›æ–¹æ³•åœ¨æå‡ Java è¿è¡Œæ•ˆç‡ã€å¢å¼º Java è¯­è¨€åº•å±‚èµ„æºæ“ä½œèƒ½åŠ›æ–¹é¢èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ã€‚ä½†ç”±äº Unsafe ç±»ä½¿ Java è¯­è¨€æ‹¥æœ‰äº†ç±»ä¼¼ C è¯­è¨€æŒ‡é’ˆä¸€æ ·æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼Œè¿™æ— ç–‘ä¹Ÿå¢åŠ äº†ç¨‹åºå‘ç”Ÿç›¸å…³æŒ‡é’ˆé—®é¢˜çš„é£é™©ã€‚åœ¨ç¨‹åºä¸­è¿‡åº¦ã€ä¸æ­£ç¡®ä½¿ç”¨ Unsafe ç±»ä¼šä½¿å¾—ç¨‹åºå‡ºé”™çš„æ¦‚ç‡å˜å¤§ï¼Œä½¿å¾— Java è¿™ç§å®‰å…¨çš„è¯­è¨€å˜å¾—ä¸å† â€œå®‰å…¨â€ï¼Œå› æ­¤å¯¹ Unsafe çš„ä½¿ç”¨ä¸€å®šè¦æ…é‡ã€‚</p>\n<p>è¯¥ç±»çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰é€šè¿‡åå°„æ‰èƒ½æ‹¿åˆ°å…¶å®ä¾‹åŒ–å¯¹è±¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">//Unsafe æ„é€ æ–¹æ³•ç§æœ‰ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œé€šè¿‡åå°„è·å¾—å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Field</span> f <span class=\"token operator\">=</span> <span class=\"token class-name\">Unsafe</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"theUnsafe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    f<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessible</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">Unsafe</span> unsafe <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Unsafe</span><span class=\"token punctuation\">)</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Unsafe ç±»æä¾›çš„ API å¤§è‡´å¯åˆ†ä¸ºï¼šå†…å­˜æ“ä½œï¼ŒCASï¼ŒClass ç›¸å…³ï¼Œå¯¹è±¡æ“ä½œï¼Œçº¿ç¨‹è°ƒåº¦ï¼Œç³»ç»Ÿä¿¡æ¯è·å–ï¼Œå†…å­˜å±éšœï¼Œæ•°ç»„æ“ä½œã€‚</p>\n<p>é€šè¿‡æŸ¥çœ‹æºç ï¼Œå…¶å® Unsafe åªæä¾›ä¸‰ç§ CAS æ–¹æ³•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//paramObject1:int å­—æ®µæ‰€åœ¨çš„å¯¹è±¡ï¼ŒparamLongï¼šè¯¥å­—æ®µåœ¨è¯¥å¯¹è±¡ä¸­çš„åç§»é‡ï¼ŒparamObject2ï¼šæœŸæœ›çš„æ—§å€¼ï¼ŒparamObject3ï¼šè¦æ›´æ–°çš„å€¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">compareAndSwapObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> paramObject1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> paramObject2<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> paramObject3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">compareAndSwapInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> paramObject<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> paramInt1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> paramInt2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">compareAndSwapLong</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> paramObject<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong2<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™å‡ ä¸ªéƒ½æ˜¯ <code>native</code>  æ–¹æ³•ï¼Œç”± C++ ä»£ç å®ç°ï¼Œéƒ½ä½äº <code>unsafe.cpp</code>  æ–‡ä»¶ä¸­</p>\n<pre><code class=\"language-c++\">UNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))\n  //ä¹‹å‰çš„ä»£ç å±•ç¤ºæˆ‘ä»¬çœ‹åˆ°ï¼ŒCASå‡½æ•°æ˜¯æ”¾åœ¨whileå¾ªç¯ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n  UnsafeWrapper(&quot;Unsafe_CompareAndSwapInt&quot;);\n  oop p = JNIHandles::resolve(obj);\n\n  //è¯¥å‡½æ•°è¦æ›´æ–°çš„æ˜¯ä¸€ä¸ªjint,æ‰€ä»¥è¦å…ˆæ ¹æ®å¯¹è±¡å¼•ç”¨+åç§»é‡å¾—åˆ°å…¶åœ°å€ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„æŒ‡é’ˆ\n  jint* addr = (jint *) index_oop_from_field_offset_long(p, offset);\n\n  //å¾ˆæ˜æ˜¾ï¼ŒAtomic::cmpxhgæ‰æ˜¯è¿›è¡ŒCASæ“ä½œï¼ˆæ¯”è¾ƒ+æ›¿æ¢ï¼‰çš„é‚£ä¸€æ­¥ï¼Œxæ˜¯å³å°†æ›´æ–°çš„å€¼ï¼Œeæ˜¯æœŸæœ›çš„æ—§å€¼\n  return (jint)(Atomic::cmpxchg(x, addr, e)) == e;\nUNSAFE_END\n</code></pre>\n<p>å½“ç„¶ï¼ŒUnsafe ç±»è¿˜æä¾›äº†è®¸å¤šç¡¬ä»¶çº§åˆ«çš„æ“ä½œ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// è·å–ç»™å®šçš„ paramField çš„å†…å­˜åœ°å€åç§»é‡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">long</span> <span class=\"token function\">staticFieldOffset</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Field</span> paramField<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// åˆ†é…å†…å­˜</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">long</span> <span class=\"token function\">allocateMemory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> paramLong<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// æ‰©å……å†…å­˜</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">long</span> <span class=\"token function\">reallocateMemory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> paramLong1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> paramLong2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// é‡Šæ”¾å†…å­˜</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">void</span> <span class=\"token function\">freeMemory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> paramLong<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// è·å–æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">int</span> <span class=\"token function\">arrayBaseOffset</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span> paramClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>å…³äº Unsafe ç±»çš„æ›´å¤šçŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTkvMDIvMTQvdGFsay1hYm91dC1qYXZhLW1hZ2ljLWNsYXNzLXVuc2FmZS5odG1s\">Java é­”æ³•ç±»ï¼šUnsafe åº”ç”¨è§£æ</span></p>\n</blockquote>\n<h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1qdWMtQXRvbWljSW50ZWdlci5odG1s\">https://pdai.tech/md/java/thread/java-thread-x-juc-AtomicInteger.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTkvMDIvMTQvdGFsay1hYm91dC1qYXZhLW1hZ2ljLWNsYXNzLXVuc2FmZS5odG1s\">https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/25/Database/MySQL/InnoDB%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%AD%98%E5%82%A8%E8%AE%B0%E5%BD%95/",
            "url": "https://cecilia.cool/2022/07/25/Database/MySQL/InnoDB%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%AD%98%E5%82%A8%E8%AE%B0%E5%BD%95/",
            "title": "InnoDBè¡Œæ ¼å¼å­˜å‚¨è®°å½•",
            "date_published": "2022-07-25T02:11:43.000Z",
            "content_html": "<h1 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h1>\n<p>MySQL æœåŠ¡å™¨ä¸­è´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®è¿›è¡Œè¯»å–å’Œå†™å…¥å·¥ä½œçš„éƒ¨åˆ†æ˜¯<strong>å­˜å‚¨å¼•æ“</strong>ï¼Œè€ŒæœåŠ¡å™¨æ”¯æŒä¸åŒç±»å‹çš„å­˜å‚¨å¼•æ“ï¼Œå¦‚ InnoDBï¼ŒMyISAMï¼ŒMEMORY ç­‰ã€‚<strong>çœŸå®æ•°æ®åœ¨ä¸åŒå­˜å‚¨å¼•æ“çš„å­˜æ”¾æ ¼å¼å¯èƒ½ä¸åŒ</strong>ã€‚å› ä¸º InnoDB ç°åœ¨æ˜¯ MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œæ‰€ä»¥ä¼šä»‹ç»å…¶ç›¸å…³ç‰¹æ€§ã€‚</p>\n<p>åœ¨ MySQL ä¸­ï¼Œè¡¨ä¸­çš„ä¸€è¡Œæ•°æ®è¢«ç§°ä¸ºä¸€æ¡è®°å½•ï¼Œè®°å½•ä¿å­˜åœ¨é¡µä¸­ï¼Œé¡µç»„æˆ B + æ ‘ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾è¿…é€Ÿæ‰¾åˆ°è®°å½•ã€‚å¦‚æœä½ è¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œä¹Ÿæ²¡å¤ªå¤§å…³ç³»ï¼Œè¿™å¥è¯åªæ˜¯æƒ³å‘Šè¯‰ä½  InnoDB å­˜å‚¨æ•°æ®çš„æœ¬è´¨ã€‚</p>\n<h1 id=\"innodbé¡µ\"><a class=\"anchor\" href=\"#innodbé¡µ\">#</a> InnoDB é¡µ</h1>\n<p>æ•°æ®åº“ä¼šé¢‘ç¹å‘ç”Ÿæ•°æ®çš„è¯»å–å’Œå†™å…¥ï¼Œè¿™å°±åƒæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œä¼šå‘ç”Ÿå¤§é‡çš„ä¸ç£ç›˜çš„äº¤äº’ã€‚ä½†æ˜¯ä»ç£ç›˜ä¸­ç›´æ¥è¯»å†™æ•°æ®éå¸¸æ…¢ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“ä¸å¯èƒ½æ¯æ¬¡è¯»å†™æ•°æ®éƒ½ç›´æ¥å’Œç£ç›˜äº¤äº’ï¼Œæ‰€ä»¥å°±å°†æ•°æ®åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œ<strong>ä»¥é¡µä½œä¸ºç£ç›˜ä¸å†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½</strong>ï¼Œå…¶å®é¡µçš„æœ¬è´¨ä¹Ÿå°±æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„å†…å­˜ã€‚</p>\n<p>InnoDB ä¸­çš„é¡µå¤§å°ä¸€èˆ¬æ˜¯ 16KBï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¬¡ä»ç£ç›˜ä¸­è¯»å–çš„æ•°æ®æœ€å°‘æ˜¯ 16KBï¼Œæ¯æ¬¡å°†å†…å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­æœ€å°‘ä¹Ÿæ˜¯ 16KBã€‚</p>\n<pre><code class=\"language-mysql\">mysql&gt; show variables like 'innodb_page_size';\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| innodb_page_size | 16384 |\n+------------------+-------+\n1 row in set, 1 warning (0.00 sec)\n# 16 * 1024 = 16384\n#è¯¥ç³»ç»Ÿå˜é‡ä¸èƒ½åœ¨æœåŠ¡å™¨è¿è¡Œæ—¶ä¿®æ”¹ã€‚\n</code></pre>\n<h1 id=\"innodbè¡Œæ ¼å¼\"><a class=\"anchor\" href=\"#innodbè¡Œæ ¼å¼\">#</a> InnoDB è¡Œæ ¼å¼</h1>\n<p><strong>ä¸€æ¡è®°å½•çš„å­˜æ”¾æ ¼å¼è¢«ç§°ä¸ºä¸ºè¡Œæ ¼å¼æˆ–è€…è®°å½•æ ¼å¼</strong>ï¼ŒInnoDB ç›®å‰æœ‰å››ç§è¡Œæ ¼å¼ï¼š <code>COMPACT</code> ï¼Œ <code>REDUNDANT</code> ï¼Œ <code>DYNAMIC</code> ï¼Œ <code>COMPRESSED</code> ã€‚</p>\n<pre><code class=\"language-mysql\"># æŒ‡å®šè¡Œæ ¼å¼\ncreate table è¡¨å (åˆ—ä¿¡æ¯) row_format=è¡Œæ ¼å¼å\nalter table è¡¨å row_format=è¡Œæ ¼å¼\n</code></pre>\n<h2 id=\"compactè¡Œæ ¼å¼\"><a class=\"anchor\" href=\"#compactè¡Œæ ¼å¼\">#</a> COMPACT è¡Œæ ¼å¼</h2>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/25/49b544009f43872c.png\" alt=\"image-20220725103902849\" /></p>\n<h3 id=\"å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨\"><a class=\"anchor\" href=\"#å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨\">#</a> å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</h3>\n<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œç”¨äºä¹‹åçš„ç¤ºä¾‹è®²è§£</p>\n<pre><code class=\"language-mysql\">create table record_format_demo (\n\tt1 varchar(10),\n    t2 varchar(256),\n    t3 varchar(20) not null\n) character set = ascii row_format = COMPACT;\n</code></pre>\n<p>å˜é•¿å­—æ®µæŒ‡çš„å°±æ˜¯ varchar (10) è¿™ç§ï¼Œä¸èƒ½é¢„å…ˆç¡®å®šå­˜å‚¨çš„æ•°æ®çš„å¤§å°ã€‚åœ¨ InnoDB è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªç¡®å®šå¤§å°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±èƒ½æ ¹æ®å…¶å¤§å°ç¡®å®šåç§»é‡ä»è€Œè¯»å–å‡ºæ­£ç¡®çš„æ•°æ®ï¼Œä½†æ˜¯å˜é•¿æ•°æ®æ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥å°±éœ€è¦ä¿å­˜è¿™ä¸ªå˜é•¿å­—æ®µï¼ˆä¸ä¸º NULLï¼‰çš„é•¿åº¦ï¼Œæ¥å‘Šè¯‰ InnoDB è¿™ä¸ªæ•°æ®çš„å¤§å°ã€‚</p>\n<p>æ‰€ä»¥å˜é•¿å­—æ®µå ç”¨çš„å­˜å‚¨ç©ºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>\n<ul>\n<li>çœŸæ­£çš„æ•°æ®å†…å®¹</li>\n<li>è¯¥æ•°æ®å ç”¨çš„å­—èŠ‚æ•°</li>\n</ul>\n<p>åœ¨ COMPACT è¡Œæ ¼å¼ä¸­ï¼Œæ‰€æœ‰å˜é•¿å­—æ®µçš„çœŸå®æ•°æ®å ç”¨å­—èŠ‚æ•°éƒ½å­˜æ”¾åœ¨è®°å½•çš„å¼€å¤´ä½ç½® (åå…­è¿›åˆ¶ï¼Œå„å­—æ®µé•¿åº¦ä¹‹é—´æ²¡æœ‰ç©ºæ ¼)ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€‚å„å­—æ®µå ç”¨<strong>å­—èŠ‚æ•°</strong>æŒ‰åˆ—çš„é¡ºåºé€†åºå­˜æ”¾ï¼Œæ˜¯é€†åºå­˜æ”¾ï¼</p>\n<p>æœ‰æ—¶ç”¨äºè¡¨ç¤ºé•¿åº¦çš„æ•°æ®ï¼Œéœ€è¦å æ®ä¸æ­¢ä¸€ä¸ªå­—èŠ‚ã€‚æ¯”å¦‚æŸä¸€å˜é•¿å­—æ®µå å­—èŠ‚ <code>n=700</code> , é‚£ä¹ˆå°±éœ€è¦ç”¨åˆ°å¤šä¸ªå­—èŠ‚æ¥è¡¨ç¤º <code>n</code> ï¼Œ<strong>å› ä¸ºä¸€ä¸ªå­—èŠ‚å“ªæ€•åŠ ä¸Šç¬¦å·ä½ä¹Ÿè¡¨ç¤ºä¸äº† n</strong>ã€‚å…³äºä½¿ç”¨å‡ ä¸ªå­—èŠ‚ï¼ŒInnoDB æœ‰å±äºè‡ªå·±çš„è§„åˆ™ï¼Œæ­¤å¤„å¼•å…¥ <code>Wï¼ŒMï¼ŒL</code>  ä¸‰ä¸ªç¬¦å·ï¼š</p>\n<ul>\n<li>\n<p>Wï¼šå‡è®¾æŸä¸ª<strong>å­—ç¬¦é›†</strong>ä¸­æœ€å¤šéœ€è¦ <code>W</code>  å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ (ä¹Ÿå°±æ˜¯ <code>show charset;</code>  ä¸­çš„ <code>MaxLen</code>  åˆ—)</p>\n</li>\n<li>\n<p>Mï¼šå¯¹äºå˜é•¿ç±»å‹ <code>VARCHAR(M)</code>  æ¥è¯´ï¼Œè¿™ç§ç±»å‹è¡¨ç¤ºèƒ½å­˜å‚¨æœ€å¤š<strong> M ä¸ªå­—ç¬¦</strong> (æ˜¯å­—ç¬¦ï¼Œä¸æ˜¯å­—èŠ‚)ï¼Œæ‰€ä»¥è¯¥ç±»å‹æœ€å¤šèƒ½å­˜å‚¨ <code>M*W</code>  ä¸ªå­—èŠ‚</p>\n</li>\n<li>\n<p>Lï¼šè¯¥å˜é•¿å­—æ®µ<strong>å®é™…å­˜å‚¨</strong>çš„å­—ç¬¦æ•°å ç”¨çš„å­—èŠ‚æ•°æ˜¯ L</p>\n</li>\n</ul>\n<p>InnoDB åœ¨è¯»å–è®°å½•å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨æ—¶ï¼Œ<strong>ä¼šå…ˆæŸ¥çœ‹è¡¨ç»“æ„</strong>ï¼Œå¦‚æœæŸä¸ªå­—æ®µå…è®¸å­˜å‚¨æœ€å¤§å­—èŠ‚æ•° <code>M*W&lt;=255</code> ï¼Œå°±è®¤ä¸ºåªæ˜¯ç”¨ 1 å­—èŠ‚è¡¨ç¤ºçœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ã€‚</p>\n<p>å¦‚æœ <code>M*W &gt; 255</code> :</p>\n<ul>\n<li>è‹¥ <code>L &lt;= 127</code>  ä½¿ç”¨ 1 å­—èŠ‚</li>\n<li>è‹¥ <code>L &gt; 127</code>   ä½¿ç”¨ 2 å­—èŠ‚</li>\n</ul>\n<blockquote>\n<p>255 æ˜¯ 1 ä¸ªå­—èŠ‚ï¼ˆæ— ç¬¦å·æ•´å‹ï¼‰èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°ï¼Œå³ 8 ä½å…¨ä¸º 1ï¼Œ2^8-1=255ã€‚</p>\n<p>127 æ˜¯ 1 ä¸ªå­—èŠ‚ï¼ˆæœ‰ç¬¦å·æ•´å‹ï¼‰èƒ½è¡¨ç¤ºçš„æœ€å¤§æ•°ï¼Œå³æœ€é«˜ä½ 0ï¼Œå…¶ä»– 7 ä½ä¸º 1ï¼Œ2^7-1=127</p>\n</blockquote>\n<p>è¯¥è§„åˆ™ä¸»è¦å°±æ˜¯ç”¨äºåŒºåˆ†é•¿åº¦åˆ—è¡¨ä¸­ï¼Œå½“ <code>M*W &gt; 255</code>  æ—¶ï¼Œä¸€ä¸ªå­—èŠ‚åˆ°åº•æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—æ®µé•¿åº¦ **ï¼ˆL &lt;= 127ï¼‰<strong>ï¼Œè¿˜æ˜¯åŠä¸ªå­—æ®µé•¿åº¦</strong>ï¼ˆL &gt; 127)**ã€‚è®¾è®¡è€…ä½¿ç”¨è¯¥å­—èŠ‚çš„ç¬¬ä¸€ä¸ªäºŒè¿›åˆ¶ä½ä½œä¸ºæ ‡å¿—ä½ï¼šå¦‚æœè¯¥å­—èŠ‚çš„ç¬¬ä¸€ä¸ªä½æ˜¯ 0ï¼Œè¯¥å­—èŠ‚å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—æ®µé•¿åº¦ï¼Œè¿™ä¹Ÿå°±æ˜¯ 0~127 çš„ç¬¬ä¸€ä½éƒ½æ˜¯ 0ã€‚å¦‚æœç¬¬ä¸€ä½ä¸º 1ï¼Œé‚£ä¹ˆè¯¥å­—èŠ‚å°±æ˜¯åŠä¸ªå­—æ®µé•¿åº¦ã€‚</p>\n<blockquote>\n<p>å…¶å®å¯ä»¥è®¾å®šï¼Œåªè¦ M*W &gt; 255 å°±ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨å˜é•¿å­—æ®µé•¿åº¦ã€‚ä¹‹æ‰€ä»¥åˆ†çš„è¿™ä¹ˆç»†ï¼Œæ˜¯æƒ³è¦èŠ‚çœç©ºé—´ï¼Œè®¾è®¡è€…çš„è‰¯è‹¦ç”¨å¿ƒå¯è§ä¸€æ–‘</p>\n</blockquote>\n<p>å¦‚æœæŸä¸ªå­—æ®µå ç”¨å­—èŠ‚ç‰¹åˆ«å¤šï¼ŒInnoDB å¯èƒ½ä¼šæŠŠè¯¥å­—æ®µçš„å€¼çš„ä¸€éƒ¨åˆ†æ•°æ®å­˜æ”¾åˆ°<strong>æº¢å‡ºé¡µ</strong>ä¸­ï¼Œå˜é•¿åº¦åˆ—è¡¨åªè®°å½•ç•™åœ¨æœ¬é¡µä¸­çš„æ•°æ®é•¿åº¦ï¼Œ<br />\næ‰€ä»¥<strong> 2 å­—èŠ‚è¡¨ç¤ºå˜é•¿å­—æ®µé•¿åº¦æ˜¯å®Œå…¨è¶³å¤Ÿçš„</strong>ã€‚åŒæ—¶ï¼Œé•¿åº¦åˆ—è¡¨åªæœ‰åœ¨<strong>æœ‰å¿…è¦å­˜åœ¨æ—¶</strong>ï¼Œæ‰ä¼šå­˜åœ¨ï¼ˆå­˜åœ¨ä¸ä¸º NULL çš„å˜é•¿å­—æ®µï¼‰</p>\n<p>å¯¹äº <code>CHAR(M)</code>  è€Œè¨€ï¼Œå¦‚æœä½¿ç”¨çš„<strong>å­—ç¬¦é›†</strong>æ˜¯å˜é•¿ç¼–ç å­—ç¬¦é›†ï¼Œé‚£ä¹ˆè¯¥å±æ€§ä¹Ÿä¼šè¢«åŠ å…¥åˆ°å˜é•¿åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”é•¿åº¦ä¸º <code>M*W</code>  (è¯¥å­—ç¬¦é›†çš„ MaxLen=W)ã€‚</p>\n<h3 id=\"nullå€¼åˆ—è¡¨\"><a class=\"anchor\" href=\"#nullå€¼åˆ—è¡¨\">#</a> NULL å€¼åˆ—è¡¨</h3>\n<p>COMPACT æŠŠä¸€æ¡è®°å½•çš„å€¼ä¸º NULL çš„ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜å‚¨åˆ° NULL åˆ—è¡¨ä¸­ã€‚å¤„ç†è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>ç»Ÿè®¡è¡¨ä¸­å…è®¸å‚¨å­˜ NULL çš„åˆ—æœ‰å“ªäº› (æ¯”å¦‚ä¸»é”®å’Œ NOT NULL ä¼šè¢«æ’é™¤)</li>\n<li>å¦‚æœè¡¨ä¸­æ‰€æœ‰åˆ—éƒ½ä¸èƒ½å­˜å‚¨ NULLï¼Œé‚£ä¹ˆ NULL å€¼åˆ—è¡¨ä¹Ÿå°±ä¸å­˜åœ¨ã€‚å¦åˆ™å°†æ¯ä¸ªå…è®¸å­˜å‚¨ NULL çš„åˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä½æŒ‰ç…§åˆ—çš„é¡ºåº<strong>é€†åº</strong>æ’åˆ—ï¼Œä½å€¼ä¸º 1 æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸º NULL</li>\n<li>MySQL è§„å®š NULL åˆ—è¡¨å¿…é¡»ç”¨æ•´æ•°ä¸ªå­—èŠ‚çš„ä½è¡¨ç¤ºï¼Œä¸è¶³é«˜ä½è¡¥ 0</li>\n</ul>\n<blockquote>\n<p>ä¸ºä»€ä¹ˆæ˜¯é€†åºä¹‹åä¼šæåˆ°ï¼Œå…ˆä¸è¦ç€æ€¥ã€‚</p>\n</blockquote>\n<h3 id=\"è®°å½•å¤´ä¿¡æ¯\"><a class=\"anchor\" href=\"#è®°å½•å¤´ä¿¡æ¯\">#</a> è®°å½•å¤´ä¿¡æ¯</h3>\n<p>è®°å½•å¤´ä¿¡æ¯ç”±å›ºå®šçš„ 5 ä¸ªå­—èŠ‚ï¼ˆ40bitï¼‰ç»„æˆï¼Œç”¨äºæè¿°è®°å½•çš„ä¸€äº›ä¿¡æ¯</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/25/75ddfe7a3d59a65d.png\" alt=\"image-20220725112044762\" /></p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tå„äºŒè¿›åˆ¶ä½çš„è¯¦ç»†ä¿¡æ¯</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">åç§°</th>\n<th style=\"text-align:center\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">é¢„ç•™ä½ 1</td>\n<td style=\"text-align:center\">æ²¡æœ‰ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">é¢„ç•™ä½ 2</td>\n<td style=\"text-align:center\">æ²¡æœ‰ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">deleted_flag</td>\n<td style=\"text-align:center\">æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">min_rec_flag</td>\n<td style=\"text-align:center\">B + æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­æœ€å°ç›®å½•é¡¹è®°å½•ä¼šæ·»åŠ è¯¥æ ‡è®°</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">n_owned</td>\n<td style=\"text-align:center\">é¡µé¢ä¸­è®°å½•ä¼šè¢«åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„æœ€å¤§çš„é‚£ä¸ªè®°å½•ä½œä¸º â€œå¤§å“¥â€ï¼Œâ€œå¤§å“¥ â€œçš„è¯¥æ ‡å¿—ä½ä¼šè®°å½•ç»„ä¸­è®°å½•æ¡æ•°</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">heap_no</td>\n<td style=\"text-align:center\">å½“å‰è®°å½•åœ¨é¡µé¢å †ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œè®°å½•ç´§å¯†æ’åˆ—çš„ç»“æ„ç§°ä¸ºå †ï¼Œå‰é¢çš„è®°å½•è¯¥å€¼å°ï¼Œåé¢çš„å€¼æ›´å¤§</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">record_type</td>\n<td style=\"text-align:center\">å½“å‰è®°å½•ç±»å‹ï¼Œ0-- æ™®é€šè®°å½•ï¼Œ1--B + æ ‘éå¶å­èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•ï¼Œ2--Infimumï¼Œ3--supremum</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">next_record</td>\n<td style=\"text-align:center\">è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td>\n</tr>\n</tbody>\n</table>\n<p>è¿™ä¹ˆå¤šï¼Œçœ‹ä¸æ‡‚æ— æ‰€è°“ï¼Œç°åœ¨è®°ä¸ä½æ— æ‰€è°“ã€‚</p>\n<p>è§£é‡Šï¼š</p>\n<ul>\n<li>deleted_flag ä¸­ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰åˆ é™¤ï¼Œ1 è¡¨ç¤ºå·²ç»åˆ é™¤ã€‚å°½ç®¡ä¸€æ¡è®°å½•è¢«æ ‡å¿—ä¸ºåˆ é™¤ï¼Œä½†æ˜¯å¹¶ä¸ä¼šé©¬ä¸Šä»è¡¨ä¸­ç§»é™¤ï¼Œ<strong>è¿™æ˜¯é¿å…ç§»é™¤åè¦é‡æ–°æ’åˆ—å…¶ä»–è®°å½•ï¼Œé€ æˆæ€§èƒ½æŸè€—</strong>ã€‚æ‰€ä»¥è¿™äº›è¢«æ ‡å¿—åˆ é™¤çš„è®°å½•ï¼Œä¼šç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œè¿™äº›ç©ºé—´åˆè¢«ç§°ä¸ºå¯é‡ç”¨ç©ºé—´ï¼Œå¦‚æˆ‘æ–°æ’å…¥çš„è®°å½•ï¼Œåƒåœ¾é“¾è¡¨ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè®°å½•ï¼‰æ”¾å¾—ä¸‹ï¼Œå°±ä¼šå°†æ–°çºªå½•è¦†ç›–çš„é‚£æ¡è¢«æ ‡å¿—ä¸ºåˆ é™¤çš„è®°å½•ã€‚</li>\n<li>next_record å‘æˆ‘ä»¬è¡¨æ˜è®°å½•ä¼šè¢«æ’åˆ—æˆé“¾è¡¨ï¼Œé“¾è¡¨æ˜¯ä¸ªå¥½ä¸œè¥¿ã€‚</li>\n<li>record_type è¡¨ç¤ºè®°å½•çš„å››ç§ç±»å‹ï¼Œåœ¨ç›®å‰çŸ¥æ™“çš„æŸ¥è¯¢ç®—æ³•ä¸­ï¼ŒäºŒåˆ†æŸ¥æ‰¾å·²éå¸¸ä¼˜ç§€çš„ï¼Œæ‰€ä»¥åœ¨ MySQL ä¸­å¤§é‡ä½¿ç”¨äº†äºŒåˆ†æŸ¥æ‰¾ã€‚é‚£ä¹ˆå°±æ¶‰åŠåˆ°è®°å½•ä¹‹é—´çš„å¤§å°æ¯”è¾ƒï¼Œä¸€èˆ¬æ˜¯é€šè¿‡é”®å€¼æ¯”è¾ƒå¤§å°ã€‚è§„å®š <code>record_type=2</code>  çš„è®°å½•æ˜¯æ‰€æœ‰è®°å½•ä¸­æœ€å°çš„ï¼Œ <code>record_type=3</code>  çš„è®°å½•æ˜¯æ‰€æœ‰è®°å½•ä¸­æœ€å¤§çš„ã€‚è¿™ä¸¤ä¸ªè®°å½•å®é™…ä¸å­˜å‚¨ä»»ä½•çœŸå®æ•°æ®ï¼Œä½†æ˜¯å®ƒä»¬åˆ†åˆ«æ˜¯è®°å½•é“¾è¡¨ä¸­çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œéå¸¸é‡è¦ã€‚ <code>record_type=1</code>  æš‚æ—¶ä¸éœ€è¦çŸ¥é“ã€‚ä¹‹åä¼šè®²è§£</li>\n</ul>\n<h3 id=\"è®°å½•çš„çœŸå®æ•°æ®\"><a class=\"anchor\" href=\"#è®°å½•çš„çœŸå®æ•°æ®\">#</a> è®°å½•çš„çœŸå®æ•°æ®</h3>\n<p>æˆ‘éœ€è¦æé†’ä¸€ä¸‹ï¼Œæ ‡é¢˜ä¸­çš„è®°å½•éƒ½æ˜¯åè¯ï¼Œä¸æ˜¯åŠ¨è¯ã€‚</p>\n<p>å¯¹äºè¡¨æ¥è¯´ï¼Œè®°å½•çš„çœŸå®æ•°æ®é™¤äº†æˆ‘ä»¬è‡ªå·±è®¾å®šçš„æ•°æ®ï¼ˆæ¯”å¦‚ <code>name='cyan'</code>  ä¹‹ç±»çš„ï¼‰ï¼ŒMySQL è¿˜ä¼šä¸ºæ¯ä¸ªè®°å½•é»˜è®¤åœ°æ·»åŠ ä¸€äº›åˆ— (ä¹Ÿç§°ä¸º<strong>éšè—åˆ—</strong>)ã€‚</p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\tMySQL ä¸ºæ¯ä¸ªè®°å½•é»˜è®¤æ·»åŠ çš„åˆ—</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">åˆ—å</th>\n<th style=\"text-align:center\">æ˜¯å¦å¿…éœ€</th>\n<th style=\"text-align:center\">å ç”¨ç©ºé—´</th>\n<th style=\"text-align:center\">æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">row_id</td>\n<td style=\"text-align:center\">éå¿…éœ€</td>\n<td style=\"text-align:center\">6 å­—èŠ‚</td>\n<td style=\"text-align:center\">è¡Œ IDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">trx_id</td>\n<td style=\"text-align:center\">å¿…éœ€</td>\n<td style=\"text-align:center\">6 å­—èŠ‚</td>\n<td style=\"text-align:center\">äº‹åŠ¡ ID</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">roll_pointer</td>\n<td style=\"text-align:center\">å¿…éœ€</td>\n<td style=\"text-align:center\">7 å­—èŠ‚</td>\n<td style=\"text-align:center\">å›æ»šæŒ‡é’ˆï¼Œå½¢æˆç‰ˆæœ¬é“¾</td>\n</tr>\n</tbody>\n</table>\n<p>å…¶å®ä¸Šè¿°åˆ—åéƒ½æ˜¯å¤§å†™ï¼å¹¶ä¸”è¿™ä¸‰åˆ—æ•°æ®ä½äºé¢å¤–ä¿¡æ¯å’ŒçœŸå®æ•°æ®ä¸­é—´</p>\n<p>è§£é‡Šï¼š</p>\n<ul>\n<li>row_id æ˜¯å”¯ä¸€è¡¨ç¤ºä¸€æ¡è®°å½•ã€‚å¦‚æœåœ¨åˆ›å»ºè¡¨æ—¶æ²¡æœ‰æŒ‡å®šä¸»é”®æˆ–è€…æ²¡æœ‰<strong>ä¸èƒ½ä¸º NULL çš„å”¯ä¸€å±æ€§</strong>ï¼Œåæ­£å°±æ˜¯ï¼Œæ²¡æœ‰ä¸€ä¸ªå±æ€§èƒ½å¤Ÿå”¯ä¸€è¡¨ç¤ºä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆ row_id å°±ä¼šè¢«æ·»åŠ ã€‚</li>\n<li>trx_id ä¸äº‹åŠ¡æœ‰å…³ï¼Œæš‚æ—¶ä¸éœ€è¦äº†è§£</li>\n<li>roll_pointer æ˜¯å›æ»šæŒ‡é’ˆï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œè¿™é‡Œä¸é‚£ä¹ˆå‡†ç¡®çš„è®²ï¼ŒMySQL æ”¯æŒå›æ»šæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ”¹åŠ¨ä¸€æ¡è®°å½•åï¼Œå¦‚æœæƒ³è¦å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œå°±éœ€è¦ä¿å­˜ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œé‚£ä¹ˆ roll_pointer å°±æ˜¯æŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆæ”¹åŠ¨å‰ï¼‰çš„å†…å­˜ã€‚</li>\n</ul>\n<h1 id=\"å¼•ç”¨\"><a class=\"anchor\" href=\"#å¼•ç”¨\">#</a> å¼•ç”¨</h1>\n<blockquote>\n<p>æœ¬æ–‡æ€»ç»“äºã€Šä»æ ¹ä¸Šç†è§£ MySQLã€‹ç¬¬å››ç«  p55-p63ï¼Œä½œè€…ï¼šå°å­©å­ 4919ã€‚å¯¹äºæœ‰èƒ½åŠ›æˆ–è€…å…´è¶£çš„è¯»è€…ï¼Œé„™äººå¼ºçƒˆæ¨èè¿™æœ¬ä¹¦ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿé€šè¿‡æ­£è§„æ¸ é“è´­ä¹°ï¼Œæ”¯æŒä½œè€…ï¼Œæ”¯æŒæ­£ç‰ˆï¼Œæ”¯æŒæ¯ä¸€é¢—çƒ­çˆ±æŠ€æœ¯çš„å¿ƒï¼Œæˆ‘å°†æ„Ÿæ¿€ä¸å°½ã€‚</p>\n</blockquote>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/24/Database/MySQL/%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E6%AF%94%E8%BE%83%E8%A7%84%E5%88%99/",
            "url": "https://cecilia.cool/2022/07/24/Database/MySQL/%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E6%AF%94%E8%BE%83%E8%A7%84%E5%88%99/",
            "title": "å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™",
            "date_published": "2022-07-24T08:13:45.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p>è®¡ç®—æœºä¸­å­˜å‚¨çš„å®é™…ä¸Šæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œæƒ³è¦å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå°±è¦å»ºç«‹å­—ç¬¦ä¸äºŒè¿›åˆ¶æ•°æ®çš„æ˜ å°„å…³ç³»ã€‚å°†å­—ç¬¦æ˜ å°„ä¸ºäºŒè¿›åˆ¶æ•°æ®çš„è¿‡ç¨‹å«åš<strong>ç¼–ç </strong>ï¼Œå°†äºŒè¿›åˆ¶æ•°æ®æ˜ å°„ä¸ºå­—ç¬¦çš„è¿‡ç¨‹å°±æ˜¯<strong>è§£ç </strong>ã€‚</p>\n<p>ä¸ºäº†å®¹æ˜“è®°å¿†ï¼Œä½ éœ€è¦çŸ¥é“ï¼Œè§£ç å°±æ˜¯æŠŠçœ‹ä¸æ‡‚çš„æ•°æ®ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰è§£æä¸ºçœ‹å¾—æ‡‚çš„æ•°æ®ï¼ˆå­—ç¬¦ï¼‰ã€‚</p>\n<p>å› ä¸ºæ¯ä¸ªå­—ç¬¦å®é™…ä¸Šæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯å¯ä»¥æ¯”è¾ƒå¤§å°çš„ï¼Œç”±æ­¤è¡ç”Ÿå‡ºæ¯”è¾ƒè§„åˆ™ã€‚ä»¥æœ€ç»å…¸çš„ ASCII å­—ç¬¦é›†ä¸ºä¾‹ï¼Œè¯¥å­—ç¬¦é›†ä¸€å…±æ”¶å½•<strong> 128 ä¸ªå­—ç¬¦</strong>ï¼Œ<strong>æ¯ä¸ªå­—ç¬¦ç”±ä¸€ä¸ªå­—èŠ‚ä¿å­˜</strong>ã€‚å­—ç¬¦<strong> a</strong> çš„äºŒè¿›åˆ¶ç¼–ç ä¸º <code>1100001</code> ï¼Œå­—ç¬¦<strong> b</strong> çš„äºŒè¿›åˆ¶ç¼–ç ä¸º <code>1100010</code> ï¼Œé€šè¿‡æ¯”è¾ƒå°±å¯ä»¥çœ‹å‡º <code>a&gt;b</code> ã€‚</p>\n<p>éœ€è¦è®°ä½å‡ ç§é‡è¦çš„å­—ç¬¦é›†ï¼š</p>\n<ul>\n<li>GBK å­—ç¬¦é›†ï¼šåœ¨å­—ç¬¦èŒƒå›´ä¸Šå¯¹ GB2312 å­—ç¬¦é›†è¿›è¡Œæ‰©å……ï¼Œç¼–ç æ–¹å¼å…¼å®¹ GB2312 å­—ç¬¦é›†ã€‚è®°ä½å…¶åº”ç”¨å¹¿æ³›å³å¯</li>\n<li>UTF-8 å­—ç¬¦é›†ï¼šå‡ ä¹æ”¶å½•å„å›½ï¼ˆåœ°åŒºï¼‰ä½¿ç”¨çš„å­—ç¬¦ï¼Œå¹¶ä¸”åœ¨ä¸æ–­æ‰©å……ã€‚ä½¿ç”¨å˜é•¿ç¼–ç æ–¹å¼ï¼Œä¸€ä¸ªå­—ç¬¦éœ€è¦ä½¿ç”¨ 1~4 ä¸ªå­—èŠ‚</li>\n</ul>\n<p>å…¶å® UTF-8 åªæ˜¯ Unicode å­—ç¬¦é›†çš„ä¸€ç§<strong>ç¼–ç æ–¹æ¡ˆ</strong>ï¼Œå…¶ä»–çš„è¿˜æœ‰ UTF-16ï¼ˆ2 æˆ– 4 å­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼ŒUTF-32ï¼ˆ4 å­—èŠ‚ï¼‰ã€‚</p>\n<h1 id=\"mysqlæ”¯æŒçš„å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™\"><a class=\"anchor\" href=\"#mysqlæ”¯æŒçš„å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™\">#</a> MySQL æ”¯æŒçš„å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™</h1>\n<h2 id=\"utf8mb3å’Œutf8mb4\"><a class=\"anchor\" href=\"#utf8mb3å’Œutf8mb4\">#</a> utf8mb3 å’Œ utf8mb4</h2>\n<p>æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸€èˆ¬ç”¨ 1~3 ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºï¼Œåœ¨ MySQL ä¸­ï¼Œ<strong>å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ‰€ç”¨çš„æœ€å¤§å­—èŠ‚æ•°ä¼šå½±å“ç³»ç»Ÿå­˜å‚¨å’Œæ€§èƒ½</strong>ï¼ˆæ¯”å¦‚ä¸€æ¡è®°å½•ä¸­å˜é•¿æ•°æ®çš„å­˜å‚¨ï¼Œä¹‹åçš„æ–‡ç« ä¼šè®²åˆ°ï¼‰ã€‚</p>\n<p>æ€»ä¹‹ï¼Œä½ éœ€è¦è®°ä½çš„æ˜¯ UTF-8 ä½¿ç”¨ 1-4 ä¸ªå­—èŠ‚å­˜å‚¨æ–¹å¼æœ‰ç‚¹æµªè´¹ï¼Œæ‰€ä»¥å°±æœ‰äº† utf8mb3ã€‚</p>\n<ul>\n<li>utf8mb3ï¼šé˜‰å‰²ç‰ˆçš„ UTF-8 å­—ç¬¦é›†ï¼Œä½¿ç”¨ 1~3 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚</li>\n<li>utf8mb4ï¼šå°±æ˜¯ UTF-8 å­—ç¬¦é›†ï¼Œä½¿ç”¨ 1~4 ä¸ªå­—èŠ‚ã€‚</li>\n</ul>\n<p>åœ¨ MySQL ä¸­ï¼Œ<strong>utf8 æ˜¯ utf8mb3 çš„åˆ«å</strong>ã€‚åŒæ—¶ï¼Œåœ¨ MySQL8.0 ä¸­ï¼Œutf8mb4 è¢«æå¤§ä¼˜åŒ–ï¼Œæˆä¸ºäº†é»˜è®¤çš„å­—ç¬¦é›†ã€‚</p>\n<h2 id=\"å­—ç¬¦é›†çš„æŸ¥çœ‹\"><a class=\"anchor\" href=\"#å­—ç¬¦é›†çš„æŸ¥çœ‹\">#</a> å­—ç¬¦é›†çš„æŸ¥çœ‹</h2>\n<pre><code class=\"language-mysql\">mysql&gt; show charset;\n+----------+---------------------------------+---------------------+--------+\n| Charset  | Description                     | Default collation   | Maxlen |\n+----------+---------------------------------+---------------------+--------+\n| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |\n| dec8     | DEC West European               | dec8_swedish_ci     |      1 |\n| cp850    | DOS West European               | cp850_general_ci    |      1 |\n| hp8      | HP West European                | hp8_english_ci      |      1 |\n| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 |\n+----------+---------------------------------+---------------------+--------+\n</code></pre>\n<p>å‘½ä»¤  <code>show (character set | charset) [like åŒ¹é…æ¨¡å¼];</code>  ï¼ˆ <code>[]</code>  é‡Œçš„å†…å®¹å¯ä»¥çœç•¥ï¼‰</p>\n<p><code>Maxlen</code>  è¡¨ç¤ºè¯¥å­—ç¬¦é›†æœ€å¤šéœ€è¦å‡ ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚</p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>è¡¨ 1  å¸¸ç”¨å­—ç¬¦é›†ä¸ Maxlen</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Charset</th>\n<th style=\"text-align:center\">Maxlen</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">ascii</td>\n<td style=\"text-align:center\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">latin1</td>\n<td style=\"text-align:center\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">gb2312</td>\n<td style=\"text-align:center\">2</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">gbk</td>\n<td style=\"text-align:center\">2</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">utf8</td>\n<td style=\"text-align:center\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">utf8mb4</td>\n<td style=\"text-align:center\">4</td>\n</tr>\n</tbody>\n</table>\n<p><code>Default collation</code>  è¡¨ç¤ºé»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ï¼Œ<strong>ä¸€ä¸ªå­—ç¬¦é›†å¯èƒ½å¯¹åº”å¤šç§æ¯”è¾ƒè§„åˆ™</strong>ã€‚</p>\n<pre><code class=\"language-mysql\">mysql&gt; show collation like 'utf8\\_%';\n+--------------------------+---------+-----+---------+----------+---------+\n| Collation                | Charset | Id  | Default | Compiled | Sortlen |\n+--------------------------+---------+-----+---------+----------+---------+\n| utf8_general_ci          | utf8    |  33 | Yes     | Yes      |       1 |\n| utf8_bin                 | utf8    |  83 |         | Yes      |       1 |\n| utf8_unicode_ci          | utf8    | 192 |         | Yes      |       8 |\n| utf8_icelandic_ci        | utf8    | 193 |         | Yes      |       8 |\n| utf8_latvian_ci          | utf8    | 194 |         | Yes      |       8 |\n| utf8_romanian_ci         | utf8    | 195 |         | Yes      |       8 |\n| utf8_slovenian_ci        | utf8    | 196 |         | Yes      |       8 |\n| utf8_polish_ci           | utf8    | 197 |         | Yes      |       8 |\n| utf8_estonian_ci         | utf8    | 198 |         | Yes      |       8 |\n| utf8_spanish_ci          | utf8    | 199 |         | Yes      |       8 |\n| utf8_swedish_ci          | utf8    | 200 |         | Yes      |       8 |\n| utf8_turkish_ci          | utf8    | 201 |         | Yes      |       8 |\n| utf8_czech_ci            | utf8    | 202 |         | Yes      |       8 |\n| utf8_danish_ci           | utf8    | 203 |         | Yes      |       8 |\n| utf8_lithuanian_ci       | utf8    | 204 |         | Yes      |       8 |\n| utf8_slovak_ci           | utf8    | 205 |         | Yes      |       8 |\n| utf8_spanish2_ci         | utf8    | 206 |         | Yes      |       8 |\n| utf8_roman_ci            | utf8    | 207 |         | Yes      |       8 |\n| utf8_persian_ci          | utf8    | 208 |         | Yes      |       8 |\n| utf8_esperanto_ci        | utf8    | 209 |         | Yes      |       8 |\n| utf8_hungarian_ci        | utf8    | 210 |         | Yes      |       8 |\n| utf8_sinhala_ci          | utf8    | 211 |         | Yes      |       8 |\n| utf8_german2_ci          | utf8    | 212 |         | Yes      |       8 |\n| utf8_croatian_ci         | utf8    | 213 |         | Yes      |       8 |\n| utf8_unicode_520_ci      | utf8    | 214 |         | Yes      |       8 |\n| utf8_vietnamese_ci       | utf8    | 215 |         | Yes      |       8 |\n| utf8_general_mysql500_ci | utf8    | 223 |         | Yes      |       1 |\n+--------------------------+---------+-----+---------+----------+---------+\n27 rows in set (0.00 sec)\n</code></pre>\n<p>å‘½ä»¤ï¼š <code>show collation [like åŒ¹é…æ¨¡å¼];</code></p>\n<p>ä»å‘½åä¸­å¯ä»¥çœ‹å‡ºæœ‰äº›ä¸åœ°åŸŸæœ‰å…³ç³»ï¼Œå¦‚ <code>utf8_spanish_ci</code>  æ˜¯è¥¿ç­ç‰™è¯­çš„æ¯”è¾ƒè§„åˆ™ï¼Œ <code>utf8_polish_ci</code>  åˆ™æ˜¯æ³¢å…°è¯­çš„æ¯”è¾ƒè§„åˆ™ã€‚</p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>è¡¨ 2  æ¯”è¾ƒè§„åˆ™åç¼€è‹±æ–‡é‡Šä¹‰åŠæè¿°</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">åç¼€</th>\n<th style=\"text-align:center\">è‹±æ–‡é‡Šä¹‰</th>\n<th style=\"text-align:center\">æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">_ai</td>\n<td style=\"text-align:center\">accent insensitive</td>\n<td style=\"text-align:center\">ä¸åŒºåˆ†é‡éŸ³</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">_as</td>\n<td style=\"text-align:center\">accent sensitive</td>\n<td style=\"text-align:center\">åŒºåˆ†é‡éŸ³</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">_ci</td>\n<td style=\"text-align:center\">case insensitive</td>\n<td style=\"text-align:center\">ä¸åŒºåˆ†å¤§å°å†™</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">_cs</td>\n<td style=\"text-align:center\">case (å¤§å°å†™) sensitive</td>\n<td style=\"text-align:center\">åŒºåˆ†å¤§å°å†™</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">_bin</td>\n<td style=\"text-align:center\">binary</td>\n<td style=\"text-align:center\">ä»¥äºŒè¿›åˆ¶æ–¹å¼æ¯”è¾ƒ</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"åº”ç”¨\"><a class=\"anchor\" href=\"#åº”ç”¨\">#</a> åº”ç”¨</h1>\n<p>MySQL æœ‰å››ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ†åˆ«æ˜¯æœåŠ¡å™¨çº§åˆ«ï¼Œæ•°æ®åº“çº§åˆ«ï¼Œè¡¨çº§åˆ«ï¼Œåˆ—çº§åˆ«ã€‚ä¸‹é¢è§£é‡Šå¦‚ä½•è®¾ç½®å’ŒæŸ¥çœ‹ä¸åŒçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p>\n<h3 id=\"æœåŠ¡å™¨çº§åˆ«\"><a class=\"anchor\" href=\"#æœåŠ¡å™¨çº§åˆ«\">#</a> æœåŠ¡å™¨çº§åˆ«</h3>\n<p>MySQL æä¾›ä¸¤ä¸ªå˜é‡æ¥è¡¨ç¤ºæœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>è¡¨ 3  æœåŠ¡å™¨å¯¹åº”çš„ç³»ç»Ÿå˜é‡</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">ç³»ç»Ÿå˜é‡</th>\n<th style=\"text-align:center\">æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">character_set_server</td>\n<td style=\"text-align:center\">æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">collation_server</td>\n<td style=\"text-align:center\">æœåŠ¡å™¨çº§åˆ«çš„æ¯”è¾ƒè§„åˆ™</td>\n</tr>\n</tbody>\n</table>\n<p>ç›¸å…³å‘½ä»¤</p>\n<pre><code class=\"language-mysql\">mysql&gt; show variables like '%_server';\n+----------------------+-------------------+\n| Variable_name        | Value             |\n+----------------------+-------------------+\n| character_set_server | latin1            |\n| collation_server     | latin1_swedish_ci |\n+----------------------+-------------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre>\n<p>å¦‚æœæƒ³è¦ä¿®æ”¹è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡ï¼Œéœ€è¦é€šè¿‡å¯åŠ¨é€‰é¡¹æˆ–è€…ä½¿ç”¨ set è¯­å¥ä¿®æ”¹  <code>set global/session varName = value</code> ï¼ˆå¦‚æœçœ‹ä¸æ‡‚å‘½ä»¤ï¼Œä¹‹åçš„æ–‡ç« ä¼šæåˆ° <code>global/session</code> ï¼‰</p>\n<h3 id=\"æ•°æ®åº“çº§åˆ«\"><a class=\"anchor\" href=\"#æ•°æ®åº“çº§åˆ«\">#</a> æ•°æ®åº“çº§åˆ«</h3>\n<p>å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™åœ¨åˆ›å»ºå’Œä¿®æ”¹æ•°æ®åº“æ—¶å¯ä»¥æŒ‡å®šè¯¥æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</p>\n<pre><code class=\"language-mysql\">create database æ•°æ®åº“å\n\t[[default] character set å­—ç¬¦é›†åç§°]\n\t[[default] collation æ¯”è¾ƒè§„åˆ™åç§°]\n\t\nalter database æ•°æ®åº“å\n\t[[default] character set å­—ç¬¦é›†åç§°]\n\t[[default] collation æ¯”è¾ƒè§„åˆ™åç§°]\n</code></pre>\n<p>æ•°æ®åº“çº§åˆ«ä¹Ÿæœ‰ä¸¤ä¸ªç³»ç»Ÿå˜é‡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>use</code>  è¯­å¥é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“æ—¶ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼å°±æ˜¯è¯¥æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚<strong>å¦‚æœæ²¡æœ‰é€‰æ‹©æ•°æ®åº“ï¼Œå®ƒä»¬çš„å€¼å’ŒæœåŠ¡å™¨çº§åˆ«çš„ç³»ç»Ÿå˜é‡å€¼ç›¸åŒ</strong>ã€‚</p>\n<p>â€‹\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>è¡¨ 4  æ•°æ®åº“å¯¹åº”çš„ç³»ç»Ÿå˜é‡</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">ç³»ç»Ÿå˜é‡</th>\n<th style=\"text-align:center\">æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">character_set_database</td>\n<td style=\"text-align:center\">å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">collation_databased</td>\n<td style=\"text-align:center\">å½“å‰æ•°æ®åº“çš„æ¯”è¾ƒè§„åˆ™</td>\n</tr>\n</tbody>\n</table>\n<p>æˆ‘ä»¬ä¸èƒ½é€šè¿‡ä¿®æ”¹è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡çš„å€¼æ¥æ”¹å˜å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p>\n<pre><code class=\"language-mysql\">mysql&gt; show variables like '%_server';\n+----------------------+-------------------+\n| Variable_name        | Value             |\n+----------------------+-------------------+\n| character_set_server | latin1            |\n| collation_server     | latin1_swedish_ci |\n+----------------------+-------------------+\n2 rows in set, 1 warning (0.00 sec)\n\nmysql&gt; create database test;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql&gt; use test;\nDatabase changed\n\nmysql&gt; show variables like '%_database';\n+------------------------+-------------------+\n| Variable_name          | Value             |\n+------------------------+-------------------+\n| character_set_database | latin1            |\n| collation_database     | latin1_swedish_ci |\n| skip_show_database     | OFF               |\n+------------------------+-------------------+\n3 rows in set, 1 warning (0.00 sec)\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ<strong>åœ¨åˆ›å»ºæ•°æ®åº“æ—¶æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå°±ä¼šä½¿ç”¨æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</strong>ã€‚</p>\n<h3 id=\"è¡¨çº§åˆ«\"><a class=\"anchor\" href=\"#è¡¨çº§åˆ«\">#</a> è¡¨çº§åˆ«</h3>\n<p>è¡¨çº§åˆ«å’Œæ•°æ®åº“çº§åˆ«å·®ä¸å¤šï¼Œéƒ½æ˜¯åœ¨åˆ›å»ºï¼Œä¿®æ”¹è¡¨æ—¶å¯ä»¥ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡æ˜å…¶å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå°±ä¼šä½¿ç”¨å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</p>\n<pre><code class=\"language-mysql\">create table t(\n\tcol varchar(10)\n) character set utf8,collate utf8_general_ci;\n\nalter table t character set utf8;\n</code></pre>\n<p>è¡¨æŸ¥çœ‹æ¯”è¾ƒè§„åˆ™</p>\n<pre><code class=\"language-mysql\"># ä½¿ç”¨\\Gæ˜¯å°†è¾“å‡ºç»“æœæ—‹è½¬90åº¦è¾“å‡ºï¼Œæ–¹ä¾¿è§‚çœ‹\nmysql&gt; show table status from test like 't' \\G;\n*************************** 1. row ***************************\n           Name: t\n         Engine: InnoDB\n        Version: 10\n     Row_format: Dynamic\n           Rows: 0\n Avg_row_length: 0\n    Data_length: 16384\nMax_data_length: 0\n   Index_length: 0\n      Data_free: 0\n Auto_increment: NULL\n    Create_time: 2022-07-24 17:44:59\n    Update_time: NULL\n     Check_time: NULL\n      Collation: utf8_general_ci #æ¯”è¾ƒè§„åˆ™\n       Checksum: NULL\n Create_options:\n        Comment:\n1 row in set (0.00 sec)\n\nERROR:\nNo query specified\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œè¡¨ <code>t</code>  çš„æ¯”è¾ƒè§„åˆ™ä¸º <code>utf8_general_ci</code> ï¼Œåˆ™å­—ç¬¦é›†ä¸º  <code>utf8</code> ï¼ˆä¸ºä»€ä¹ˆçŸ¥é“æ¯”è¾ƒè§„åˆ™ä¹‹åå°±çŸ¥é“äº†å­—ç¬¦é›†ï¼Œè¯·ç»§ç»­çœ‹ï¼‰ã€‚</p>\n<h3 id=\"åˆ—çº§åˆ«\"><a class=\"anchor\" href=\"#åˆ—çº§åˆ«\">#</a> åˆ—çº§åˆ«</h3>\n<p>åŒä¸€ä¸ªè¡¨ä¸­ï¼Œä¸åŒåˆ—ä¹Ÿå¯ä»¥æœ‰ä¸åŒçš„æ¯”è¾ƒè§„åˆ™ã€‚</p>\n<pre><code class=\"language-mysql\">create table è¡¨å(\n\tåˆ—å å­—ç¬¦ä¸²ç±»å‹ [character set å­—ç¬¦é›†åç§°] [collate æ¯”è¾ƒè§„åˆ™åç§°],\n    å…¶ä»–åˆ—....\n);\n\nalter table è¡¨å modify åˆ—å [character set å­—ç¬¦é›†åç§°] [collate æ¯”è¾ƒè§„åˆ™åç§°];\n</code></pre>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¯¹äºä»»ä½•ä¸€ä¸ªçº§åˆ«</strong>ï¼Œå­˜åœ¨ä¸¤æ¡ä¿®æ”¹è§„åˆ™ï¼š</p>\n<ul>\n<li>åªä¿®æ”¹å­—ç¬¦é›†ï¼Œåˆ™æ¯”è¾ƒè§„åˆ™å°†ä¼šå˜ä¸ºä¿®æ”¹åçš„å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ã€‚</li>\n<li>åªä¿®æ”¹æ¯”è¾ƒè§„åˆ™ï¼Œåˆ™å­—ç¬¦é›†ä¼šå˜ä¸ºæ¯”è¾ƒè§„åˆ™å¯¹åº”çš„å­—ç¬¦é›†ã€‚</li>\n</ul>\n<p>å¦‚æœæƒ³è¦åŒæ—¶ä¿®æ”¹å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œä»–ä»¬ä¸¤ä¸ªä¸€å®šè¦é€‚é…ï¼Œæ¯”å¦‚ä¸‹åˆ—å‘½ä»¤</p>\n<pre><code class=\"language-mysql\">mysql&gt; alter table t character set utf8 collate utf8mb4_general_ci;\nERROR 1253 (42000): COLLATION 'utf8mb4_general_ci' is not valid for CHARACTER SET 'utf8'\n</code></pre>\n<p>æŠ¥é”™ä¿¡æ¯ä¸ºæ¯”è¾ƒè§„åˆ™ <code>utf8mb4_general_ci</code>  å¯¹äºå­—ç¬¦é›† <code>utf8</code>  æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸€ä¸ªè¡¨çš„æ¯”è¾ƒè§„åˆ™ï¼Œä¸€èˆ¬ä¹Ÿå°±çŸ¥é“äº†å…¶å­—ç¬¦é›†ã€‚</p>\n<h1 id=\"å¼•ç”¨\"><a class=\"anchor\" href=\"#å¼•ç”¨\">#</a> å¼•ç”¨</h1>\n<blockquote>\n<p>æœ¬æ–‡æ€»ç»“äºã€Šä»æ ¹ä¸Šç†è§£ MySQLã€‹ç¬¬ä¸‰ç«  p32-p43ï¼Œä½œè€…ï¼šå°å­©å­ 4919ã€‚å¯¹äºæœ‰èƒ½åŠ›æˆ–è€…å…´è¶£çš„è¯»è€…ï¼Œé„™äººå¼ºçƒˆæ¨èè¿™æœ¬ä¹¦ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿé€šè¿‡æ­£è§„æ¸ é“è´­ä¹°ï¼Œæ”¯æŒä½œè€…ï¼Œæ”¯æŒæ­£ç‰ˆï¼Œæ”¯æŒæ¯ä¸€é¢—çƒ­çˆ±æŠ€æœ¯çš„å¿ƒï¼Œæˆ‘å°†æ„Ÿæ¿€ä¸å°½ã€‚</p>\n</blockquote>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/21/Java/%E5%B9%B6%E5%8F%91/JUC_locks1-LockSupport/",
            "url": "https://cecilia.cool/2022/07/21/Java/%E5%B9%B6%E5%8F%91/JUC_locks1-LockSupport/",
            "title": "J.U.C.locks(1)--LockSupport",
            "date_published": "2022-07-21T08:39:21.000Z",
            "content_html": "<h1 id=\"æºç åˆ†æ\"><a class=\"anchor\" href=\"#æºç åˆ†æ\">#</a> æºç åˆ†æ</h1>\n<h2 id=\"å®ä¾‹å­—æ®µ\"><a class=\"anchor\" href=\"#å®ä¾‹å­—æ®µ\">#</a> å®ä¾‹å­—æ®µ</h2>\n<p>é™æ€å˜é‡ä¿å­˜ Thread æŒ‡å®šçš„å­—æ®µçš„å†…å­˜åç§»é‡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LockSupport</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// Hotspot implementation via intrinsics API</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\"><span class=\"token namespace\">sun<span class=\"token punctuation\">.</span>misc<span class=\"token punctuation\">.</span></span>Unsafe</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// ä¸‹é¢å±æ€§éƒ½æ˜¯è·å–å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> parkBlockerOffset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">SEED</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">PROBE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">SECONDARY</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token constant\">UNSAFE</span> <span class=\"token operator\">=</span> <span class=\"token class-name\"><span class=\"token namespace\">sun<span class=\"token punctuation\">.</span>misc<span class=\"token punctuation\">.</span></span>Unsafe</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUnsafe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> tk <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\">// è·å– Thread çš„æŒ‡å®šå­—æ®µçš„å†…å­˜åç§»åœ°å€</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            parkBlockerOffset <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">(</span>tk<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"parkBlocker\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token constant\">SEED</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">(</span>tk<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"threadLocalRandomSeed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token constant\">PROBE</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">(</span>tk<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"threadLocalRandomProbe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token constant\">SECONDARY</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span>objectFieldOffset</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">(</span>tk<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"threadLocalRandomSecondarySeed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>LockSupport çš„æ„é€ æ–¹æ³•è¢« private ä¿®é¥°ï¼Œä¸èƒ½åœ¨å¤–éƒ¨å®ä¾‹åŒ–ã€‚</p>\n<h2 id=\"é‡è¦å‡½æ•°\"><a class=\"anchor\" href=\"#é‡è¦å‡½æ•°\">#</a> é‡è¦å‡½æ•°</h2>\n<h3 id=\"parkunpark\"><a class=\"anchor\" href=\"#parkunpark\">#</a> park/unpark</h3>\n<p>ä»æºç å¯çŸ¥ï¼ŒLockSupport çš„ park å’Œ unpark éƒ½æ˜¯åŸºäº sun.misc.Unsafe å®ç°ï¼Œsun.misc.Unsafe å¯¹äºè¿™ä¸¤ä¸ªå‡½æ•°ç›¸å…³çš„å®šä¹‰ä¸º</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">void</span> <span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> isAbsolute<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">native</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unpark</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>park ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•° isAbsoluteï¼Œè¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»å¯¹æ—¶é—´ï¼ˆisAbsolute==trueï¼‰è¿˜æ˜¯ç›¸å¯¹æ—¶é—´ï¼ˆfalseï¼‰ï¼Œç»å¯¹æ—¶é—´çš„å•ä½æ˜¯æ¯«ç§’ï¼Œç›¸å¯¹æ—¶é—´çš„å•ä½æ˜¯çº³ç§’ï¼Œå…¶æœ¬è´¨éƒ½æ˜¯ä¼ å…¥ä¸€ä¸ª long çš„å­—æ®µã€‚</p>\n<p>ç®€å•åœ°è¯´ï¼Œpark çš„ä½œç”¨å°±æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“ time æ˜¯ 0 æ—¶ï¼Œå°±æ˜¯æ— é™ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ unparkã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">NoSuchFieldException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IllegalAccessException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">//Unsafe æ„é€ æ–¹æ³•ç§æœ‰ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œé€šè¿‡åå°„è·å¾—å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Field</span> f <span class=\"token operator\">=</span> <span class=\"token class-name\">Unsafe</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaredField</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"theUnsafe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessible</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Unsafe</span> unsafe <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Unsafe</span><span class=\"token punctuation\">)</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ç»å¯¹æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       <span class=\"token class-name\">Thread</span> t1 <span class=\"token operator\">=</span>  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"parkç»å¯¹æ—¶é—´æµ‹è¯•ï¼Œå•ä½æ¯«ç§’\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            unsafe<span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç»å¯¹æ—¶é—´æµ‹è¯•ç»“æŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"parkç›¸å¯¹æ—¶é—´æµ‹è¯•ï¼Œå•ä½çº³ç§’\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            unsafe<span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token number\">300000000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç›¸å¯¹æ—¶é—´æµ‹è¯•ç»“æŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        t1<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        t2<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>park</code>  å‡½æ•°æœ‰ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> blocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> blocker<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// è·å–å½“å‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½® Blocker</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">setBlocker</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> blocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// è·å–è®¸å¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// é‡æ–°å¯è¿è¡Œåå†æ­¤è®¾ç½® Blocker</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">setBlocker</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setBlocker</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> t<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// è®¾ç½®çº¿ç¨‹ t çš„ parkBlocker å­—æ®µçš„å€¼ä¸º arg</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token constant\">UNSAFE</span><span class=\"token punctuation\">.</span><span class=\"token function\">putObject</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> parkBlockerOffset<span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡ <code>setBlocker</code>  æ—¶ï¼Œæ˜¯å…¶ä»–çº¿ç¨‹è°ƒç”¨äº† <code>unpark</code>  åï¼Œè¯¥çº¿ç¨‹ä» <code>park</code>  ä¸­æ¢å¤ï¼Œå°†çº¿ç¨‹ä¸­çš„ <code>parkBlocker</code>  å­—æ®µé‡æ–°ç½®ä¸º <code>null</code> ã€‚åœ¨ <code>setBlocker</code>  ä¸­ï¼Œä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ <code>LockSupport</code>  é™æ€ä»£ç å—ä¸­ï¼Œé€šè¿‡ <code>Unsafe</code>  è·å¾—çš„ <code>parkBlocker</code>  åœ¨ <code>Thread</code>  ä¸­çš„åœ°å€åç§»é‡ã€‚</p>\n<p><code>LockSupport</code>  è¿˜æœ‰å…¶ä»–å‡½æ•°ï¼Œæ­¤å¤„ç¨å¾®åˆ—ä¸¾ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">parkNanos</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> blocker<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> nanos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">parkUntil</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> blocker<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> deadline<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"åŸºæœ¬ä½¿ç”¨\"><a class=\"anchor\" href=\"#åŸºæœ¬ä½¿ç”¨\">#</a> åŸºæœ¬ä½¿ç”¨</h1>\n<p><code>LockSupport.park()</code>  å’Œ <code>LockSupport.unpark()</code>  ç”¨äºæŒ‡å®šçº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>locks<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LockSupport</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mainçº¿ç¨‹\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Thread</span> t <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹å¼€å§‹è¿è¡Œ...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">park</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// çº¿ç¨‹è¿›å…¥é˜»å¡</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çº¿ç¨‹é˜»å¡ç»“æŸ...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        t<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tçº¿ç¨‹\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        t<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸»çº¿ç¨‹å…ˆä¼‘çœ ä¸¤ç§’ï¼Œä¿è¯å¦ä¸€ä¸ªçº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œ LockSupport.park ()</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">LockSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">unpark</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ <code>main</code>  å‡½æ•°ä¸­çš„ <code>LockSupport.unpark()</code>  ä¸€è¡Œä»£ç æ‰“æ–­ç‚¹ï¼Œé€‰æ‹©ä¸‹æ çš„ Debug-&gt;Layout setting-&gt;Frames æŸ¥çœ‹ t çº¿ç¨‹çš„çŠ¶æ€ï¼ˆWAITï¼‰</p>\n<p><img data-src=\"https://s3.bmp.ovh/imgs/2022/07/24/576db05114ca5c7d.png\" alt=\"image-20220724125734871\" /></p>\n<h1 id=\"æ·±å…¥ç†è§£\"><a class=\"anchor\" href=\"#æ·±å…¥ç†è§£\">#</a> æ·±å…¥ç†è§£</h1>\n<h2 id=\"objectwaitå’Œconditionawaitçš„åŒºåˆ«\"><a class=\"anchor\" href=\"#objectwaitå’Œconditionawaitçš„åŒºåˆ«\">#</a> Object.wait () å’Œ Condition.await () çš„åŒºåˆ«</h2>\n<p><code>Object.wait()</code>  å’Œ <code>Condition.await()</code>  çš„åŸç†æ˜¯åŸºæœ¬ä¸€è‡´çš„ï¼Œä¸åŒçš„æ˜¯ <code>Condition.await()</code>  åº•å±‚æ˜¯è°ƒç”¨ <code>LockSupport.park()</code>  æ¥å®ç°é˜»å¡å½“å‰çº¿ç¨‹çš„ã€‚</p>\n<p>å®é™…ä¸Šï¼Œå®ƒåœ¨é˜»å¡å½“å‰çº¿ç¨‹ä¹‹å‰è¿˜å¹²äº†ä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯æŠŠå½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼ŒäºŒæ˜¯ â€œå®Œå…¨â€ é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ˜¯è®© <code>state</code>  çŠ¶æ€å˜é‡å˜ä¸º 0ï¼Œç„¶åæ‰æ˜¯è°ƒç”¨ <code>LockSupport.park()</code>  é˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>\n<h2 id=\"å…³äºparkçš„ç‚¹\"><a class=\"anchor\" href=\"#å…³äºparkçš„ç‚¹\">#</a> å…³äº park çš„ç‚¹</h2>\n<ul>\n<li><code>park</code>  ä¸ä¼šé‡Šæ”¾é”èµ„æºã€‚</li>\n<li><code>park</code>  å¯ä»¥è¢« <code>interrupt</code>  æ‰“æ–­ï¼Œä½†æ˜¯ä¸éœ€è¦å¤„ç† <code>InterruptedException</code>  å¼‚å¸¸ã€‚</li>\n<li><code>LockSupport.park()</code>  åº•å±‚æ˜¯è°ƒç”¨çš„ <code>Unsafe</code>  çš„ <code>native</code>  æ–¹æ³•ã€‚</li>\n</ul>\n<h1 id=\"å‚è€ƒæ–‡ç« \"><a class=\"anchor\" href=\"#å‚è€ƒæ–‡ç« \">#</a> å‚è€ƒæ–‡ç« </h1>\n<blockquote>\n<p>Java å…¨æ ˆçŸ¥è¯†ä½“ç³»ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZGFpLnRlY2gvbWQvamF2YS90aHJlYWQvamF2YS10aHJlYWQteC1sb2NrLUxvY2tTdXBwb3J0Lmh0bWw=\">https://pdai.tech/md/java/thread/java-thread-x-lock-LockSupport.html</span></p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        },
        {
            "id": "https://cecilia.cool/2022/07/21/Java/%E5%B9%B6%E5%8F%91/Java%E5%85%B3%E9%94%AE%E5%AD%97-synchronized/",
            "url": "https://cecilia.cool/2022/07/21/Java/%E5%B9%B6%E5%8F%91/Java%E5%85%B3%E9%94%AE%E5%AD%97-synchronized/",
            "title": "Javaå…³é”®å­—--synchronized",
            "date_published": "2022-07-21T08:10:35.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<p><code>synchronized</code>  å…³é”®å­—æ˜¯ <code>JVM</code>  å®ç°çš„ï¼Œåªèƒ½æ˜¯éå…¬å¹³é”ã€‚åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªçº¿ç¨‹æˆ–è€…å…¨éƒ¨å”¤é†’ã€‚æ­¤å¤„å¯ä»¥å¯¹æ¯” <code>Conditon</code> ï¼Œåœ¨åŸºäº <code>AQS</code>  çš„åŒæ­¥å™¨å¯ä»¥å”¤é†’ç­‰å¾…é˜Ÿåˆ—é˜Ÿé¦–çš„çº¿ç¨‹ã€‚</p>\n<p><code>synchronized</code>  çš„ä¼˜åŠ¿</p>\n<ul>\n<li>ä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œ <code>JVM</code>  è‡ªåŠ¨å¤„ç†ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œ <code>JVM</code>  ä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚</li>\n<li><code>JVM</code>  ç”¨ <code>synchronized</code>  è¿›è¡Œç®¡ç†é”å®šè¯·æ±‚å’Œé‡Šæ”¾æ—¶ï¼Œ <code>JVM</code>  åœ¨ç”Ÿæˆçº¿ç¨‹è½¬å‚¨æ—¶èƒ½å¤Ÿé”å®šä¿¡æ¯ï¼Œè¿™äº›å¯¹è°ƒè¯•éå¸¸æœ‰ä»·å€¼ï¼Œå› ä¸ºå®ƒä»¬èƒ½ æ ‡è¯†æ­»é”æˆ–è€…å…¶ä»–å¼‚å¸¸è¡Œä¸ºçš„æ¥æºã€‚è€Œ <code>ReentrantLock</code>  åªæ˜¯æ™®é€šçš„ç±»ï¼Œ <code>JVM</code>  ä¸çŸ¥é“å…·ä½“å“ªä¸ªçº¿ç¨‹æ‹¥æœ‰ <code>lock</code>  å¯¹è±¡ã€‚</li>\n<li><code>synchronized</code>  å¯ä»¥åœ¨æ‰€æœ‰ <code>JVM</code>  ç‰ˆæœ¬ä¸­å·¥ä½œï¼Œ <code>ReentrantLock</code>  åœ¨æŸäº› 1.5 ä¹‹å‰ç‰ˆæœ¬çš„ <code>JVM</code>  ä¸­å¯èƒ½ä¸æ”¯æŒã€‚</li>\n</ul>\n<p>ä¸‹é¢çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä½¿ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token punctuation\">&#123;</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count = \"</span><span class=\"token operator\">+</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">synchronized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Main</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h1>\n<blockquote>\n<p>å†°æ²³ã€Šæ·±å…¥ç†è§£é«˜å¹¶å‘ç¼–ç¨‹ã€‹ç¬¬ä¸€ç‰ˆ</p>\n</blockquote>\n",
            "tags": [
                "å¹¶å‘"
            ]
        }
    ]
}